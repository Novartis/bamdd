<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yingying Wang - yingying.wang@novartis.com">
<meta name="author" content="Sebastian Weber - sebastian.weber@novartis.com">

<title>7&nbsp; Use of historical control data with a covariate – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/02k_nuisance.html" rel="next">
<link href="../src/02ac_meta_analysis_strata.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-211643d51178a3b3a2246e12448a6b35.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02ad_meta_analysis_covariate.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Use of historical control data with a covariate</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ad_meta_analysis_covariate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Use of historical control data with a covariate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02m_proportion_difference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">configure here</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">7.1</span> Background</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">7.2</span> Data</a></li>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description"><span class="header-section-number">7.3</span> Model description</a>
  <ul class="collapse">
  <li><a href="#trial-analysis-model" id="toc-trial-analysis-model" class="nav-link" data-scroll-target="#trial-analysis-model"><span class="header-section-number">7.3.1</span> Trial analysis model</a></li>
  <li><a href="#historical-control-data-synthesis" id="toc-historical-control-data-synthesis" class="nav-link" data-scroll-target="#historical-control-data-synthesis"><span class="header-section-number">7.3.2</span> Historical control data synthesis</a></li>
  <li><a href="#sec-model-partial" id="toc-sec-model-partial" class="nav-link" data-scroll-target="#sec-model-partial"><span class="header-section-number">7.3.3</span> Modelling explicitly the sum of two binomials (advanced)</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">7.4</span> Implementation</a>
  <ul class="collapse">
  <li><a href="#sec-impl-complete-only" id="toc-sec-impl-complete-only" class="nav-link" data-scroll-target="#sec-impl-complete-only"><span class="header-section-number">7.4.1</span> MAP prior for complete historical data only</a></li>
  <li><a href="#map-prior-for-complete-and-partial-historical-data-advanced" id="toc-map-prior-for-complete-and-partial-historical-data-advanced" class="nav-link" data-scroll-target="#map-prior-for-complete-and-partial-historical-data-advanced"><span class="header-section-number">7.4.2</span> MAP prior for complete and partial historical data (advanced)</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">7.5</span> Results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7.6</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.7</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02ad_meta_analysis_covariate.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Use of historical control data with a covariate</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-use-hist-control-data-cov" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Use of historical control data with a covariate</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Yingying Wang - <a href="mailto:yingying.wang@novartis.com" class="email">yingying.wang@novartis.com</a> </p>
             <p>Sebastian Weber - <a href="mailto:sebastian.weber@novartis.com" class="email">sebastian.weber@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<!-- https://raw.githubusercontent.com/Novartis/bamdd/main/src/_macros.qmd -->
<p>The use of baseline covariates for trial analysis is frequently applied in practice whenever known prognostic factors are relevant in the context of the study population. This can complicate the use of historical control information in particular for a non-normal endpoint for which the respective generalized linear models are often not collapsible. This case study demonstrates</p>
<ul>
<li>setting up a bi-variate meta-analysis for a binary endpoint to borrow information on the intercept and a baseline covariate effect from historical data</li>
<li>how we can make use of incomplete responder data as one often encounters in practice (responder data not given for each level of a categorical covariate)</li>
<li>how two different likelihoods can be used with custom Stan code adapting the <code>brms</code> generated Stan model</li>
<li>how to summarize with a multi-variate normal mixture the MAP prior with covariates</li>
<li>how to use the multi-variate normal mixture MAP prior as a prior for the main analysis using <code>brms</code></li>
</ul>
<p>To run the R code of this section please ensure to load these libraries and options first:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RBesT)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/02ad_meta_analysis_covariate.qmd"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="dv">12</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">57339</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># allow for wider and prettier printing</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">140</span>, <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make brms less verbose</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.short_summary =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="background" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="background"><span class="header-section-number">7.1</span> Background</h2>
<p>Atopic dermatitis (AD) is an inflammation of the skin. It’s prevalence is substantial in the population and various treatments have been studied to date. Therefore, a substantial amount of data has been generated to date on experimental treatments for AD and along with it on placebo treated patient data. Given that treatment procedures are well standardized the historical data on placebo treatments is relevant for future trials in the indication.</p>
<p>One of the standard clinical endpoints is the investigator global assessment (IGA) score which ranges from 0 (clear) to 4 (severe). Changes in this score over a time-span of 16 weeks compared to baseline when treatment is initiated is used to evaluate the efficacy of treatments. Derived from the IGA score one often considers the binary IGA response status defined as an improvement of at least 2 points and reaching either 0 or 1 (clear or almost clear) IGA score. By construction of the score the initial status at baseline being moderate or severe is a prognostic factor for reaching IGA response by week 16 or not as it is harder to reach response whenever one has baseline score 4 (severe) at baseline in comparison to score 3 (moderate).</p>
<p>As a consequence, patients are often stratified by baseline response score into moderate and severe for trials studying this population. While most trials report the baseline distribution of the number of moderate and severe patients, only a fraction of trials report the outcome responder data stratified by baseline response data, which is a complication for using this historical data whenever one wishes to leverage the historical data.</p>
<p>In the following we illustrate how an informative MAP prior is derived in such a situation. Historical data on a placebo treatment for use in a future trial is used as we are aiming to reduce the required sample size in the placebo arm while maintaining appropiate power to detect a treatment effect in a two arm trial.</p>
</section>
<section id="data" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="data"><span class="header-section-number">7.2</span> Data</h2>
<p>We consider the planning stage of a potential new trial in the indication of AD. Let’s assume that an initial search for relevant historical control data in the literature lead to the following set of identified historical trials:</p>
<div class="cell">
<div class="cell-output-display">
<div id="dyddzkmqts" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dyddzkmqts table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dyddzkmqts thead, #dyddzkmqts tbody, #dyddzkmqts tfoot, #dyddzkmqts tr, #dyddzkmqts td, #dyddzkmqts th {
  border-style: none;
}

#dyddzkmqts p {
  margin: 0;
  padding: 0;
}

#dyddzkmqts .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dyddzkmqts .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dyddzkmqts .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dyddzkmqts .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dyddzkmqts .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dyddzkmqts .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dyddzkmqts .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dyddzkmqts .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dyddzkmqts .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dyddzkmqts .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dyddzkmqts .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dyddzkmqts .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dyddzkmqts .gt_spanner_row {
  border-bottom-style: hidden;
}

#dyddzkmqts .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dyddzkmqts .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dyddzkmqts .gt_from_md > :first-child {
  margin-top: 0;
}

#dyddzkmqts .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dyddzkmqts .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dyddzkmqts .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dyddzkmqts .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dyddzkmqts .gt_row_group_first td {
  border-top-width: 2px;
}

#dyddzkmqts .gt_row_group_first th {
  border-top-width: 2px;
}

#dyddzkmqts .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dyddzkmqts .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dyddzkmqts .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dyddzkmqts .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dyddzkmqts .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dyddzkmqts .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dyddzkmqts .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dyddzkmqts .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dyddzkmqts .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dyddzkmqts .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dyddzkmqts .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dyddzkmqts .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dyddzkmqts .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dyddzkmqts .gt_left {
  text-align: left;
}

#dyddzkmqts .gt_center {
  text-align: center;
}

#dyddzkmqts .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dyddzkmqts .gt_font_normal {
  font-weight: normal;
}

#dyddzkmqts .gt_font_bold {
  font-weight: bold;
}

#dyddzkmqts .gt_font_italic {
  font-style: italic;
}

#dyddzkmqts .gt_super {
  font-size: 65%;
}

#dyddzkmqts .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dyddzkmqts .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dyddzkmqts .gt_indent_1 {
  text-indent: 5px;
}

#dyddzkmqts .gt_indent_2 {
  text-indent: 10px;
}

#dyddzkmqts .gt_indent_3 {
  text-indent: 15px;
}

#dyddzkmqts .gt_indent_4 {
  text-indent: 20px;
}

#dyddzkmqts .gt_indent_5 {
  text-indent: 25px;
}

#dyddzkmqts .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dyddzkmqts div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="study" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">study</th>
<th id="compound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">compound</th>
<th id="trial" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trial</th>
<th id="start_time" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">start_time</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_severe" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_severe</th>
<th id="r_ovrall" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_ovrall</th>
<th id="r_mod" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_mod</th>
<th id="r_severe" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_severe</th>
<th id="oral" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">oral</th>
<th id="is_complete" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">is_complete</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<th id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_1 study">1</td>
<td class="gt_row gt_left" headers="stub_1_1 compound">Duplmb</td>
<td class="gt_row gt_left" headers="stub_1_1 trial">2b</td>
<td class="gt_row gt_left" headers="stub_1_1 start_time">2013 May</td>
<td class="gt_row gt_right" headers="stub_1_1 n">61</td>
<td class="gt_row gt_right" headers="stub_1_1 n_severe">29</td>
<td class="gt_row gt_right" headers="stub_1_1 r_ovrall">1</td>
<td class="gt_row gt_right" headers="stub_1_1 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_1 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_1 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_1 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_2 study">2</td>
<td class="gt_row gt_left" headers="stub_1_2 compound">Duplmb</td>
<td class="gt_row gt_left" headers="stub_1_2 trial">SOLO 1</td>
<td class="gt_row gt_left" headers="stub_1_2 start_time">2014 Oct</td>
<td class="gt_row gt_right" headers="stub_1_2 n">224</td>
<td class="gt_row gt_right" headers="stub_1_2 n_severe">111</td>
<td class="gt_row gt_right" headers="stub_1_2 r_ovrall">23</td>
<td class="gt_row gt_right" headers="stub_1_2 r_mod">16</td>
<td class="gt_row gt_right" headers="stub_1_2 r_severe">7</td>
<td class="gt_row gt_right" headers="stub_1_2 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_2 is_complete">0</td>
</tr>
<tr class="odd">
<th id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_3 study">3</td>
<td class="gt_row gt_left" headers="stub_1_3 compound">Duplmb</td>
<td class="gt_row gt_left" headers="stub_1_3 trial">SOLO 2</td>
<td class="gt_row gt_left" headers="stub_1_3 start_time">2014 Dec</td>
<td class="gt_row gt_right" headers="stub_1_3 n">236</td>
<td class="gt_row gt_right" headers="stub_1_3 n_severe">115</td>
<td class="gt_row gt_right" headers="stub_1_3 r_ovrall">20</td>
<td class="gt_row gt_right" headers="stub_1_3 r_mod">17</td>
<td class="gt_row gt_right" headers="stub_1_3 r_severe">3</td>
<td class="gt_row gt_right" headers="stub_1_3 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_3 is_complete">0</td>
</tr>
<tr class="even">
<th id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_4 study">4</td>
<td class="gt_row gt_left" headers="stub_1_4 compound">Trlknm</td>
<td class="gt_row gt_left" headers="stub_1_4 trial">ECZTRA 1</td>
<td class="gt_row gt_left" headers="stub_1_4 start_time">2017 May</td>
<td class="gt_row gt_right" headers="stub_1_4 n">197</td>
<td class="gt_row gt_right" headers="stub_1_4 n_severe">102</td>
<td class="gt_row gt_right" headers="stub_1_4 r_ovrall">14</td>
<td class="gt_row gt_right" headers="stub_1_4 r_mod">10</td>
<td class="gt_row gt_right" headers="stub_1_4 r_severe">4</td>
<td class="gt_row gt_right" headers="stub_1_4 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_4 is_complete">0</td>
</tr>
<tr class="odd">
<th id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_5 study">5</td>
<td class="gt_row gt_left" headers="stub_1_5 compound">Trlknm</td>
<td class="gt_row gt_left" headers="stub_1_5 trial">ECZTRA 2</td>
<td class="gt_row gt_left" headers="stub_1_5 start_time">2017 Jun</td>
<td class="gt_row gt_right" headers="stub_1_5 n">193</td>
<td class="gt_row gt_right" headers="stub_1_5 n_severe">100</td>
<td class="gt_row gt_right" headers="stub_1_5 r_ovrall">18</td>
<td class="gt_row gt_right" headers="stub_1_5 r_mod">13</td>
<td class="gt_row gt_right" headers="stub_1_5 r_severe">5</td>
<td class="gt_row gt_right" headers="stub_1_5 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_5 is_complete">0</td>
</tr>
<tr class="even">
<th id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_6 study">6</td>
<td class="gt_row gt_left" headers="stub_1_6 compound">Rctnlm</td>
<td class="gt_row gt_left" headers="stub_1_6 trial">2b</td>
<td class="gt_row gt_left" headers="stub_1_6 start_time">2018</td>
<td class="gt_row gt_right" headers="stub_1_6 n">57</td>
<td class="gt_row gt_right" headers="stub_1_6 n_severe">26</td>
<td class="gt_row gt_right" headers="stub_1_6 r_ovrall">1</td>
<td class="gt_row gt_right" headers="stub_1_6 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_6 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_6 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_6 is_complete">1</td>
</tr>
<tr class="odd">
<th id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_7 study">7</td>
<td class="gt_row gt_left" headers="stub_1_7 compound">Lbrkzm</td>
<td class="gt_row gt_left" headers="stub_1_7 trial">D</td>
<td class="gt_row gt_left" headers="stub_1_7 start_time">2018 Jan</td>
<td class="gt_row gt_right" headers="stub_1_7 n">52</td>
<td class="gt_row gt_right" headers="stub_1_7 n_severe">20</td>
<td class="gt_row gt_right" headers="stub_1_7 r_ovrall">8</td>
<td class="gt_row gt_right" headers="stub_1_7 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_7 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_7 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_7 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_8 study">8</td>
<td class="gt_row gt_left" headers="stub_1_8 compound">Lbrkzm</td>
<td class="gt_row gt_left" headers="stub_1_8 trial">ADvocate1</td>
<td class="gt_row gt_left" headers="stub_1_8 start_time">2019</td>
<td class="gt_row gt_right" headers="stub_1_8 n">141</td>
<td class="gt_row gt_right" headers="stub_1_8 n_severe">58</td>
<td class="gt_row gt_right" headers="stub_1_8 r_ovrall">18</td>
<td class="gt_row gt_right" headers="stub_1_8 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_8 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_8 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_8 is_complete">1</td>
</tr>
<tr class="odd">
<th id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_9 study">9</td>
<td class="gt_row gt_left" headers="stub_1_9 compound">Lbrkzm</td>
<td class="gt_row gt_left" headers="stub_1_9 trial">ADvocate2</td>
<td class="gt_row gt_left" headers="stub_1_9 start_time">2019</td>
<td class="gt_row gt_right" headers="stub_1_9 n">146</td>
<td class="gt_row gt_right" headers="stub_1_9 n_severe">51</td>
<td class="gt_row gt_right" headers="stub_1_9 r_ovrall">16</td>
<td class="gt_row gt_right" headers="stub_1_9 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_9 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_9 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_9 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_10 study">10</td>
<td class="gt_row gt_left" headers="stub_1_10 compound">Amltlm</td>
<td class="gt_row gt_left" headers="stub_1_10 trial">2a</td>
<td class="gt_row gt_left" headers="stub_1_10 start_time">2018 Dec</td>
<td class="gt_row gt_right" headers="stub_1_10 n">24</td>
<td class="gt_row gt_right" headers="stub_1_10 n_severe">15</td>
<td class="gt_row gt_right" headers="stub_1_10 r_ovrall">2</td>
<td class="gt_row gt_right" headers="stub_1_10 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_10 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_10 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_10 is_complete">1</td>
</tr>
<tr class="odd">
<th id="stub_1_11" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_11 study">11</td>
<td class="gt_row gt_left" headers="stub_1_11 compound">Updctn</td>
<td class="gt_row gt_left" headers="stub_1_11 trial">2</td>
<td class="gt_row gt_left" headers="stub_1_11 start_time">2016</td>
<td class="gt_row gt_right" headers="stub_1_11 n">41</td>
<td class="gt_row gt_right" headers="stub_1_11 n_severe">23</td>
<td class="gt_row gt_right" headers="stub_1_11 r_ovrall">1</td>
<td class="gt_row gt_right" headers="stub_1_11 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_11 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_11 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_11 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_12" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_12 study">12</td>
<td class="gt_row gt_left" headers="stub_1_12 compound">Updctn</td>
<td class="gt_row gt_left" headers="stub_1_12 trial">Measure Up 1</td>
<td class="gt_row gt_left" headers="stub_1_12 start_time">2018</td>
<td class="gt_row gt_right" headers="stub_1_12 n">281</td>
<td class="gt_row gt_right" headers="stub_1_12 n_severe">125</td>
<td class="gt_row gt_right" headers="stub_1_12 r_ovrall">24</td>
<td class="gt_row gt_right" headers="stub_1_12 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_12 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_12 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_12 is_complete">1</td>
</tr>
<tr class="odd">
<th id="stub_1_13" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_13 study">13</td>
<td class="gt_row gt_left" headers="stub_1_13 compound">Updctn</td>
<td class="gt_row gt_left" headers="stub_1_13 trial">Measure Up 2</td>
<td class="gt_row gt_left" headers="stub_1_13 start_time">2018</td>
<td class="gt_row gt_right" headers="stub_1_13 n">278</td>
<td class="gt_row gt_right" headers="stub_1_13 n_severe">153</td>
<td class="gt_row gt_right" headers="stub_1_13 r_ovrall">13</td>
<td class="gt_row gt_right" headers="stub_1_13 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_13 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_13 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_13 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_14" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_14 study">14</td>
<td class="gt_row gt_left" headers="stub_1_14 compound">Abrctn</td>
<td class="gt_row gt_left" headers="stub_1_14 trial">2b</td>
<td class="gt_row gt_left" headers="stub_1_14 start_time">2016</td>
<td class="gt_row gt_right" headers="stub_1_14 n">52</td>
<td class="gt_row gt_right" headers="stub_1_14 n_severe">20</td>
<td class="gt_row gt_right" headers="stub_1_14 r_ovrall">3</td>
<td class="gt_row gt_right" headers="stub_1_14 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_14 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_14 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_14 is_complete">1</td>
</tr>
<tr class="odd">
<th id="stub_1_15" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_15 study">15</td>
<td class="gt_row gt_left" headers="stub_1_15 compound">Abrctn</td>
<td class="gt_row gt_left" headers="stub_1_15 trial">JADE MONO 2</td>
<td class="gt_row gt_left" headers="stub_1_15 start_time">2017</td>
<td class="gt_row gt_right" headers="stub_1_15 n">78</td>
<td class="gt_row gt_right" headers="stub_1_15 n_severe">26</td>
<td class="gt_row gt_right" headers="stub_1_15 r_ovrall">7</td>
<td class="gt_row gt_right" headers="stub_1_15 r_mod">6</td>
<td class="gt_row gt_right" headers="stub_1_15 r_severe">1</td>
<td class="gt_row gt_right" headers="stub_1_15 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_15 is_complete">0</td>
</tr>
<tr class="even">
<th id="stub_1_16" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_16 study">16</td>
<td class="gt_row gt_left" headers="stub_1_16 compound">Abrctn</td>
<td class="gt_row gt_left" headers="stub_1_16 trial">JADE MONO 1</td>
<td class="gt_row gt_left" headers="stub_1_16 start_time">2018</td>
<td class="gt_row gt_right" headers="stub_1_16 n">77</td>
<td class="gt_row gt_right" headers="stub_1_16 n_severe">31</td>
<td class="gt_row gt_right" headers="stub_1_16 r_ovrall">6</td>
<td class="gt_row gt_right" headers="stub_1_16 r_mod">5</td>
<td class="gt_row gt_right" headers="stub_1_16 r_severe">1</td>
<td class="gt_row gt_right" headers="stub_1_16 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_16 is_complete">0</td>
</tr>
<tr class="odd">
<th id="stub_1_17" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_17 study">17</td>
<td class="gt_row gt_left" headers="stub_1_17 compound">Brctnb</td>
<td class="gt_row gt_left" headers="stub_1_17 trial">BREEZE-AD1</td>
<td class="gt_row gt_left" headers="stub_1_17 start_time">2017</td>
<td class="gt_row gt_right" headers="stub_1_17 n">249</td>
<td class="gt_row gt_right" headers="stub_1_17 n_severe">105</td>
<td class="gt_row gt_right" headers="stub_1_17 r_ovrall">12</td>
<td class="gt_row gt_right" headers="stub_1_17 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_17 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_17 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_17 is_complete">1</td>
</tr>
<tr class="even">
<th id="stub_1_18" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></th>
<td class="gt_row gt_right" headers="stub_1_18 study">18</td>
<td class="gt_row gt_left" headers="stub_1_18 compound">Brctnb</td>
<td class="gt_row gt_left" headers="stub_1_18 trial">BREEZE-AD2</td>
<td class="gt_row gt_left" headers="stub_1_18 start_time">2018</td>
<td class="gt_row gt_right" headers="stub_1_18 n">244</td>
<td class="gt_row gt_right" headers="stub_1_18 n_severe">121</td>
<td class="gt_row gt_right" headers="stub_1_18 r_ovrall">11</td>
<td class="gt_row gt_right" headers="stub_1_18 r_mod">—</td>
<td class="gt_row gt_right" headers="stub_1_18 r_severe">—</td>
<td class="gt_row gt_right" headers="stub_1_18 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_18 is_complete">1</td>
</tr>
<tr class="odd">
<th id="grand_summary_stub_1" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row" data-quarto-table-cell-role="th" scope="row">min</th>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 study">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 compound">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 trial">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 start_time">—</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 n">24.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 n_severe">15.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 r_ovrall">1.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 r_mod">5.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 r_severe">1.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 oral">0.0%</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row" headers="grand_summary_stub_1 is_complete">0.0%</td>
</tr>
<tr class="even">
<th id="grand_summary_stub_2" class="gt_row gt_left gt_stub gt_grand_summary_row" data-quarto-table-cell-role="th" scope="row">max</th>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 study">—</td>
<td class="gt_row gt_left gt_grand_summary_row" headers="grand_summary_stub_2 compound">—</td>
<td class="gt_row gt_left gt_grand_summary_row" headers="grand_summary_stub_2 trial">—</td>
<td class="gt_row gt_left gt_grand_summary_row" headers="grand_summary_stub_2 start_time">—</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 n">281.0</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 n_severe">153.0</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 r_ovrall">24.0</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 r_mod">17.0</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 r_severe">7.0</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 oral">100.0%</td>
<td class="gt_row gt_right gt_grand_summary_row" headers="grand_summary_stub_2 is_complete">100.0%</td>
</tr>
<tr class="odd">
<th id="grand_summary_stub_3" class="gt_row gt_left gt_stub gt_grand_summary_row gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">avg</th>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 study">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 compound">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 trial">—</td>
<td class="gt_row gt_left gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 start_time">—</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 n">146.2</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 n_severe">68.4</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 r_ovrall">11.0</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 r_mod">11.2</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 r_severe">3.5</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 oral">44.4%</td>
<td class="gt_row gt_right gt_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_3 is_complete">66.7%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A graphical overview of the data as a forest plot showing the historical responder data in separate for moderate and severe (when available) and as overall number of responders:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ad_meta_analysis_covariate_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-description" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="model-description"><span class="header-section-number">7.3</span> Model description</h2>
<section id="trial-analysis-model" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="trial-analysis-model"><span class="header-section-number">7.3.1</span> Trial analysis model</h3>
<p>The aim is to decrease the sample size of the placebo arm in a future placebo controlled trial. To start, we first define the analysis model used for the future trial. We assume that the trial enrolls patients with either an IGA score of 3 (moderate) or 4 (severe). The baseline severity is a clinically relevant prognostic factor for response. Therefore, we assume that the trial analysis accounts for a patient’s disease status at baseline via an indicator <code>severe</code> resulting in the analysis model of the binary IGA responder outcome as</p>
<p><span class="math display"> r_i|\theta_i \sim \text{Bernoulli}(\theta_i) </span></p>
<p><span class="math display"> \text{logit}(\theta_i) = \alpha_0 + I(\text{severe}_i) \, \beta_1 + I(\text{active}_i) \, \beta_2 . </span></p>
<p>Our goal is not to derive from the historical data above informative priors for the overall intercept <span class="math inline">\alpha_0</span> <em>and</em> the covariate effect due to baseline disease status <span class="math inline">\beta_1</span>.</p>
</section>
<section id="historical-control-data-synthesis" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="historical-control-data-synthesis"><span class="header-section-number">7.3.2</span> Historical control data synthesis</h3>
<p>Aggregate historical data necessitates adapting the trial analysis model in several ways. First, the Bernoulli likelihood for each individual patient <span class="math inline">i</span> is transferred to an equivalent Binomial likelihood. Additionally, since each patient is classified as either moderate (<span class="math inline">l = 0</span>) or severe (<span class="math inline">l = 1</span>), it becomes necessary to introduce a pair of Binomial likelihood terms for each historical study (<span class="math inline">h</span>), with one term corresponding to each baseline disease severity level.</p>
<p>Furthermore, the inclusion of the covariate effect for baseline severity requires deriving a MAP prior for both the intercept and the log odds ratio of the covariate effect. If only a MAP prior were derived for the intercept while assigning a non-informative prior to the covariate effect, the trial analysis would borrow information exclusively for the disease severity level linked to the reference category of the intercept, leaving the covariate effect uninformative.</p>
<p>To address this, the trial analysis model is extended by incorporating a hierarchical structure. This hierarchical model assigns trial-specific intercepts and slopes for the covariate effect, with these parameters being related across trials through an exchangeability assumption. This assumption enables partial pooling of the available data, allowing the model to share information across trials while also capturing trial-specific variability.</p>
<p><span class="math display"> r_{h,l}|\theta_{h,l} \sim \text{Binomial}(\theta_{h,l}) </span></p>
<p><span class="math display"> \text{logit}(\theta_{h,l}) = \beta_{0,h} + I(\text{severe}_{h,l}) \, \beta_{1,h} + I(\text{oral}_{h}) \, \beta_3 </span></p>
<p>with the usual between-trial heterogeneity on the intercept and the slope:</p>
<p><span class="math display"> (\beta_{0,h}, \beta_{1,h})|\mu_0,\mu_1,\tau_0,\tau_1,\rho \sim \text{Normal}((\mu_0, \mu_1), \Sigma) </span></p>
<p><span class="math display">\Sigma =
\begin{pmatrix}
\tau_0^2 &amp; \tau_0 \, \tau_1 \, \rho \\
\tau_0 \, \tau_1 \, \rho &amp; \tau_1^2
\end{pmatrix}
</span></p>
<p>However, this model requires for each historical trial the outcome of the responders to be given for each baseline disease severity level separatley (corresponding to trials marked with “complete” information). Thus, this model can only be applied in this form to a subset of the data with complete information.</p>
</section>
<section id="sec-model-partial" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="sec-model-partial"><span class="header-section-number">7.3.3</span> Modelling explicitly the sum of two binomials (advanced)</h3>
<p>For a number of trials we do not have reported the <em>complete</em> information needed for the above model. The complete response information per trial includes the number of responders stratified by disease severity,</p>
<ul>
<li><span class="math inline">r_{h,l=0}</span> responders with moderate baseline status</li>
<li><span class="math inline">r_{h,l=1}</span> responders with severe baseline status.</li>
</ul>
<p>However, we have instead reported the <em>partial</em> information reported of the overall number of responders, which equals the sum of the two random variables abvove:</p>
<p><span class="math display">r_h = r_{h,l=0} + r_{h,l=1}</span></p>
<p>In the following we describe how we can use the information on the sum while we model the data <em>as if</em> we were given the stratified response data. That is, we formulate the likelihood on the basis of the given sum of responders <span class="math inline">r_h</span> while using the latent response rates <span class="math inline">\theta_{h,l=0}</span> and <span class="math inline">\theta_{h,l=1}</span> for which the model for the complete data is</p>
<p><span class="math display"> r_{h,l=0}|\theta_{h,l=0} \sim \text{Binomial}(\theta_{h,l=0}) </span> <span class="math display"> r_{h,l=1}|\theta_{h,l=1} \sim \text{Binomial}(\theta_{h,l=1}) </span></p>
<p>The sum of two Binomial variables is distributed as the discrete convolution of the individual Binomial distribution:</p>
<p><span class="math display"> P(Y=r) = \sum_{y_1=0}^{r} P_1(y_1) \, P_2(r - y_1)</span></p>
<p>Accounting for the fact that each variable is bounded by <span class="math inline">n_1</span> and <span class="math inline">n_2</span> respectivley, we can limit the domain of the sum accordingly:</p>
<p><span class="math display"> P(Y=r) = \sum_{y_1=\max(0,r-n_2)}^{\min(n_1, r)} P_1(y_1) \, P_2(r - y_1)</span></p>
</section>
</section>
<section id="implementation" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="implementation"><span class="header-section-number">7.4</span> Implementation</h2>
<section id="sec-impl-complete-only" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="sec-impl-complete-only"><span class="header-section-number">7.4.1</span> MAP prior for complete historical data only</h3>
<p>Modelling jointly the complete and partial information from the historical trials requires two types of likelihoods in a single model depending on the respective case. Here we first model the historical trials with complete information only. This can be formulated as a hierarchical Binomial regression problem. Thus, we first subset to the 6 trials for which complete information is available, which we reformat into a long format for which each trial contributes one row for the moderate and one row for the severe outcome:</p>
<div class="cell">
<div class="cell-output-display">
<div id="gsalpybftc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gsalpybftc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gsalpybftc thead, #gsalpybftc tbody, #gsalpybftc tfoot, #gsalpybftc tr, #gsalpybftc td, #gsalpybftc th {
  border-style: none;
}

#gsalpybftc p {
  margin: 0;
  padding: 0;
}

#gsalpybftc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gsalpybftc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gsalpybftc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gsalpybftc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gsalpybftc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gsalpybftc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gsalpybftc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gsalpybftc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gsalpybftc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gsalpybftc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gsalpybftc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gsalpybftc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gsalpybftc .gt_spanner_row {
  border-bottom-style: hidden;
}

#gsalpybftc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gsalpybftc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gsalpybftc .gt_from_md > :first-child {
  margin-top: 0;
}

#gsalpybftc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gsalpybftc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gsalpybftc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gsalpybftc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gsalpybftc .gt_row_group_first td {
  border-top-width: 2px;
}

#gsalpybftc .gt_row_group_first th {
  border-top-width: 2px;
}

#gsalpybftc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gsalpybftc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gsalpybftc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gsalpybftc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gsalpybftc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gsalpybftc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gsalpybftc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gsalpybftc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gsalpybftc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gsalpybftc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gsalpybftc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gsalpybftc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gsalpybftc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gsalpybftc .gt_left {
  text-align: left;
}

#gsalpybftc .gt_center {
  text-align: center;
}

#gsalpybftc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gsalpybftc .gt_font_normal {
  font-weight: normal;
}

#gsalpybftc .gt_font_bold {
  font-weight: bold;
}

#gsalpybftc .gt_font_italic {
  font-style: italic;
}

#gsalpybftc .gt_super {
  font-size: 65%;
}

#gsalpybftc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gsalpybftc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gsalpybftc .gt_indent_1 {
  text-indent: 5px;
}

#gsalpybftc .gt_indent_2 {
  text-indent: 10px;
}

#gsalpybftc .gt_indent_3 {
  text-indent: 15px;
}

#gsalpybftc .gt_indent_4 {
  text-indent: 20px;
}

#gsalpybftc .gt_indent_5 {
  text-indent: 25px;
}

#gsalpybftc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gsalpybftc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="study" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">study</th>
<th id="compound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">compound</th>
<th id="trial" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trial</th>
<th id="severe" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severe</th>
<th id="oral" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">oral</th>
<th id="r" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="study">2</td>
<td class="gt_row gt_left" headers="compound">Dupilumab</td>
<td class="gt_row gt_left" headers="trial">SOLO 1</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">16</td>
<td class="gt_row gt_right" headers="n">113</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">2</td>
<td class="gt_row gt_left" headers="compound">Dupilumab</td>
<td class="gt_row gt_left" headers="trial">SOLO 1</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">7</td>
<td class="gt_row gt_right" headers="n">111</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="study">3</td>
<td class="gt_row gt_left" headers="compound">Dupilumab</td>
<td class="gt_row gt_left" headers="trial">SOLO 2</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">17</td>
<td class="gt_row gt_right" headers="n">121</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">3</td>
<td class="gt_row gt_left" headers="compound">Dupilumab</td>
<td class="gt_row gt_left" headers="trial">SOLO 2</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">3</td>
<td class="gt_row gt_right" headers="n">115</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="study">4</td>
<td class="gt_row gt_left" headers="compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="trial">ECZTRA 1</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">10</td>
<td class="gt_row gt_right" headers="n">95</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">4</td>
<td class="gt_row gt_left" headers="compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="trial">ECZTRA 1</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">4</td>
<td class="gt_row gt_right" headers="n">102</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="study">5</td>
<td class="gt_row gt_left" headers="compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="trial">ECZTRA 2</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">13</td>
<td class="gt_row gt_right" headers="n">93</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">5</td>
<td class="gt_row gt_left" headers="compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="trial">ECZTRA 2</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">0</td>
<td class="gt_row gt_right" headers="r">5</td>
<td class="gt_row gt_right" headers="n">100</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="study">15</td>
<td class="gt_row gt_left" headers="compound">Abrocitinib</td>
<td class="gt_row gt_left" headers="trial">JADE MONO 2</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">1</td>
<td class="gt_row gt_right" headers="r">6</td>
<td class="gt_row gt_right" headers="n">52</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">15</td>
<td class="gt_row gt_left" headers="compound">Abrocitinib</td>
<td class="gt_row gt_left" headers="trial">JADE MONO 2</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">1</td>
<td class="gt_row gt_right" headers="r">1</td>
<td class="gt_row gt_right" headers="n">26</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="study">16</td>
<td class="gt_row gt_left" headers="compound">Abrocitinib</td>
<td class="gt_row gt_left" headers="trial">JADE MONO 1</td>
<td class="gt_row gt_right" headers="severe">0</td>
<td class="gt_row gt_right" headers="oral">1</td>
<td class="gt_row gt_right" headers="r">5</td>
<td class="gt_row gt_right" headers="n">46</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="study">16</td>
<td class="gt_row gt_left" headers="compound">Abrocitinib</td>
<td class="gt_row gt_left" headers="trial">JADE MONO 1</td>
<td class="gt_row gt_right" headers="severe">1</td>
<td class="gt_row gt_right" headers="oral">1</td>
<td class="gt_row gt_right" headers="r">1</td>
<td class="gt_row gt_right" headers="n">31</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this form, the data can be directly modelled with weakly-informative priors in <code>brms</code>. The priors are set on the basis of the unit information standard deviation. This derives from the overall mean response rate of 7%, for which the respective binomial variance is transformed to the logit scale.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bi-variate hierarchical Binomial logistic regression model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>complete_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> oral <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">|</span> study),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> binomial, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>complete_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.5</span>), <span class="at">class =</span> b) <span class="sc">+</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.5</span> <span class="sc">/</span> <span class="dv">4</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group=</span>study) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> <span class="fl">3.5</span> <span class="sc">/</span> <span class="dv">4</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> severe, <span class="at">group=</span>study) </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>complete_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(complete_model, <span class="at">data =</span> hist_pbo_long_complete,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> complete_prior,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.95</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">refresh =</span> <span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.6 seconds.
Chain 2 finished in 0.6 seconds.
Chain 3 finished in 0.6 seconds.
Chain 4 finished in 0.7 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.6 seconds.
Total execution time: 3.0 seconds.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>complete_mc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: r | trials(n) ~ 1 + severe + oral + (1 + severe | study) 
   Data: hist_pbo_long_complete (Number of observations: 12) 

Multilevel Hyperparameters:
~study (Number of levels: 6) 
                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)             0.20      0.18     0.01     0.65 1.00     1303     1283
sd(severe)                0.39      0.34     0.02     1.27 1.00     1950     1859
cor(Intercept,severe)    -0.05      0.59    -0.97     0.93 1.00     2882     2531

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -1.89      0.19    -2.26    -1.52 1.00     2205     1983
severe       -1.25      0.34    -1.97    -0.61 1.00     2309     1773
oral         -0.23      0.38    -1.01     0.49 1.00     2959     2755</code></pre>
</div>
</div>
<p>The MAP prior is then derived as prediction of the parameters (intercept and slope) for a new study. However, most <code>brms</code> prediction functions are meant to predict new data or response means, which involves the linear predictor on the logit scale. Instead, we wish to extract the parameters themselves, which one can obtain by considering respective levels of the linear predictor:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>study_new_levels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">0</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">severe =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">oral =</span> <span class="dv">0</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="st">"new_study"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain posterior for severe and moderate; note that we must allow to</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sample new levels of the random effects and also specify to do so</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># using the "gaussian" option (as brms would otherwise bootstrap from</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># existing studies).</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study <span class="ot">&lt;-</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    complete_mc,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> study_new_levels,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_new_levels =</span> <span class="st">"gaussian"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># we get a posterior for each condition (moderate / severe) - the</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># second column includes the intercept plus the covariate effect due</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># to severity,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rvar&lt;4000&gt;[2] mean ± sd:
[1] -1.9 ± 0.34  -3.1 ± 0.67 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which we convert to the log odds ratio estimate</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># only by subtracting the overall intercept in the first column</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study[<span class="dv">2</span>] <span class="ot">&lt;-</span> prior_complete_new_study[<span class="dv">2</span>] <span class="sc">-</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  prior_complete_new_study[<span class="dv">1</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># As we wish to formulate a joint prior on all model parameters of the</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># trial model - including the treatment effect - a weakly-informative</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prior for the treatment effect is added to the posterior in MC form.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  prior_complete_new_study,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">rvar_rng</span>(rnorm, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">3.5</span>, <span class="at">ndraws =</span> <span class="fu">ndraws</span>(prior_complete_new_study))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prior_complete_new_study) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"inter"</span>, <span class="st">"severe"</span>, <span class="st">"active"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># now turn the MC sample of the prior into a parametric representation</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># using functions from RBesT</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>map_prior_complete <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(prior_complete_new_study),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"mvnorm"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>map_prior_complete</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>EM for Multivariate Normal Mixture Model
Log-Likelihood = -14806

Multivariate normal mixture
Outcome dimension: 3
Mixture Components:
                         comp1  comp2  comp3 
w                         0.587  0.258  0.155
m[x[inter]]              -1.876 -1.892 -1.868
m[x[severe]]             -1.217 -1.297 -1.307
m[x[active]]              0.256 -0.441 -0.078
s[x[inter]]               0.224  0.208  0.684
s[x[severe]]              0.329  0.729  1.063
s[x[active]]              3.584  3.352  3.599
rho[x[severe],x[inter]]  -0.295 -0.085 -0.054
rho[x[active],x[inter]]  -0.082  0.090  0.046
rho[x[active],x[severe]]  0.083 -0.057 -0.065</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(map_prior_complete)<span class="sc">$</span>mixpairs</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Diagnostic plots for mixture multivariate normal densities are experimental.
Please note that these are subject to changes in future releases.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ad_meta_analysis_covariate_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># robustify joint prior</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>prior_non_inf <span class="ot">&lt;-</span> <span class="fu">mixmvnorm</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rmap_prior_complete <span class="ot">&lt;-</span> <span class="fu">mixcombine</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  map_prior_complete,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  prior_non_inf,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmap_prior_complete, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multivariate normal mixture
Outcome dimension: 3
Mixture Components:
                         comp1  comp2  comp3  comp1 
w                         0.469  0.206  0.124  0.200
m[x[inter]]              -1.876 -1.892 -1.868  0.000
m[x[severe]]             -1.217 -1.297 -1.307  0.000
m[x[active]]              0.256 -0.441 -0.078  0.000
s[x[inter]]               0.224  0.208  0.684  3.500
s[x[severe]]              0.329  0.729  1.063  3.500
s[x[active]]              3.584  3.352  3.599  3.500
rho[x[severe],x[inter]]  -0.295 -0.085 -0.054  0.000
rho[x[active],x[inter]]  -0.082  0.090  0.046  0.000
rho[x[active],x[severe]]  0.083 -0.057 -0.065  0.000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For pre-specification of the MAP prior we have to report the MAP</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># prior with a finite precision in the protocol. Thereby, it is</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># recommended to write the MAP prior to disk using the JSON read/write</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># functions from RBesT to store the MAP prior with a defined precision</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># on file in a human readable format as JSON:</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>map_complete_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"map_complete_new_trial_json.txt"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  map_prior_complete,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  map_complete_new_trial_file,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">pretty =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dropping EM information from mixture object before serialization.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rmap_complete_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rmap_complete_new__trial_json.txt"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  rmap_prior_complete,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  rmap_complete_new_trial_file,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pretty =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(rmap_complete_new_trial_file), <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
  "meta": {
    "dim": [10, 4],
    "dimnames": [
      ["w", "m[x[inter]]", "m[x[severe]]", "m[x[active]]", "s[x[inter]]", "s[x[severe]]", "s[x[active]]", "rho[x[severe],x[inter]]", "rho[x[active],x[inter]]", "rho[x[active],x[severe]]"],
      ["comp1", "comp2", "comp3", "comp1"]
    ],
    "class": ["mvnormMix", "mix"],
    "link": ["identity"],
    "likelihood": ["mvnormal"]
  },
  "comp": [
    [0.4694, 0.2064, 0.1242, 0.2],
    [-1.8764, -1.8915, -1.8678, 0],
    [-1.2169, -1.2967, -1.3074, 0],
    [0.2556, -0.4407, -0.0782, 0],
    [0.2238, 0.2085, 0.6844, 3.5],
    [0.3291, 0.7288, 1.0633, 3.5],
    [3.584, 3.3516, 3.5986, 3.5],
    [-0.2954, -0.0846, -0.0543, 0],
    [-0.0818, 0.0901, 0.0463, 0],
    [0.0827, -0.0574, -0.065, 0]
  ]
}</code></pre>
</div>
</div>
<p>The MAP prior used in the future trial is then the mixture prior one obtains by loading the JSON file. In case the rounding to a limited number of digits caused that the weights do not exactly sum to unity, these will then automatically be rescalled accordingly:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_mix_json</span>(rmap_complete_new_trial_file, <span class="at">rescale=</span><span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multivariate normal mixture
Outcome dimension: 3
Mixture Components:
                         comp1  comp2  comp3  comp1 
w                         0.469  0.206  0.124  0.200
m[x[inter]]              -1.876 -1.891 -1.868  0.000
m[x[severe]]             -1.217 -1.297 -1.307  0.000
m[x[active]]              0.256 -0.441 -0.078  0.000
s[x[inter]]               0.224  0.208  0.684  3.500
s[x[severe]]              0.329  0.729  1.063  3.500
s[x[active]]              3.584  3.352  3.599  3.500
rho[x[severe],x[inter]]  -0.295 -0.085 -0.054  0.000
rho[x[active],x[inter]]  -0.082  0.090  0.046  0.000
rho[x[active],x[severe]]  0.083 -0.057 -0.065  0.000</code></pre>
</div>
</div>
</section>
<section id="map-prior-for-complete-and-partial-historical-data-advanced" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="map-prior-for-complete-and-partial-historical-data-advanced"><span class="header-section-number">7.4.2</span> MAP prior for complete and partial historical data (advanced)</h3>
<p>In the previous <a href="#sec-impl-complete-only" class="quarto-xref"><span>Section 7.4.1</span></a> the data of the partially reported trials was dropped corresponding to a subset of <!-- -----> 1005 patients such that<!-----> 1626 were left out, which is unsatisfactory. As explained in <a href="#sec-model-partial" class="quarto-xref"><span>Section 7.3.3</span></a>, the data from the trials with partial data can be modelled using a latent variable approach. Their likelihood contribution for the partially observed historical trials is then based on the convolution theorem and deviates from the case of a complete data historical trial.</p>
<p>As strategy to model this with <code>brms</code> we will extend the previous model from <a href="#sec-impl-complete-only" class="quarto-xref"><span>Section 7.4.1</span></a> in two ways</p>
<ol type="1">
<li>include the trials with partial data such that we model their response rate by stratum in a latent manner</li>
<li>add the likelihood for the partially reported data</li>
</ol>
<p>The first point can be achived by casting all data into a long format including the partially observed trials. However, for the partially observed trial data the information is missing on the number of responses per disease severity. For these trials we state in the data to have zero responders and zero patients as</p>
<p><span class="math display">
\tilde{r}_{h,l} =
\begin{cases}
r_{h,l} &amp; \text{complete data} \\
0 &amp; \text{partial data} \\
\end{cases}
</span></p>
<p><span class="math display">
\tilde{n}_{h,l} =
\begin{cases}
n_{h,l} &amp; \text{complete data} \\
0 &amp; \text{partial data} \\
\end{cases}
</span></p>
<p>We also include a column <code>is_complete</code> indicating if a trial is reported as complete or partial. Moreover, a column <code>row</code> is included which is simply the row in the data set, which will be used below.</p>
<div class="cell">
<div class="cell-output-display">
<div id="wokkgpjxup" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wokkgpjxup table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wokkgpjxup thead, #wokkgpjxup tbody, #wokkgpjxup tfoot, #wokkgpjxup tr, #wokkgpjxup td, #wokkgpjxup th {
  border-style: none;
}

#wokkgpjxup p {
  margin: 0;
  padding: 0;
}

#wokkgpjxup .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wokkgpjxup .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wokkgpjxup .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wokkgpjxup .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wokkgpjxup .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wokkgpjxup .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wokkgpjxup .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wokkgpjxup .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wokkgpjxup .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wokkgpjxup .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wokkgpjxup .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wokkgpjxup .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wokkgpjxup .gt_spanner_row {
  border-bottom-style: hidden;
}

#wokkgpjxup .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wokkgpjxup .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wokkgpjxup .gt_from_md > :first-child {
  margin-top: 0;
}

#wokkgpjxup .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wokkgpjxup .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wokkgpjxup .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wokkgpjxup .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wokkgpjxup .gt_row_group_first td {
  border-top-width: 2px;
}

#wokkgpjxup .gt_row_group_first th {
  border-top-width: 2px;
}

#wokkgpjxup .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wokkgpjxup .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wokkgpjxup .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wokkgpjxup .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wokkgpjxup .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wokkgpjxup .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wokkgpjxup .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wokkgpjxup .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wokkgpjxup .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wokkgpjxup .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wokkgpjxup .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wokkgpjxup .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wokkgpjxup .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wokkgpjxup .gt_left {
  text-align: left;
}

#wokkgpjxup .gt_center {
  text-align: center;
}

#wokkgpjxup .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wokkgpjxup .gt_font_normal {
  font-weight: normal;
}

#wokkgpjxup .gt_font_bold {
  font-weight: bold;
}

#wokkgpjxup .gt_font_italic {
  font-style: italic;
}

#wokkgpjxup .gt_super {
  font-size: 65%;
}

#wokkgpjxup .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wokkgpjxup .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wokkgpjxup .gt_indent_1 {
  text-indent: 5px;
}

#wokkgpjxup .gt_indent_2 {
  text-indent: 10px;
}

#wokkgpjxup .gt_indent_3 {
  text-indent: 15px;
}

#wokkgpjxup .gt_indent_4 {
  text-indent: 20px;
}

#wokkgpjxup .gt_indent_5 {
  text-indent: 25px;
}

#wokkgpjxup .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wokkgpjxup div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="study" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">study</th>
<th id="compound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">compound</th>
<th id="trial" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trial</th>
<th id="severe" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severe</th>
<th id="oral" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">oral</th>
<th id="r" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="is_complete" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">is_complete</th>
<th id="r_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_total</th>
<th id="n_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_total</th>
<th id="r_tilde" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_tilde</th>
<th id="n_tilde" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_tilde</th>
<th id="row" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">row</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<th id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">1</th>
<td class="gt_row gt_right" headers="stub_1_1 study">1</td>
<td class="gt_row gt_left" headers="stub_1_1 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_1 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_1 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_1 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_1 r">—</td>
<td class="gt_row gt_right" headers="stub_1_1 n">32</td>
<td class="gt_row gt_right" headers="stub_1_1 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_1 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_1 n_total">61</td>
<td class="gt_row gt_right" headers="stub_1_1 r_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_1 n_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_1 row">1</td>
</tr>
<tr class="even">
<th id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">2</th>
<td class="gt_row gt_right" headers="stub_1_2 study">1</td>
<td class="gt_row gt_left" headers="stub_1_2 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_2 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_2 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_2 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_2 r">—</td>
<td class="gt_row gt_right" headers="stub_1_2 n">29</td>
<td class="gt_row gt_right" headers="stub_1_2 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_2 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_2 n_total">61</td>
<td class="gt_row gt_right" headers="stub_1_2 r_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_2 n_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_2 row">2</td>
</tr>
<tr class="odd">
<th id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">3</th>
<td class="gt_row gt_right" headers="stub_1_3 study">2</td>
<td class="gt_row gt_left" headers="stub_1_3 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_3 trial">SOLO 1</td>
<td class="gt_row gt_right" headers="stub_1_3 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_3 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_3 r">16</td>
<td class="gt_row gt_right" headers="stub_1_3 n">113</td>
<td class="gt_row gt_right" headers="stub_1_3 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_3 r_total">23</td>
<td class="gt_row gt_right" headers="stub_1_3 n_total">224</td>
<td class="gt_row gt_right" headers="stub_1_3 r_tilde">16</td>
<td class="gt_row gt_right" headers="stub_1_3 n_tilde">113</td>
<td class="gt_row gt_right" headers="stub_1_3 row">3</td>
</tr>
<tr class="even">
<th id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">4</th>
<td class="gt_row gt_right" headers="stub_1_4 study">2</td>
<td class="gt_row gt_left" headers="stub_1_4 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_4 trial">SOLO 1</td>
<td class="gt_row gt_right" headers="stub_1_4 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_4 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_4 r">7</td>
<td class="gt_row gt_right" headers="stub_1_4 n">111</td>
<td class="gt_row gt_right" headers="stub_1_4 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_4 r_total">23</td>
<td class="gt_row gt_right" headers="stub_1_4 n_total">224</td>
<td class="gt_row gt_right" headers="stub_1_4 r_tilde">7</td>
<td class="gt_row gt_right" headers="stub_1_4 n_tilde">111</td>
<td class="gt_row gt_right" headers="stub_1_4 row">4</td>
</tr>
<tr class="odd">
<th id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">5</th>
<td class="gt_row gt_right" headers="stub_1_5 study">3</td>
<td class="gt_row gt_left" headers="stub_1_5 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_5 trial">SOLO 2</td>
<td class="gt_row gt_right" headers="stub_1_5 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_5 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_5 r">17</td>
<td class="gt_row gt_right" headers="stub_1_5 n">121</td>
<td class="gt_row gt_right" headers="stub_1_5 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_5 r_total">20</td>
<td class="gt_row gt_right" headers="stub_1_5 n_total">236</td>
<td class="gt_row gt_right" headers="stub_1_5 r_tilde">17</td>
<td class="gt_row gt_right" headers="stub_1_5 n_tilde">121</td>
<td class="gt_row gt_right" headers="stub_1_5 row">5</td>
</tr>
<tr class="even">
<th id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">6</th>
<td class="gt_row gt_right" headers="stub_1_6 study">3</td>
<td class="gt_row gt_left" headers="stub_1_6 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_6 trial">SOLO 2</td>
<td class="gt_row gt_right" headers="stub_1_6 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_6 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_6 r">3</td>
<td class="gt_row gt_right" headers="stub_1_6 n">115</td>
<td class="gt_row gt_right" headers="stub_1_6 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_6 r_total">20</td>
<td class="gt_row gt_right" headers="stub_1_6 n_total">236</td>
<td class="gt_row gt_right" headers="stub_1_6 r_tilde">3</td>
<td class="gt_row gt_right" headers="stub_1_6 n_tilde">115</td>
<td class="gt_row gt_right" headers="stub_1_6 row">6</td>
</tr>
<tr class="odd">
<th id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">7</th>
<td class="gt_row gt_right" headers="stub_1_7 study">4</td>
<td class="gt_row gt_left" headers="stub_1_7 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_7 trial">ECZTRA 1</td>
<td class="gt_row gt_right" headers="stub_1_7 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_7 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_7 r">10</td>
<td class="gt_row gt_right" headers="stub_1_7 n">95</td>
<td class="gt_row gt_right" headers="stub_1_7 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_7 r_total">14</td>
<td class="gt_row gt_right" headers="stub_1_7 n_total">197</td>
<td class="gt_row gt_right" headers="stub_1_7 r_tilde">10</td>
<td class="gt_row gt_right" headers="stub_1_7 n_tilde">95</td>
<td class="gt_row gt_right" headers="stub_1_7 row">7</td>
</tr>
<tr class="even">
<th id="stub_1_8" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">8</th>
<td class="gt_row gt_right" headers="stub_1_8 study">4</td>
<td class="gt_row gt_left" headers="stub_1_8 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_8 trial">ECZTRA 1</td>
<td class="gt_row gt_right" headers="stub_1_8 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_8 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_8 r">4</td>
<td class="gt_row gt_right" headers="stub_1_8 n">102</td>
<td class="gt_row gt_right" headers="stub_1_8 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_8 r_total">14</td>
<td class="gt_row gt_right" headers="stub_1_8 n_total">197</td>
<td class="gt_row gt_right" headers="stub_1_8 r_tilde">4</td>
<td class="gt_row gt_right" headers="stub_1_8 n_tilde">102</td>
<td class="gt_row gt_right" headers="stub_1_8 row">8</td>
</tr>
<tr class="odd">
<th id="stub_1_9" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">9</th>
<td class="gt_row gt_right" headers="stub_1_9 study">5</td>
<td class="gt_row gt_left" headers="stub_1_9 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_9 trial">ECZTRA 2</td>
<td class="gt_row gt_right" headers="stub_1_9 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_9 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_9 r">13</td>
<td class="gt_row gt_right" headers="stub_1_9 n">93</td>
<td class="gt_row gt_right" headers="stub_1_9 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_9 r_total">18</td>
<td class="gt_row gt_right" headers="stub_1_9 n_total">193</td>
<td class="gt_row gt_right" headers="stub_1_9 r_tilde">13</td>
<td class="gt_row gt_right" headers="stub_1_9 n_tilde">93</td>
<td class="gt_row gt_right" headers="stub_1_9 row">9</td>
</tr>
<tr class="even">
<th id="stub_1_10" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">10</th>
<td class="gt_row gt_right" headers="stub_1_10 study">5</td>
<td class="gt_row gt_left" headers="stub_1_10 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_10 trial">ECZTRA 2</td>
<td class="gt_row gt_right" headers="stub_1_10 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_10 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_10 r">5</td>
<td class="gt_row gt_right" headers="stub_1_10 n">100</td>
<td class="gt_row gt_right" headers="stub_1_10 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_10 r_total">18</td>
<td class="gt_row gt_right" headers="stub_1_10 n_total">193</td>
<td class="gt_row gt_right" headers="stub_1_10 r_tilde">5</td>
<td class="gt_row gt_right" headers="stub_1_10 n_tilde">100</td>
<td class="gt_row gt_right" headers="stub_1_10 row">10</td>
</tr>
<tr class="odd">
<th id="stub_1_11" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">11</th>
<td class="gt_row gt_right" headers="stub_1_11 study">6</td>
<td class="gt_row gt_left" headers="stub_1_11 compound">Rocatinlimab</td>
<td class="gt_row gt_left" headers="stub_1_11 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_11 severe">0</td>
<td class="gt_row gt_right" headers="stub_1_11 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_11 r">—</td>
<td class="gt_row gt_right" headers="stub_1_11 n">31</td>
<td class="gt_row gt_right" headers="stub_1_11 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_11 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_11 n_total">57</td>
<td class="gt_row gt_right" headers="stub_1_11 r_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_11 n_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_11 row">11</td>
</tr>
<tr class="even">
<th id="stub_1_12" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">12</th>
<td class="gt_row gt_right" headers="stub_1_12 study">6</td>
<td class="gt_row gt_left" headers="stub_1_12 compound">Rocatinlimab</td>
<td class="gt_row gt_left" headers="stub_1_12 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_12 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_12 oral">0</td>
<td class="gt_row gt_right" headers="stub_1_12 r">—</td>
<td class="gt_row gt_right" headers="stub_1_12 n">26</td>
<td class="gt_row gt_right" headers="stub_1_12 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_12 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_12 n_total">57</td>
<td class="gt_row gt_right" headers="stub_1_12 r_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_12 n_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_12 row">12</td>
</tr>
<tr class="odd">
<th id="stub_1_13" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier; font-size: x-small; background-color: #E4E4E4">13..35</th>
<td class="gt_row gt_right" headers="stub_1_13 study" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_13 compound" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_13 trial" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 severe" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 oral" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 r" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 n" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 is_complete" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 r_total" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 n_total" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 r_tilde" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 n_tilde" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_13 row" style="background-color: #E4E4E4"></td>
</tr>
<tr class="even">
<th id="stub_1_14" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">36</th>
<td class="gt_row gt_right" headers="stub_1_14 study">18</td>
<td class="gt_row gt_left" headers="stub_1_14 compound">Baricitinib</td>
<td class="gt_row gt_left" headers="stub_1_14 trial">BREEZE-AD2</td>
<td class="gt_row gt_right" headers="stub_1_14 severe">1</td>
<td class="gt_row gt_right" headers="stub_1_14 oral">1</td>
<td class="gt_row gt_right" headers="stub_1_14 r">—</td>
<td class="gt_row gt_right" headers="stub_1_14 n">121</td>
<td class="gt_row gt_right" headers="stub_1_14 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_14 r_total">11</td>
<td class="gt_row gt_right" headers="stub_1_14 n_total">244</td>
<td class="gt_row gt_right" headers="stub_1_14 r_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_14 n_tilde">0</td>
<td class="gt_row gt_right" headers="stub_1_14 row">36</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Adding the data for the partially observed trials with responders and patients set to zero causes <code>brms</code> to include these trials in the model and instantiate corresponding random effects for the intercept and the slope. However, since no data is effectivley provided (zero responders and zero patients), the resulting posterior is not altered as can be seen by rerunning the previouse model with the longer data including the fake data:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we reuse the previous model fit and "update" it with the longer</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data. For this to work, we need to align the column names to the</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model of the complete model fit.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  complete_mc,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">mutate</span>(hist_pbo_long, <span class="at">r =</span> r_tilde, <span class="at">n =</span> n_tilde),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">645776</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 1.1 seconds.
Chain 2 finished in 1.1 seconds.
Chain 3 finished in 1.1 seconds.
Chain 4 finished in 1.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.1 seconds.
Total execution time: 4.7 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: r | trials(n) ~ 1 + severe + oral + (1 + severe | study) 
   Data: mutate(hist_pbo_long, r = r_tilde, n = n_tilde) (Number of observations: 36) 

Multilevel Hyperparameters:
~study (Number of levels: 18) 
                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)             0.19      0.17     0.01     0.66 1.00     1911     1767
sd(severe)                0.38      0.34     0.01     1.26 1.00     2405     2215
cor(Intercept,severe)    -0.05      0.59    -0.95     0.93 1.00     4330     2656

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -1.89      0.19    -2.27    -1.52 1.00     3016     2349
severe       -1.23      0.34    -1.94    -0.56 1.00     3477     2311
oral         -0.23      0.38    -1.01     0.50 1.00     3894     2264</code></pre>
</div>
</div>
<p>To now include the special likelihood term for the partially reported historical trials, we use the <code>stanvar</code> facilities of <code>brms</code>. These allow to inject custom Stan code into the model such that we may add an additional likelihood for the partially observed historical trial data. As each partially observed trial only contributes a single term to the likelihood, it is appropiate to recast the previously long format into a wide data format such that one data row corresponds to just one historical trial. In order to be able to link the wide data format with the rows from the moderate and severe rows in the long format, the column <code>row</code> of the long format is cast into the wide format as well:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hist_pbo_wide <span class="ot">&lt;-</span> hist_pbo_long <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    study,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    compound,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    trial,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    n_total,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    is_complete,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    r_total,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    severe,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    n,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    row</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"study"</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"compound"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"trial"</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"r_total"</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"n_total"</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"is_complete"</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"row"</span>),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"severe"</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>hist_pbo_wide <span class="sc">|&gt;</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_preview</span>(<span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="xbezxjlesp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xbezxjlesp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xbezxjlesp thead, #xbezxjlesp tbody, #xbezxjlesp tfoot, #xbezxjlesp tr, #xbezxjlesp td, #xbezxjlesp th {
  border-style: none;
}

#xbezxjlesp p {
  margin: 0;
  padding: 0;
}

#xbezxjlesp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xbezxjlesp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xbezxjlesp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xbezxjlesp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xbezxjlesp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xbezxjlesp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xbezxjlesp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xbezxjlesp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xbezxjlesp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xbezxjlesp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xbezxjlesp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xbezxjlesp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xbezxjlesp .gt_spanner_row {
  border-bottom-style: hidden;
}

#xbezxjlesp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xbezxjlesp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xbezxjlesp .gt_from_md > :first-child {
  margin-top: 0;
}

#xbezxjlesp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xbezxjlesp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xbezxjlesp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xbezxjlesp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xbezxjlesp .gt_row_group_first td {
  border-top-width: 2px;
}

#xbezxjlesp .gt_row_group_first th {
  border-top-width: 2px;
}

#xbezxjlesp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xbezxjlesp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xbezxjlesp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xbezxjlesp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xbezxjlesp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xbezxjlesp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xbezxjlesp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xbezxjlesp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xbezxjlesp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xbezxjlesp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xbezxjlesp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xbezxjlesp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xbezxjlesp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xbezxjlesp .gt_left {
  text-align: left;
}

#xbezxjlesp .gt_center {
  text-align: center;
}

#xbezxjlesp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xbezxjlesp .gt_font_normal {
  font-weight: normal;
}

#xbezxjlesp .gt_font_bold {
  font-weight: bold;
}

#xbezxjlesp .gt_font_italic {
  font-style: italic;
}

#xbezxjlesp .gt_super {
  font-size: 65%;
}

#xbezxjlesp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xbezxjlesp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xbezxjlesp .gt_indent_1 {
  text-indent: 5px;
}

#xbezxjlesp .gt_indent_2 {
  text-indent: 10px;
}

#xbezxjlesp .gt_indent_3 {
  text-indent: 15px;
}

#xbezxjlesp .gt_indent_4 {
  text-indent: 20px;
}

#xbezxjlesp .gt_indent_5 {
  text-indent: 25px;
}

#xbezxjlesp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#xbezxjlesp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="study" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">study</th>
<th id="compound" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">compound</th>
<th id="trial" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trial</th>
<th id="r_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r_total</th>
<th id="n_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_total</th>
<th id="is_complete" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">is_complete</th>
<th id="n_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_0</th>
<th id="n_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_1</th>
<th id="row_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">row_0</th>
<th id="row_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">row_1</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<th id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">1</th>
<td class="gt_row gt_right" headers="stub_1_1 study">1</td>
<td class="gt_row gt_left" headers="stub_1_1 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_1 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_1 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_1 n_total">61</td>
<td class="gt_row gt_right" headers="stub_1_1 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_1 n_0">32</td>
<td class="gt_row gt_right" headers="stub_1_1 n_1">29</td>
<td class="gt_row gt_right" headers="stub_1_1 row_0">1</td>
<td class="gt_row gt_right" headers="stub_1_1 row_1">2</td>
</tr>
<tr class="even">
<th id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">2</th>
<td class="gt_row gt_right" headers="stub_1_2 study">2</td>
<td class="gt_row gt_left" headers="stub_1_2 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_2 trial">SOLO 1</td>
<td class="gt_row gt_right" headers="stub_1_2 r_total">23</td>
<td class="gt_row gt_right" headers="stub_1_2 n_total">224</td>
<td class="gt_row gt_right" headers="stub_1_2 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_2 n_0">113</td>
<td class="gt_row gt_right" headers="stub_1_2 n_1">111</td>
<td class="gt_row gt_right" headers="stub_1_2 row_0">3</td>
<td class="gt_row gt_right" headers="stub_1_2 row_1">4</td>
</tr>
<tr class="odd">
<th id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">3</th>
<td class="gt_row gt_right" headers="stub_1_3 study">3</td>
<td class="gt_row gt_left" headers="stub_1_3 compound">Dupilumab</td>
<td class="gt_row gt_left" headers="stub_1_3 trial">SOLO 2</td>
<td class="gt_row gt_right" headers="stub_1_3 r_total">20</td>
<td class="gt_row gt_right" headers="stub_1_3 n_total">236</td>
<td class="gt_row gt_right" headers="stub_1_3 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_3 n_0">121</td>
<td class="gt_row gt_right" headers="stub_1_3 n_1">115</td>
<td class="gt_row gt_right" headers="stub_1_3 row_0">5</td>
<td class="gt_row gt_right" headers="stub_1_3 row_1">6</td>
</tr>
<tr class="even">
<th id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">4</th>
<td class="gt_row gt_right" headers="stub_1_4 study">4</td>
<td class="gt_row gt_left" headers="stub_1_4 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_4 trial">ECZTRA 1</td>
<td class="gt_row gt_right" headers="stub_1_4 r_total">14</td>
<td class="gt_row gt_right" headers="stub_1_4 n_total">197</td>
<td class="gt_row gt_right" headers="stub_1_4 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_4 n_0">95</td>
<td class="gt_row gt_right" headers="stub_1_4 n_1">102</td>
<td class="gt_row gt_right" headers="stub_1_4 row_0">7</td>
<td class="gt_row gt_right" headers="stub_1_4 row_1">8</td>
</tr>
<tr class="odd">
<th id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">5</th>
<td class="gt_row gt_right" headers="stub_1_5 study">5</td>
<td class="gt_row gt_left" headers="stub_1_5 compound">Tralokinumab</td>
<td class="gt_row gt_left" headers="stub_1_5 trial">ECZTRA 2</td>
<td class="gt_row gt_right" headers="stub_1_5 r_total">18</td>
<td class="gt_row gt_right" headers="stub_1_5 n_total">193</td>
<td class="gt_row gt_right" headers="stub_1_5 is_complete">1</td>
<td class="gt_row gt_right" headers="stub_1_5 n_0">93</td>
<td class="gt_row gt_right" headers="stub_1_5 n_1">100</td>
<td class="gt_row gt_right" headers="stub_1_5 row_0">9</td>
<td class="gt_row gt_right" headers="stub_1_5 row_1">10</td>
</tr>
<tr class="even">
<th id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">6</th>
<td class="gt_row gt_right" headers="stub_1_6 study">6</td>
<td class="gt_row gt_left" headers="stub_1_6 compound">Rocatinlimab</td>
<td class="gt_row gt_left" headers="stub_1_6 trial">2b</td>
<td class="gt_row gt_right" headers="stub_1_6 r_total">1</td>
<td class="gt_row gt_right" headers="stub_1_6 n_total">57</td>
<td class="gt_row gt_right" headers="stub_1_6 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_6 n_0">31</td>
<td class="gt_row gt_right" headers="stub_1_6 n_1">26</td>
<td class="gt_row gt_right" headers="stub_1_6 row_0">11</td>
<td class="gt_row gt_right" headers="stub_1_6 row_1">12</td>
</tr>
<tr class="odd">
<th id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier; font-size: x-small; background-color: #E4E4E4">7..17</th>
<td class="gt_row gt_right" headers="stub_1_7 study" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_7 compound" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_7 trial" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 r_total" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 n_total" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 is_complete" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 n_0" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 n_1" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 row_0" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_7 row_1" style="background-color: #E4E4E4"></td>
</tr>
<tr class="even">
<th id="stub_1_8" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">18</th>
<td class="gt_row gt_right" headers="stub_1_8 study">18</td>
<td class="gt_row gt_left" headers="stub_1_8 compound">Baricitinib</td>
<td class="gt_row gt_left" headers="stub_1_8 trial">BREEZE-AD2</td>
<td class="gt_row gt_right" headers="stub_1_8 r_total">11</td>
<td class="gt_row gt_right" headers="stub_1_8 n_total">244</td>
<td class="gt_row gt_right" headers="stub_1_8 is_complete">0</td>
<td class="gt_row gt_right" headers="stub_1_8 n_0">123</td>
<td class="gt_row gt_right" headers="stub_1_8 n_1">121</td>
<td class="gt_row gt_right" headers="stub_1_8 row_0">35</td>
<td class="gt_row gt_right" headers="stub_1_8 row_1">36</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>All columns with a <code>_0</code> postfix correspond to the <code>moderate</code> information available and <code>_1</code> to the respective <code>severe</code> information.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>exact_binomial_sum <span class="ot">&lt;-</span> <span class="do">## first we define the probability density for a sum of two binomials</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"binomial_sum_lpmf"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">scode =</span> <span class="st">"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="st">  // lpmf of the sum of two binomially distributed random variables</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real binomial_logit_sum_lpmf(int y, int n1, real alpha1, int n2, real alpha2) {</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="st">    // the discrete convolution here sums over all possible</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="st">    // configurations which lead to a sum of y1+y2==y</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="st">    int y1_min = max(0, y-n2);</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="st">    int y1_max = min(n1, y);</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="st">    int n_terms = y1_max - y1_min + 1;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[n_terms] log_prob;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="st">    for(i in y1_min:y1_max)</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="st">      log_prob[i - y1_min + 1] = binomial_logit_lpmf(i | n1, alpha1) + binomial_logit_lpmf(y-i | n2, alpha2);</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="st">    return log_sum_exp(log_prob);</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">block =</span> <span class="st">"functions"</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"marginal_likelihood_sum"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">scode =</span> <span class="st">"</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="st">    // likelihood on sum of Binomials (exact solution uses a discrete convolution)</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="st">    for(i in 1:n_studies) {</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="st">       if(is_complete[i] == 1)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="st">         continue;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="st">       target += binomial_logit_sum_lpmf(r_total[i] | n_0[i], mu[row_0[i]], n_1[i], mu[row_1[i]]);</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">block =</span> <span class="st">"likelihood"</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"end"</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="do">## needed for brms &lt;= 2.21 and cmdstan &gt; 2.32 to have arrays declared</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="do">## with the newer Stan syntax for arrays</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>stanvar_array <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(data))</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.integer</span>(data)) {</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">stanvar</span>(data, <span class="at">name =</span> name))</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(data, <span class="at">name =</span> name, <span class="at">scode =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"array[{n}] int {name};"</span>))</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>model_marginal_data <span class="ot">&lt;-</span> <span class="fu">with</span>(hist_pbo_wide, {</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar_array</span>(r_total) <span class="sc">+</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(is_complete) <span class="sc">+</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(n_0) <span class="sc">+</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(n_1) <span class="sc">+</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(row_0) <span class="sc">+</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(row_1) <span class="sc">+</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar</span>(<span class="fu">length</span>(row_1), <span class="st">"n_studies"</span>)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>  r_tilde <span class="sc">|</span> <span class="fu">trials</span>(n_tilde) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> oral <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">|</span> study),</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the same prior as used for modelling the subset of complete</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="co"># data only</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>full_prior <span class="ot">&lt;-</span> complete_prior</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>full_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>  full_model,</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> hist_pbo_long,</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> full_prior,</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>),</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> model_marginal_data <span class="sc">+</span> exact_binomial_sum,</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">458678</span>,</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 10.1 seconds.
Chain 2 finished in 7.7 seconds.
Chain 3 finished in 5.8 seconds.
Chain 4 finished in 6.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 7.5 seconds.
Total execution time: 30.4 seconds.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>full_mc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: r_tilde | trials(n_tilde) ~ 1 + severe + oral + (1 + severe | study) 
   Data: hist_pbo_long (Number of observations: 36) 

Multilevel Hyperparameters:
~study (Number of levels: 18) 
                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)             0.17      0.13     0.01     0.48 1.00     1436     2105
sd(severe)                0.36      0.29     0.01     1.07 1.00     2101     2120
cor(Intercept,severe)    -0.04      0.60    -0.96     0.96 1.00     3592     2574

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -1.90      0.14    -2.18    -1.64 1.00     2828     2496
severe       -1.31      0.33    -2.00    -0.71 1.00     3491     2537
oral         -0.47      0.19    -0.84    -0.07 1.00     2888     2670</code></pre>
</div>
</div>
<p>To see how the Stan model has been augmented with the <code>stanvars</code> argument above the full Stan model code can be obtained with the <code>stancode</code> command:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(full_mc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-output.var="fullStanModel">
<details class="code-fold">
<summary>Show full Stan model</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">// generated with brms 2.23.0</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">functions</span> {</span>
<span id="cb34-3"><a href="#cb34-3"></a> <span class="co">/* compute correlated group-level effects</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co">  * Args:</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">  *   z: matrix of unscaled group-level effects</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">  *   SD: vector of standard deviation parameters</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">  *   L: cholesky factor correlation matrix</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">  * Returns:</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">  *   matrix of scaled group-level effects</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">  */</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>  <span class="dt">matrix</span> scale_r_cor(<span class="dt">matrix</span> z, <span class="dt">vector</span> SD, <span class="dt">matrix</span> L) {</span>
<span id="cb34-12"><a href="#cb34-12"></a>    <span class="co">// r is stored in another dimension order than z</span></span>
<span id="cb34-13"><a href="#cb34-13"></a>    <span class="cf">return</span> transpose(diag_pre_multiply(SD, L) * z);</span>
<span id="cb34-14"><a href="#cb34-14"></a>  }</span>
<span id="cb34-15"><a href="#cb34-15"></a>  </span>
<span id="cb34-16"><a href="#cb34-16"></a>  <span class="co">// lpmf of the sum of two binomially distributed random variables</span></span>
<span id="cb34-17"><a href="#cb34-17"></a>  <span class="dt">real</span> binomial_logit_sum_lpmf(<span class="dt">int</span> y, <span class="dt">int</span> n1, <span class="dt">real</span> alpha1, <span class="dt">int</span> n2, <span class="dt">real</span> alpha2) {</span>
<span id="cb34-18"><a href="#cb34-18"></a>    <span class="co">// the discrete convolution here sums over all possible</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>    <span class="co">// configurations which lead to a sum of y1+y2==y</span></span>
<span id="cb34-20"><a href="#cb34-20"></a>    <span class="dt">int</span> y1_min = max(<span class="dv">0</span>, y-n2);</span>
<span id="cb34-21"><a href="#cb34-21"></a>    <span class="dt">int</span> y1_max = min(n1, y);</span>
<span id="cb34-22"><a href="#cb34-22"></a>    <span class="dt">int</span> n_terms = y1_max - y1_min + <span class="dv">1</span>;</span>
<span id="cb34-23"><a href="#cb34-23"></a>    <span class="dt">vector</span>[n_terms] log_prob;</span>
<span id="cb34-24"><a href="#cb34-24"></a>    <span class="cf">for</span>(i <span class="cf">in</span> y1_min:y1_max)</span>
<span id="cb34-25"><a href="#cb34-25"></a>      log_prob[i - y1_min + <span class="dv">1</span>] = binomial_logit_lpmf(i | n1, alpha1) + binomial_logit_lpmf(y-i | n2, alpha2);</span>
<span id="cb34-26"><a href="#cb34-26"></a>    <span class="cf">return</span> log_sum_exp(log_prob);</span>
<span id="cb34-27"><a href="#cb34-27"></a>  }</span>
<span id="cb34-28"><a href="#cb34-28"></a></span>
<span id="cb34-29"><a href="#cb34-29"></a>}</span>
<span id="cb34-30"><a href="#cb34-30"></a><span class="kw">data</span> {</span>
<span id="cb34-31"><a href="#cb34-31"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N;  <span class="co">// total number of observations</span></span>
<span id="cb34-32"><a href="#cb34-32"></a>  <span class="dt">array</span>[N] <span class="dt">int</span> Y;  <span class="co">// response variable</span></span>
<span id="cb34-33"><a href="#cb34-33"></a>  <span class="dt">array</span>[N] <span class="dt">int</span> trials;  <span class="co">// number of trials</span></span>
<span id="cb34-34"><a href="#cb34-34"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; K;  <span class="co">// number of population-level effects</span></span>
<span id="cb34-35"><a href="#cb34-35"></a>  <span class="dt">matrix</span>[N, K] X;  <span class="co">// population-level design matrix</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>  <span class="co">// data for group-level effects of ID 1</span></span>
<span id="cb34-37"><a href="#cb34-37"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_1;  <span class="co">// number of grouping levels</span></span>
<span id="cb34-38"><a href="#cb34-38"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; M_1;  <span class="co">// number of coefficients per level</span></span>
<span id="cb34-39"><a href="#cb34-39"></a>  <span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; J_1;  <span class="co">// grouping indicator per observation</span></span>
<span id="cb34-40"><a href="#cb34-40"></a>  <span class="co">// group-level predictor values</span></span>
<span id="cb34-41"><a href="#cb34-41"></a>  <span class="dt">vector</span>[N] Z_1_1;</span>
<span id="cb34-42"><a href="#cb34-42"></a>  <span class="dt">vector</span>[N] Z_1_2;</span>
<span id="cb34-43"><a href="#cb34-43"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; NC_1;  <span class="co">// number of group-level correlations</span></span>
<span id="cb34-44"><a href="#cb34-44"></a>  <span class="dt">int</span> prior_only;  <span class="co">// should the likelihood be ignored?</span></span>
<span id="cb34-45"><a href="#cb34-45"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> r_total;</span>
<span id="cb34-46"><a href="#cb34-46"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> is_complete;</span>
<span id="cb34-47"><a href="#cb34-47"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> n_0;</span>
<span id="cb34-48"><a href="#cb34-48"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> n_1;</span>
<span id="cb34-49"><a href="#cb34-49"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> row_0;</span>
<span id="cb34-50"><a href="#cb34-50"></a>  <span class="dt">array</span>[<span class="dv">18</span>] <span class="dt">int</span> row_1;</span>
<span id="cb34-51"><a href="#cb34-51"></a>  <span class="dt">int</span> n_studies;</span>
<span id="cb34-52"><a href="#cb34-52"></a>}</span>
<span id="cb34-53"><a href="#cb34-53"></a><span class="kw">transformed data</span> {</span>
<span id="cb34-54"><a href="#cb34-54"></a>}</span>
<span id="cb34-55"><a href="#cb34-55"></a><span class="kw">parameters</span> {</span>
<span id="cb34-56"><a href="#cb34-56"></a>  <span class="dt">vector</span>[K] b;  <span class="co">// regression coefficients</span></span>
<span id="cb34-57"><a href="#cb34-57"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[M_1] sd_1;  <span class="co">// group-level standard deviations</span></span>
<span id="cb34-58"><a href="#cb34-58"></a>  <span class="dt">matrix</span>[M_1, N_1] z_1;  <span class="co">// standardized group-level effects</span></span>
<span id="cb34-59"><a href="#cb34-59"></a>  <span class="dt">cholesky_factor_corr</span>[M_1] L_1;  <span class="co">// cholesky factor of correlation matrix</span></span>
<span id="cb34-60"><a href="#cb34-60"></a>}</span>
<span id="cb34-61"><a href="#cb34-61"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb34-62"><a href="#cb34-62"></a>  <span class="dt">matrix</span>[N_1, M_1] r_1;  <span class="co">// actual group-level effects</span></span>
<span id="cb34-63"><a href="#cb34-63"></a>  <span class="co">// using vectors speeds up indexing in loops</span></span>
<span id="cb34-64"><a href="#cb34-64"></a>  <span class="dt">vector</span>[N_1] r_1_1;</span>
<span id="cb34-65"><a href="#cb34-65"></a>  <span class="dt">vector</span>[N_1] r_1_2;</span>
<span id="cb34-66"><a href="#cb34-66"></a>  <span class="co">// prior contributions to the log posterior</span></span>
<span id="cb34-67"><a href="#cb34-67"></a>  <span class="dt">real</span> lprior = <span class="dv">0</span>;</span>
<span id="cb34-68"><a href="#cb34-68"></a>  <span class="co">// compute actual group-level effects</span></span>
<span id="cb34-69"><a href="#cb34-69"></a>  r_1 = scale_r_cor(z_1, sd_1, L_1);</span>
<span id="cb34-70"><a href="#cb34-70"></a>  r_1_1 = r_1[, <span class="dv">1</span>];</span>
<span id="cb34-71"><a href="#cb34-71"></a>  r_1_2 = r_1[, <span class="dv">2</span>];</span>
<span id="cb34-72"><a href="#cb34-72"></a>  lprior += normal_lpdf(b | <span class="dv">0</span>, <span class="fl">3.5</span>);</span>
<span id="cb34-73"><a href="#cb34-73"></a>  lprior += normal_lpdf(sd_1[<span class="dv">1</span>] | <span class="dv">0</span>, <span class="fl">3.5</span>/<span class="dv">4</span>)</span>
<span id="cb34-74"><a href="#cb34-74"></a>    - <span class="dv">1</span> * normal_lccdf(<span class="dv">0</span> | <span class="dv">0</span>, <span class="fl">3.5</span>/<span class="dv">4</span>);</span>
<span id="cb34-75"><a href="#cb34-75"></a>  lprior += normal_lpdf(sd_1[<span class="dv">2</span>] | <span class="dv">0</span>, <span class="dv">2</span> * <span class="fl">3.5</span>/<span class="dv">4</span>)</span>
<span id="cb34-76"><a href="#cb34-76"></a>    - <span class="dv">1</span> * normal_lccdf(<span class="dv">0</span> | <span class="dv">0</span>, <span class="dv">2</span> * <span class="fl">3.5</span>/<span class="dv">4</span>);</span>
<span id="cb34-77"><a href="#cb34-77"></a>  lprior += lkj_corr_cholesky_lpdf(L_1 | <span class="dv">1</span>);</span>
<span id="cb34-78"><a href="#cb34-78"></a>}</span>
<span id="cb34-79"><a href="#cb34-79"></a><span class="kw">model</span> {</span>
<span id="cb34-80"><a href="#cb34-80"></a>  <span class="co">// likelihood including constants</span></span>
<span id="cb34-81"><a href="#cb34-81"></a>  <span class="cf">if</span> (!prior_only) {</span>
<span id="cb34-82"><a href="#cb34-82"></a>    <span class="co">// initialize linear predictor term</span></span>
<span id="cb34-83"><a href="#cb34-83"></a>    <span class="dt">vector</span>[N] mu = rep_vector(<span class="fl">0.0</span>, N);</span>
<span id="cb34-84"><a href="#cb34-84"></a>    mu += X * b;</span>
<span id="cb34-85"><a href="#cb34-85"></a>    <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb34-86"><a href="#cb34-86"></a>      <span class="co">// add more terms to the linear predictor</span></span>
<span id="cb34-87"><a href="#cb34-87"></a>      mu[n] += r_1_1[J_1[n]] * Z_1_1[n] + r_1_2[J_1[n]] * Z_1_2[n];</span>
<span id="cb34-88"><a href="#cb34-88"></a>    }</span>
<span id="cb34-89"><a href="#cb34-89"></a>    <span class="kw">target +=</span> binomial_logit_lpmf(Y | trials, mu);</span>
<span id="cb34-90"><a href="#cb34-90"></a>    </span>
<span id="cb34-91"><a href="#cb34-91"></a>      <span class="co">// likelihood on sum of Binomials (exact solution uses a discrete convolution)</span></span>
<span id="cb34-92"><a href="#cb34-92"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span>:n_studies) {</span>
<span id="cb34-93"><a href="#cb34-93"></a>         <span class="cf">if</span>(is_complete[i] == <span class="dv">1</span>)</span>
<span id="cb34-94"><a href="#cb34-94"></a>           <span class="cf">continue</span>;</span>
<span id="cb34-95"><a href="#cb34-95"></a>         <span class="kw">target +=</span> binomial_logit_sum_lpmf(r_total[i] | n_0[i], mu[row_0[i]], n_1[i], mu[row_1[i]]);</span>
<span id="cb34-96"><a href="#cb34-96"></a>      }</span>
<span id="cb34-97"><a href="#cb34-97"></a></span>
<span id="cb34-98"><a href="#cb34-98"></a>  }</span>
<span id="cb34-99"><a href="#cb34-99"></a>  <span class="co">// priors including constants</span></span>
<span id="cb34-100"><a href="#cb34-100"></a>  <span class="kw">target +=</span> lprior;</span>
<span id="cb34-101"><a href="#cb34-101"></a>  <span class="kw">target +=</span> std_normal_lpdf(to_vector(z_1));</span>
<span id="cb34-102"><a href="#cb34-102"></a>}</span>
<span id="cb34-103"><a href="#cb34-103"></a><span class="kw">generated quantities</span> {</span>
<span id="cb34-104"><a href="#cb34-104"></a>  <span class="co">// compute group-level correlations</span></span>
<span id="cb34-105"><a href="#cb34-105"></a>  <span class="dt">corr_matrix</span>[M_1] Cor_1 = multiply_lower_tri_self_transpose(L_1);</span>
<span id="cb34-106"><a href="#cb34-106"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=-<span class="dv">1</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt;[NC_1] cor_1;</span>
<span id="cb34-107"><a href="#cb34-107"></a>  <span class="co">// extract upper diagonal of correlation matrix</span></span>
<span id="cb34-108"><a href="#cb34-108"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span>:M_1) {</span>
<span id="cb34-109"><a href="#cb34-109"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span>:(k - <span class="dv">1</span>)) {</span>
<span id="cb34-110"><a href="#cb34-110"></a>      cor_1[choose(k - <span class="dv">1</span>, <span class="dv">2</span>) + j] = Cor_1[j, k];</span>
<span id="cb34-111"><a href="#cb34-111"></a>    }</span>
<span id="cb34-112"><a href="#cb34-112"></a>  }</span>
<span id="cb34-113"><a href="#cb34-113"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Diagnostic plots for mixture multivariate normal densities are experimental.
Please note that these are subject to changes in future releases.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ad_meta_analysis_covariate_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Multivariate normal mixture
Outcome dimension: 3
Mixture Components:
                         comp1  comp2  comp3  comp1 
w                         0.490  0.178  0.132  0.200
m[x[inter]]              -1.885 -1.920 -1.882  0.000
m[x[severe]]             -1.264 -1.329 -1.501  0.000
m[x[active]]              0.122  0.164 -0.076  0.000
s[x[inter]]               0.172  0.426  0.217  3.500
s[x[severe]]              0.324  0.625  0.991  3.500
s[x[active]]              3.534  3.349  3.724  3.500
rho[x[severe],x[inter]]  -0.302 -0.129 -0.090  0.000
rho[x[active],x[inter]]   0.029 -0.071  0.189  0.000
rho[x[active],x[severe]] -0.019  0.033  0.031  0.000</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Dropping EM information from mixture object before serialization.</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="results"><span class="header-section-number">7.5</span> Results</h2>
<p>At this stage we have derived robust bi-variate MAP priors from the subset of the complete historical control data and the full historical control data. Now we proceed and illustrate how these priors compare, what operating characeristics these imply and how these priors can be used in the analysis of the future trial data.</p>
<p>We first load the derived robust MAP priors which are stored as JSON files. It is important to emphasize that this constitutes the information used as a prior in the new trial. That is, the previous hierarchical model for the historical data is no longer needed to analyze the future trial given that we have accuratley approximated the (robust) MAP density in parametric form.</p>
<p>Nonetheles, the prior must also be made available to <code>brms</code> as a prior density. This requires the use of <code>RBesT</code> mixture priors within <code>brms</code>. Given that these mixture priors are not known to <code>brms</code> per se, an adapter function is provided by <code>RBesT</code>, the <a href="https://opensource.nibr.com/RBesT/reference/mixstanvar.html"><code>mixstanvar</code> adapter</a>. Here, we illustrate it’s use by instantiating a <code>brms</code> model, which is used to sample from the MAP priors to characerise it’s properties.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load pre-specified prior</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>rmap_prior_protocol <span class="ot">&lt;-</span> <span class="fu">read_mix_json</span>(rmap_new_trial_file, <span class="at">rescale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>rmap_prior_complete_protocol <span class="ot">&lt;-</span> <span class="fu">read_mix_json</span>(</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  rmap_complete_new_trial_file,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rescale =</span> <span class="cn">TRUE</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># model for trial without hierarchical structure</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>trial_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(r <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> active, <span class="at">family =</span> bernoulli, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># uses as prior the multi-variate normal prior previously store on</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># file</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>trial_model_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">mixmvnorm</span>(rmap_w, rmap_m, rmap_sigma_L), <span class="at">class =</span> b)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># insert dummy data for the two strata on control only here</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>study_strata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">0</span>,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">severe =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="dv">0</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="st">"new_trial"</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co"># sample prior of the model as we like to evaluate operating</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># characteristics</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>trail_model_full_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  trial_model,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> study_strata,</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is the magic sauce from RBesT which plugs</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the multi-variate normal mixture prior into</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the brms model</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> trial_model_prior,</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvar =</span> <span class="fu">mixstanvar</span>(<span class="at">rmap =</span> rmap_prior_protocol),</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.4 seconds.
Chain 2 finished in 0.5 seconds.
Chain 3 finished in 0.7 seconds.
Chain 4 finished in 0.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.5 seconds.
Total execution time: 2.8 seconds.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>trail_model_complete_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  trial_model,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> study_strata,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> trial_model_prior,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvar =</span> <span class="fu">mixstanvar</span>(<span class="at">rmap =</span> rmap_prior_complete_protocol),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.3 seconds.
Chain 2 finished in 0.2 seconds.
Chain 3 finished in 0.5 seconds.
Chain 4 finished in 0.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.4 seconds.
Total execution time: 2.1 seconds.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain MC sample of trial prior on response scale</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>trial_prior_full_rv <span class="ot">&lt;-</span> <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  trail_model_full_mc,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="cn">TRUE</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_rv <span class="ot">&lt;-</span> <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  trail_model_complete_mc,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="cn">TRUE</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># on the response scale we form the expected response rate which</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># respects the expected percentage of severe patients.</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>w_severe <span class="ot">&lt;-</span> <span class="fl">0.45</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>trial_prior_full_mean_rv <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_severe) <span class="sc">*</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  trial_prior_full_rv[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  w_severe <span class="sc">*</span> trial_prior_full_rv[<span class="dv">2</span>]</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_mean_rv <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_severe) <span class="sc">*</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_rv[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  w_severe <span class="sc">*</span> trial_prior_complete_rv[<span class="dv">2</span>]</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>trial_prior_full_mean <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(trial_prior_full_mean_rv),</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"beta"</span>,</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_mean <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(trial_prior_complete_mean_rv),</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"beta"</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trial_prior_full_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> mean    sd  2.5% 50.0% 97.5% 
0.152 0.202 0.032 0.094 0.962 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trial_prior_complete_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> mean    sd  2.5% 50.0% 97.5% 
0.169 0.217 0.023 0.098 0.966 </code></pre>
</div>
</div>
<p>These MAP priors have been derived on the response scale and are approximated using Beta mixture priors. These correspond to the marginal prior density when assuming the quoted 45% of severe patients at baseline in the future trial. In this marginal form we can use the commonly used tools to study the trial operating characeristics when using an informative MAP prior for the control group. Note that this essentially ignores the presence of a covariate, which is a commonplace simplification for trial planning and the expectation that trial power will increase due to the explicit use of the covariate.</p>
<p>We start by considering the effective sample size of the priors:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ess</span>(trial_prior_full_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 202</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ess</span>(trial_prior_complete_mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 133</code></pre>
</div>
</div>
<p>And continue with evaluating the operating characteristics of the trial, which assume a true response rate for placebo of 9% and use as reference case a sample size of 50 per arm (100 total), which is considered for a reduction to a 2:1 ratio trial with a total of only 75 patients:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>success_crit <span class="ot">&lt;-</span> <span class="fu">decision2S</span>(<span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.6</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>), <span class="cn">FALSE</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>unif_prior <span class="ot">&lt;-</span> <span class="fu">mixbeta</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>design_noninf_11 <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, unif_prior, <span class="dv">50</span>, <span class="dv">50</span>, success_crit)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>design_noninf_21 <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, unif_prior, <span class="dv">50</span>, <span class="dv">25</span>, success_crit)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>design_complete <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_mean,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>design_full <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, trial_prior_full_mean, <span class="dv">50</span>, <span class="dv">25</span>, success_crit)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">delta =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.7</span>)), <span class="fu">aes</span>(<span class="at">x =</span> delta)) <span class="sc">+</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_full</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"Full data"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_complete</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"Complete only data"</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_noninf_21</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"No prior 50:25"</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_noninf_11</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"No prior 50:50"</span>)</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Prior"</span>) <span class="sc">+</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Power"</span>, <span class="at">subtitle =</span> <span class="st">"Assumed placebo response rate of 9%"</span>) <span class="sc">+</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Response rate difference active to placebo"</span>) <span class="sc">+</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Power"</span>) <span class="sc">+</span></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ad_meta_analysis_covariate_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The MAP priors do improve the power to detect a difference to control here. The difference between the full and complete only prior is not quite pronounced. This can also be seen by considering the critical values tabulated by a given number of responders in the placebo group:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>crit_complete <span class="ot">&lt;-</span> <span class="fu">decision2S_boundary</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_mean,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>crit_full <span class="ot">&lt;-</span> <span class="fu">decision2S_boundary</span>(</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  trial_prior_full_mean,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">r_placebo =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_complete =</span> <span class="fu">crit_complete</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_full =</span> <span class="fu">crit_full</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_complete =</span> <span class="fu">if_else</span>(</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>      min_r_active_complete <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span>,</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>      min_r_active_complete <span class="sc">/</span> <span class="dv">50</span> <span class="sc">-</span> r_placebo <span class="sc">/</span> <span class="dv">25</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_full =</span> <span class="fu">if_else</span>(</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>      min_r_active_full <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span>,</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>      min_r_active_full <span class="sc">/</span> <span class="dv">50</span> <span class="sc">-</span> r_placebo <span class="sc">/</span> <span class="dv">25</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>(<span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"min_r"</span>), <span class="fu">starts_with</span>(<span class="st">"r_"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="fu">starts_with</span>(<span class="st">"min_obs"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">html</span>(<span class="st">"Minimal active&lt;br&gt;responders"</span>),</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"min_r"</span>)</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">html</span>(<span class="st">"Minimal observed&lt;br&gt;difference"</span>),</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"min_obs"</span>)</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_complete =</span> <span class="fu">html</span>(<span class="st">"Complete&lt;br&gt;only"</span>),</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_full =</span> <span class="st">"Full"</span>,</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_complete =</span> <span class="fu">html</span>(<span class="st">"Complete&lt;br&gt;only"</span>),</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_full =</span> <span class="st">"Full"</span>,</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_placebo =</span> <span class="fu">html</span>(<span class="st">"Responder&lt;br&gt;Placebo"</span>)</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="idnworcyzq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#idnworcyzq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#idnworcyzq thead, #idnworcyzq tbody, #idnworcyzq tfoot, #idnworcyzq tr, #idnworcyzq td, #idnworcyzq th {
  border-style: none;
}

#idnworcyzq p {
  margin: 0;
  padding: 0;
}

#idnworcyzq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#idnworcyzq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#idnworcyzq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#idnworcyzq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#idnworcyzq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#idnworcyzq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idnworcyzq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#idnworcyzq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#idnworcyzq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#idnworcyzq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#idnworcyzq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#idnworcyzq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#idnworcyzq .gt_spanner_row {
  border-bottom-style: hidden;
}

#idnworcyzq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#idnworcyzq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#idnworcyzq .gt_from_md > :first-child {
  margin-top: 0;
}

#idnworcyzq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#idnworcyzq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#idnworcyzq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#idnworcyzq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#idnworcyzq .gt_row_group_first td {
  border-top-width: 2px;
}

#idnworcyzq .gt_row_group_first th {
  border-top-width: 2px;
}

#idnworcyzq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#idnworcyzq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#idnworcyzq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#idnworcyzq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idnworcyzq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#idnworcyzq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#idnworcyzq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#idnworcyzq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#idnworcyzq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#idnworcyzq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#idnworcyzq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#idnworcyzq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#idnworcyzq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#idnworcyzq .gt_left {
  text-align: left;
}

#idnworcyzq .gt_center {
  text-align: center;
}

#idnworcyzq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#idnworcyzq .gt_font_normal {
  font-weight: normal;
}

#idnworcyzq .gt_font_bold {
  font-weight: bold;
}

#idnworcyzq .gt_font_italic {
  font-style: italic;
}

#idnworcyzq .gt_super {
  font-size: 65%;
}

#idnworcyzq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#idnworcyzq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#idnworcyzq .gt_indent_1 {
  text-indent: 5px;
}

#idnworcyzq .gt_indent_2 {
  text-indent: 10px;
}

#idnworcyzq .gt_indent_3 {
  text-indent: 15px;
}

#idnworcyzq .gt_indent_4 {
  text-indent: 20px;
}

#idnworcyzq .gt_indent_5 {
  text-indent: 25px;
}

#idnworcyzq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#idnworcyzq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="r_placebo" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Responder<br>
Placebo</th>
<th colspan="2" id="Minimal active<br>responders" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Minimal active<br>
responders
</div></th>
<th colspan="2" id="Minimal observed<br>difference" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Minimal observed<br>
difference
</div></th>
</tr>
<tr class="gt_col_headings even">
<th id="min_r_active_complete" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Complete<br>
only</th>
<th id="min_r_active_full" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Full</th>
<th id="min_obs_delta_complete" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Complete<br>
only</th>
<th id="min_obs_delta_full" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Full</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">0</td>
<td class="gt_row gt_right" headers="min_r_active_complete">22</td>
<td class="gt_row gt_right" headers="min_r_active_full">22</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">44%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">44%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">1</td>
<td class="gt_row gt_right" headers="min_r_active_complete">23</td>
<td class="gt_row gt_right" headers="min_r_active_full">23</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">42%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">42%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">2</td>
<td class="gt_row gt_right" headers="min_r_active_complete">24</td>
<td class="gt_row gt_right" headers="min_r_active_full">23</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">40%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">38%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">3</td>
<td class="gt_row gt_right" headers="min_r_active_complete">24</td>
<td class="gt_row gt_right" headers="min_r_active_full">24</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">36%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">36%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">4</td>
<td class="gt_row gt_right" headers="min_r_active_complete">24</td>
<td class="gt_row gt_right" headers="min_r_active_full">24</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">32%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">32%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">5</td>
<td class="gt_row gt_right" headers="min_r_active_complete">25</td>
<td class="gt_row gt_right" headers="min_r_active_full">25</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">30%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">30%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">6</td>
<td class="gt_row gt_right" headers="min_r_active_complete">27</td>
<td class="gt_row gt_right" headers="min_r_active_full">26</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">30%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">28%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">7</td>
<td class="gt_row gt_right" headers="min_r_active_complete">31</td>
<td class="gt_row gt_right" headers="min_r_active_full">30</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">32%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">8</td>
<td class="gt_row gt_right" headers="min_r_active_complete">34</td>
<td class="gt_row gt_right" headers="min_r_active_full">33</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">36%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">9</td>
<td class="gt_row gt_right" headers="min_r_active_complete">36</td>
<td class="gt_row gt_right" headers="min_r_active_full">36</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">36%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">36%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">10</td>
<td class="gt_row gt_right" headers="min_r_active_complete">38</td>
<td class="gt_row gt_right" headers="min_r_active_full">37</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">36%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">11</td>
<td class="gt_row gt_right" headers="min_r_active_complete">39</td>
<td class="gt_row gt_right" headers="min_r_active_full">39</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">12</td>
<td class="gt_row gt_right" headers="min_r_active_complete">41</td>
<td class="gt_row gt_right" headers="min_r_active_full">41</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">13</td>
<td class="gt_row gt_right" headers="min_r_active_complete">43</td>
<td class="gt_row gt_right" headers="min_r_active_full">43</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">14</td>
<td class="gt_row gt_right" headers="min_r_active_complete">45</td>
<td class="gt_row gt_right" headers="min_r_active_full">45</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">15</td>
<td class="gt_row gt_right" headers="min_r_active_complete">47</td>
<td class="gt_row gt_right" headers="min_r_active_full">46</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">32%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">16</td>
<td class="gt_row gt_right" headers="min_r_active_complete">49</td>
<td class="gt_row gt_right" headers="min_r_active_full">49</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">34%</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">34%</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">17</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">18</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">19</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">20</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">21</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">22</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">23</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="r_placebo">24</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="r_placebo">25</td>
<td class="gt_row gt_right" headers="min_r_active_complete">0</td>
<td class="gt_row gt_right" headers="min_r_active_full">0</td>
<td class="gt_row gt_right" headers="min_obs_delta_complete">—</td>
<td class="gt_row gt_right" headers="min_obs_delta_full">—</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conclusion" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">7.6</span> Conclusion</h2>
<p>This case study demonstrates how we may use historical control data which requires the use of a baseline covariate. This complicates the derivation of a MAP prior in two ways: (i) we are then required to derive an informative MAP prior for the intercept and the slope parameters of the respective model and (ii) the information we need from the historical data may only be given in partial form. This former complication can be resolved by a latent variable approach which we marginalize for the trials with only partial information such that we can make use of the partial data as given. This illustrates how we can use two different likelihoods within the very same <code>brms</code> model.</p>
<p>We completed the case study by illustrating the operating characteristics of a potential future trial in a simplified manner by considering the marginalized response rate. These analyses showed that there is indeed a benefit to use a MAP prior in this cotext. However, the differences between using a MAP prior based on the full and complete data only priors are not marked. Still, the ability to use the full data set without further assumptions (the distribution of the Binomial sum is calculated in an exact manner) is preferable over dismissing relevant historical control data.</p>
</section>
<section id="exercises" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.7</span> Exercises</h2>
<p>Use a normal approximation instead of the exact binomial convolution for incorporating the partially reported data. Study the differences to the case of using the exact Binomial convolution.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02ac_meta_analysis_strata.html" class="pagination-link" aria-label="Use of historical control data with stratification">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/02k_nuisance.html" class="pagination-link" aria-label="Nuisance parameters, expected power and the &quot;significance threshold&quot;">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Yingying Wang - &lt;yingying.wang@novartis.com&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Sebastian Weber - &lt;sebastian.weber@novartis.com&gt;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use of historical control data with a covariate {#sec-use-hist-control-data-cov}</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- https://raw.githubusercontent.com/Novartis/bamdd/main/src/_macros.qmd --&gt;</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>{{&lt; include _macros.qmd &gt;}}</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>The use of baseline covariates for trial analysis is frequently</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>applied in practice whenever known prognostic factors are relevant in</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>the context of the study population. This can complicate the use of</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>historical control information in particular for a non-normal endpoint</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>for which the respective generalized linear models are often not</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>collapsible. This case study demonstrates</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>setting up a bi-variate meta-analysis for a binary endpoint to</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  borrow information on the intercept and a baseline covariate effect</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  from historical data</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how we can make use of incomplete responder data as one often</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  encounters in practice (responder data not given for each level of a</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  categorical covariate)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how two different likelihoods can be used with custom Stan code</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  adapting the <span class="in">`brms`</span> generated Stan model</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how to summarize with a multi-variate normal mixture the MAP prior</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  with covariates</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how to use the multi-variate normal mixture MAP prior as a prior</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  for the main analysis using <span class="in">`brms`</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these libraries</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>and options first:</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE,cache=FALSE}</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RBesT)</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/02ad_meta_analysis_covariate.qmd"</span>)</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="dv">12</span>))</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">57339</span>)</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a><span class="co"># allow for wider and prettier printing</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">140</span>, <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a><span class="co"># make brms less verbose</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.short_summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="dummy"}</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview Video</span></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>{{&lt; video videos/brms-20250428-map-binomial-covariate.mp4 &gt;}}</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE, eval=TRUE, cache=FALSE}</span></span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible to the reader additional setup steps, which are optional</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"src"</span>, <span class="st">"setup.R"</span>))</span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>Atopic dermatitis (AD) is an inflammation of the skin. It's prevalence</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>is substantial in the population and various treatments have been</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>studied to date. Therefore, a substantial amount of data has been</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>generated to date on experimental treatments for AD and along with it</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>on placebo treated patient data. Given that treatment procedures are</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>well standardized the historical data on placebo treatments is</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>relevant for future trials in the indication.</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>One of the standard clinical endpoints is the investigator global</span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>assessment (IGA) score which ranges from 0 (clear) to 4</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>(severe). Changes in this score over a time-span of 16 weeks compared</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>to baseline when treatment is initiated is used to evaluate the</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>efficacy of treatments. Derived from the IGA score one often considers</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>the binary IGA response status defined as an improvement of at least 2</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>points and reaching either 0 or 1 (clear or almost clear) IGA</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>score. By construction of the score the initial status at baseline</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>being moderate or severe is a prognostic factor for reaching IGA</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>response by week 16 or not as it is harder to reach response whenever</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>one has baseline score 4 (severe) at baseline in comparison to score 3</span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>(moderate).</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a>As a consequence, patients are often stratified by baseline response</span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>score into moderate and severe for trials studying this</span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>population. While most trials report the baseline distribution of</span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>the number of moderate and severe patients, only a fraction of trials</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a>report the outcome responder data stratified by baseline response</span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>data, which is a complication for using this historical data whenever</span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>one wishes to leverage the historical data.</span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a>In the following we illustrate how an informative MAP prior is derived</span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>in such a situation. Historical data on a placebo treatment for use in</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>a future trial is used as we are aiming to reduce the required sample</span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>size in the placebo arm while maintaining appropiate power to detect a</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a>treatment effect in a two arm trial.</span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data}</span></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a>hist_pbo <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">study =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, </span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a><span class="st">"9"</span>, <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"13"</span>, <span class="st">"14"</span>, <span class="st">"15"</span>, <span class="st">"16"</span>, <span class="st">"17"</span>, <span class="st">"18"</span>),</span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a><span class="at">compound =</span> <span class="fu">c</span>(<span class="st">"Dupilumab"</span>, </span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a><span class="st">"Dupilumab"</span>, <span class="st">"Dupilumab"</span>, <span class="st">"Tralokinumab"</span>, <span class="st">"Tralokinumab"</span>, <span class="st">"Rocatinlimab"</span>, </span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a><span class="st">"Lebrikizumab"</span>, <span class="st">"Lebrikizumab"</span>, <span class="st">"Lebrikizumab"</span>, <span class="st">"Amlitelimab"</span>, </span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a><span class="st">"Upadacitinib"</span>, <span class="st">"Upadacitinib"</span>, <span class="st">"Upadacitinib"</span>, <span class="st">"Abrocitinib"</span>, </span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a><span class="st">"Abrocitinib"</span>, <span class="st">"Abrocitinib"</span>, <span class="st">"Baricitinib"</span>, <span class="st">"Baricitinib"</span>), </span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">trial =</span> <span class="fu">c</span>(<span class="st">"2b"</span>, <span class="st">"SOLO 1"</span>, <span class="st">"SOLO 2"</span>, <span class="st">"ECZTRA 1"</span>, <span class="st">"ECZTRA 2"</span>, </span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2b"</span>, <span class="st">"D"</span>, <span class="st">"ADvocate1"</span>, <span class="st">"ADvocate2"</span>, <span class="st">"2a"</span>, <span class="st">"2"</span>, <span class="st">"Measure Up 1"</span>, </span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Measure Up 2"</span>, <span class="st">"2b"</span>, <span class="st">"JADE MONO 2"</span>, <span class="st">"JADE MONO 1"</span>, <span class="st">"BREEZE-AD1"</span>, </span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BREEZE-AD2"</span>), <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">61</span>L, <span class="dv">224</span>L, <span class="dv">236</span>L, <span class="dv">197</span>L, <span class="dv">193</span>L, <span class="dv">57</span>L, <span class="dv">52</span>L, </span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a>    <span class="dv">141</span>L, <span class="dv">146</span>L, <span class="dv">24</span>L, <span class="dv">41</span>L, <span class="dv">281</span>L, <span class="dv">278</span>L, <span class="dv">52</span>L, <span class="dv">78</span>L, <span class="dv">77</span>L, <span class="dv">249</span>L, <span class="dv">244</span>L</span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">r_ovrall =</span> <span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">23</span>L, <span class="dv">20</span>L, <span class="dv">14</span>L, <span class="dv">18</span>L, <span class="dv">1</span>L, <span class="dv">8</span>L, <span class="dv">18</span>L, <span class="dv">16</span>L, </span>
<span id="cb55-134"><a href="#cb55-134" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">24</span>L, <span class="dv">13</span>L, <span class="dv">3</span>L, <span class="dv">7</span>L, <span class="dv">6</span>L, <span class="dv">12</span>L, <span class="dv">11</span>L), <span class="at">n_severe =</span> <span class="fu">c</span>(<span class="dv">29</span>L, </span>
<span id="cb55-135"><a href="#cb55-135" aria-hidden="true" tabindex="-1"></a>    <span class="dv">111</span>L, <span class="dv">115</span>L, <span class="dv">102</span>L, <span class="dv">100</span>L, <span class="dv">26</span>L, <span class="dv">20</span>L, <span class="dv">58</span>L, <span class="dv">51</span>L, <span class="dv">15</span>L, <span class="dv">23</span>L, <span class="dv">125</span>L, </span>
<span id="cb55-136"><a href="#cb55-136" aria-hidden="true" tabindex="-1"></a>    <span class="dv">153</span>L, <span class="dv">20</span>L, <span class="dv">26</span>L, <span class="dv">31</span>L, <span class="dv">105</span>L, <span class="dv">121</span>L), <span class="at">r_mod =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">16</span>L, <span class="dv">17</span>L, </span>
<span id="cb55-137"><a href="#cb55-137" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span>L, <span class="dv">13</span>L, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">6</span>L, <span class="dv">5</span>L, <span class="cn">NA</span>, </span>
<span id="cb55-138"><a href="#cb55-138" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>), <span class="at">r_severe =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">7</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">5</span>L, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, </span>
<span id="cb55-139"><a href="#cb55-139" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">use_for_CMK =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"Yes"</span>, </span>
<span id="cb55-140"><a href="#cb55-140" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, </span>
<span id="cb55-141"><a href="#cb55-141" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="st">"Yes"</span>), <span class="at">start_time =</span> <span class="fu">c</span>(<span class="st">"2013 May"</span>, </span>
<span id="cb55-142"><a href="#cb55-142" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2014 Oct"</span>, <span class="st">"2014 Dec"</span>, <span class="st">"2017 May"</span>, <span class="st">"2017 Jun"</span>, <span class="st">"2018"</span>, <span class="st">"2018 Jan"</span>, </span>
<span id="cb55-143"><a href="#cb55-143" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2019"</span>, <span class="st">"2019"</span>, <span class="st">"2018 Dec"</span>, <span class="st">"2016"</span>, <span class="st">"2018"</span>, <span class="st">"2018"</span>, <span class="st">"2016"</span>, </span>
<span id="cb55-144"><a href="#cb55-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2017"</span>, <span class="st">"2018"</span>, <span class="st">"2017"</span>, <span class="st">"2018"</span>), <span class="at">oral =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, </span>
<span id="cb55-145"><a href="#cb55-145" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L)) <span class="sc">|&gt;</span></span>
<span id="cb55-146"><a href="#cb55-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start_year=</span><span class="fu">as.integer</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(start_time, <span class="st">"^[0-9]+"</span>)),</span>
<span id="cb55-147"><a href="#cb55-147" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_complete=</span><span class="dv">1</span><span class="sc">*</span><span class="fu">is.na</span>(r_mod)) <span class="sc">|&gt;</span></span>
<span id="cb55-148"><a href="#cb55-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>use_for_CMK) <span class="sc">|&gt;</span></span>
<span id="cb55-149"><a href="#cb55-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(study, compound, trial, start_time, n, n_severe)</span>
<span id="cb55-150"><a href="#cb55-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-151"><a href="#cb55-151" aria-hidden="true" tabindex="-1"></a><span class="co"># long format</span></span>
<span id="cb55-152"><a href="#cb55-152" aria-hidden="true" tabindex="-1"></a>hist_pbo_long <span class="ot">&lt;-</span> hist_pbo <span class="sc">|&gt;</span></span>
<span id="cb55-153"><a href="#cb55-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_mod =</span> n <span class="sc">-</span> n_severe) <span class="sc">|&gt;</span></span>
<span id="cb55-154"><a href="#cb55-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb55-155"><a href="#cb55-155" aria-hidden="true" tabindex="-1"></a>    compound,</span>
<span id="cb55-156"><a href="#cb55-156" aria-hidden="true" tabindex="-1"></a>    trial,</span>
<span id="cb55-157"><a href="#cb55-157" aria-hidden="true" tabindex="-1"></a>    study,</span>
<span id="cb55-158"><a href="#cb55-158" aria-hidden="true" tabindex="-1"></a>    start_year,</span>
<span id="cb55-159"><a href="#cb55-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_total =</span> r_ovrall,</span>
<span id="cb55-160"><a href="#cb55-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_total =</span> n,</span>
<span id="cb55-161"><a href="#cb55-161" aria-hidden="true" tabindex="-1"></a>    r_mod,</span>
<span id="cb55-162"><a href="#cb55-162" aria-hidden="true" tabindex="-1"></a>    n_mod,</span>
<span id="cb55-163"><a href="#cb55-163" aria-hidden="true" tabindex="-1"></a>    r_severe,</span>
<span id="cb55-164"><a href="#cb55-164" aria-hidden="true" tabindex="-1"></a>    n_severe,</span>
<span id="cb55-165"><a href="#cb55-165" aria-hidden="true" tabindex="-1"></a>    oral</span>
<span id="cb55-166"><a href="#cb55-166" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-167"><a href="#cb55-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(r_mod, r_severe), <span class="at">names_to =</span> <span class="st">"severe"</span>, <span class="at">values_to =</span> <span class="st">"r"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-168"><a href="#cb55-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-169"><a href="#cb55-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">severe =</span> <span class="fu">if_else</span>(severe <span class="sc">==</span> <span class="st">"r_mod"</span>, <span class="dv">0</span>L, <span class="dv">1</span>L),</span>
<span id="cb55-170"><a href="#cb55-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">if_else</span>(severe <span class="sc">==</span> <span class="dv">0</span>, n_mod, n_severe),</span>
<span id="cb55-171"><a href="#cb55-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_mod =</span> <span class="cn">NULL</span>,</span>
<span id="cb55-172"><a href="#cb55-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_severe =</span> <span class="cn">NULL</span>,</span>
<span id="cb55-173"><a href="#cb55-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_tilde =</span> <span class="fu">replace_na</span>(r, <span class="dv">0</span>),</span>
<span id="cb55-174"><a href="#cb55-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_tilde =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(r), <span class="dv">0</span>, n),</span>
<span id="cb55-175"><a href="#cb55-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb55-176"><a href="#cb55-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_complete =</span> <span class="dv">1</span>L <span class="sc">*</span> <span class="sc">!</span><span class="fu">is.na</span>(r)</span>
<span id="cb55-177"><a href="#cb55-177" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-178"><a href="#cb55-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(study, compound, trial, severe, oral, r, n, is_complete)</span>
<span id="cb55-179"><a href="#cb55-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-180"><a href="#cb55-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-181"><a href="#cb55-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-182"><a href="#cb55-182" aria-hidden="true" tabindex="-1"></a>We consider the planning stage of a potential new trial in the</span>
<span id="cb55-183"><a href="#cb55-183" aria-hidden="true" tabindex="-1"></a>indication of AD. Let's assume that an initial search for relevant</span>
<span id="cb55-184"><a href="#cb55-184" aria-hidden="true" tabindex="-1"></a>historical control data in the literature lead to the following set of</span>
<span id="cb55-185"><a href="#cb55-185" aria-hidden="true" tabindex="-1"></a>identified historical trials:</span>
<span id="cb55-186"><a href="#cb55-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-189"><a href="#cb55-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-190"><a href="#cb55-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-191"><a href="#cb55-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-192"><a href="#cb55-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-193"><a href="#cb55-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-194"><a href="#cb55-194" aria-hidden="true" tabindex="-1"></a>hist_pbo <span class="sc">|&gt;</span></span>
<span id="cb55-195"><a href="#cb55-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>start_year) <span class="sc">|&gt;</span></span>
<span id="cb55-196"><a href="#cb55-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">compound =</span> <span class="fu">abbreviate</span>(compound, <span class="dv">6</span>)) <span class="sc">|&gt;</span></span>
<span id="cb55-197"><a href="#cb55-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-198"><a href="#cb55-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-199"><a href="#cb55-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-200"><a href="#cb55-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grand_summary_rows</span>(</span>
<span id="cb55-201"><a href="#cb55-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(n, n_severe, r_ovrall, r_mod, r_severe, oral, is_complete),</span>
<span id="cb55-202"><a href="#cb55-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">fns =</span> <span class="fu">list</span>(</span>
<span id="cb55-203"><a href="#cb55-203" aria-hidden="true" tabindex="-1"></a>      min <span class="sc">~</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-204"><a href="#cb55-204" aria-hidden="true" tabindex="-1"></a>      max <span class="sc">~</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-205"><a href="#cb55-205" aria-hidden="true" tabindex="-1"></a>      avg <span class="sc">~</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-206"><a href="#cb55-206" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-207"><a href="#cb55-207" aria-hidden="true" tabindex="-1"></a>    <span class="at">fmt =</span> <span class="fu">list</span>(</span>
<span id="cb55-208"><a href="#cb55-208" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">fmt_percent</span>(., <span class="at">columns =</span> <span class="fu">c</span>(is_complete, oral), <span class="at">decimals =</span> <span class="dv">1</span>),</span>
<span id="cb55-209"><a href="#cb55-209" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">fmt_number</span>(</span>
<span id="cb55-210"><a href="#cb55-210" aria-hidden="true" tabindex="-1"></a>        .,</span>
<span id="cb55-211"><a href="#cb55-211" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> <span class="sc">!</span><span class="fu">c</span>(is_complete, oral),</span>
<span id="cb55-212"><a href="#cb55-212" aria-hidden="true" tabindex="-1"></a>        <span class="at">use_seps =</span> <span class="cn">FALSE</span>,</span>
<span id="cb55-213"><a href="#cb55-213" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb55-214"><a href="#cb55-214" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb55-215"><a href="#cb55-215" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-216"><a href="#cb55-216" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-217"><a href="#cb55-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-218"><a href="#cb55-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-219"><a href="#cb55-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-220"><a href="#cb55-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-221"><a href="#cb55-221" aria-hidden="true" tabindex="-1"></a>A graphical overview of the data as a forest plot showing the</span>
<span id="cb55-222"><a href="#cb55-222" aria-hidden="true" tabindex="-1"></a>historical responder data in separate for moderate and severe (when</span>
<span id="cb55-223"><a href="#cb55-223" aria-hidden="true" tabindex="-1"></a>available) and as overall number of responders:</span>
<span id="cb55-224"><a href="#cb55-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-227"><a href="#cb55-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-228"><a href="#cb55-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-229"><a href="#cb55-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-230"><a href="#cb55-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-231"><a href="#cb55-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb55-232"><a href="#cb55-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-233"><a href="#cb55-233" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(forestplot))</span>
<span id="cb55-234"><a href="#cb55-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-235"><a href="#cb55-235" aria-hidden="true" tabindex="-1"></a>hist_pbo_forest <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb55-236"><a href="#cb55-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hist_pbo_long, study, compound, trial, r, n, <span class="at">case =</span> severe),</span>
<span id="cb55-237"><a href="#cb55-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb55-238"><a href="#cb55-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(hist_pbo_long, severe <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb55-239"><a href="#cb55-239" aria-hidden="true" tabindex="-1"></a>    study,</span>
<span id="cb55-240"><a href="#cb55-240" aria-hidden="true" tabindex="-1"></a>    compound,</span>
<span id="cb55-241"><a href="#cb55-241" aria-hidden="true" tabindex="-1"></a>    trial,</span>
<span id="cb55-242"><a href="#cb55-242" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> r_total,</span>
<span id="cb55-243"><a href="#cb55-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> n_total</span>
<span id="cb55-244"><a href="#cb55-244" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-245"><a href="#cb55-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">case =</span> <span class="dv">2</span>)</span>
<span id="cb55-246"><a href="#cb55-246" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb55-247"><a href="#cb55-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-248"><a href="#cb55-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-249"><a href="#cb55-249" aria-hidden="true" tabindex="-1"></a>    <span class="at">case =</span> <span class="fu">factor</span>(case, <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Moderate"</span>, <span class="st">"Severe"</span>, <span class="st">"Overall"</span>)),</span>
<span id="cb55-250"><a href="#cb55-250" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> r <span class="sc">/</span> n,</span>
<span id="cb55-251"><a href="#cb55-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">BinaryExactCI</span>(r, n)[<span class="dv">1</span>],</span>
<span id="cb55-252"><a href="#cb55-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">BinaryExactCI</span>(r, n)[<span class="dv">2</span>]</span>
<span id="cb55-253"><a href="#cb55-253" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-254"><a href="#cb55-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb55-255"><a href="#cb55-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-256"><a href="#cb55-256" aria-hidden="true" tabindex="-1"></a>hist_pbo_forest <span class="ot">&lt;-</span> hist_pbo_forest <span class="sc">|&gt;</span></span>
<span id="cb55-257"><a href="#cb55-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(hist_pbo, study, <span class="at">n_total =</span> n, n_severe), <span class="at">by =</span> <span class="st">"study"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-258"><a href="#cb55-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-259"><a href="#cb55-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">study =</span> <span class="fu">as.numeric</span>(study),</span>
<span id="cb55-260"><a href="#cb55-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent_severe =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n_severe <span class="sc">/</span> n_total, <span class="dv">0</span>)</span>
<span id="cb55-261"><a href="#cb55-261" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-262"><a href="#cb55-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(study, case)</span>
<span id="cb55-263"><a href="#cb55-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-264"><a href="#cb55-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-265"><a href="#cb55-265" aria-hidden="true" tabindex="-1"></a>hist_pbo_forest <span class="sc">|&gt;</span></span>
<span id="cb55-266"><a href="#cb55-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(case) <span class="sc">|&gt;</span></span>
<span id="cb55-267"><a href="#cb55-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forestplot</span>(</span>
<span id="cb55-268"><a href="#cb55-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">labeltext =</span> <span class="fu">c</span>(trial, compound, n_total, percent_severe),</span>
<span id="cb55-269"><a href="#cb55-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">clip =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb55-270"><a href="#cb55-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">"Response rate"</span></span>
<span id="cb55-271"><a href="#cb55-271" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-272"><a href="#cb55-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fp_set_style</span>(<span class="at">box =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb55-273"><a href="#cb55-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fp_add_header</span>(</span>
<span id="cb55-274"><a href="#cb55-274" aria-hidden="true" tabindex="-1"></a>    <span class="at">compound =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Compound"</span>),</span>
<span id="cb55-275"><a href="#cb55-275" aria-hidden="true" tabindex="-1"></a>    <span class="at">trial =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Trial"</span>),</span>
<span id="cb55-276"><a href="#cb55-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_total =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"N"</span>),</span>
<span id="cb55-277"><a href="#cb55-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent_severe =</span> <span class="fu">c</span>(<span class="st">"Severe"</span>, <span class="st">"[%]"</span>)</span>
<span id="cb55-278"><a href="#cb55-278" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-279"><a href="#cb55-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-280"><a href="#cb55-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-281"><a href="#cb55-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-282"><a href="#cb55-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model description</span></span>
<span id="cb55-283"><a href="#cb55-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-284"><a href="#cb55-284" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trial analysis model</span></span>
<span id="cb55-285"><a href="#cb55-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-286"><a href="#cb55-286" aria-hidden="true" tabindex="-1"></a>The aim is to decrease the sample size of the placebo arm in a future</span>
<span id="cb55-287"><a href="#cb55-287" aria-hidden="true" tabindex="-1"></a>placebo controlled trial. To start, we first define the analysis model</span>
<span id="cb55-288"><a href="#cb55-288" aria-hidden="true" tabindex="-1"></a>used for the future trial. We assume that the trial enrolls patients</span>
<span id="cb55-289"><a href="#cb55-289" aria-hidden="true" tabindex="-1"></a>with either an IGA score of 3 (moderate) or 4 (severe). The baseline</span>
<span id="cb55-290"><a href="#cb55-290" aria-hidden="true" tabindex="-1"></a>severity is a clinically relevant prognostic factor for</span>
<span id="cb55-291"><a href="#cb55-291" aria-hidden="true" tabindex="-1"></a>response. Therefore, we assume that the trial analysis accounts for a</span>
<span id="cb55-292"><a href="#cb55-292" aria-hidden="true" tabindex="-1"></a>patient's disease status at baseline via an indicator <span class="in">`severe`</span></span>
<span id="cb55-293"><a href="#cb55-293" aria-hidden="true" tabindex="-1"></a>resulting in the analysis model of the binary IGA responder outcome as</span>
<span id="cb55-294"><a href="#cb55-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-295"><a href="#cb55-295" aria-hidden="true" tabindex="-1"></a>$$ r_i|\theta_i \sim \text{Bernoulli}(\theta_i) $$</span>
<span id="cb55-296"><a href="#cb55-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-297"><a href="#cb55-297" aria-hidden="true" tabindex="-1"></a>$$ \text{logit}(\theta_i) = \alpha_0 + I(\text{severe}_i) \, \beta_1 + I(\text{active}_i) \, \beta_2 . $$</span>
<span id="cb55-298"><a href="#cb55-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-299"><a href="#cb55-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-300"><a href="#cb55-300" aria-hidden="true" tabindex="-1"></a>Our goal is not to derive from the historical data above informative</span>
<span id="cb55-301"><a href="#cb55-301" aria-hidden="true" tabindex="-1"></a>priors for the overall intercept $\alpha_0$ *and* the covariate effect</span>
<span id="cb55-302"><a href="#cb55-302" aria-hidden="true" tabindex="-1"></a>due to baseline disease status $\beta_1$.</span>
<span id="cb55-303"><a href="#cb55-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-304"><a href="#cb55-304" aria-hidden="true" tabindex="-1"></a><span class="fu">### Historical control data synthesis</span></span>
<span id="cb55-305"><a href="#cb55-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-306"><a href="#cb55-306" aria-hidden="true" tabindex="-1"></a>Aggregate historical data necessitates adapting the trial analysis</span>
<span id="cb55-307"><a href="#cb55-307" aria-hidden="true" tabindex="-1"></a>model in several ways. First, the Bernoulli likelihood for each</span>
<span id="cb55-308"><a href="#cb55-308" aria-hidden="true" tabindex="-1"></a>individual patient $i$ is transferred to an equivalent Binomial</span>
<span id="cb55-309"><a href="#cb55-309" aria-hidden="true" tabindex="-1"></a>likelihood. Additionally, since each patient is classified as either</span>
<span id="cb55-310"><a href="#cb55-310" aria-hidden="true" tabindex="-1"></a>moderate ($l = 0$) or severe ($l = 1$), it becomes</span>
<span id="cb55-311"><a href="#cb55-311" aria-hidden="true" tabindex="-1"></a>necessary to introduce a pair of Binomial likelihood terms for each</span>
<span id="cb55-312"><a href="#cb55-312" aria-hidden="true" tabindex="-1"></a>historical study ($h$), with one term corresponding to each baseline</span>
<span id="cb55-313"><a href="#cb55-313" aria-hidden="true" tabindex="-1"></a>disease severity level.</span>
<span id="cb55-314"><a href="#cb55-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-315"><a href="#cb55-315" aria-hidden="true" tabindex="-1"></a>Furthermore, the inclusion of the covariate effect for baseline</span>
<span id="cb55-316"><a href="#cb55-316" aria-hidden="true" tabindex="-1"></a>severity requires deriving a MAP prior for both</span>
<span id="cb55-317"><a href="#cb55-317" aria-hidden="true" tabindex="-1"></a>the intercept and the log odds ratio of the covariate effect. If only</span>
<span id="cb55-318"><a href="#cb55-318" aria-hidden="true" tabindex="-1"></a>a MAP prior were derived for the intercept while assigning a</span>
<span id="cb55-319"><a href="#cb55-319" aria-hidden="true" tabindex="-1"></a>non-informative prior to the covariate effect, the trial analysis</span>
<span id="cb55-320"><a href="#cb55-320" aria-hidden="true" tabindex="-1"></a>would borrow information exclusively for the disease severity level</span>
<span id="cb55-321"><a href="#cb55-321" aria-hidden="true" tabindex="-1"></a>linked to the reference category of the intercept, leaving the</span>
<span id="cb55-322"><a href="#cb55-322" aria-hidden="true" tabindex="-1"></a>covariate effect uninformative.</span>
<span id="cb55-323"><a href="#cb55-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-324"><a href="#cb55-324" aria-hidden="true" tabindex="-1"></a>To address this, the trial analysis model is extended by incorporating</span>
<span id="cb55-325"><a href="#cb55-325" aria-hidden="true" tabindex="-1"></a>a hierarchical structure. This hierarchical model assigns</span>
<span id="cb55-326"><a href="#cb55-326" aria-hidden="true" tabindex="-1"></a>trial-specific intercepts and slopes for the covariate effect, with</span>
<span id="cb55-327"><a href="#cb55-327" aria-hidden="true" tabindex="-1"></a>these parameters being related across trials through an</span>
<span id="cb55-328"><a href="#cb55-328" aria-hidden="true" tabindex="-1"></a>exchangeability assumption. This assumption enables partial pooling of</span>
<span id="cb55-329"><a href="#cb55-329" aria-hidden="true" tabindex="-1"></a>the available data, allowing the model to share information across</span>
<span id="cb55-330"><a href="#cb55-330" aria-hidden="true" tabindex="-1"></a>trials while also capturing trial-specific variability.</span>
<span id="cb55-331"><a href="#cb55-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-332"><a href="#cb55-332" aria-hidden="true" tabindex="-1"></a>$$ r_{h,l}|\theta_{h,l} \sim \text{Binomial}(\theta_{h,l}) $$</span>
<span id="cb55-333"><a href="#cb55-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-334"><a href="#cb55-334" aria-hidden="true" tabindex="-1"></a>$$ \text{logit}(\theta_{h,l}) = \beta_{0,h} + I(\text{severe}_{h,l}) \, \beta_{1,h} + I(\text{oral}_{h}) \, \beta_3 $$</span>
<span id="cb55-335"><a href="#cb55-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-336"><a href="#cb55-336" aria-hidden="true" tabindex="-1"></a>with the usual between-trial heterogeneity on the intercept and the slope:</span>
<span id="cb55-337"><a href="#cb55-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-338"><a href="#cb55-338" aria-hidden="true" tabindex="-1"></a>$$ (\beta_{0,h}, \beta_{1,h})|\mu_0,\mu_1,\tau_0,\tau_1,\rho \sim \text{Normal}((\mu_0, \mu_1), \Sigma) $$</span>
<span id="cb55-339"><a href="#cb55-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-340"><a href="#cb55-340" aria-hidden="true" tabindex="-1"></a>$$\Sigma =</span>
<span id="cb55-341"><a href="#cb55-341" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb55-342"><a href="#cb55-342" aria-hidden="true" tabindex="-1"></a>\tau_0^2 &amp; \tau_0 \, \tau_1 \, \rho <span class="sc">\\</span></span>
<span id="cb55-343"><a href="#cb55-343" aria-hidden="true" tabindex="-1"></a> \tau_0 \, \tau_1 \, \rho &amp; \tau_1^2</span>
<span id="cb55-344"><a href="#cb55-344" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb55-345"><a href="#cb55-345" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-346"><a href="#cb55-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-347"><a href="#cb55-347" aria-hidden="true" tabindex="-1"></a>However, this model requires for each historical trial the outcome of</span>
<span id="cb55-348"><a href="#cb55-348" aria-hidden="true" tabindex="-1"></a>the responders to be given for each baseline disease severity level</span>
<span id="cb55-349"><a href="#cb55-349" aria-hidden="true" tabindex="-1"></a>separatley (corresponding to trials marked with "complete"</span>
<span id="cb55-350"><a href="#cb55-350" aria-hidden="true" tabindex="-1"></a>information). Thus, this model can only be applied in this form to a</span>
<span id="cb55-351"><a href="#cb55-351" aria-hidden="true" tabindex="-1"></a>subset of the data with complete information.</span>
<span id="cb55-352"><a href="#cb55-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-353"><a href="#cb55-353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modelling explicitly the sum of two binomials (advanced) {#sec-model-partial}</span></span>
<span id="cb55-354"><a href="#cb55-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-355"><a href="#cb55-355" aria-hidden="true" tabindex="-1"></a>For a number of trials we do not have reported the *complete*</span>
<span id="cb55-356"><a href="#cb55-356" aria-hidden="true" tabindex="-1"></a>information needed for the above model. The complete response</span>
<span id="cb55-357"><a href="#cb55-357" aria-hidden="true" tabindex="-1"></a>information per trial includes the number of responders</span>
<span id="cb55-358"><a href="#cb55-358" aria-hidden="true" tabindex="-1"></a>stratified by disease severity,</span>
<span id="cb55-359"><a href="#cb55-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-360"><a href="#cb55-360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$r_{h,l=0}$ responders with moderate baseline status</span>
<span id="cb55-361"><a href="#cb55-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$r_{h,l=1}$ responders with severe baseline status.</span>
<span id="cb55-362"><a href="#cb55-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-363"><a href="#cb55-363" aria-hidden="true" tabindex="-1"></a>However, we have instead reported the *partial* information reported</span>
<span id="cb55-364"><a href="#cb55-364" aria-hidden="true" tabindex="-1"></a>of the overall number of responders, which equals the sum of the two</span>
<span id="cb55-365"><a href="#cb55-365" aria-hidden="true" tabindex="-1"></a>random variables abvove:</span>
<span id="cb55-366"><a href="#cb55-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-367"><a href="#cb55-367" aria-hidden="true" tabindex="-1"></a>$$r_h = r_{h,l=0} + r_{h,l=1}$$</span>
<span id="cb55-368"><a href="#cb55-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-369"><a href="#cb55-369" aria-hidden="true" tabindex="-1"></a>In the following we describe how we can use the information on the</span>
<span id="cb55-370"><a href="#cb55-370" aria-hidden="true" tabindex="-1"></a>sum while we model the data *as if* we were given the stratified</span>
<span id="cb55-371"><a href="#cb55-371" aria-hidden="true" tabindex="-1"></a>response data. That is, we formulate the likelihood on the basis of</span>
<span id="cb55-372"><a href="#cb55-372" aria-hidden="true" tabindex="-1"></a>the given sum of responders $r_h$ while using the latent response</span>
<span id="cb55-373"><a href="#cb55-373" aria-hidden="true" tabindex="-1"></a>rates $\theta_{h,l=0}$ and $\theta_{h,l=1}$ for which the model for</span>
<span id="cb55-374"><a href="#cb55-374" aria-hidden="true" tabindex="-1"></a>the complete data is</span>
<span id="cb55-375"><a href="#cb55-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-376"><a href="#cb55-376" aria-hidden="true" tabindex="-1"></a>$$ r_{h,l=0}|\theta_{h,l=0} \sim \text{Binomial}(\theta_{h,l=0}) $$</span>
<span id="cb55-377"><a href="#cb55-377" aria-hidden="true" tabindex="-1"></a>$$ r_{h,l=1}|\theta_{h,l=1} \sim \text{Binomial}(\theta_{h,l=1}) $$</span>
<span id="cb55-378"><a href="#cb55-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-379"><a href="#cb55-379" aria-hidden="true" tabindex="-1"></a>The sum of two Binomial variables is distributed as the discrete</span>
<span id="cb55-380"><a href="#cb55-380" aria-hidden="true" tabindex="-1"></a>convolution of the individual Binomial distribution:</span>
<span id="cb55-381"><a href="#cb55-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-382"><a href="#cb55-382" aria-hidden="true" tabindex="-1"></a>$$ P(Y=r) = \sum_{y_1=0}^{r} P_1(y_1) \, P_2(r - y_1)$$</span>
<span id="cb55-383"><a href="#cb55-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-384"><a href="#cb55-384" aria-hidden="true" tabindex="-1"></a>Accounting for the fact that each variable is bounded by $n_1$ and</span>
<span id="cb55-385"><a href="#cb55-385" aria-hidden="true" tabindex="-1"></a>$n_2$ respectivley, we can limit the domain of the sum accordingly:</span>
<span id="cb55-386"><a href="#cb55-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-387"><a href="#cb55-387" aria-hidden="true" tabindex="-1"></a>$$ P(Y=r) = \sum_{y_1=\max(0,r-n_2)}^{\min(n_1, r)} P_1(y_1) \, P_2(r - y_1)$$</span>
<span id="cb55-388"><a href="#cb55-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-389"><a href="#cb55-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-390"><a href="#cb55-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation</span></span>
<span id="cb55-391"><a href="#cb55-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-392"><a href="#cb55-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### MAP prior for complete historical data only {#sec-impl-complete-only}</span></span>
<span id="cb55-393"><a href="#cb55-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-394"><a href="#cb55-394" aria-hidden="true" tabindex="-1"></a>Modelling jointly the complete and partial information from the</span>
<span id="cb55-395"><a href="#cb55-395" aria-hidden="true" tabindex="-1"></a>historical trials requires two types of likelihoods in a single model</span>
<span id="cb55-396"><a href="#cb55-396" aria-hidden="true" tabindex="-1"></a>depending on the respective case. Here we first model the historical</span>
<span id="cb55-397"><a href="#cb55-397" aria-hidden="true" tabindex="-1"></a>trials with complete information only. This can be formulated as a</span>
<span id="cb55-398"><a href="#cb55-398" aria-hidden="true" tabindex="-1"></a>hierarchical Binomial regression problem. Thus, we first subset to the</span>
<span id="cb55-399"><a href="#cb55-399" aria-hidden="true" tabindex="-1"></a>6 trials for which complete information is available, which we</span>
<span id="cb55-400"><a href="#cb55-400" aria-hidden="true" tabindex="-1"></a>reformat into a long format for which each trial contributes one row</span>
<span id="cb55-401"><a href="#cb55-401" aria-hidden="true" tabindex="-1"></a>for the moderate and one row for the severe outcome:</span>
<span id="cb55-402"><a href="#cb55-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-403"><a href="#cb55-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, data_long,echo=FALSE}</span></span>
<span id="cb55-404"><a href="#cb55-404" aria-hidden="true" tabindex="-1"></a>hist_pbo_long_complete <span class="ot">&lt;-</span> hist_pbo_long <span class="sc">|&gt;</span></span>
<span id="cb55-405"><a href="#cb55-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_complete<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-406"><a href="#cb55-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb55-407"><a href="#cb55-407" aria-hidden="true" tabindex="-1"></a>hist_pbo_long_complete <span class="sc">|&gt;</span></span>
<span id="cb55-408"><a href="#cb55-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-409"><a href="#cb55-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-410"><a href="#cb55-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-411"><a href="#cb55-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>() </span>
<span id="cb55-412"><a href="#cb55-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-413"><a href="#cb55-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-414"><a href="#cb55-414" aria-hidden="true" tabindex="-1"></a>In this form, the data can be directly modelled with</span>
<span id="cb55-415"><a href="#cb55-415" aria-hidden="true" tabindex="-1"></a>weakly-informative priors in <span class="in">`brms`</span>. The priors are set on the basis</span>
<span id="cb55-416"><a href="#cb55-416" aria-hidden="true" tabindex="-1"></a>of the unit information standard deviation. This derives from the</span>
<span id="cb55-417"><a href="#cb55-417" aria-hidden="true" tabindex="-1"></a>overall mean response rate of</span>
<span id="cb55-418"><a href="#cb55-418" aria-hidden="true" tabindex="-1"></a><span class="in">`r with(hist_pbo, round(100 * mean(r_ovrall/n)))`</span>%, for which the</span>
<span id="cb55-419"><a href="#cb55-419" aria-hidden="true" tabindex="-1"></a>respective binomial variance is transformed to the logit scale.</span>
<span id="cb55-420"><a href="#cb55-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-423"><a href="#cb55-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-424"><a href="#cb55-424" aria-hidden="true" tabindex="-1"></a><span class="co"># bi-variate hierarchical Binomial logistic regression model</span></span>
<span id="cb55-425"><a href="#cb55-425" aria-hidden="true" tabindex="-1"></a>complete_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> oral <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">|</span> study),</span>
<span id="cb55-426"><a href="#cb55-426" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> binomial, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-427"><a href="#cb55-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-428"><a href="#cb55-428" aria-hidden="true" tabindex="-1"></a>complete_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.5</span>), <span class="at">class =</span> b) <span class="sc">+</span> </span>
<span id="cb55-429"><a href="#cb55-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.5</span> <span class="sc">/</span> <span class="dv">4</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group=</span>study) <span class="sc">+</span></span>
<span id="cb55-430"><a href="#cb55-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> <span class="fl">3.5</span> <span class="sc">/</span> <span class="dv">4</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> severe, <span class="at">group=</span>study) </span>
<span id="cb55-431"><a href="#cb55-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-432"><a href="#cb55-432" aria-hidden="true" tabindex="-1"></a>complete_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(complete_model, <span class="at">data =</span> hist_pbo_long_complete,</span>
<span id="cb55-433"><a href="#cb55-433" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> complete_prior,</span>
<span id="cb55-434"><a href="#cb55-434" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.95</span>),</span>
<span id="cb55-435"><a href="#cb55-435" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb55-436"><a href="#cb55-436" aria-hidden="true" tabindex="-1"></a>                   <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb55-437"><a href="#cb55-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-438"><a href="#cb55-438" aria-hidden="true" tabindex="-1"></a>complete_mc</span>
<span id="cb55-439"><a href="#cb55-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-440"><a href="#cb55-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-441"><a href="#cb55-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-442"><a href="#cb55-442" aria-hidden="true" tabindex="-1"></a>The MAP prior is then derived as prediction of the parameters</span>
<span id="cb55-443"><a href="#cb55-443" aria-hidden="true" tabindex="-1"></a>(intercept and slope) for a new study. However, most <span class="in">`brms`</span> prediction</span>
<span id="cb55-444"><a href="#cb55-444" aria-hidden="true" tabindex="-1"></a>functions are meant to predict new data or response means, which</span>
<span id="cb55-445"><a href="#cb55-445" aria-hidden="true" tabindex="-1"></a>involves the linear predictor on the logit scale. Instead, we wish to</span>
<span id="cb55-446"><a href="#cb55-446" aria-hidden="true" tabindex="-1"></a>extract the parameters themselves, which one can obtain by considering</span>
<span id="cb55-447"><a href="#cb55-447" aria-hidden="true" tabindex="-1"></a>respective levels of the linear predictor:</span>
<span id="cb55-448"><a href="#cb55-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-451"><a href="#cb55-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-452"><a href="#cb55-452" aria-hidden="true" tabindex="-1"></a>study_new_levels <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-453"><a href="#cb55-453" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">0</span>,</span>
<span id="cb55-454"><a href="#cb55-454" aria-hidden="true" tabindex="-1"></a>  <span class="at">severe =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb55-455"><a href="#cb55-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb55-456"><a href="#cb55-456" aria-hidden="true" tabindex="-1"></a>  <span class="at">oral =</span> <span class="dv">0</span>,</span>
<span id="cb55-457"><a href="#cb55-457" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="st">"new_study"</span></span>
<span id="cb55-458"><a href="#cb55-458" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-459"><a href="#cb55-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-460"><a href="#cb55-460" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain posterior for severe and moderate; note that we must allow to</span></span>
<span id="cb55-461"><a href="#cb55-461" aria-hidden="true" tabindex="-1"></a><span class="co"># sample new levels of the random effects and also specify to do so</span></span>
<span id="cb55-462"><a href="#cb55-462" aria-hidden="true" tabindex="-1"></a><span class="co"># using the "gaussian" option (as brms would otherwise bootstrap from</span></span>
<span id="cb55-463"><a href="#cb55-463" aria-hidden="true" tabindex="-1"></a><span class="co"># existing studies).</span></span>
<span id="cb55-464"><a href="#cb55-464" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study <span class="ot">&lt;-</span></span>
<span id="cb55-465"><a href="#cb55-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb55-466"><a href="#cb55-466" aria-hidden="true" tabindex="-1"></a>    complete_mc,</span>
<span id="cb55-467"><a href="#cb55-467" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> study_new_levels,</span>
<span id="cb55-468"><a href="#cb55-468" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-469"><a href="#cb55-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_new_levels =</span> <span class="st">"gaussian"</span></span>
<span id="cb55-470"><a href="#cb55-470" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb55-471"><a href="#cb55-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-472"><a href="#cb55-472" aria-hidden="true" tabindex="-1"></a><span class="co"># we get a posterior for each condition (moderate / severe) - the</span></span>
<span id="cb55-473"><a href="#cb55-473" aria-hidden="true" tabindex="-1"></a><span class="co"># second column includes the intercept plus the covariate effect due</span></span>
<span id="cb55-474"><a href="#cb55-474" aria-hidden="true" tabindex="-1"></a><span class="co"># to severity,</span></span>
<span id="cb55-475"><a href="#cb55-475" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study</span>
<span id="cb55-476"><a href="#cb55-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-477"><a href="#cb55-477" aria-hidden="true" tabindex="-1"></a><span class="co"># which we convert to the log odds ratio estimate</span></span>
<span id="cb55-478"><a href="#cb55-478" aria-hidden="true" tabindex="-1"></a><span class="co"># only by subtracting the overall intercept in the first column</span></span>
<span id="cb55-479"><a href="#cb55-479" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study[<span class="dv">2</span>] <span class="ot">&lt;-</span> prior_complete_new_study[<span class="dv">2</span>] <span class="sc">-</span></span>
<span id="cb55-480"><a href="#cb55-480" aria-hidden="true" tabindex="-1"></a>  prior_complete_new_study[<span class="dv">1</span>]</span>
<span id="cb55-481"><a href="#cb55-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-482"><a href="#cb55-482" aria-hidden="true" tabindex="-1"></a><span class="co"># As we wish to formulate a joint prior on all model parameters of the</span></span>
<span id="cb55-483"><a href="#cb55-483" aria-hidden="true" tabindex="-1"></a><span class="co"># trial model - including the treatment effect - a weakly-informative</span></span>
<span id="cb55-484"><a href="#cb55-484" aria-hidden="true" tabindex="-1"></a><span class="co"># prior for the treatment effect is added to the posterior in MC form.</span></span>
<span id="cb55-485"><a href="#cb55-485" aria-hidden="true" tabindex="-1"></a>prior_complete_new_study <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb55-486"><a href="#cb55-486" aria-hidden="true" tabindex="-1"></a>  prior_complete_new_study,</span>
<span id="cb55-487"><a href="#cb55-487" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">rvar_rng</span>(rnorm, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">3.5</span>, <span class="at">ndraws =</span> <span class="fu">ndraws</span>(prior_complete_new_study))</span>
<span id="cb55-488"><a href="#cb55-488" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-489"><a href="#cb55-489" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prior_complete_new_study) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"inter"</span>, <span class="st">"severe"</span>, <span class="st">"active"</span>)</span>
<span id="cb55-490"><a href="#cb55-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-491"><a href="#cb55-491" aria-hidden="true" tabindex="-1"></a><span class="co"># now turn the MC sample of the prior into a parametric representation</span></span>
<span id="cb55-492"><a href="#cb55-492" aria-hidden="true" tabindex="-1"></a><span class="co"># using functions from RBesT</span></span>
<span id="cb55-493"><a href="#cb55-493" aria-hidden="true" tabindex="-1"></a>map_prior_complete <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb55-494"><a href="#cb55-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(prior_complete_new_study),</span>
<span id="cb55-495"><a href="#cb55-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"mvnorm"</span>,</span>
<span id="cb55-496"><a href="#cb55-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb55-497"><a href="#cb55-497" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-498"><a href="#cb55-498" aria-hidden="true" tabindex="-1"></a>map_prior_complete</span>
<span id="cb55-499"><a href="#cb55-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-500"><a href="#cb55-500" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(map_prior_complete)<span class="sc">$</span>mixpairs</span>
<span id="cb55-501"><a href="#cb55-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-502"><a href="#cb55-502" aria-hidden="true" tabindex="-1"></a><span class="co"># robustify joint prior</span></span>
<span id="cb55-503"><a href="#cb55-503" aria-hidden="true" tabindex="-1"></a>prior_non_inf <span class="ot">&lt;-</span> <span class="fu">mixmvnorm</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb55-504"><a href="#cb55-504" aria-hidden="true" tabindex="-1"></a>rmap_prior_complete <span class="ot">&lt;-</span> <span class="fu">mixcombine</span>(</span>
<span id="cb55-505"><a href="#cb55-505" aria-hidden="true" tabindex="-1"></a>  map_prior_complete,</span>
<span id="cb55-506"><a href="#cb55-506" aria-hidden="true" tabindex="-1"></a>  prior_non_inf,</span>
<span id="cb55-507"><a href="#cb55-507" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)</span>
<span id="cb55-508"><a href="#cb55-508" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-509"><a href="#cb55-509" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmap_prior_complete, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb55-510"><a href="#cb55-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-511"><a href="#cb55-511" aria-hidden="true" tabindex="-1"></a><span class="co"># For pre-specification of the MAP prior we have to report the MAP</span></span>
<span id="cb55-512"><a href="#cb55-512" aria-hidden="true" tabindex="-1"></a><span class="co"># prior with a finite precision in the protocol. Thereby, it is</span></span>
<span id="cb55-513"><a href="#cb55-513" aria-hidden="true" tabindex="-1"></a><span class="co"># recommended to write the MAP prior to disk using the JSON read/write</span></span>
<span id="cb55-514"><a href="#cb55-514" aria-hidden="true" tabindex="-1"></a><span class="co"># functions from RBesT to store the MAP prior with a defined precision</span></span>
<span id="cb55-515"><a href="#cb55-515" aria-hidden="true" tabindex="-1"></a><span class="co"># on file in a human readable format as JSON:</span></span>
<span id="cb55-516"><a href="#cb55-516" aria-hidden="true" tabindex="-1"></a>map_complete_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb55-517"><a href="#cb55-517" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span>,</span>
<span id="cb55-518"><a href="#cb55-518" aria-hidden="true" tabindex="-1"></a>  <span class="st">"map_complete_new_trial_json.txt"</span></span>
<span id="cb55-519"><a href="#cb55-519" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-520"><a href="#cb55-520" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(</span>
<span id="cb55-521"><a href="#cb55-521" aria-hidden="true" tabindex="-1"></a>  map_prior_complete,</span>
<span id="cb55-522"><a href="#cb55-522" aria-hidden="true" tabindex="-1"></a>  map_complete_new_trial_file,</span>
<span id="cb55-523"><a href="#cb55-523" aria-hidden="true" tabindex="-1"></a>  <span class="at">pretty =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-524"><a href="#cb55-524" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span></span>
<span id="cb55-525"><a href="#cb55-525" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-526"><a href="#cb55-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-527"><a href="#cb55-527" aria-hidden="true" tabindex="-1"></a>rmap_complete_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(</span>
<span id="cb55-528"><a href="#cb55-528" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span>,</span>
<span id="cb55-529"><a href="#cb55-529" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rmap_complete_new__trial_json.txt"</span></span>
<span id="cb55-530"><a href="#cb55-530" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-531"><a href="#cb55-531" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(</span>
<span id="cb55-532"><a href="#cb55-532" aria-hidden="true" tabindex="-1"></a>  rmap_prior_complete,</span>
<span id="cb55-533"><a href="#cb55-533" aria-hidden="true" tabindex="-1"></a>  rmap_complete_new_trial_file,</span>
<span id="cb55-534"><a href="#cb55-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">pretty =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-535"><a href="#cb55-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span></span>
<span id="cb55-536"><a href="#cb55-536" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-537"><a href="#cb55-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-538"><a href="#cb55-538" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(rmap_complete_new_trial_file), <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb55-539"><a href="#cb55-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-540"><a href="#cb55-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-541"><a href="#cb55-541" aria-hidden="true" tabindex="-1"></a>The MAP prior used in the future trial is then the mixture</span>
<span id="cb55-542"><a href="#cb55-542" aria-hidden="true" tabindex="-1"></a>prior one obtains by loading the JSON file. In case the rounding to a</span>
<span id="cb55-543"><a href="#cb55-543" aria-hidden="true" tabindex="-1"></a>limited number of digits caused that the weights do not exactly sum to</span>
<span id="cb55-544"><a href="#cb55-544" aria-hidden="true" tabindex="-1"></a>unity, these will then automatically be rescalled accordingly:</span>
<span id="cb55-545"><a href="#cb55-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-548"><a href="#cb55-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-549"><a href="#cb55-549" aria-hidden="true" tabindex="-1"></a><span class="fu">read_mix_json</span>(rmap_complete_new_trial_file, <span class="at">rescale=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-550"><a href="#cb55-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-551"><a href="#cb55-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-552"><a href="#cb55-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-553"><a href="#cb55-553" aria-hidden="true" tabindex="-1"></a><span class="fu">### MAP prior for complete and partial historical data (advanced)</span></span>
<span id="cb55-554"><a href="#cb55-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-555"><a href="#cb55-555" aria-hidden="true" tabindex="-1"></a>In the previous @sec-impl-complete-only the data of the partially</span>
<span id="cb55-556"><a href="#cb55-556" aria-hidden="true" tabindex="-1"></a>reported trials was dropped corresponding to a subset of <span class="co">&lt;!-- -----&gt;</span></span>
<span id="cb55-557"><a href="#cb55-557" aria-hidden="true" tabindex="-1"></a><span class="in">`r with(hist_pbo, sum(n[!is.na(r_mod)]))`</span> patients such that<span class="co">&lt;!-----&gt;</span></span>
<span id="cb55-558"><a href="#cb55-558" aria-hidden="true" tabindex="-1"></a><span class="in">`r with(hist_pbo, sum(n[is.na(r_mod)]))`</span> were left out, which is</span>
<span id="cb55-559"><a href="#cb55-559" aria-hidden="true" tabindex="-1"></a>unsatisfactory. As explained in @sec-model-partial, the data from the</span>
<span id="cb55-560"><a href="#cb55-560" aria-hidden="true" tabindex="-1"></a>trials with partial data can be modelled using a latent variable</span>
<span id="cb55-561"><a href="#cb55-561" aria-hidden="true" tabindex="-1"></a>approach. Their likelihood contribution for the partially observed</span>
<span id="cb55-562"><a href="#cb55-562" aria-hidden="true" tabindex="-1"></a>historical trials is then based on the convolution theorem and</span>
<span id="cb55-563"><a href="#cb55-563" aria-hidden="true" tabindex="-1"></a>deviates from the case of a complete data historical trial.</span>
<span id="cb55-564"><a href="#cb55-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-565"><a href="#cb55-565" aria-hidden="true" tabindex="-1"></a>As strategy to model this with <span class="in">`brms`</span> we will extend the previous</span>
<span id="cb55-566"><a href="#cb55-566" aria-hidden="true" tabindex="-1"></a>model from @sec-impl-complete-only in two ways</span>
<span id="cb55-567"><a href="#cb55-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-568"><a href="#cb55-568" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>include the trials with partial data such that we model their</span>
<span id="cb55-569"><a href="#cb55-569" aria-hidden="true" tabindex="-1"></a>   response rate by stratum in a latent manner</span>
<span id="cb55-570"><a href="#cb55-570" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>add the likelihood for the partially reported data</span>
<span id="cb55-571"><a href="#cb55-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-572"><a href="#cb55-572" aria-hidden="true" tabindex="-1"></a>The first point can be achived by casting all data into a long format</span>
<span id="cb55-573"><a href="#cb55-573" aria-hidden="true" tabindex="-1"></a>including the partially observed trials. However, for the partially</span>
<span id="cb55-574"><a href="#cb55-574" aria-hidden="true" tabindex="-1"></a>observed trial data the information is missing on the number of</span>
<span id="cb55-575"><a href="#cb55-575" aria-hidden="true" tabindex="-1"></a>responses per disease severity. For these trials we state in the data</span>
<span id="cb55-576"><a href="#cb55-576" aria-hidden="true" tabindex="-1"></a>to have zero responders and zero patients as</span>
<span id="cb55-577"><a href="#cb55-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-578"><a href="#cb55-578" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-579"><a href="#cb55-579" aria-hidden="true" tabindex="-1"></a>\tilde{r}_{h,l} =</span>
<span id="cb55-580"><a href="#cb55-580" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb55-581"><a href="#cb55-581" aria-hidden="true" tabindex="-1"></a>r_{h,l} &amp; \text{complete data} <span class="sc">\\</span></span>
<span id="cb55-582"><a href="#cb55-582" aria-hidden="true" tabindex="-1"></a>0 &amp; \text{partial data} <span class="sc">\\</span></span>
<span id="cb55-583"><a href="#cb55-583" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb55-584"><a href="#cb55-584" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-585"><a href="#cb55-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-586"><a href="#cb55-586" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-587"><a href="#cb55-587" aria-hidden="true" tabindex="-1"></a>\tilde{n}_{h,l} =</span>
<span id="cb55-588"><a href="#cb55-588" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb55-589"><a href="#cb55-589" aria-hidden="true" tabindex="-1"></a>n_{h,l} &amp; \text{complete data} <span class="sc">\\</span></span>
<span id="cb55-590"><a href="#cb55-590" aria-hidden="true" tabindex="-1"></a>0 &amp; \text{partial data} <span class="sc">\\</span></span>
<span id="cb55-591"><a href="#cb55-591" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb55-592"><a href="#cb55-592" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb55-593"><a href="#cb55-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-594"><a href="#cb55-594" aria-hidden="true" tabindex="-1"></a>We also include a column <span class="in">`is_complete`</span> indicating if a trial is</span>
<span id="cb55-595"><a href="#cb55-595" aria-hidden="true" tabindex="-1"></a>reported as complete or partial. Moreover, a column <span class="in">`row`</span> is included</span>
<span id="cb55-596"><a href="#cb55-596" aria-hidden="true" tabindex="-1"></a>which is simply the row in the data set, which will be used below.</span>
<span id="cb55-597"><a href="#cb55-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-600"><a href="#cb55-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-601"><a href="#cb55-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-602"><a href="#cb55-602" aria-hidden="true" tabindex="-1"></a><span class="co"># long format with fake entries of zero responder/patients for</span></span>
<span id="cb55-603"><a href="#cb55-603" aria-hidden="true" tabindex="-1"></a><span class="co"># partially observed trials</span></span>
<span id="cb55-604"><a href="#cb55-604" aria-hidden="true" tabindex="-1"></a>hist_pbo_long <span class="sc">|&gt;</span></span>
<span id="cb55-605"><a href="#cb55-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>start_year) <span class="sc">|&gt;</span></span>
<span id="cb55-606"><a href="#cb55-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_preview</span>(<span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-607"><a href="#cb55-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-608"><a href="#cb55-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-609"><a href="#cb55-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>()</span>
<span id="cb55-610"><a href="#cb55-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-611"><a href="#cb55-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-612"><a href="#cb55-612" aria-hidden="true" tabindex="-1"></a>Adding the data for the partially observed trials with responders and</span>
<span id="cb55-613"><a href="#cb55-613" aria-hidden="true" tabindex="-1"></a>patients set to zero causes <span class="in">`brms`</span> to include these trials in the</span>
<span id="cb55-614"><a href="#cb55-614" aria-hidden="true" tabindex="-1"></a>model and instantiate corresponding random effects for the intercept</span>
<span id="cb55-615"><a href="#cb55-615" aria-hidden="true" tabindex="-1"></a>and the slope. However, since no data is effectivley provided (zero</span>
<span id="cb55-616"><a href="#cb55-616" aria-hidden="true" tabindex="-1"></a>responders and zero patients), the resulting posterior is not altered</span>
<span id="cb55-617"><a href="#cb55-617" aria-hidden="true" tabindex="-1"></a>as can be seen by rerunning the previouse model with the longer data</span>
<span id="cb55-618"><a href="#cb55-618" aria-hidden="true" tabindex="-1"></a>including the fake data:</span>
<span id="cb55-619"><a href="#cb55-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-622"><a href="#cb55-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-623"><a href="#cb55-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we reuse the previous model fit and "update" it with the longer</span></span>
<span id="cb55-624"><a href="#cb55-624" aria-hidden="true" tabindex="-1"></a><span class="co"># data. For this to work, we need to align the column names to the</span></span>
<span id="cb55-625"><a href="#cb55-625" aria-hidden="true" tabindex="-1"></a><span class="co"># model of the complete model fit.</span></span>
<span id="cb55-626"><a href="#cb55-626" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(</span>
<span id="cb55-627"><a href="#cb55-627" aria-hidden="true" tabindex="-1"></a>  complete_mc,</span>
<span id="cb55-628"><a href="#cb55-628" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> <span class="fu">mutate</span>(hist_pbo_long, <span class="at">r =</span> r_tilde, <span class="at">n =</span> n_tilde),</span>
<span id="cb55-629"><a href="#cb55-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb55-630"><a href="#cb55-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">645776</span></span>
<span id="cb55-631"><a href="#cb55-631" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-632"><a href="#cb55-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-633"><a href="#cb55-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-634"><a href="#cb55-634" aria-hidden="true" tabindex="-1"></a>To now include the special likelihood term for the partially reported</span>
<span id="cb55-635"><a href="#cb55-635" aria-hidden="true" tabindex="-1"></a>historical trials, we use the <span class="in">`stanvar`</span> facilities of <span class="in">`brms`</span>. These</span>
<span id="cb55-636"><a href="#cb55-636" aria-hidden="true" tabindex="-1"></a>allow to inject custom Stan code into the model such that we may add</span>
<span id="cb55-637"><a href="#cb55-637" aria-hidden="true" tabindex="-1"></a>an additional likelihood for the partially observed historical trial</span>
<span id="cb55-638"><a href="#cb55-638" aria-hidden="true" tabindex="-1"></a>data. As each partially observed trial only contributes a single term</span>
<span id="cb55-639"><a href="#cb55-639" aria-hidden="true" tabindex="-1"></a>to the likelihood, it is appropiate to recast the previously long</span>
<span id="cb55-640"><a href="#cb55-640" aria-hidden="true" tabindex="-1"></a>format into a wide data format such that one data row corresponds to</span>
<span id="cb55-641"><a href="#cb55-641" aria-hidden="true" tabindex="-1"></a>just one historical trial. In order to be able to link the wide data</span>
<span id="cb55-642"><a href="#cb55-642" aria-hidden="true" tabindex="-1"></a>format with the rows from the moderate and severe rows in the long</span>
<span id="cb55-643"><a href="#cb55-643" aria-hidden="true" tabindex="-1"></a>format, the column <span class="in">`row`</span> of the long format is cast into the wide</span>
<span id="cb55-644"><a href="#cb55-644" aria-hidden="true" tabindex="-1"></a>format as well:</span>
<span id="cb55-645"><a href="#cb55-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-648"><a href="#cb55-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-649"><a href="#cb55-649" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-650"><a href="#cb55-650" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-651"><a href="#cb55-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-652"><a href="#cb55-652" aria-hidden="true" tabindex="-1"></a>hist_pbo_wide <span class="ot">&lt;-</span> hist_pbo_long <span class="sc">|&gt;</span></span>
<span id="cb55-653"><a href="#cb55-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb55-654"><a href="#cb55-654" aria-hidden="true" tabindex="-1"></a>    study,</span>
<span id="cb55-655"><a href="#cb55-655" aria-hidden="true" tabindex="-1"></a>    compound,</span>
<span id="cb55-656"><a href="#cb55-656" aria-hidden="true" tabindex="-1"></a>    trial,</span>
<span id="cb55-657"><a href="#cb55-657" aria-hidden="true" tabindex="-1"></a>    n_total,</span>
<span id="cb55-658"><a href="#cb55-658" aria-hidden="true" tabindex="-1"></a>    is_complete,</span>
<span id="cb55-659"><a href="#cb55-659" aria-hidden="true" tabindex="-1"></a>    r_total,</span>
<span id="cb55-660"><a href="#cb55-660" aria-hidden="true" tabindex="-1"></a>    severe,</span>
<span id="cb55-661"><a href="#cb55-661" aria-hidden="true" tabindex="-1"></a>    n,</span>
<span id="cb55-662"><a href="#cb55-662" aria-hidden="true" tabindex="-1"></a>    row</span>
<span id="cb55-663"><a href="#cb55-663" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-664"><a href="#cb55-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb55-665"><a href="#cb55-665" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(</span>
<span id="cb55-666"><a href="#cb55-666" aria-hidden="true" tabindex="-1"></a>      <span class="st">"study"</span>,</span>
<span id="cb55-667"><a href="#cb55-667" aria-hidden="true" tabindex="-1"></a>      <span class="st">"compound"</span>,</span>
<span id="cb55-668"><a href="#cb55-668" aria-hidden="true" tabindex="-1"></a>      <span class="st">"trial"</span>,</span>
<span id="cb55-669"><a href="#cb55-669" aria-hidden="true" tabindex="-1"></a>      <span class="st">"r_total"</span>,</span>
<span id="cb55-670"><a href="#cb55-670" aria-hidden="true" tabindex="-1"></a>      <span class="st">"n_total"</span>,</span>
<span id="cb55-671"><a href="#cb55-671" aria-hidden="true" tabindex="-1"></a>      <span class="st">"is_complete"</span></span>
<span id="cb55-672"><a href="#cb55-672" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-673"><a href="#cb55-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"row"</span>),</span>
<span id="cb55-674"><a href="#cb55-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"severe"</span></span>
<span id="cb55-675"><a href="#cb55-675" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-676"><a href="#cb55-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-677"><a href="#cb55-677" aria-hidden="true" tabindex="-1"></a>hist_pbo_wide <span class="sc">|&gt;</span></span>
<span id="cb55-678"><a href="#cb55-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_preview</span>(<span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-679"><a href="#cb55-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-680"><a href="#cb55-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-681"><a href="#cb55-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>()</span>
<span id="cb55-682"><a href="#cb55-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-683"><a href="#cb55-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-684"><a href="#cb55-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-685"><a href="#cb55-685" aria-hidden="true" tabindex="-1"></a>All columns with a <span class="in">`_0`</span> postfix correspond to the <span class="in">`moderate`</span></span>
<span id="cb55-686"><a href="#cb55-686" aria-hidden="true" tabindex="-1"></a>information available and <span class="in">`_1`</span> to the respective <span class="in">`severe`</span> information.</span>
<span id="cb55-687"><a href="#cb55-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-688"><a href="#cb55-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb55-689"><a href="#cb55-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-690"><a href="#cb55-690" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-691"><a href="#cb55-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-692"><a href="#cb55-692" aria-hidden="true" tabindex="-1"></a>exact_binomial_sum <span class="ot">&lt;-</span> <span class="do">## first we define the probability density for a sum of two binomials</span></span>
<span id="cb55-693"><a href="#cb55-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(</span>
<span id="cb55-694"><a href="#cb55-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"binomial_sum_lpmf"</span>,</span>
<span id="cb55-695"><a href="#cb55-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">scode =</span> <span class="st">"</span></span>
<span id="cb55-696"><a href="#cb55-696" aria-hidden="true" tabindex="-1"></a><span class="st">  // lpmf of the sum of two binomially distributed random variables</span></span>
<span id="cb55-697"><a href="#cb55-697" aria-hidden="true" tabindex="-1"></a><span class="st">  real binomial_logit_sum_lpmf(int y, int n1, real alpha1, int n2, real alpha2) {</span></span>
<span id="cb55-698"><a href="#cb55-698" aria-hidden="true" tabindex="-1"></a><span class="st">    // the discrete convolution here sums over all possible</span></span>
<span id="cb55-699"><a href="#cb55-699" aria-hidden="true" tabindex="-1"></a><span class="st">    // configurations which lead to a sum of y1+y2==y</span></span>
<span id="cb55-700"><a href="#cb55-700" aria-hidden="true" tabindex="-1"></a><span class="st">    int y1_min = max(0, y-n2);</span></span>
<span id="cb55-701"><a href="#cb55-701" aria-hidden="true" tabindex="-1"></a><span class="st">    int y1_max = min(n1, y);</span></span>
<span id="cb55-702"><a href="#cb55-702" aria-hidden="true" tabindex="-1"></a><span class="st">    int n_terms = y1_max - y1_min + 1;</span></span>
<span id="cb55-703"><a href="#cb55-703" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[n_terms] log_prob;</span></span>
<span id="cb55-704"><a href="#cb55-704" aria-hidden="true" tabindex="-1"></a><span class="st">    for(i in y1_min:y1_max)</span></span>
<span id="cb55-705"><a href="#cb55-705" aria-hidden="true" tabindex="-1"></a><span class="st">      log_prob[i - y1_min + 1] = binomial_logit_lpmf(i | n1, alpha1) + binomial_logit_lpmf(y-i | n2, alpha2);</span></span>
<span id="cb55-706"><a href="#cb55-706" aria-hidden="true" tabindex="-1"></a><span class="st">    return log_sum_exp(log_prob);</span></span>
<span id="cb55-707"><a href="#cb55-707" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb55-708"><a href="#cb55-708" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb55-709"><a href="#cb55-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">block =</span> <span class="st">"functions"</span></span>
<span id="cb55-710"><a href="#cb55-710" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-711"><a href="#cb55-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(</span>
<span id="cb55-712"><a href="#cb55-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"marginal_likelihood_sum"</span>,</span>
<span id="cb55-713"><a href="#cb55-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">scode =</span> <span class="st">"</span></span>
<span id="cb55-714"><a href="#cb55-714" aria-hidden="true" tabindex="-1"></a><span class="st">    // likelihood on sum of Binomials (exact solution uses a discrete convolution)</span></span>
<span id="cb55-715"><a href="#cb55-715" aria-hidden="true" tabindex="-1"></a><span class="st">    for(i in 1:n_studies) {</span></span>
<span id="cb55-716"><a href="#cb55-716" aria-hidden="true" tabindex="-1"></a><span class="st">       if(is_complete[i] == 1)</span></span>
<span id="cb55-717"><a href="#cb55-717" aria-hidden="true" tabindex="-1"></a><span class="st">         continue;</span></span>
<span id="cb55-718"><a href="#cb55-718" aria-hidden="true" tabindex="-1"></a><span class="st">       target += binomial_logit_sum_lpmf(r_total[i] | n_0[i], mu[row_0[i]], n_1[i], mu[row_1[i]]);</span></span>
<span id="cb55-719"><a href="#cb55-719" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb55-720"><a href="#cb55-720" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb55-721"><a href="#cb55-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">block =</span> <span class="st">"likelihood"</span>,</span>
<span id="cb55-722"><a href="#cb55-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"end"</span></span>
<span id="cb55-723"><a href="#cb55-723" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-724"><a href="#cb55-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-725"><a href="#cb55-725" aria-hidden="true" tabindex="-1"></a><span class="do">## needed for brms &lt;= 2.21 and cmdstan &gt; 2.32 to have arrays declared</span></span>
<span id="cb55-726"><a href="#cb55-726" aria-hidden="true" tabindex="-1"></a><span class="do">## with the newer Stan syntax for arrays</span></span>
<span id="cb55-727"><a href="#cb55-727" aria-hidden="true" tabindex="-1"></a>stanvar_array <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb55-728"><a href="#cb55-728" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(data))</span>
<span id="cb55-729"><a href="#cb55-729" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb55-730"><a href="#cb55-730" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.integer</span>(data)) {</span>
<span id="cb55-731"><a href="#cb55-731" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">stanvar</span>(data, <span class="at">name =</span> name))</span>
<span id="cb55-732"><a href="#cb55-732" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-733"><a href="#cb55-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(data, <span class="at">name =</span> name, <span class="at">scode =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"array[{n}] int {name};"</span>))</span>
<span id="cb55-734"><a href="#cb55-734" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-735"><a href="#cb55-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-736"><a href="#cb55-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-737"><a href="#cb55-737" aria-hidden="true" tabindex="-1"></a>model_marginal_data <span class="ot">&lt;-</span> <span class="fu">with</span>(hist_pbo_wide, {</span>
<span id="cb55-738"><a href="#cb55-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar_array</span>(r_total) <span class="sc">+</span></span>
<span id="cb55-739"><a href="#cb55-739" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(is_complete) <span class="sc">+</span></span>
<span id="cb55-740"><a href="#cb55-740" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(n_0) <span class="sc">+</span></span>
<span id="cb55-741"><a href="#cb55-741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(n_1) <span class="sc">+</span></span>
<span id="cb55-742"><a href="#cb55-742" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(row_0) <span class="sc">+</span></span>
<span id="cb55-743"><a href="#cb55-743" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar_array</span>(row_1) <span class="sc">+</span></span>
<span id="cb55-744"><a href="#cb55-744" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stanvar</span>(<span class="fu">length</span>(row_1), <span class="st">"n_studies"</span>)</span>
<span id="cb55-745"><a href="#cb55-745" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb55-746"><a href="#cb55-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-747"><a href="#cb55-747" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb55-748"><a href="#cb55-748" aria-hidden="true" tabindex="-1"></a>  r_tilde <span class="sc">|</span> <span class="fu">trials</span>(n_tilde) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> oral <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">|</span> study),</span>
<span id="cb55-749"><a href="#cb55-749" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb55-750"><a href="#cb55-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb55-751"><a href="#cb55-751" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-752"><a href="#cb55-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-753"><a href="#cb55-753" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the same prior as used for modelling the subset of complete</span></span>
<span id="cb55-754"><a href="#cb55-754" aria-hidden="true" tabindex="-1"></a><span class="co"># data only</span></span>
<span id="cb55-755"><a href="#cb55-755" aria-hidden="true" tabindex="-1"></a>full_prior <span class="ot">&lt;-</span> complete_prior</span>
<span id="cb55-756"><a href="#cb55-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-757"><a href="#cb55-757" aria-hidden="true" tabindex="-1"></a>full_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb55-758"><a href="#cb55-758" aria-hidden="true" tabindex="-1"></a>  full_model,</span>
<span id="cb55-759"><a href="#cb55-759" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> hist_pbo_long,</span>
<span id="cb55-760"><a href="#cb55-760" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> full_prior,</span>
<span id="cb55-761"><a href="#cb55-761" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>),</span>
<span id="cb55-762"><a href="#cb55-762" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> model_marginal_data <span class="sc">+</span> exact_binomial_sum,</span>
<span id="cb55-763"><a href="#cb55-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">458678</span>,</span>
<span id="cb55-764"><a href="#cb55-764" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb55-765"><a href="#cb55-765" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-766"><a href="#cb55-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-767"><a href="#cb55-767" aria-hidden="true" tabindex="-1"></a>full_mc</span>
<span id="cb55-768"><a href="#cb55-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-769"><a href="#cb55-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-770"><a href="#cb55-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-771"><a href="#cb55-771" aria-hidden="true" tabindex="-1"></a>To see how the Stan model has been augmented with the <span class="in">`stanvars`</span></span>
<span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a>argument above the full Stan model code can be obtained with the</span>
<span id="cb55-773"><a href="#cb55-773" aria-hidden="true" tabindex="-1"></a><span class="in">`stancode`</span> command:</span>
<span id="cb55-774"><a href="#cb55-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-777"><a href="#cb55-777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-778"><a href="#cb55-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb55-779"><a href="#cb55-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb55-780"><a href="#cb55-780" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(full_mc)</span>
<span id="cb55-781"><a href="#cb55-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-782"><a href="#cb55-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-783"><a href="#cb55-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{stan, output.var="fullStanModel", code=brms::stancode(full_mc), echo=TRUE}</span></span>
<span id="cb55-784"><a href="#cb55-784" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-line-numbers: "16-27,90-95"</span></span>
<span id="cb55-785"><a href="#cb55-785" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb55-786"><a href="#cb55-786" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show full Stan model"</span></span>
<span id="cb55-787"><a href="#cb55-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-788"><a href="#cb55-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-789"><a href="#cb55-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-790"><a href="#cb55-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-793"><a href="#cb55-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-794"><a href="#cb55-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-795"><a href="#cb55-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-796"><a href="#cb55-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb55-797"><a href="#cb55-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-798"><a href="#cb55-798" aria-hidden="true" tabindex="-1"></a>study_future <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-799"><a href="#cb55-799" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">0</span>,</span>
<span id="cb55-800"><a href="#cb55-800" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_tilde =</span> <span class="dv">0</span>,</span>
<span id="cb55-801"><a href="#cb55-801" aria-hidden="true" tabindex="-1"></a>  <span class="at">severe =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb55-802"><a href="#cb55-802" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb55-803"><a href="#cb55-803" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_tilde =</span> <span class="dv">1</span>,</span>
<span id="cb55-804"><a href="#cb55-804" aria-hidden="true" tabindex="-1"></a>  <span class="at">oral =</span> <span class="dv">0</span>,</span>
<span id="cb55-805"><a href="#cb55-805" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="st">"new_trial"</span></span>
<span id="cb55-806"><a href="#cb55-806" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-807"><a href="#cb55-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-808"><a href="#cb55-808" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain posterior for severe and moderate; note that we must allow to</span></span>
<span id="cb55-809"><a href="#cb55-809" aria-hidden="true" tabindex="-1"></a><span class="co"># sample new levels of the random effects and also specify to do so</span></span>
<span id="cb55-810"><a href="#cb55-810" aria-hidden="true" tabindex="-1"></a><span class="co"># using the "gaussian" option (as brms would otherwise bootstrap from</span></span>
<span id="cb55-811"><a href="#cb55-811" aria-hidden="true" tabindex="-1"></a><span class="co"># existing studies).</span></span>
<span id="cb55-812"><a href="#cb55-812" aria-hidden="true" tabindex="-1"></a>prior_future_study <span class="ot">&lt;-</span></span>
<span id="cb55-813"><a href="#cb55-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb55-814"><a href="#cb55-814" aria-hidden="true" tabindex="-1"></a>    full_mc,</span>
<span id="cb55-815"><a href="#cb55-815" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> study_future,</span>
<span id="cb55-816"><a href="#cb55-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-817"><a href="#cb55-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_new_levels =</span> <span class="st">"gaussian"</span></span>
<span id="cb55-818"><a href="#cb55-818" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb55-819"><a href="#cb55-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-820"><a href="#cb55-820" aria-hidden="true" tabindex="-1"></a><span class="co"># we get a matrix with dimensions draws x predictions the second</span></span>
<span id="cb55-821"><a href="#cb55-821" aria-hidden="true" tabindex="-1"></a><span class="co"># column includes the intercept plus the covariate effect due to</span></span>
<span id="cb55-822"><a href="#cb55-822" aria-hidden="true" tabindex="-1"></a><span class="co"># severity, which we convert to the log odds ratio estimate only by</span></span>
<span id="cb55-823"><a href="#cb55-823" aria-hidden="true" tabindex="-1"></a><span class="co"># subtracting the overall intercept in the first column</span></span>
<span id="cb55-824"><a href="#cb55-824" aria-hidden="true" tabindex="-1"></a>prior_future_study[<span class="dv">2</span>] <span class="ot">&lt;-</span> prior_future_study[<span class="dv">2</span>] <span class="sc">-</span> prior_future_study[<span class="dv">1</span>]</span>
<span id="cb55-825"><a href="#cb55-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-826"><a href="#cb55-826" aria-hidden="true" tabindex="-1"></a><span class="co"># As we wish to formulate a joint prior on all model parameters of the</span></span>
<span id="cb55-827"><a href="#cb55-827" aria-hidden="true" tabindex="-1"></a><span class="co"># trial model - including the treatment effect - a weakly-informative</span></span>
<span id="cb55-828"><a href="#cb55-828" aria-hidden="true" tabindex="-1"></a><span class="co"># prior for the treatment effect is added to the posterior in MC form.</span></span>
<span id="cb55-829"><a href="#cb55-829" aria-hidden="true" tabindex="-1"></a>prior_future_study <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb55-830"><a href="#cb55-830" aria-hidden="true" tabindex="-1"></a>  prior_future_study,</span>
<span id="cb55-831"><a href="#cb55-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="fu">rvar_rng</span>(rnorm, <span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">3.5</span>, <span class="at">ndraws =</span> <span class="fu">ndraws</span>(prior_future_study))</span>
<span id="cb55-832"><a href="#cb55-832" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-833"><a href="#cb55-833" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prior_future_study) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"inter"</span>, <span class="st">"severe"</span>, <span class="st">"active"</span>)</span>
<span id="cb55-834"><a href="#cb55-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-835"><a href="#cb55-835" aria-hidden="true" tabindex="-1"></a><span class="co"># now turn the MC sample of the prior into a parametric representation</span></span>
<span id="cb55-836"><a href="#cb55-836" aria-hidden="true" tabindex="-1"></a><span class="co"># using functions from RBesT</span></span>
<span id="cb55-837"><a href="#cb55-837" aria-hidden="true" tabindex="-1"></a>map_prior <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb55-838"><a href="#cb55-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(prior_future_study),</span>
<span id="cb55-839"><a href="#cb55-839" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"mvnorm"</span>,</span>
<span id="cb55-840"><a href="#cb55-840" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb55-841"><a href="#cb55-841" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-842"><a href="#cb55-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-843"><a href="#cb55-843" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(map_prior)<span class="sc">$</span>mixpairs</span>
<span id="cb55-844"><a href="#cb55-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-845"><a href="#cb55-845" aria-hidden="true" tabindex="-1"></a><span class="do">## robustify joint prior</span></span>
<span id="cb55-846"><a href="#cb55-846" aria-hidden="true" tabindex="-1"></a>prior_non_inf <span class="ot">&lt;-</span> <span class="fu">mixmvnorm</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb55-847"><a href="#cb55-847" aria-hidden="true" tabindex="-1"></a>rmap_prior <span class="ot">&lt;-</span> <span class="fu">mixcombine</span>(map_prior, prior_non_inf, <span class="at">weight =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span>
<span id="cb55-848"><a href="#cb55-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-849"><a href="#cb55-849" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rmap_prior)</span>
<span id="cb55-850"><a href="#cb55-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-851"><a href="#cb55-851" aria-hidden="true" tabindex="-1"></a><span class="co"># For pre-specification of the MAP prior we have to report the MAP</span></span>
<span id="cb55-852"><a href="#cb55-852" aria-hidden="true" tabindex="-1"></a><span class="co"># prior with a finite precision in the protocol. Thereby, it is</span></span>
<span id="cb55-853"><a href="#cb55-853" aria-hidden="true" tabindex="-1"></a><span class="co"># recommended to write the MAP prior to disk using the JSON read/write</span></span>
<span id="cb55-854"><a href="#cb55-854" aria-hidden="true" tabindex="-1"></a><span class="co"># functions from RBesT to store the MAP prior with a defined precision</span></span>
<span id="cb55-855"><a href="#cb55-855" aria-hidden="true" tabindex="-1"></a><span class="co"># on file in a human readable format as JSON:</span></span>
<span id="cb55-856"><a href="#cb55-856" aria-hidden="true" tabindex="-1"></a>map_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"map_new_trial_json.txt"</span>))</span>
<span id="cb55-857"><a href="#cb55-857" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(map_prior, map_new_trial_file, <span class="at">pretty =</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb55-858"><a href="#cb55-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-859"><a href="#cb55-859" aria-hidden="true" tabindex="-1"></a>rmap_new_trial_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"rmap_new_trial_json.txt"</span>))</span>
<span id="cb55-860"><a href="#cb55-860" aria-hidden="true" tabindex="-1"></a><span class="fu">write_mix_json</span>(rmap_prior, rmap_new_trial_file, <span class="at">pretty =</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb55-861"><a href="#cb55-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-862"><a href="#cb55-862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-863"><a href="#cb55-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-864"><a href="#cb55-864" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb55-865"><a href="#cb55-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-866"><a href="#cb55-866" aria-hidden="true" tabindex="-1"></a>At this stage we have derived robust bi-variate MAP priors from the</span>
<span id="cb55-867"><a href="#cb55-867" aria-hidden="true" tabindex="-1"></a>subset of the complete historical control data and the full historical</span>
<span id="cb55-868"><a href="#cb55-868" aria-hidden="true" tabindex="-1"></a>control data. Now we proceed and illustrate how these priors compare,</span>
<span id="cb55-869"><a href="#cb55-869" aria-hidden="true" tabindex="-1"></a>what operating characeristics these imply and how these priors can be</span>
<span id="cb55-870"><a href="#cb55-870" aria-hidden="true" tabindex="-1"></a>used in the analysis of the future trial data.</span>
<span id="cb55-871"><a href="#cb55-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-872"><a href="#cb55-872" aria-hidden="true" tabindex="-1"></a>We first load the derived robust MAP priors which are stored as JSON</span>
<span id="cb55-873"><a href="#cb55-873" aria-hidden="true" tabindex="-1"></a>files. It is important to emphasize that this constitutes the</span>
<span id="cb55-874"><a href="#cb55-874" aria-hidden="true" tabindex="-1"></a>information used as a prior in the new trial. That is, the previous</span>
<span id="cb55-875"><a href="#cb55-875" aria-hidden="true" tabindex="-1"></a>hierarchical model for the historical data is no longer needed to</span>
<span id="cb55-876"><a href="#cb55-876" aria-hidden="true" tabindex="-1"></a>analyze the future trial given that we have accuratley approximated</span>
<span id="cb55-877"><a href="#cb55-877" aria-hidden="true" tabindex="-1"></a>the (robust) MAP density in parametric form.</span>
<span id="cb55-878"><a href="#cb55-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-879"><a href="#cb55-879" aria-hidden="true" tabindex="-1"></a>Nonetheles, the prior must also be made available to <span class="in">`brms`</span> as a prior</span>
<span id="cb55-880"><a href="#cb55-880" aria-hidden="true" tabindex="-1"></a>density. This requires the use of <span class="in">`RBesT`</span> mixture priors within</span>
<span id="cb55-881"><a href="#cb55-881" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span>. Given that these mixture priors are not known to <span class="in">`brms`</span> per</span>
<span id="cb55-882"><a href="#cb55-882" aria-hidden="true" tabindex="-1"></a>se, an adapter function is provided by <span class="in">`RBesT`</span>, the [<span class="in">`mixstanvar`</span></span>
<span id="cb55-883"><a href="#cb55-883" aria-hidden="true" tabindex="-1"></a>adapter](https://opensource.nibr.com/RBesT/reference/mixstanvar.html). Here,</span>
<span id="cb55-884"><a href="#cb55-884" aria-hidden="true" tabindex="-1"></a>we illustrate it's use by instantiating a <span class="in">`brms`</span> model, which is used</span>
<span id="cb55-885"><a href="#cb55-885" aria-hidden="true" tabindex="-1"></a>to sample from the MAP priors to characerise it's properties.</span>
<span id="cb55-886"><a href="#cb55-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-889"><a href="#cb55-889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-890"><a href="#cb55-890" aria-hidden="true" tabindex="-1"></a><span class="co"># load pre-specified prior</span></span>
<span id="cb55-891"><a href="#cb55-891" aria-hidden="true" tabindex="-1"></a>rmap_prior_protocol <span class="ot">&lt;-</span> <span class="fu">read_mix_json</span>(rmap_new_trial_file, <span class="at">rescale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-892"><a href="#cb55-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-893"><a href="#cb55-893" aria-hidden="true" tabindex="-1"></a>rmap_prior_complete_protocol <span class="ot">&lt;-</span> <span class="fu">read_mix_json</span>(</span>
<span id="cb55-894"><a href="#cb55-894" aria-hidden="true" tabindex="-1"></a>  rmap_complete_new_trial_file,</span>
<span id="cb55-895"><a href="#cb55-895" aria-hidden="true" tabindex="-1"></a>  <span class="at">rescale =</span> <span class="cn">TRUE</span></span>
<span id="cb55-896"><a href="#cb55-896" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-897"><a href="#cb55-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-898"><a href="#cb55-898" aria-hidden="true" tabindex="-1"></a><span class="co"># model for trial without hierarchical structure</span></span>
<span id="cb55-899"><a href="#cb55-899" aria-hidden="true" tabindex="-1"></a>trial_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(r <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> severe <span class="sc">+</span> active, <span class="at">family =</span> bernoulli, <span class="at">center =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-900"><a href="#cb55-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-901"><a href="#cb55-901" aria-hidden="true" tabindex="-1"></a><span class="co"># uses as prior the multi-variate normal prior previously store on</span></span>
<span id="cb55-902"><a href="#cb55-902" aria-hidden="true" tabindex="-1"></a><span class="co"># file</span></span>
<span id="cb55-903"><a href="#cb55-903" aria-hidden="true" tabindex="-1"></a>trial_model_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">mixmvnorm</span>(rmap_w, rmap_m, rmap_sigma_L), <span class="at">class =</span> b)</span>
<span id="cb55-904"><a href="#cb55-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-905"><a href="#cb55-905" aria-hidden="true" tabindex="-1"></a><span class="co"># insert dummy data for the two strata on control only here</span></span>
<span id="cb55-906"><a href="#cb55-906" aria-hidden="true" tabindex="-1"></a>study_strata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-907"><a href="#cb55-907" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="dv">0</span>,</span>
<span id="cb55-908"><a href="#cb55-908" aria-hidden="true" tabindex="-1"></a>  <span class="at">severe =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb55-909"><a href="#cb55-909" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb55-910"><a href="#cb55-910" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="dv">0</span>,</span>
<span id="cb55-911"><a href="#cb55-911" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="st">"new_trial"</span></span>
<span id="cb55-912"><a href="#cb55-912" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-913"><a href="#cb55-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-914"><a href="#cb55-914" aria-hidden="true" tabindex="-1"></a><span class="co"># sample prior of the model as we like to evaluate operating</span></span>
<span id="cb55-915"><a href="#cb55-915" aria-hidden="true" tabindex="-1"></a><span class="co"># characteristics</span></span>
<span id="cb55-916"><a href="#cb55-916" aria-hidden="true" tabindex="-1"></a>trail_model_full_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb55-917"><a href="#cb55-917" aria-hidden="true" tabindex="-1"></a>  trial_model,</span>
<span id="cb55-918"><a href="#cb55-918" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> study_strata,</span>
<span id="cb55-919"><a href="#cb55-919" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is the magic sauce from RBesT which plugs</span></span>
<span id="cb55-920"><a href="#cb55-920" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the multi-variate normal mixture prior into</span></span>
<span id="cb55-921"><a href="#cb55-921" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the brms model</span></span>
<span id="cb55-922"><a href="#cb55-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> trial_model_prior,</span>
<span id="cb55-923"><a href="#cb55-923" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvar =</span> <span class="fu">mixstanvar</span>(<span class="at">rmap =</span> rmap_prior_protocol),</span>
<span id="cb55-924"><a href="#cb55-924" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb55-925"><a href="#cb55-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb55-926"><a href="#cb55-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb55-927"><a href="#cb55-927" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb55-928"><a href="#cb55-928" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-929"><a href="#cb55-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-930"><a href="#cb55-930" aria-hidden="true" tabindex="-1"></a>trail_model_complete_mc <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb55-931"><a href="#cb55-931" aria-hidden="true" tabindex="-1"></a>  trial_model,</span>
<span id="cb55-932"><a href="#cb55-932" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> study_strata,</span>
<span id="cb55-933"><a href="#cb55-933" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> trial_model_prior,</span>
<span id="cb55-934"><a href="#cb55-934" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvar =</span> <span class="fu">mixstanvar</span>(<span class="at">rmap =</span> rmap_prior_complete_protocol),</span>
<span id="cb55-935"><a href="#cb55-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">"only"</span>,</span>
<span id="cb55-936"><a href="#cb55-936" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb55-937"><a href="#cb55-937" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">4585678</span>,</span>
<span id="cb55-938"><a href="#cb55-938" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb55-939"><a href="#cb55-939" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-940"><a href="#cb55-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-941"><a href="#cb55-941" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain MC sample of trial prior on response scale</span></span>
<span id="cb55-942"><a href="#cb55-942" aria-hidden="true" tabindex="-1"></a>trial_prior_full_rv <span class="ot">&lt;-</span> <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb55-943"><a href="#cb55-943" aria-hidden="true" tabindex="-1"></a>  trail_model_full_mc,</span>
<span id="cb55-944"><a href="#cb55-944" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="cn">TRUE</span></span>
<span id="cb55-945"><a href="#cb55-945" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-946"><a href="#cb55-946" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_rv <span class="ot">&lt;-</span> <span class="fu">rvar</span>(<span class="fu">posterior_linpred</span>(</span>
<span id="cb55-947"><a href="#cb55-947" aria-hidden="true" tabindex="-1"></a>  trail_model_complete_mc,</span>
<span id="cb55-948"><a href="#cb55-948" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="cn">TRUE</span></span>
<span id="cb55-949"><a href="#cb55-949" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb55-950"><a href="#cb55-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-951"><a href="#cb55-951" aria-hidden="true" tabindex="-1"></a><span class="co"># on the response scale we form the expected response rate which</span></span>
<span id="cb55-952"><a href="#cb55-952" aria-hidden="true" tabindex="-1"></a><span class="co"># respects the expected percentage of severe patients.</span></span>
<span id="cb55-953"><a href="#cb55-953" aria-hidden="true" tabindex="-1"></a>w_severe <span class="ot">&lt;-</span> <span class="fl">0.45</span></span>
<span id="cb55-954"><a href="#cb55-954" aria-hidden="true" tabindex="-1"></a>trial_prior_full_mean_rv <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_severe) <span class="sc">*</span></span>
<span id="cb55-955"><a href="#cb55-955" aria-hidden="true" tabindex="-1"></a>  trial_prior_full_rv[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb55-956"><a href="#cb55-956" aria-hidden="true" tabindex="-1"></a>  w_severe <span class="sc">*</span> trial_prior_full_rv[<span class="dv">2</span>]</span>
<span id="cb55-957"><a href="#cb55-957" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_mean_rv <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_severe) <span class="sc">*</span></span>
<span id="cb55-958"><a href="#cb55-958" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_rv[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb55-959"><a href="#cb55-959" aria-hidden="true" tabindex="-1"></a>  w_severe <span class="sc">*</span> trial_prior_complete_rv[<span class="dv">2</span>]</span>
<span id="cb55-960"><a href="#cb55-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-961"><a href="#cb55-961" aria-hidden="true" tabindex="-1"></a>trial_prior_full_mean <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb55-962"><a href="#cb55-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(trial_prior_full_mean_rv),</span>
<span id="cb55-963"><a href="#cb55-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"beta"</span>,</span>
<span id="cb55-964"><a href="#cb55-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb55-965"><a href="#cb55-965" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-966"><a href="#cb55-966" aria-hidden="true" tabindex="-1"></a>trial_prior_complete_mean <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(</span>
<span id="cb55-967"><a href="#cb55-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(trial_prior_complete_mean_rv),</span>
<span id="cb55-968"><a href="#cb55-968" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"beta"</span>,</span>
<span id="cb55-969"><a href="#cb55-969" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nc =</span> <span class="dv">3</span></span>
<span id="cb55-970"><a href="#cb55-970" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-971"><a href="#cb55-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-972"><a href="#cb55-972" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trial_prior_full_mean)</span>
<span id="cb55-973"><a href="#cb55-973" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trial_prior_complete_mean)</span>
<span id="cb55-974"><a href="#cb55-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-975"><a href="#cb55-975" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-976"><a href="#cb55-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-977"><a href="#cb55-977" aria-hidden="true" tabindex="-1"></a>These MAP priors have been derived on the response scale and are</span>
<span id="cb55-978"><a href="#cb55-978" aria-hidden="true" tabindex="-1"></a>approximated using Beta mixture priors. These correspond to the</span>
<span id="cb55-979"><a href="#cb55-979" aria-hidden="true" tabindex="-1"></a>marginal prior density when assuming the quoted 45% of severe patients</span>
<span id="cb55-980"><a href="#cb55-980" aria-hidden="true" tabindex="-1"></a>at baseline in the future trial. In this marginal form we can use the</span>
<span id="cb55-981"><a href="#cb55-981" aria-hidden="true" tabindex="-1"></a>commonly used tools to study the trial operating characeristics when</span>
<span id="cb55-982"><a href="#cb55-982" aria-hidden="true" tabindex="-1"></a>using an informative MAP prior for the control group. Note that this</span>
<span id="cb55-983"><a href="#cb55-983" aria-hidden="true" tabindex="-1"></a>essentially ignores the presence of a covariate, which is a</span>
<span id="cb55-984"><a href="#cb55-984" aria-hidden="true" tabindex="-1"></a>commonplace simplification for trial planning and the expectation that</span>
<span id="cb55-985"><a href="#cb55-985" aria-hidden="true" tabindex="-1"></a>trial power will increase due to the explicit use of the covariate.</span>
<span id="cb55-986"><a href="#cb55-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-987"><a href="#cb55-987" aria-hidden="true" tabindex="-1"></a>We start by considering the effective sample size of the priors:</span>
<span id="cb55-988"><a href="#cb55-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-991"><a href="#cb55-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-992"><a href="#cb55-992" aria-hidden="true" tabindex="-1"></a><span class="fu">ess</span>(trial_prior_full_mean)</span>
<span id="cb55-993"><a href="#cb55-993" aria-hidden="true" tabindex="-1"></a><span class="fu">ess</span>(trial_prior_complete_mean)</span>
<span id="cb55-994"><a href="#cb55-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-995"><a href="#cb55-995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-996"><a href="#cb55-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-997"><a href="#cb55-997" aria-hidden="true" tabindex="-1"></a>And continue with evaluating the operating characteristics of the</span>
<span id="cb55-998"><a href="#cb55-998" aria-hidden="true" tabindex="-1"></a>trial, which assume a true response rate for placebo of 9% and use as</span>
<span id="cb55-999"><a href="#cb55-999" aria-hidden="true" tabindex="-1"></a>reference case a sample size of 50 per arm (100 total), which is</span>
<span id="cb55-1000"><a href="#cb55-1000" aria-hidden="true" tabindex="-1"></a>considered for a reduction to a 2:1 ratio trial with a total of only</span>
<span id="cb55-1001"><a href="#cb55-1001" aria-hidden="true" tabindex="-1"></a>75 patients:</span>
<span id="cb55-1002"><a href="#cb55-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1005"><a href="#cb55-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1006"><a href="#cb55-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-1007"><a href="#cb55-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-1008"><a href="#cb55-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1009"><a href="#cb55-1009" aria-hidden="true" tabindex="-1"></a>success_crit <span class="ot">&lt;-</span> <span class="fu">decision2S</span>(<span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.6</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>), <span class="cn">FALSE</span>)</span>
<span id="cb55-1010"><a href="#cb55-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1011"><a href="#cb55-1011" aria-hidden="true" tabindex="-1"></a>unif_prior <span class="ot">&lt;-</span> <span class="fu">mixbeta</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb55-1012"><a href="#cb55-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1013"><a href="#cb55-1013" aria-hidden="true" tabindex="-1"></a>design_noninf_11 <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, unif_prior, <span class="dv">50</span>, <span class="dv">50</span>, success_crit)</span>
<span id="cb55-1014"><a href="#cb55-1014" aria-hidden="true" tabindex="-1"></a>design_noninf_21 <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, unif_prior, <span class="dv">50</span>, <span class="dv">25</span>, success_crit)</span>
<span id="cb55-1015"><a href="#cb55-1015" aria-hidden="true" tabindex="-1"></a>design_complete <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(</span>
<span id="cb55-1016"><a href="#cb55-1016" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb55-1017"><a href="#cb55-1017" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_mean,</span>
<span id="cb55-1018"><a href="#cb55-1018" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb55-1019"><a href="#cb55-1019" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb55-1020"><a href="#cb55-1020" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb55-1021"><a href="#cb55-1021" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1022"><a href="#cb55-1022" aria-hidden="true" tabindex="-1"></a>design_full <span class="ot">&lt;-</span> <span class="fu">oc2S</span>(unif_prior, trial_prior_full_mean, <span class="dv">50</span>, <span class="dv">25</span>, success_crit)</span>
<span id="cb55-1023"><a href="#cb55-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1024"><a href="#cb55-1024" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">delta =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.7</span>)), <span class="fu">aes</span>(<span class="at">x =</span> delta)) <span class="sc">+</span></span>
<span id="cb55-1025"><a href="#cb55-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb55-1026"><a href="#cb55-1026" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_full</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb55-1027"><a href="#cb55-1027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"Full data"</span>)</span>
<span id="cb55-1028"><a href="#cb55-1028" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-1029"><a href="#cb55-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb55-1030"><a href="#cb55-1030" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_complete</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb55-1031"><a href="#cb55-1031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"Complete only data"</span>)</span>
<span id="cb55-1032"><a href="#cb55-1032" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-1033"><a href="#cb55-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb55-1034"><a href="#cb55-1034" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_noninf_21</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb55-1035"><a href="#cb55-1035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"No prior 50:25"</span>)</span>
<span id="cb55-1036"><a href="#cb55-1036" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-1037"><a href="#cb55-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb55-1038"><a href="#cb55-1038" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> \(x) <span class="fu">design_noninf_11</span>(<span class="fl">0.09</span> <span class="sc">+</span> x, <span class="fl">0.09</span>),</span>
<span id="cb55-1039"><a href="#cb55-1039" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">linetype =</span> <span class="st">"No prior 50:50"</span>)</span>
<span id="cb55-1040"><a href="#cb55-1040" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-1041"><a href="#cb55-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">"Prior"</span>) <span class="sc">+</span></span>
<span id="cb55-1042"><a href="#cb55-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Power"</span>, <span class="at">subtitle =</span> <span class="st">"Assumed placebo response rate of 9%"</span>) <span class="sc">+</span></span>
<span id="cb55-1043"><a href="#cb55-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Response rate difference active to placebo"</span>) <span class="sc">+</span></span>
<span id="cb55-1044"><a href="#cb55-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Power"</span>) <span class="sc">+</span></span>
<span id="cb55-1045"><a href="#cb55-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb55-1046"><a href="#cb55-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb55-1047"><a href="#cb55-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb55-1048"><a href="#cb55-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1049"><a href="#cb55-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1050"><a href="#cb55-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1051"><a href="#cb55-1051" aria-hidden="true" tabindex="-1"></a>The MAP priors do improve the power to detect a difference to control</span>
<span id="cb55-1052"><a href="#cb55-1052" aria-hidden="true" tabindex="-1"></a>here. The difference between the full and complete only prior is not</span>
<span id="cb55-1053"><a href="#cb55-1053" aria-hidden="true" tabindex="-1"></a>quite pronounced. This can also be seen by considering the critical</span>
<span id="cb55-1054"><a href="#cb55-1054" aria-hidden="true" tabindex="-1"></a>values tabulated by a given number of responders in the placebo group:</span>
<span id="cb55-1055"><a href="#cb55-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1058"><a href="#cb55-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb55-1059"><a href="#cb55-1059" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb55-1060"><a href="#cb55-1060" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb55-1061"><a href="#cb55-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1062"><a href="#cb55-1062" aria-hidden="true" tabindex="-1"></a>crit_complete <span class="ot">&lt;-</span> <span class="fu">decision2S_boundary</span>(</span>
<span id="cb55-1063"><a href="#cb55-1063" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb55-1064"><a href="#cb55-1064" aria-hidden="true" tabindex="-1"></a>  trial_prior_complete_mean,</span>
<span id="cb55-1065"><a href="#cb55-1065" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb55-1066"><a href="#cb55-1066" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb55-1067"><a href="#cb55-1067" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb55-1068"><a href="#cb55-1068" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1069"><a href="#cb55-1069" aria-hidden="true" tabindex="-1"></a>crit_full <span class="ot">&lt;-</span> <span class="fu">decision2S_boundary</span>(</span>
<span id="cb55-1070"><a href="#cb55-1070" aria-hidden="true" tabindex="-1"></a>  unif_prior,</span>
<span id="cb55-1071"><a href="#cb55-1071" aria-hidden="true" tabindex="-1"></a>  trial_prior_full_mean,</span>
<span id="cb55-1072"><a href="#cb55-1072" aria-hidden="true" tabindex="-1"></a>  <span class="dv">50</span>,</span>
<span id="cb55-1073"><a href="#cb55-1073" aria-hidden="true" tabindex="-1"></a>  <span class="dv">25</span>,</span>
<span id="cb55-1074"><a href="#cb55-1074" aria-hidden="true" tabindex="-1"></a>  success_crit</span>
<span id="cb55-1075"><a href="#cb55-1075" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-1076"><a href="#cb55-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1077"><a href="#cb55-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">r_placebo =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-1078"><a href="#cb55-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-1079"><a href="#cb55-1079" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_complete =</span> <span class="fu">crit_complete</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb55-1080"><a href="#cb55-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_full =</span> <span class="fu">crit_full</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb55-1081"><a href="#cb55-1081" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_complete =</span> <span class="fu">if_else</span>(</span>
<span id="cb55-1082"><a href="#cb55-1082" aria-hidden="true" tabindex="-1"></a>      min_r_active_complete <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb55-1083"><a href="#cb55-1083" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span>,</span>
<span id="cb55-1084"><a href="#cb55-1084" aria-hidden="true" tabindex="-1"></a>      min_r_active_complete <span class="sc">/</span> <span class="dv">50</span> <span class="sc">-</span> r_placebo <span class="sc">/</span> <span class="dv">25</span></span>
<span id="cb55-1085"><a href="#cb55-1085" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb55-1086"><a href="#cb55-1086" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_full =</span> <span class="fu">if_else</span>(</span>
<span id="cb55-1087"><a href="#cb55-1087" aria-hidden="true" tabindex="-1"></a>      min_r_active_full <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb55-1088"><a href="#cb55-1088" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span>,</span>
<span id="cb55-1089"><a href="#cb55-1089" aria-hidden="true" tabindex="-1"></a>      min_r_active_full <span class="sc">/</span> <span class="dv">50</span> <span class="sc">-</span> r_placebo <span class="sc">/</span> <span class="dv">25</span></span>
<span id="cb55-1090"><a href="#cb55-1090" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-1091"><a href="#cb55-1091" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-1092"><a href="#cb55-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-1093"><a href="#cb55-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_integer</span>(<span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"min_r"</span>), <span class="fu">starts_with</span>(<span class="st">"r_"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb55-1094"><a href="#cb55-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="fu">starts_with</span>(<span class="st">"min_obs"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-1095"><a href="#cb55-1095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb55-1096"><a href="#cb55-1096" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">html</span>(<span class="st">"Minimal active&lt;br&gt;responders"</span>),</span>
<span id="cb55-1097"><a href="#cb55-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"min_r"</span>)</span>
<span id="cb55-1098"><a href="#cb55-1098" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-1099"><a href="#cb55-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb55-1100"><a href="#cb55-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">html</span>(<span class="st">"Minimal observed&lt;br&gt;difference"</span>),</span>
<span id="cb55-1101"><a href="#cb55-1101" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"min_obs"</span>)</span>
<span id="cb55-1102"><a href="#cb55-1102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-1103"><a href="#cb55-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb55-1104"><a href="#cb55-1104" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_complete =</span> <span class="fu">html</span>(<span class="st">"Complete&lt;br&gt;only"</span>),</span>
<span id="cb55-1105"><a href="#cb55-1105" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_r_active_full =</span> <span class="st">"Full"</span>,</span>
<span id="cb55-1106"><a href="#cb55-1106" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_complete =</span> <span class="fu">html</span>(<span class="st">"Complete&lt;br&gt;only"</span>),</span>
<span id="cb55-1107"><a href="#cb55-1107" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_obs_delta_full =</span> <span class="st">"Full"</span>,</span>
<span id="cb55-1108"><a href="#cb55-1108" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_placebo =</span> <span class="fu">html</span>(<span class="st">"Responder&lt;br&gt;Placebo"</span>)</span>
<span id="cb55-1109"><a href="#cb55-1109" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-1110"><a href="#cb55-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>()</span>
<span id="cb55-1111"><a href="#cb55-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1112"><a href="#cb55-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1113"><a href="#cb55-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb55-1114"><a href="#cb55-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1115"><a href="#cb55-1115" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb55-1116"><a href="#cb55-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1117"><a href="#cb55-1117" aria-hidden="true" tabindex="-1"></a>This case study demonstrates how we may use historical control data</span>
<span id="cb55-1118"><a href="#cb55-1118" aria-hidden="true" tabindex="-1"></a>which requires the use of a baseline covariate. This complicates the</span>
<span id="cb55-1119"><a href="#cb55-1119" aria-hidden="true" tabindex="-1"></a>derivation of a MAP prior in two ways: (i) we are then required to derive an</span>
<span id="cb55-1120"><a href="#cb55-1120" aria-hidden="true" tabindex="-1"></a>informative MAP prior for the intercept and the slope parameters of</span>
<span id="cb55-1121"><a href="#cb55-1121" aria-hidden="true" tabindex="-1"></a>the respective model and (ii) the information we need from the</span>
<span id="cb55-1122"><a href="#cb55-1122" aria-hidden="true" tabindex="-1"></a>historical data may only be given in partial form. This former</span>
<span id="cb55-1123"><a href="#cb55-1123" aria-hidden="true" tabindex="-1"></a>complication can be resolved by a latent variable approach which we</span>
<span id="cb55-1124"><a href="#cb55-1124" aria-hidden="true" tabindex="-1"></a>marginalize for the trials with only partial information such that we</span>
<span id="cb55-1125"><a href="#cb55-1125" aria-hidden="true" tabindex="-1"></a>can make use of the partial data as given. This illustrates how we can</span>
<span id="cb55-1126"><a href="#cb55-1126" aria-hidden="true" tabindex="-1"></a>use two different likelihoods within the very same <span class="in">`brms`</span> model.</span>
<span id="cb55-1127"><a href="#cb55-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1128"><a href="#cb55-1128" aria-hidden="true" tabindex="-1"></a>We completed the case study by illustrating the operating</span>
<span id="cb55-1129"><a href="#cb55-1129" aria-hidden="true" tabindex="-1"></a>characteristics of a potential future trial in a simplified manner by</span>
<span id="cb55-1130"><a href="#cb55-1130" aria-hidden="true" tabindex="-1"></a>considering the marginalized response rate. These analyses showed that</span>
<span id="cb55-1131"><a href="#cb55-1131" aria-hidden="true" tabindex="-1"></a>there is indeed a benefit to use a MAP prior in this cotext. However,</span>
<span id="cb55-1132"><a href="#cb55-1132" aria-hidden="true" tabindex="-1"></a>the differences between using a MAP prior based on the full and</span>
<span id="cb55-1133"><a href="#cb55-1133" aria-hidden="true" tabindex="-1"></a>complete data only priors are not marked. Still, the ability to use</span>
<span id="cb55-1134"><a href="#cb55-1134" aria-hidden="true" tabindex="-1"></a>the full data set without further assumptions (the distribution of the</span>
<span id="cb55-1135"><a href="#cb55-1135" aria-hidden="true" tabindex="-1"></a>Binomial sum is calculated in an exact manner) is preferable over</span>
<span id="cb55-1136"><a href="#cb55-1136" aria-hidden="true" tabindex="-1"></a>dismissing relevant historical control data.</span>
<span id="cb55-1137"><a href="#cb55-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1138"><a href="#cb55-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb55-1139"><a href="#cb55-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1140"><a href="#cb55-1140" aria-hidden="true" tabindex="-1"></a>Use a normal approximation instead of the exact binomial convolution</span>
<span id="cb55-1141"><a href="#cb55-1141" aria-hidden="true" tabindex="-1"></a>for incorporating the partially reported data. Study the differences</span>
<span id="cb55-1142"><a href="#cb55-1142" aria-hidden="true" tabindex="-1"></a>to the case of using the exact Binomial convolution.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>