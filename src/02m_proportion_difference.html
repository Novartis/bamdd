<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Björn Holzhauer - bjoern.holzhauer@novartis.com">

<title>18&nbsp; Difference in proportions from a fitted logistic regression – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/03a_stan_code.html" rel="next">
<link href="../src/02j_network_meta_analysis.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-989f635e0436309011e17b1a0ac5a5c1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02m_proportion_difference.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02m_proportion_difference.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Parallel computation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">18.1</span> Background</a>
  <ul class="collapse">
  <li><a href="#different-effect-measures" id="toc-different-effect-measures" class="nav-link" data-scroll-target="#different-effect-measures"><span class="header-section-number">18.1.1</span> Different effect measures</a></li>
  <li><a href="#marginal-population-average-or-conditional-patient-specific" id="toc-marginal-population-average-or-conditional-patient-specific" class="nav-link" data-scroll-target="#marginal-population-average-or-conditional-patient-specific"><span class="header-section-number">18.1.2</span> Marginal (population-average) or conditional (patient-specific)</a></li>
  <li><a href="#marginal-difference-in-proportions-based-on-a-covariate-adjusted-bayesian-analysis" id="toc-marginal-difference-in-proportions-based-on-a-covariate-adjusted-bayesian-analysis" class="nav-link" data-scroll-target="#marginal-difference-in-proportions-based-on-a-covariate-adjusted-bayesian-analysis"><span class="header-section-number">18.1.3</span> Marginal difference in proportions based on a covariate-adjusted Bayesian analysis</a></li>
  </ul></li>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data"><span class="header-section-number">18.2</span> Example data</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="header-section-number">18.3</span> Model</a>
  <ul class="collapse">
  <li><a href="#details-of-approach" id="toc-details-of-approach" class="nav-link" data-scroll-target="#details-of-approach"><span class="header-section-number">18.3.1</span> Details of approach</a></li>
  <li><a href="#model-structure" id="toc-model-structure" class="nav-link" data-scroll-target="#model-structure"><span class="header-section-number">18.3.2</span> Model structure</a></li>
  <li><a href="#choice-of-prior-distributions" id="toc-choice-of-prior-distributions" class="nav-link" data-scroll-target="#choice-of-prior-distributions"><span class="header-section-number">18.3.3</span> Choice of prior distributions</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting"><span class="header-section-number">18.3.4</span> Model fitting</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">18.4</span> Results</a>
  <ul class="collapse">
  <li><a href="#population-average-difference-in-proportions" id="toc-population-average-difference-in-proportions" class="nav-link" data-scroll-target="#population-average-difference-in-proportions"><span class="header-section-number">18.4.1</span> Population average difference in proportions</a></li>
  <li><a href="#potential-interpretational-issues" id="toc-potential-interpretational-issues" class="nav-link" data-scroll-target="#potential-interpretational-issues"><span class="header-section-number">18.4.2</span> Potential interpretational issues</a></li>
  <li><a href="#omitting-terms-from-the-analysis-model" id="toc-omitting-terms-from-the-analysis-model" class="nav-link" data-scroll-target="#omitting-terms-from-the-analysis-model"><span class="header-section-number">18.4.3</span> Omitting terms from the analysis model</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions"><span class="header-section-number">18.5</span> Conclusions</a></li>
  <li><a href="#excercise" id="toc-excercise" class="nav-link" data-scroll-target="#excercise"><span class="header-section-number">18.6</span> Excercise</a>
  <ul class="collapse">
  <li><a href="#excercise-1" id="toc-excercise-1" class="nav-link" data-scroll-target="#excercise-1"><span class="header-section-number">18.6.1</span> Excercise 1</a></li>
  <li><a href="#excercise-2" id="toc-excercise-2" class="nav-link" data-scroll-target="#excercise-2"><span class="header-section-number">18.6.2</span> Excercise 2</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02m_proportion_difference.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-diffp" class="quarto-section-identifier"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Björn Holzhauer - <a href="mailto:bjoern.holzhauer@novartis.com" class="email">bjoern.holzhauer@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<!-- https://raw.githubusercontent.com/Novartis/bamdd/main/src/_macros.qmd -->
<p>This case study features:</p>
<ul>
<li>how to obtain a difference between proportions after fitting a Bayesian logistic regression using the standardized estimator approach</li>
<li>how to use sum-to-zero contrasts to express a-priori equal uncertainty about multiple factor levels</li>
<li>that a normal prior distribution with a standard deviation of 3.14 for the intercept of a logistic regression is already very vague</li>
<li>the use of <code>rvars</code> and the convenient helper functions such as <code>tidybayes::add_epred_rvars()</code></li>
<li>collapsability and transportability of effect measures, as well as population average and individual treatment effects</li>
</ul>
<p>To run the R code of this section please ensure to load these libraries first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">678571</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># default controls args passed to Stan</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>, <span class="at">step_size=</span><span class="fl">0.1</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># nice common ggplot2 theme</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">18</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="background" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="background"><span class="header-section-number">18.1</span> Background</h2>
<section id="different-effect-measures" class="level3" data-number="18.1.1">
<h3 data-number="18.1.1" class="anchored" data-anchor-id="different-effect-measures"><span class="header-section-number">18.1.1</span> Different effect measures</h3>
<p>Statisticians will often report results of an analysis in terms of the parameters of their analysis model, such as a (log-)odds ratio based on a logistic regression for a binary outcome. However, physicians or patients may struggle to understand these effect measures. They might instead prefer alternative effect measures such as a difference in proportion, the number of patients they need to treat with a drug (instead of with placebo) before we expect “it to make a difference for one of the patients” (aka “number needed to treat” or NNT) or the ratio of proportions (risk-ratio).</p>
<p>Even once we have chosen an effect measure, another question is whether we want it in its marginal (population-average) or conditional (patient-specific) form. Additionally, different effect measures may have other desirable properties such as collapsability and transportability.</p>
</section>
<section id="marginal-population-average-or-conditional-patient-specific" class="level3" data-number="18.1.2">
<h3 data-number="18.1.2" class="anchored" data-anchor-id="marginal-population-average-or-conditional-patient-specific"><span class="header-section-number">18.1.2</span> Marginal (population-average) or conditional (patient-specific)</h3>
<p>A patient (and their physician) will usually be interested in how much a treatment will help them (“How much would taking the drug reduced my risk of being hospitalized in the next year?”) taking their specific situation into account. This is the <strong>conditional</strong> (on patient covariates) or <strong>patient-specific</strong> question.</p>
<p>In contrast, an insurance company or state healthcare system might be more interested in the effect an intervention has on a population level (“How much would giving the drug to all eligible patients reduce the number of hospitalizations in the next year?”). This is a <strong>marginal</strong> or <strong>population-average</strong> effect question.</p>
<div class="alert alert-info">
<p>The difference between conditional and marginal estimates is not whether they come from a covariate adjusted model. Marginal estimates can still be obtained (with gain in precision) from covariate adjusted analyses.</p>
</div>
<p>Even when a treatment actually has the same causal effect for all patients, the population-average effect may not be the same as the patient specific effect. In general, we call an effect measure <strong>collapsible</strong> when the population-average effect is the average of the effects for the members of the population. In contrast, an effect measure, for which this is not the case is <strong>non-collapsible</strong>.</p>
<p>The difference in proportions is a <strong>collapsible effect measure</strong>. I.e. the marginal (population average) difference in proportions is the mean of the difference in proportions across the individuals in the population. This also means that, if the modelled difference in proportions is the same for all patients, then the marginal difference in proportions is the same as for each patient.</p>
<p>However, mathematically, a difference in proportions cannot be constant over differing control group proportions. It may just not vary to a degree we consider practically relevant. The difference in proportion for one patient will not generally be the same as for another patient and there may be no patient for whom the marginal difference in proportion applies (it is simply an average across patients). Thus, the marginal difference in proportions will differ for two populations with different covariate distributions. For that reason <a href="https://www.fharrell.com/post/rct-mimic/">Harrell has discussed</a> that the marginal difference in proportions is not a <strong>transportable</strong> effect measure, while the odds ratio might be transportable (but is non-collapsible).</p>
<p>I.e. a marginal difference in proportions for a drug compared with placebo from a clinical trial may not be a good summary of what will happen in clinical practice, because the distribution of characteristics of trial participants will rarely exactly match the distribution of the real-world patient population for the drug.</p>
<p><a href="https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adjusting-covariates-randomized-clinical-trials-drugs-and-biological-products">The FDA guidance</a> illustrates the difference between the odds ratio and the difference in proportions. This example illustrates the non-collapsibility of the odds ratio in a hypothetical target population (the marginal odds ratio is lower than the odds ratio for both subgroups) and the collapsibility of the difference in proportions (the marginal difference in proportions is exactly the weighted average of the subgroup differences weighted by the percentage of the target population in the subgroup).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 16%">
</colgroup>
<tbody>
<tr class="odd">
<td>Population</td>
<td>Percentage of target population</td>
<td>Success rate New drug</td>
<td>Success rate Placebo</td>
<td>Odds ratio</td>
<td>Difference in proportions</td>
</tr>
<tr class="even">
<td>Biomarkerpositive</td>
<td>50%</td>
<td>80.0%</td>
<td>33.3%</td>
<td>8.0</td>
<td>46.7%</td>
</tr>
<tr class="odd">
<td>Biomarkernegative</td>
<td>50%</td>
<td>25.0%</td>
<td>4.0%</td>
<td>8.0</td>
<td>21.0%</td>
</tr>
<tr class="even">
<td>Combined</td>
<td>100%</td>
<td>52.5%</td>
<td>18.7%</td>
<td>4.8</td>
<td>33.8%</td>
</tr>
</tbody>
</table>
<p>In this example, an conditional (on covariates) odds ratio of 8.0 applies to all patients and would be a reasonable patient-specific effect measure.</p>
<p>For a population with 50% biomarker-positive and 50% biomarker-negative patients a difference of proportion of 33.8% is the correct marginal (population-average) difference in proportions. However, this marginal effect applies to no patient (the difference in proportions for a patient is either 46.7% or 21.0% depending on the subgroup the patient is in). It also changes when we look at a population with, say, 80% biomarker-negative patients, then the marginal difference becomes 26.1%. If the data above have arisen from a clinical trial, in which the equal size of the biomarker-positive and -negative subgroups was solely an effect of ensuring equal enrolment in both subgroups, then it seems hard to justify why the equal weighting of the subgroup-specific differences in proportions is relevant to clinical practice. It is, of course, possible to adjust a difference in proportions to a known covariate distribution for a population of interest.</p>
</section>
<section id="marginal-difference-in-proportions-based-on-a-covariate-adjusted-bayesian-analysis" class="level3" data-number="18.1.3">
<h3 data-number="18.1.3" class="anchored" data-anchor-id="marginal-difference-in-proportions-based-on-a-covariate-adjusted-bayesian-analysis"><span class="header-section-number">18.1.3</span> Marginal difference in proportions based on a covariate-adjusted Bayesian analysis</h3>
<p>In this case study, we illustrate how to obtain a marginal difference in proportions based on a covariate-adjusted Bayesian analysis, as well as from one not adjusted for covariates. The same approach can also be used for e.g.&nbsp;the ratio of proportions, the difference in exponential hazard rates or the difference in the proportion of patients with an event after 1-year based on a survival model, or the difference in the proportion of patients achieving blood pressure control based on a linear regression.</p>
</section>
</section>
<section id="example-data" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="example-data"><span class="header-section-number">18.2</span> Example data</h2>
<p>The example concerns a hypothetical Phase IIA randomized controlled trial (RCT) conducted in four clinical trial sites. The RCT compared a new drug with placebo in terms of the proportion of patients with a disease achieving levels of a blood biomarker above the lower limit of normal for a healthy population. Younger patients are more likely to have a faster progressing and more aggressive form of the disease, so they are expected to be less likely to achieve this.</p>
<div class="cell">
<details class="code-fold">
<summary>Example data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> qlogis</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>inv_logit <span class="ot">=</span> plogis</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>trial_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">USUBJID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRT01P =</span> <span class="fu">c</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE =</span> <span class="fu">c</span>(</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="dv">77</span>L, <span class="dv">49</span>L, <span class="dv">51</span>L, <span class="dv">77</span>L, <span class="dv">73</span>L, <span class="dv">76</span>L, <span class="dv">58</span>L, <span class="dv">77</span>L, <span class="dv">69</span>L, <span class="dv">52</span>L, <span class="dv">45</span>L, <span class="dv">67</span>L, <span class="dv">42</span>L,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="dv">42</span>L, <span class="dv">56</span>L, <span class="dv">76</span>L, <span class="dv">71</span>L, <span class="dv">46</span>L, <span class="dv">76</span>L, <span class="dv">54</span>L, <span class="dv">67</span>L, <span class="dv">40</span>L, <span class="dv">37</span>L, <span class="dv">70</span>L, <span class="dv">70</span>L, <span class="dv">45</span>L,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="dv">69</span>L, <span class="dv">67</span>L, <span class="dv">63</span>L, <span class="dv">35</span>L, <span class="dv">64</span>L, <span class="dv">62</span>L, <span class="dv">78</span>L, <span class="dv">53</span>L, <span class="dv">44</span>L, <span class="dv">55</span>L, <span class="dv">47</span>L, <span class="dv">46</span>L, <span class="dv">63</span>L,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="dv">65</span>L, <span class="dv">67</span>L, <span class="dv">79</span>L, <span class="dv">44</span>L, <span class="dv">56</span>L, <span class="dv">47</span>L, <span class="dv">61</span>L, <span class="dv">74</span>L, <span class="dv">52</span>L, <span class="dv">57</span>L, <span class="dv">65</span>L, <span class="dv">36</span>L, <span class="dv">58</span>L,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="dv">72</span>L, <span class="dv">59</span>L, <span class="dv">48</span>L, <span class="dv">72</span>L, <span class="dv">71</span>L, <span class="dv">45</span>L, <span class="dv">66</span>L, <span class="dv">80</span>L, <span class="dv">62</span>L, <span class="dv">75</span>L, <span class="dv">67</span>L, <span class="dv">67</span>L, <span class="dv">66</span>L,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="dv">49</span>L, <span class="dv">72</span>L, <span class="dv">55</span>L, <span class="dv">44</span>L, <span class="dv">68</span>L, <span class="dv">77</span>L, <span class="dv">59</span>L, <span class="dv">84</span>L, <span class="dv">78</span>L, <span class="dv">77</span>L, <span class="dv">71</span>L, <span class="dv">36</span>L, <span class="dv">72</span>L,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        <span class="dv">36</span>L, <span class="dv">39</span>L, <span class="dv">57</span>L, <span class="dv">79</span>L, <span class="dv">71</span>L, <span class="dv">43</span>L, <span class="dv">61</span>L, <span class="dv">72</span>L, <span class="dv">49</span>L, <span class="dv">56</span>L, <span class="dv">54</span>L, <span class="dv">75</span>L, <span class="dv">68</span>L,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">45</span>L, <span class="dv">58</span>L, <span class="dv">46</span>L, <span class="dv">39</span>L, <span class="dv">65</span>L, <span class="dv">73</span>L, <span class="dv">72</span>L, <span class="dv">71</span>L, <span class="dv">49</span>L, <span class="dv">65</span>L, <span class="dv">70</span>L, <span class="dv">57</span>L, <span class="dv">47</span>L,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="dv">62</span>L, <span class="dv">36</span>L, <span class="dv">76</span>L, <span class="dv">70</span>L, <span class="dv">84</span>L, <span class="dv">54</span>L, <span class="dv">76</span>L, <span class="dv">36</span>L, <span class="dv">51</span>L, <span class="dv">38</span>L, <span class="dv">56</span>L, <span class="dv">44</span>L, <span class="dv">58</span>L,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="dv">53</span>L, <span class="dv">47</span>L, <span class="dv">80</span>L, <span class="dv">75</span>L, <span class="dv">47</span>L, <span class="dv">61</span>L, <span class="dv">57</span>L, <span class="dv">49</span>L, <span class="dv">64</span>L, <span class="dv">53</span>L, <span class="dv">44</span>L, <span class="dv">47</span>L, <span class="dv">67</span>L,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="dv">40</span>L, <span class="dv">56</span>L, <span class="dv">69</span>L, <span class="dv">81</span>L, <span class="dv">67</span>L, <span class="dv">83</span>L, <span class="dv">84</span>L, <span class="dv">81</span>L, <span class="dv">81</span>L, <span class="dv">55</span>L, <span class="dv">38</span>L, <span class="dv">48</span>L, <span class="dv">61</span>L,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="dv">80</span>L, <span class="dv">51</span>L, <span class="dv">76</span>L, <span class="dv">82</span>L, <span class="dv">61</span>L, <span class="dv">44</span>L, <span class="dv">51</span>L, <span class="dv">48</span>L, <span class="dv">72</span>L, <span class="dv">56</span>L, <span class="dv">49</span>L, <span class="dv">73</span>L, <span class="dv">71</span>L,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="dv">61</span>L, <span class="dv">72</span>L, <span class="dv">47</span>L, <span class="dv">45</span>L, <span class="dv">42</span>L, <span class="dv">82</span>L, <span class="dv">84</span>L, <span class="dv">50</span>L, <span class="dv">46</span>L, <span class="dv">57</span>L, <span class="dv">66</span>L, <span class="dv">49</span>L, <span class="dv">74</span>L,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="dv">70</span>L, <span class="dv">47</span>L, <span class="dv">48</span>L, <span class="dv">75</span>L, <span class="dv">53</span>L, <span class="dv">67</span>L, <span class="dv">38</span>L, <span class="dv">58</span>L, <span class="dv">48</span>L, <span class="dv">65</span>L, <span class="dv">44</span>L, <span class="dv">47</span>L, <span class="dv">47</span>L,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="dv">61</span>L, <span class="dv">76</span>L, <span class="dv">77</span>L, <span class="dv">49</span>L, <span class="dv">81</span>L, <span class="dv">77</span>L, <span class="dv">70</span>L, <span class="dv">61</span>L, <span class="dv">83</span>L, <span class="dv">48</span>L, <span class="dv">48</span>L, <span class="dv">52</span>L, <span class="dv">56</span>L,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="dv">74</span>L, <span class="dv">47</span>L, <span class="dv">54</span>L, <span class="dv">65</span>L, <span class="dv">45</span>L, <span class="dv">37</span>L, <span class="dv">65</span>L, <span class="dv">77</span>L, <span class="dv">44</span>L, <span class="dv">76</span>L, <span class="dv">52</span>L, <span class="dv">60</span>L, <span class="dv">37</span>L,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="dv">38</span>L, <span class="dv">65</span>L, <span class="dv">81</span>L, <span class="dv">55</span>L, <span class="dv">68</span>L, <span class="dv">49</span>L, <span class="dv">84</span>L, <span class="dv">81</span>L, <span class="dv">72</span>L, <span class="dv">74</span>L, <span class="dv">62</span>L, <span class="dv">75</span>L, <span class="dv">53</span>L,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="dv">58</span>L, <span class="dv">64</span>L, <span class="dv">57</span>L, <span class="dv">61</span>L, <span class="dv">74</span>L, <span class="dv">64</span>L, <span class="dv">46</span>L, <span class="dv">37</span>L, <span class="dv">81</span>L, <span class="dv">83</span>L, <span class="dv">65</span>L, <span class="dv">69</span>L, <span class="dv">54</span>L,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="dv">77</span>L, <span class="dv">73</span>L, <span class="dv">38</span>L, <span class="dv">47</span>L, <span class="dv">50</span>L, <span class="dv">65</span>L, <span class="dv">83</span>L, <span class="dv">45</span>L, <span class="dv">55</span>L, <span class="dv">70</span>L, <span class="dv">49</span>L, <span class="dv">63</span>L, <span class="dv">64</span>L,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="dv">52</span>L, <span class="dv">41</span>L, <span class="dv">36</span>L</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">SITEID =</span> <span class="fu">c</span>(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID=</span><span class="fu">factor</span>(SITEID, <span class="at">levels=</span><span class="dv">1</span>L<span class="sc">:</span><span class="dv">4</span>L,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">"Study site "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P=</span><span class="fu">factor</span>(TRT01P, <span class="at">levels=</span><span class="dv">0</span>L<span class="sc">:</span><span class="dv">1</span>L, </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Drug"</span>)),</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">sAGE =</span> <span class="fu">scale</span>(AGE))</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>trial_data <span class="sc">|&gt;</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Responders =</span> <span class="fu">sum</span>(AVAL),</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">Proportion =</span> Responders<span class="sc">/</span>n,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Mean age</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(AGE),</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">SD age</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(AGE),</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(<span class="st">"Mean age"</span>, <span class="st">"SD age"</span>), <span class="at">decimals=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span>Proportion, <span class="at">decimals=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="lgjtccnqkb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lgjtccnqkb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lgjtccnqkb thead, #lgjtccnqkb tbody, #lgjtccnqkb tfoot, #lgjtccnqkb tr, #lgjtccnqkb td, #lgjtccnqkb th {
  border-style: none;
}

#lgjtccnqkb p {
  margin: 0;
  padding: 0;
}

#lgjtccnqkb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lgjtccnqkb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lgjtccnqkb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lgjtccnqkb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lgjtccnqkb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lgjtccnqkb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lgjtccnqkb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lgjtccnqkb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lgjtccnqkb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lgjtccnqkb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lgjtccnqkb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lgjtccnqkb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lgjtccnqkb .gt_spanner_row {
  border-bottom-style: hidden;
}

#lgjtccnqkb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lgjtccnqkb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lgjtccnqkb .gt_from_md > :first-child {
  margin-top: 0;
}

#lgjtccnqkb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lgjtccnqkb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lgjtccnqkb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lgjtccnqkb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lgjtccnqkb .gt_row_group_first td {
  border-top-width: 2px;
}

#lgjtccnqkb .gt_row_group_first th {
  border-top-width: 2px;
}

#lgjtccnqkb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lgjtccnqkb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lgjtccnqkb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lgjtccnqkb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lgjtccnqkb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lgjtccnqkb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lgjtccnqkb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lgjtccnqkb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lgjtccnqkb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lgjtccnqkb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lgjtccnqkb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lgjtccnqkb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lgjtccnqkb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lgjtccnqkb .gt_left {
  text-align: left;
}

#lgjtccnqkb .gt_center {
  text-align: center;
}

#lgjtccnqkb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lgjtccnqkb .gt_font_normal {
  font-weight: normal;
}

#lgjtccnqkb .gt_font_bold {
  font-weight: bold;
}

#lgjtccnqkb .gt_font_italic {
  font-style: italic;
}

#lgjtccnqkb .gt_super {
  font-size: 65%;
}

#lgjtccnqkb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lgjtccnqkb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lgjtccnqkb .gt_indent_1 {
  text-indent: 5px;
}

#lgjtccnqkb .gt_indent_2 {
  text-indent: 10px;
}

#lgjtccnqkb .gt_indent_3 {
  text-indent: 15px;
}

#lgjtccnqkb .gt_indent_4 {
  text-indent: 20px;
}

#lgjtccnqkb .gt_indent_5 {
  text-indent: 25px;
}

#lgjtccnqkb .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lgjtccnqkb div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="SITEID" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">SITEID</th>
<th id="TRT01P" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">TRT01P</th>
<th id="Responders" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Responders</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="Proportion" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Proportion</th>
<th id="Mean-age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Mean age</th>
<th id="SD-age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">SD age</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="SITEID">Study site 1</td>
<td class="gt_row gt_center" headers="TRT01P">Placebo</td>
<td class="gt_row gt_right" headers="Responders">30</td>
<td class="gt_row gt_right" headers="n">70</td>
<td class="gt_row gt_right" headers="Proportion">0.43</td>
<td class="gt_row gt_right" headers="Mean age">61.5</td>
<td class="gt_row gt_right" headers="SD age">13.4</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="SITEID">Study site 1</td>
<td class="gt_row gt_center" headers="TRT01P">Drug</td>
<td class="gt_row gt_right" headers="Responders">39</td>
<td class="gt_row gt_right" headers="n">67</td>
<td class="gt_row gt_right" headers="Proportion">0.58</td>
<td class="gt_row gt_right" headers="Mean age">59.4</td>
<td class="gt_row gt_right" headers="SD age">14.4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="SITEID">Study site 2</td>
<td class="gt_row gt_center" headers="TRT01P">Placebo</td>
<td class="gt_row gt_right" headers="Responders">10</td>
<td class="gt_row gt_right" headers="n">15</td>
<td class="gt_row gt_right" headers="Proportion">0.67</td>
<td class="gt_row gt_right" headers="Mean age">58.3</td>
<td class="gt_row gt_right" headers="SD age">11.7</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="SITEID">Study site 2</td>
<td class="gt_row gt_center" headers="TRT01P">Drug</td>
<td class="gt_row gt_right" headers="Responders">20</td>
<td class="gt_row gt_right" headers="n">24</td>
<td class="gt_row gt_right" headers="Proportion">0.83</td>
<td class="gt_row gt_right" headers="Mean age">60.8</td>
<td class="gt_row gt_right" headers="SD age">14.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="SITEID">Study site 3</td>
<td class="gt_row gt_center" headers="TRT01P">Placebo</td>
<td class="gt_row gt_right" headers="Responders">7</td>
<td class="gt_row gt_right" headers="n">21</td>
<td class="gt_row gt_right" headers="Proportion">0.33</td>
<td class="gt_row gt_right" headers="Mean age">62.2</td>
<td class="gt_row gt_right" headers="SD age">12.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="SITEID">Study site 3</td>
<td class="gt_row gt_center" headers="TRT01P">Drug</td>
<td class="gt_row gt_right" headers="Responders">14</td>
<td class="gt_row gt_right" headers="n">26</td>
<td class="gt_row gt_right" headers="Proportion">0.54</td>
<td class="gt_row gt_right" headers="Mean age">56.8</td>
<td class="gt_row gt_right" headers="SD age">11.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="SITEID">Study site 4</td>
<td class="gt_row gt_center" headers="TRT01P">Placebo</td>
<td class="gt_row gt_right" headers="Responders">1</td>
<td class="gt_row gt_right" headers="n">11</td>
<td class="gt_row gt_right" headers="Proportion">0.09</td>
<td class="gt_row gt_right" headers="Mean age">65.4</td>
<td class="gt_row gt_right" headers="SD age">16.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="SITEID">Study site 4</td>
<td class="gt_row gt_center" headers="TRT01P">Drug</td>
<td class="gt_row gt_right" headers="Responders">7</td>
<td class="gt_row gt_right" headers="n">16</td>
<td class="gt_row gt_right" headers="Proportion">0.44</td>
<td class="gt_row gt_right" headers="Mean age">58.2</td>
<td class="gt_row gt_right" headers="SD age">13.8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="model" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="model"><span class="header-section-number">18.3</span> Model</h2>
<section id="details-of-approach" class="level3" data-number="18.3.1">
<h3 data-number="18.3.1" class="anchored" data-anchor-id="details-of-approach"><span class="header-section-number">18.3.1</span> Details of approach</h3>
<p>We are interested in comparing the two treatment groups in the RCT in terms of the marginal (population average) difference in the proportion of patients achieving the “responder” definition for each treatment.</p>
<p>Obtaining pseudo-random samples from the posterior distribution for a difference in proportions after fitting a Bayesian logistic regression in <code>brms</code> is particularly straightforward, if our model only includes treatment. In that case, we simply get posterior MCMC samples for the logit for the treatment and the control group, convert these to probabilities and form the difference per MCMC sample to obtain MCMC samples for the difference in proportions. Unlike with some frequentist methods, the properties of transformed MCMC samples mean that these samples will automatically obey logical constraints (e.g.&nbsp;each proportion must lie in [0, 1], the control group proportion plus the difference in proportions must also result in a proportion for the treatment group in [0, 1] etc.). This makes it extremely simple to obtain a valid point estimate with a sensible credible interval.</p>
<p>Things become a little bit more complicated, if there are further terms in the model, in the case of our example age and clinical trial site ID. We might include these terms in our model, because randomization was stratified by trial site (“analyze as you randomize”) and age is a known important predictor of response in this disease.</p>
<p>We now illustrate how we obtain a “standardized” estimator for the marginal (population average or “unconditional”) difference in proportions using the approach discussed by the <a href="https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adjusting-covariates-randomized-clinical-trials-drugs-and-biological-products">FDA guidance on adjusting for covariates in randomized clinical trials for drugs and biological products</a> (see also <span class="citation" data-cites="Moore2009">(<a href="02l_single_arm_pos.html#ref-Moore2009" role="doc-biblioref">Moore and Laan 2009</a>)</span> and <span class="citation" data-cites="Steingrimsson201718">(<a href="02l_single_arm_pos.html#ref-Steingrimsson201718" role="doc-biblioref">Steingrimsson, Hanley, and Rosenblum 2017</a>)</span>). The only thing we do differently compared to the mentioned papers is that instead of using a logistic regression model fit with maximum likelihood, we use a Bayesian logistic regression.</p>
<p>In the Bayesian framework the key steps for obtaining the “standardized” estimator of a difference in proportions for a RCT are particularly easy:</p>
<ol type="1">
<li>Fit a model (here a Bayesian logistic regression) to the RCT data.</li>
<li>Predict the outcomes for each patient under treatment and control (here we obtain pseudo-random samples for the posterior predicted logit-probability for each patient).</li>
<li>Calculate the metric of interest for each patient for each MCMC sample (here we apply the inverse-logit transformation to the logit-probabilities and form the difference between the treatment and control ones making sure to match the same indices so the same underlying set of underlying MCMC samples of model parameters are used for the treatment and control prediction of each patient).</li>
<li>Form the mean across patients.</li>
<li>Summarize the resulting MCMC samples for the posterior for the difference in proportions.</li>
</ol>
</section>
<section id="model-structure" class="level3" data-number="18.3.2">
<h3 data-number="18.3.2" class="anchored" data-anchor-id="model-structure"><span class="header-section-number">18.3.2</span> Model structure</h3>
<p>We choose a relatively simple (Bayesian) logistic regression model including an intercept, treatment, site as a fixed effect, and age as a covariate. We use a centered and scaled version of age to make it easier to reason about priors, because firstly the intercept and site effects now refer to a patient with an average age for the study, and secondly the age coefficient now describes the change in the logit with every standard deviation (in the study population) of age. For full control over the design matrix, we disable the default automatic centering of the design matrix with the <code>center=FALSE</code> option here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>brms_model1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  AVAL <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> SITEID <span class="sc">+</span> sAGE <span class="sc">+</span> TRT01P,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-info">
<p>Note that the model used in Step 1 of the procedure for obtaining a “standardized” estimator in the previous subsection could include a treatment by baseline covariate interaction. Including such an interaction makes sense when (we suspect that) the log-odds-ratio between treatment and control is not constant across all observed baseline covariate values.</p>
</div>
<p>Like for the centered and scaled version of age, we want the intercept term to not to refer to a reference <code>SITEID</code>. Thus, the use sum-to-zero contrasts for the <code>SITEID</code> factor variable, which means that there is a separate coefficient for each factor-level of <code>SITEID</code>, but they sum to zero (otherwise the model would be overparameterized). Sum-to-zero contrasts also mean that we express a-priori equal uncertainty about the probability for each trial site, while with a reference category we have less prior uncertainty about the reference category and more uncertainty about the other categories. With the vague priors we use in this case study, this consideration may be of minor relevance, but in other cases it may be more important.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(trial_data<span class="sc">$</span>SITEID) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(trial_data<span class="sc">$</span>SITEID)),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="cn">TRUE</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choice-of-prior-distributions" class="level3" data-number="18.3.3">
<h3 data-number="18.3.3" class="anchored" data-anchor-id="choice-of-prior-distributions"><span class="header-section-number">18.3.3</span> Choice of prior distributions</h3>
<p>We use a <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations#prior-for-the-regression-coefficients-in-logistic-regression-non-sparse-case">weakly informative prior</a> for the regression coefficients.</p>
<p>For the intercept of the model we use a normal distribution that (on the logit-scale) approximates a vague Beta(0.5, 0.5) prior distribution for a single proportion.</p>
<p>The table below shows what normal and Student-t distributions match the moments (mean, variance and - for the Student-t distribution - excess kurtosis) of the distribution of logit-probabilities for three commonly used vague Beta prior distributions for proportions.</p>
<div class="cell">
<details class="code-fold">
<summary>Beta prior approximations</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions to deal with finding appropriate logit-normal SD</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Density of logit-normal distribution</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (see https://en.wikipedia.org/wiki/Logit-normal_distribution)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>dlogitnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  tmp_ <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(sigma) <span class="sc">-</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">-</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">qlogis</span>(x) <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(x) <span class="sc">-</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log1p</span>(<span class="sc">-</span>x)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (log) tmp_ <span class="cf">else</span> <span class="fu">exp</span>(tmp_)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of logit-normal distribution (only for mu=0)</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>vlogitnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>) {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (mu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(sigma) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">integrate</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">f =</span> \(x) (<span class="fu">plogis</span>(x) <span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, sigma),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="cn">Inf</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span>value</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (mu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(sigma) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(sigma, <span class="at">FUN =</span> \(y) {</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">integrate</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">f =</span> \(x) (<span class="fu">plogis</span>(x) <span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, y),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="dv">1</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">$</span>value</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"vlogitnorm does not deal with mu neq 0"</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of the beta distribution</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>vbeta <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1 =</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">1</span>) {</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  shape1 <span class="sc">*</span> shape2 <span class="sc">/</span> (shape1 <span class="sc">+</span> shape2)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (shape1 <span class="sc">+</span> shape2 <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#vbeta(shape1=0.5, shape2=0.5)</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Find SD of the logit-normal to match a particular beta-distribution</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>find_logitnorm_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1 =</span> <span class="fl">0.5</span>, <span class="at">shape2 =</span> <span class="fl">0.5</span>) {</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(shape1 <span class="sc">!=</span> shape2)) {</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Cannot deal with unequal shape parameters"</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(shape1) <span class="sc">==</span> <span class="dv">1</span>L <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(shape2) <span class="sc">==</span> <span class="dv">1</span>L) {</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    ucminf<span class="sc">::</span><span class="fu">ucminf</span>(<span class="at">par =</span> <span class="fu">log</span>(<span class="fl">3.14</span>), <span class="at">fn =</span> \(x) {</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">vbeta</span>(<span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2) <span class="sc">-</span> <span class="fu">vlogitnorm</span>(<span class="at">sigma =</span> <span class="fu">exp</span>(x)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    })<span class="sc">$</span>par <span class="sc">|&gt;</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>()</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(shape1) <span class="sc">==</span> <span class="fu">length</span>(shape2)) {</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2_dbl</span>(shape1, shape2, \(s1, s2) {</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>      ucminf<span class="sc">::</span><span class="fu">ucminf</span>(<span class="at">par =</span> <span class="fu">log</span>(<span class="fl">3.14</span>), <span class="at">fn =</span> \(x) {</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">vbeta</span>(<span class="at">shape1 =</span> s1, <span class="at">shape2 =</span> s2) <span class="sc">-</span> <span class="fu">vlogitnorm</span>(<span class="at">sigma =</span> <span class="fu">exp</span>(x)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>      })<span class="sc">$</span>par <span class="sc">|&gt;</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">exp</span>()</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">1.0</span> <span class="sc">/</span> <span class="fl">3.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>), <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">1.0</span> <span class="sc">/</span> <span class="fl">3.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Prior distribution for proportion</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Beta("</span>,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(alpha, <span class="dv">2</span>),</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(beta, <span class="dv">2</span>),</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="fu">sqrt</span>(<span class="fu">trigamma</span>(alpha) <span class="sc">+</span> <span class="fu">trigamma</span>(beta)),</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Normal(mean, SD) matched on logit-scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>      <span class="st">"N(0, "</span>,</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale, <span class="dv">2</span>),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale2 =</span> <span class="fu">find_logitnorm_sd</span>(alpha, beta),</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Normal(mean, SD) matched on probability scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">"N(0, "</span>,</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale2, <span class="dv">2</span>),</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">nu =</span> <span class="fu">round</span>(</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span> <span class="sc">+</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span> <span class="sc">*</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">trigamma</span>(alpha) <span class="sc">+</span> <span class="fu">trigamma</span>(beta))<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">psigamma</span>(alpha, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">psigamma</span>(beta, <span class="dv">3</span>)),</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Student-t(DF, location, scale) matched on logit-scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>      <span class="st">"T("</span>,</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>      nu,</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>,</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale <span class="sc">*</span> <span class="fu">sqrt</span>((nu <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> nu), <span class="dv">2</span>),</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Prior distribution for proportion</span><span class="st">`</span>,</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"Normal"</span>),</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Student-t(DF, location, scale) matched on logit-scale</span><span class="st">`</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Prior distribution for intercept on logit scale (moment matching)"</span>,</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Normal(mean, SD) matched on logit-scale"</span>,</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Normal(mean, SD) matched on probability scale"</span>,</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Student-t(DF, location, scale) matched on logit-scale"</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="byimsiqwhj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#byimsiqwhj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#byimsiqwhj thead, #byimsiqwhj tbody, #byimsiqwhj tfoot, #byimsiqwhj tr, #byimsiqwhj td, #byimsiqwhj th {
  border-style: none;
}

#byimsiqwhj p {
  margin: 0;
  padding: 0;
}

#byimsiqwhj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#byimsiqwhj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#byimsiqwhj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#byimsiqwhj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#byimsiqwhj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#byimsiqwhj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#byimsiqwhj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#byimsiqwhj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#byimsiqwhj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#byimsiqwhj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#byimsiqwhj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#byimsiqwhj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#byimsiqwhj .gt_spanner_row {
  border-bottom-style: hidden;
}

#byimsiqwhj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#byimsiqwhj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#byimsiqwhj .gt_from_md > :first-child {
  margin-top: 0;
}

#byimsiqwhj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#byimsiqwhj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#byimsiqwhj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#byimsiqwhj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#byimsiqwhj .gt_row_group_first td {
  border-top-width: 2px;
}

#byimsiqwhj .gt_row_group_first th {
  border-top-width: 2px;
}

#byimsiqwhj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#byimsiqwhj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#byimsiqwhj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#byimsiqwhj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#byimsiqwhj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#byimsiqwhj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#byimsiqwhj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#byimsiqwhj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#byimsiqwhj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#byimsiqwhj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#byimsiqwhj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#byimsiqwhj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#byimsiqwhj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#byimsiqwhj .gt_left {
  text-align: left;
}

#byimsiqwhj .gt_center {
  text-align: center;
}

#byimsiqwhj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#byimsiqwhj .gt_font_normal {
  font-weight: normal;
}

#byimsiqwhj .gt_font_bold {
  font-weight: bold;
}

#byimsiqwhj .gt_font_italic {
  font-style: italic;
}

#byimsiqwhj .gt_super {
  font-size: 65%;
}

#byimsiqwhj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#byimsiqwhj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#byimsiqwhj .gt_indent_1 {
  text-indent: 5px;
}

#byimsiqwhj .gt_indent_2 {
  text-indent: 10px;
}

#byimsiqwhj .gt_indent_3 {
  text-indent: 15px;
}

#byimsiqwhj .gt_indent_4 {
  text-indent: 20px;
}

#byimsiqwhj .gt_indent_5 {
  text-indent: 25px;
}

#byimsiqwhj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#byimsiqwhj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings gt_spanner_row header">
<th rowspan="2" id="Prior-distribution-for-proportion" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Prior distribution for proportion</th>
<th colspan="3" id="Prior distribution for intercept on logit scale (moment matching)" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><div class="gt_column_spanner">
Prior distribution for intercept on logit scale (moment matching)
</div></th>
</tr>
<tr class="gt_col_headings even">
<th id="Normal(mean,-SD)-matched-on-logit-scale" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Normal(mean, SD) matched on logit-scale</th>
<th id="Normal(mean,-SD)-matched-on-probability-scale" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Normal(mean, SD) matched on probability scale</th>
<th id="Student-t(DF,-location,-scale)-matched-on-logit-scale" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Student-t(DF, location, scale) matched on logit-scale</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Prior distribution for proportion">Beta(0.33, 0.33)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on logit-scale">N(0, 4.49)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on probability scale">N(0, 3.58)</td>
<td class="gt_row gt_left" headers="Student-t(DF, location, scale) matched on logit-scale">T(6.5, 0, 3.74)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Prior distribution for proportion">Beta(0.5, 0.5)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on logit-scale">N(0, 3.14)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on probability scale">N(0, 2.67)</td>
<td class="gt_row gt_left" headers="Student-t(DF, location, scale) matched on logit-scale">T(7, 0, 2.66)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Prior distribution for proportion">Beta(1, 1)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on logit-scale">N(0, 1.81)</td>
<td class="gt_row gt_left" headers="Normal(mean, SD) matched on probability scale">N(0, 1.69)</td>
<td class="gt_row gt_left" headers="Student-t(DF, location, scale) matched on logit-scale">T(9, 0, 1.6)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A Beta(1, 1) distribution gives a flat density across all probabilities, a Beta(1/2, 1/2) distribution is <a href="https://en.wikipedia.org/wiki/Jeffreys_prior">Jeffreys prior</a> for a single proportion and Beta(1/3, 1/3) is <span class="citation" data-cites="Kerman2011">(<a href="02l_single_arm_pos.html#ref-Kerman2011" role="doc-biblioref">Kerman 2011</a>)</span>. It is often preferable to use at least weakly informative prior distributions instead of such “default” vague prior distributions. However, note that these distributions that are frequently quoted as vague prior distributions for a proportion, do not translate into, say, a Normal(0, 10000) distribution, but rather into distributions with scale parameters smaller than 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>brm_prior1 <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>), <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fitting" class="level3" data-number="18.3.4">
<h3 data-number="18.3.4" class="anchored" data-anchor-id="model-fitting"><span class="header-section-number">18.3.4</span> Model fitting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>brmfit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brms_model1,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> brm_prior1,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">3560295</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trial_data</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After fitting this logistic regression model, we obtain the following posterior summaries on the logit-scale:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: bernoulli 
  Links: mu = logit 
Formula: AVAL ~ 1 + SITEID + sAGE + TRT01P 
   Data: trial_data (Number of observations: 250) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     -0.45      0.23    -0.90    -0.01 1.00     2479     2680
SITEID1        0.04      0.22    -0.38     0.48 1.00     3174     2951
SITEID2        1.21      0.32     0.63     1.85 1.00     3212     3167
SITEID3       -0.23      0.27    -0.76     0.28 1.00     3548     3132
sAGE           0.25      0.14    -0.01     0.52 1.00     4432     3361
TRT01PDrug     0.87      0.27     0.35     1.41 1.00     2932     3028

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Note that the coefficient for fourth site is not shown despite the sum-to-zero constraint, but is defined to be <code>SITEID4 = ( - SITEID1 - SITEID2 - SITEID3 )</code>.</p>
<p>Let’s first pretend our covariate distribution is representative of the target population of interest. In that case, we predict the causal effect of treatment for each patient in terms of the difference in proportions for the patient from our model (i.e.&nbsp;the difference between the proportion our model predicts for each patient on drug and in the control group).</p>
<p>This case also illustrates how using the <a href="https://mc-stan.org/posterior/articles/rvar.html">rvar datatype</a> via the <code>posterior</code> R package makes our code more concise and easier to understand:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Using rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Using predictive rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Not using rvars</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The <code>add_epred_rvars</code> function makes it easy to obtain the expectation of the posterior predictive distribution for each patient, including our uncertainty around it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>difference <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_rvars</span>(brmfit1, <span class="at">value =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"prob"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 250 × 6
   USUBJID SITEID         AGE       Placebo          Drug    Difference
     &lt;int&gt; &lt;fct&gt;        &lt;int&gt;    &lt;rvar[1d]&gt;    &lt;rvar[1d]&gt;    &lt;rvar[1d]&gt;
 1       1 Study site 1    77  0.48 ± 0.066  0.68 ± 0.064  0.20 ± 0.062
 2       2 Study site 1    49  0.35 ± 0.058  0.56 ± 0.059  0.21 ± 0.064
 3       3 Study site 3    51  0.30 ± 0.072  0.50 ± 0.080  0.20 ± 0.062
 4       4 Study site 2    77  0.74 ± 0.082  0.87 ± 0.052  0.13 ± 0.050
 5       5 Study site 1    73  0.46 ± 0.061  0.67 ± 0.060  0.21 ± 0.063
 6       6 Study site 3    76  0.41 ± 0.084  0.61 ± 0.086  0.21 ± 0.063
 7       7 Study site 1    58  0.39 ± 0.053  0.60 ± 0.054  0.21 ± 0.064
 8       8 Study site 1    77  0.48 ± 0.066  0.68 ± 0.064  0.20 ± 0.062
 9       9 Study site 1    69  0.44 ± 0.057  0.65 ± 0.057  0.21 ± 0.063
10      10 Study site 1    52  0.36 ± 0.056  0.57 ± 0.057  0.21 ± 0.064
# ℹ 240 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Unlike <code>add_epred_rvars</code>, the <code>add_predicted_rvars</code> function adds draws from the posterior predictive distribution. In this case (i.e.&nbsp;for a binomial distribution) this results in the same mean, but adds the additional variability coming from the binomial distribution (as illustrated by the larger standard deviation of the resulting <code>rvar</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>pred_difference <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_rvars</span>(brmfit1, <span class="at">value =</span> <span class="st">"pred"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"pred"</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>pred_difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 250 × 6
   USUBJID SITEID         AGE      Placebo         Drug   Difference
     &lt;int&gt; &lt;fct&gt;        &lt;int&gt;   &lt;rvar[1d]&gt;   &lt;rvar[1d]&gt;   &lt;rvar[1d]&gt;
 1       1 Study site 1    77  0.48 ± 0.50  0.67 ± 0.47  0.20 ± 0.69
 2       2 Study site 1    49  0.35 ± 0.48  0.58 ± 0.49  0.22 ± 0.69
 3       3 Study site 3    51  0.31 ± 0.46  0.49 ± 0.50  0.19 ± 0.68
 4       4 Study site 2    77  0.72 ± 0.45  0.86 ± 0.34  0.14 ± 0.55
 5       5 Study site 1    73  0.46 ± 0.50  0.67 ± 0.47  0.22 ± 0.69
 6       6 Study site 3    76  0.41 ± 0.49  0.62 ± 0.49  0.20 ± 0.68
 7       7 Study site 1    58  0.40 ± 0.49  0.61 ± 0.49  0.21 ± 0.70
 8       8 Study site 1    77  0.47 ± 0.50  0.68 ± 0.47  0.22 ± 0.68
 9       9 Study site 1    69  0.44 ± 0.50  0.65 ± 0.48  0.21 ± 0.69
10      10 Study site 1    52  0.35 ± 0.48  0.57 ± 0.49  0.22 ± 0.69
# ℹ 240 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain predicted logit-proportion from model</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="ot">&lt;-</span> <span class="fu">posterior_linpred</span>(brmfit1, <span class="at">newdata =</span> new_data) <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> \(x) <span class="fu">paste0</span>(<span class="st">"V"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))) <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(USUBJID, TRT01P, SITEID, AGE)) <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(USUBJID, TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"V"</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"m"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pred_logit"</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">as.integer</span>(<span class="fu">str_extract</span>(m, <span class="st">"[0-9]+"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>, <span class="st">"m"</span>),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"pred_logit"</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> <span class="fu">inv_logit</span>(Drug) <span class="sc">-</span> <span class="fu">inv_logit</span>(Placebo))</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>difference_oldstyle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000,000 × 7
   USUBJID SITEID         AGE     m Placebo  Drug Difference
     &lt;int&gt; &lt;fct&gt;        &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
 1       1 Study site 1    77     1 -0.423  0.795      0.293
 2       1 Study site 1    77     2 -0.363  0.760      0.271
 3       1 Study site 1    77     3 -0.387  0.669      0.257
 4       1 Study site 1    77     4 -0.263  0.854      0.267
 5       1 Study site 1    77     5  0.227  0.895      0.153
 6       1 Study site 1    77     6  0.426  0.923      0.111
 7       1 Study site 1    77     7 -0.173  0.362      0.133
 8       1 Study site 1    77     8 -0.239  0.755      0.240
 9       1 Study site 1    77     9  0.0124 0.571      0.136
10       1 Study site 1    77    10 -0.118  0.958      0.252
# ℹ 999,990 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="alert alert-info">
<p>We ensure that we form the difference in model-predicted proportions (for drug minus placebo) for each patient for the same MCMC sample. That way the two proportions are based on the same MCMC sample from the posterior distribution of the model parameters.</p>
</div>
<p>If we then average this difference across the patients in the study, we obtain the <strong>marginal (population average) difference in proportions</strong> for the study population.</p>
<div class="alert alert-info">
<p>Note that we obtain the predicted probability on treatment and control for each patient and MCMC sample, form the difference and average these across patients. This is much more sample efficient than the (also valid) alternative of starting by sampling binary outcomes from the posterior predictive distribution on treatment and control for each patient and MCMC sample. The latter approach is inefficient, because we estimate proportions through Monte Carlo integration that we already had. Doing so is valid as we aim for the mean proportion difference here. As illustration, the predictive approach is also shown resulting in a less precise estimate of the population mean difference proportion.</p>
</div>
</section>
</section>
<section id="results" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="results"><span class="header-section-number">18.4</span> Results</h2>
<section id="population-average-difference-in-proportions" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="population-average-difference-in-proportions"><span class="header-section-number">18.4.1</span> Population average difference in proportions</h3>
<p>We can now obtain the <strong>marginal (population average) difference in proportions</strong> for the study population by summarizing the posterior samples for the difference in proportions for all patients in the study population.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Population average using rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Population average using predictive rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Population average using rvars (multiple steps)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Population average not using rvars</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(difference,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize_draws</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rvar_mean</span>(Difference),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># interval instead of 95%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mean"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sd"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mad"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rhat"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_bulk"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_tail"</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="cbbqkbsrya" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cbbqkbsrya table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cbbqkbsrya thead, #cbbqkbsrya tbody, #cbbqkbsrya tfoot, #cbbqkbsrya tr, #cbbqkbsrya td, #cbbqkbsrya th {
  border-style: none;
}

#cbbqkbsrya p {
  margin: 0;
  padding: 0;
}

#cbbqkbsrya .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cbbqkbsrya .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cbbqkbsrya .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cbbqkbsrya .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cbbqkbsrya .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cbbqkbsrya .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cbbqkbsrya .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cbbqkbsrya .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cbbqkbsrya .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cbbqkbsrya .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cbbqkbsrya .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cbbqkbsrya .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cbbqkbsrya .gt_spanner_row {
  border-bottom-style: hidden;
}

#cbbqkbsrya .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cbbqkbsrya .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cbbqkbsrya .gt_from_md > :first-child {
  margin-top: 0;
}

#cbbqkbsrya .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cbbqkbsrya .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cbbqkbsrya .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cbbqkbsrya .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cbbqkbsrya .gt_row_group_first td {
  border-top-width: 2px;
}

#cbbqkbsrya .gt_row_group_first th {
  border-top-width: 2px;
}

#cbbqkbsrya .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cbbqkbsrya .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cbbqkbsrya .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cbbqkbsrya .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cbbqkbsrya .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cbbqkbsrya .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cbbqkbsrya .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cbbqkbsrya .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cbbqkbsrya .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cbbqkbsrya .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cbbqkbsrya .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cbbqkbsrya .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cbbqkbsrya .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cbbqkbsrya .gt_left {
  text-align: left;
}

#cbbqkbsrya .gt_center {
  text-align: center;
}

#cbbqkbsrya .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cbbqkbsrya .gt_font_normal {
  font-weight: normal;
}

#cbbqkbsrya .gt_font_bold {
  font-weight: bold;
}

#cbbqkbsrya .gt_font_italic {
  font-style: italic;
}

#cbbqkbsrya .gt_super {
  font-size: 65%;
}

#cbbqkbsrya .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cbbqkbsrya .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cbbqkbsrya .gt_indent_1 {
  text-indent: 5px;
}

#cbbqkbsrya .gt_indent_2 {
  text-indent: 10px;
}

#cbbqkbsrya .gt_indent_3 {
  text-indent: 15px;
}

#cbbqkbsrya .gt_indent_4 {
  text-indent: 20px;
}

#cbbqkbsrya .gt_indent_5 {
  text-indent: 25px;
}

#cbbqkbsrya .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#cbbqkbsrya div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">variable</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sd</th>
<th id="mad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mad</th>
<th id="q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q2.5</th>
<th id="q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q97.5</th>
<th id="rhat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rhat</th>
<th id="ess_bulk" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_bulk</th>
<th id="ess_tail" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_tail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">rvar_mean(Difference)</td>
<td class="gt_row gt_right" headers="mean">0.193</td>
<td class="gt_row gt_right" headers="median">0.193</td>
<td class="gt_row gt_right" headers="sd">0.058</td>
<td class="gt_row gt_right" headers="mad">0.058</td>
<td class="gt_row gt_right" headers="q2.5">0.079</td>
<td class="gt_row gt_right" headers="q97.5">0.305</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,964</td>
<td class="gt_row gt_right" headers="ess_tail">3,016</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(pred_difference,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize_draws</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rvar_mean</span>(Difference),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># interval instead of 95%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mean"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sd"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mad"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rhat"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_bulk"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_tail"</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ayemvzmzwg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ayemvzmzwg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ayemvzmzwg thead, #ayemvzmzwg tbody, #ayemvzmzwg tfoot, #ayemvzmzwg tr, #ayemvzmzwg td, #ayemvzmzwg th {
  border-style: none;
}

#ayemvzmzwg p {
  margin: 0;
  padding: 0;
}

#ayemvzmzwg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ayemvzmzwg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ayemvzmzwg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ayemvzmzwg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ayemvzmzwg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ayemvzmzwg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ayemvzmzwg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ayemvzmzwg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ayemvzmzwg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ayemvzmzwg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ayemvzmzwg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ayemvzmzwg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ayemvzmzwg .gt_spanner_row {
  border-bottom-style: hidden;
}

#ayemvzmzwg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ayemvzmzwg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ayemvzmzwg .gt_from_md > :first-child {
  margin-top: 0;
}

#ayemvzmzwg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ayemvzmzwg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ayemvzmzwg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ayemvzmzwg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ayemvzmzwg .gt_row_group_first td {
  border-top-width: 2px;
}

#ayemvzmzwg .gt_row_group_first th {
  border-top-width: 2px;
}

#ayemvzmzwg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayemvzmzwg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ayemvzmzwg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ayemvzmzwg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ayemvzmzwg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayemvzmzwg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ayemvzmzwg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ayemvzmzwg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ayemvzmzwg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ayemvzmzwg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ayemvzmzwg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayemvzmzwg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ayemvzmzwg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayemvzmzwg .gt_left {
  text-align: left;
}

#ayemvzmzwg .gt_center {
  text-align: center;
}

#ayemvzmzwg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ayemvzmzwg .gt_font_normal {
  font-weight: normal;
}

#ayemvzmzwg .gt_font_bold {
  font-weight: bold;
}

#ayemvzmzwg .gt_font_italic {
  font-style: italic;
}

#ayemvzmzwg .gt_super {
  font-size: 65%;
}

#ayemvzmzwg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ayemvzmzwg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ayemvzmzwg .gt_indent_1 {
  text-indent: 5px;
}

#ayemvzmzwg .gt_indent_2 {
  text-indent: 10px;
}

#ayemvzmzwg .gt_indent_3 {
  text-indent: 15px;
}

#ayemvzmzwg .gt_indent_4 {
  text-indent: 20px;
}

#ayemvzmzwg .gt_indent_5 {
  text-indent: 25px;
}

#ayemvzmzwg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ayemvzmzwg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">variable</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sd</th>
<th id="mad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mad</th>
<th id="q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q2.5</th>
<th id="q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q97.5</th>
<th id="rhat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rhat</th>
<th id="ess_bulk" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_bulk</th>
<th id="ess_tail" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_tail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">rvar_mean(Difference)</td>
<td class="gt_row gt_right" headers="mean">0.193</td>
<td class="gt_row gt_right" headers="median">0.196</td>
<td class="gt_row gt_right" headers="sd">0.072</td>
<td class="gt_row gt_right" headers="mad">0.071</td>
<td class="gt_row gt_right" headers="q2.5">0.048</td>
<td class="gt_row gt_right" headers="q97.5">0.332</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">3,129</td>
<td class="gt_row gt_right" headers="ess_tail">3,630</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we keep two steps of rvars to show how we would first obtain a</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rvar of the average difference, before then getting summaries on it.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(difference, <span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference)) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    avg_diff,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interval instead of 95%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"median"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sd"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mad"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rhat"</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ess_bulk"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ess_tail"</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>avg_diff) <span class="sc">|&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="xnorlfhiad" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xnorlfhiad table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xnorlfhiad thead, #xnorlfhiad tbody, #xnorlfhiad tfoot, #xnorlfhiad tr, #xnorlfhiad td, #xnorlfhiad th {
  border-style: none;
}

#xnorlfhiad p {
  margin: 0;
  padding: 0;
}

#xnorlfhiad .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xnorlfhiad .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xnorlfhiad .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xnorlfhiad .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xnorlfhiad .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnorlfhiad .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnorlfhiad .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnorlfhiad .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xnorlfhiad .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xnorlfhiad .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xnorlfhiad .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xnorlfhiad .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xnorlfhiad .gt_spanner_row {
  border-bottom-style: hidden;
}

#xnorlfhiad .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xnorlfhiad .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xnorlfhiad .gt_from_md > :first-child {
  margin-top: 0;
}

#xnorlfhiad .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xnorlfhiad .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xnorlfhiad .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xnorlfhiad .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xnorlfhiad .gt_row_group_first td {
  border-top-width: 2px;
}

#xnorlfhiad .gt_row_group_first th {
  border-top-width: 2px;
}

#xnorlfhiad .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnorlfhiad .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xnorlfhiad .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xnorlfhiad .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnorlfhiad .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnorlfhiad .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xnorlfhiad .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xnorlfhiad .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xnorlfhiad .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnorlfhiad .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnorlfhiad .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnorlfhiad .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnorlfhiad .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnorlfhiad .gt_left {
  text-align: left;
}

#xnorlfhiad .gt_center {
  text-align: center;
}

#xnorlfhiad .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xnorlfhiad .gt_font_normal {
  font-weight: normal;
}

#xnorlfhiad .gt_font_bold {
  font-weight: bold;
}

#xnorlfhiad .gt_font_italic {
  font-style: italic;
}

#xnorlfhiad .gt_super {
  font-size: 65%;
}

#xnorlfhiad .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xnorlfhiad .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xnorlfhiad .gt_indent_1 {
  text-indent: 5px;
}

#xnorlfhiad .gt_indent_2 {
  text-indent: 10px;
}

#xnorlfhiad .gt_indent_3 {
  text-indent: 15px;
}

#xnorlfhiad .gt_indent_4 {
  text-indent: 20px;
}

#xnorlfhiad .gt_indent_5 {
  text-indent: 25px;
}

#xnorlfhiad .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#xnorlfhiad div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">variable</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sd</th>
<th id="mad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mad</th>
<th id="q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q2.5</th>
<th id="q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q97.5</th>
<th id="rhat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rhat</th>
<th id="ess_bulk" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_bulk</th>
<th id="ess_tail" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_tail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">avg_diff</td>
<td class="gt_row gt_right" headers="mean">0.193</td>
<td class="gt_row gt_right" headers="median">0.193</td>
<td class="gt_row gt_right" headers="sd">0.058</td>
<td class="gt_row gt_right" headers="mad">0.058</td>
<td class="gt_row gt_right" headers="q2.5">0.079</td>
<td class="gt_row gt_right" headers="q97.5">0.305</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,964</td>
<td class="gt_row gt_right" headers="ess_tail">3,016</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Difference) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Parameter"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> is.numeric, <span class="at">decimals =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="khomzixubv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#khomzixubv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#khomzixubv thead, #khomzixubv tbody, #khomzixubv tfoot, #khomzixubv tr, #khomzixubv td, #khomzixubv th {
  border-style: none;
}

#khomzixubv p {
  margin: 0;
  padding: 0;
}

#khomzixubv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#khomzixubv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#khomzixubv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#khomzixubv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#khomzixubv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#khomzixubv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#khomzixubv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#khomzixubv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#khomzixubv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#khomzixubv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#khomzixubv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#khomzixubv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#khomzixubv .gt_spanner_row {
  border-bottom-style: hidden;
}

#khomzixubv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#khomzixubv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#khomzixubv .gt_from_md > :first-child {
  margin-top: 0;
}

#khomzixubv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#khomzixubv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#khomzixubv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#khomzixubv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#khomzixubv .gt_row_group_first td {
  border-top-width: 2px;
}

#khomzixubv .gt_row_group_first th {
  border-top-width: 2px;
}

#khomzixubv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#khomzixubv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#khomzixubv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#khomzixubv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#khomzixubv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#khomzixubv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#khomzixubv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#khomzixubv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#khomzixubv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#khomzixubv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#khomzixubv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#khomzixubv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#khomzixubv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#khomzixubv .gt_left {
  text-align: left;
}

#khomzixubv .gt_center {
  text-align: center;
}

#khomzixubv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#khomzixubv .gt_font_normal {
  font-weight: normal;
}

#khomzixubv .gt_font_bold {
  font-weight: bold;
}

#khomzixubv .gt_font_italic {
  font-style: italic;
}

#khomzixubv .gt_super {
  font-size: 65%;
}

#khomzixubv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#khomzixubv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#khomzixubv .gt_indent_1 {
  text-indent: 5px;
}

#khomzixubv .gt_indent_2 {
  text-indent: 10px;
}

#khomzixubv .gt_indent_3 {
  text-indent: 15px;
}

#khomzixubv .gt_indent_4 {
  text-indent: 20px;
}

#khomzixubv .gt_indent_5 {
  text-indent: 25px;
}

#khomzixubv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#khomzixubv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Parameter" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Parameter</th>
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Est.Error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Est.Error</th>
<th id="Q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q2.5</th>
<th id="Q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q97.5</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter">Difference</td>
<td class="gt_row gt_right" headers="Estimate">0.193</td>
<td class="gt_row gt_right" headers="Est.Error">0.066</td>
<td class="gt_row gt_right" headers="Q2.5">0.068</td>
<td class="gt_row gt_right" headers="Q97.5">0.323</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="potential-interpretational-issues" class="level3" data-number="18.4.2">
<h3 data-number="18.4.2" class="anchored" data-anchor-id="potential-interpretational-issues"><span class="header-section-number">18.4.2</span> Potential interpretational issues</h3>
<p>We can look at whether our model suggests that the difference in proportion differs across different values of age and clinical trial site. In this case, the difference in proportions varies, but the estimate is always somewhat close to the overall median of 0.19. The largest deviations are seen for young patients in study site 4 and old patients in study site 2. It is not really clear whether these differences are just chance findings due to sampling variability, but plotting the model predicted proportions for each treatment group separately clarifies this a little.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Plot difference by SITEID and age using rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Plot difference by SITEID and age without rvars</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Summarize marginal difference in proportions via rvars</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>difference <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    avg_diff,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE, <span class="at">y =</span> q50, <span class="at">ymin =</span> q2<span class="fl">.5</span>, <span class="at">ymax =</span> q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> difference <span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference)) <span class="sc">|&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(avg_diff)) <span class="sc">|&gt;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(median),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>)) <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Posterior model-predicted</span><span class="sc">\n</span><span class="st">difference in proportions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02m_proportion_difference_files/figure-html/rvarsplotdiffsiteid-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Plot difference in proportions vs model terms</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(Difference),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl =</span> <span class="fu">quantile</span>(Difference, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl =</span> <span class="fu">quantile</span>(Difference, <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE, <span class="at">y =</span> median, <span class="at">ymin =</span> lcl, <span class="at">ymax =</span> ucl)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(difference_oldstyle, Difference)),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Posterior model-predicted</span><span class="sc">\n</span><span class="st">difference in proportions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02m_proportion_difference_files/figure-html/nonrvarsplotdiffsiteid-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As we can see, in the plot below, the largest deviations from the population average difference in proportion occur when the model predicted proportions for one treatment group get close to 0 (younger patients in site 4) or 1 (older patients in site 2). Overall, the model predicted difference in proportions never deviates from the population average by too much, because while the predicted proportions for the two treatment groups vary across different values of age and clinical trial site, they do not get very close to 0 or 1 where boundary effects occur.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Plot group-level predictions by SITEID and age using rvars</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Plot group-level predictions by SITEID and age without rvars</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Summarize marginal difference in proportions via rvars</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>marginal_difference <span class="ot">&lt;-</span> difference <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_drug =</span> <span class="fu">rvar_mean</span>(Drug),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_placebo =</span> <span class="fu">rvar_mean</span>(Placebo),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(SITEID, AGE)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    marginal_difference,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_draws</span>(avg_drug, <span class="sc">~</span> <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    marginal_difference,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_draws</span>(avg_placebo, <span class="sc">~</span> <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_extract</span>(variable, <span class="st">"drug|placebo"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> AGE,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> variable,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> variable,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">`</span><span class="at">50%</span><span class="st">`</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="cn">NULL</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="cn">NULL</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">SITEID =</span> <span class="st">"Study site 1"</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">AGE =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">75</span>),</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>),</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"Drug"</span>, <span class="st">"Placebo"</span>),</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> variable),</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="st">"Set1"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Model predicted proportion"</span>) <span class="sc">+</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02m_proportion_difference_files/figure-html/rvarsplotdiffsiteidage-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Plot predicted proportions vs model terms</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_pbo =</span> <span class="fu">median</span>(<span class="fu">inv_logit</span>(Placebo)),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl_pbo =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Placebo), <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl_pbo =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Placebo), <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_drug =</span> <span class="fu">median</span>(<span class="fu">inv_logit</span>(Drug)),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl_drug =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Drug), <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl_drug =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Drug), <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.3</span>),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> lcl_pbo, <span class="at">ymax =</span> ucl_pbo)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">y =</span> median_pbo)) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> lcl_drug, <span class="at">ymax =</span> ucl_drug)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">y =</span> median_drug)) <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">SITEID =</span> <span class="st">"Study site 1"</span>, <span class="at">AGE =</span> <span class="dv">45</span>, <span class="at">y =</span> <span class="fl">0.8</span>, <span class="at">label =</span> <span class="st">"Drug"</span>),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">1</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">SITEID =</span> <span class="st">"Study site 1"</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">AGE =</span> <span class="dv">75</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="st">"Placebo"</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="dv">1</span>)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Model predicted proportion"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02m_proportion_difference_files/figure-html/nonrvarsplotdiffsiteidage-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Thus, in this case a marginal (population average) difference in proportion is arguably still approximately a reasonable summary of efficacy for all the studied patients, as well as the population. However, it is not clear that this would be the case for substantially younger or older patients, or for patients coming from clinical centers that have higher or lower average response rates than the four study sites used during the study.</p>
<p>While in the example, the marginal difference in proportions may be a reasonable summary measure for efficacy, this would not be the case, if the difference varied more substantially across values of predictors for the outcome.</p>
<div class="alert alert-info">
<p>Note that what matters is whether the difference in proportions differs across the values of predictors whether they are in the model or not. So, we also need to worry about whether we omitted any important predictors when we do this kind of assessment. We will explore this in the next subsection.</p>
</div>
<p>The other interpretational issue is whether the four particular clinical trial sites adequately and fully represent the distribution of the hospitals or doctor’s offices, where the drug would be used in clinical practice. That is likely not the case. Firstly, there were just four sites in the RCT making it hard to believe they could adequately represent all the hospitals and physicians’ practices that treat the disease under study. Secondly, clinical trial sites are usually selected both because they see a sufficient number of patients with the disease of interest, and because they have the necessary experience and infrastructure to participate in a clinical trial. That suggests that there would likely be a shift in distribution between the clinical trial setting and clinical practice. Depending on the size and nature of this shift, the non-transportability of the difference in proportions may be of concern.</p>
</section>
<section id="omitting-terms-from-the-analysis-model" class="level3" data-number="18.4.3">
<h3 data-number="18.4.3" class="anchored" data-anchor-id="omitting-terms-from-the-analysis-model"><span class="header-section-number">18.4.3</span> Omitting terms from the analysis model</h3>
<div class="alert alert-info">
<p>Keeping the model “simple” by omitting terms from the model to avoid too much of a difference in model-predicted differences in proportions for patients does not address the potential problem, because the marginal difference in proportions is still an average across patients (and due to the collapsability of the effect measure it is unaffected by including or leaving out covariates).</p>
</div>
<p>For comparison purposes, let us fit a model without covariates (other than treatment group).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>brms_model2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  AVAL <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TRT01P,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>brm_prior2 <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>), <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>brmfit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brms_model2,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> brm_prior2,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trial_data,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">356456</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now illustrate that for a model with an intercept and a term for treatment (but without further covariates) the standardized estimator of <span class="citation" data-cites="Steingrimsson201718">(<a href="02l_single_arm_pos.html#ref-Steingrimsson201718" role="doc-biblioref">Steingrimsson, Hanley, and Rosenblum 2017</a>)</span> gives identical results to what we obtain directly from the model parameters via <span class="math inline">\text{logit}^{-1}(\beta_0 + \beta_1) - \text{logit}^{-1}(\beta_0)</span>, where <span class="math inline">\beta_0</span> is the intercept and <span class="math inline">\beta_1</span> is the coefficient for active drug.</p>
<div class="cell">
<details class="code-fold">
<summary>Different ways of getting marginal proportion difference</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>difference2 <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_rvars</span>(brmfit2, <span class="at">value =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"prob"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior as rvar and apply with rdo the inv_logit function</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># by draw to the respective rvars. The use of rdo is necessary as</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inv_logit does not accept rvar inputs otherwise. We could also adapt</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the inv_logit function using the rfun adapter. See ?posterior::rfun</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>difference2a <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_rvars</span>(brmfit2),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rdo</span>(<span class="fu">inv_logit</span>(b_Intercept <span class="sc">+</span> b_TRT01PDrug) <span class="sc">-</span> <span class="fu">inv_logit</span>(b_Intercept))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference<span class="sc">$</span>Difference),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference2<span class="sc">$</span>Difference),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference2a)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mean"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"median"</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sd"</span>,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mad"</span>,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rhat"</span>,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ess_bulk"</span>,</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ess_tail"</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">c</span>(</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">"with covariates ('standardized' estimator)"</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"without covariates ('standardized' estimator)"</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"without covariates (directly from model parameters)"</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="ouvbbllxrv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ouvbbllxrv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ouvbbllxrv thead, #ouvbbllxrv tbody, #ouvbbllxrv tfoot, #ouvbbllxrv tr, #ouvbbllxrv td, #ouvbbllxrv th {
  border-style: none;
}

#ouvbbllxrv p {
  margin: 0;
  padding: 0;
}

#ouvbbllxrv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ouvbbllxrv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ouvbbllxrv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ouvbbllxrv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ouvbbllxrv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ouvbbllxrv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouvbbllxrv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ouvbbllxrv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ouvbbllxrv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ouvbbllxrv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ouvbbllxrv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ouvbbllxrv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ouvbbllxrv .gt_spanner_row {
  border-bottom-style: hidden;
}

#ouvbbllxrv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ouvbbllxrv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ouvbbllxrv .gt_from_md > :first-child {
  margin-top: 0;
}

#ouvbbllxrv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ouvbbllxrv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ouvbbllxrv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ouvbbllxrv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ouvbbllxrv .gt_row_group_first td {
  border-top-width: 2px;
}

#ouvbbllxrv .gt_row_group_first th {
  border-top-width: 2px;
}

#ouvbbllxrv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouvbbllxrv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ouvbbllxrv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ouvbbllxrv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouvbbllxrv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouvbbllxrv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ouvbbllxrv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ouvbbllxrv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ouvbbllxrv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ouvbbllxrv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ouvbbllxrv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouvbbllxrv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ouvbbllxrv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ouvbbllxrv .gt_left {
  text-align: left;
}

#ouvbbllxrv .gt_center {
  text-align: center;
}

#ouvbbllxrv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ouvbbllxrv .gt_font_normal {
  font-weight: normal;
}

#ouvbbllxrv .gt_font_bold {
  font-weight: bold;
}

#ouvbbllxrv .gt_font_italic {
  font-style: italic;
}

#ouvbbllxrv .gt_super {
  font-size: 65%;
}

#ouvbbllxrv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ouvbbllxrv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ouvbbllxrv .gt_indent_1 {
  text-indent: 5px;
}

#ouvbbllxrv .gt_indent_2 {
  text-indent: 10px;
}

#ouvbbllxrv .gt_indent_3 {
  text-indent: 15px;
}

#ouvbbllxrv .gt_indent_4 {
  text-indent: 20px;
}

#ouvbbllxrv .gt_indent_5 {
  text-indent: 25px;
}

#ouvbbllxrv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ouvbbllxrv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">variable</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sd</th>
<th id="mad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mad</th>
<th id="q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q2.5</th>
<th id="q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q97.5</th>
<th id="rhat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rhat</th>
<th id="ess_bulk" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_bulk</th>
<th id="ess_tail" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_tail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">with covariates ('standardized' estimator)</td>
<td class="gt_row gt_right" headers="mean">0.193</td>
<td class="gt_row gt_right" headers="median">0.193</td>
<td class="gt_row gt_right" headers="sd">0.058</td>
<td class="gt_row gt_right" headers="mad">0.058</td>
<td class="gt_row gt_right" headers="q2.5">0.079</td>
<td class="gt_row gt_right" headers="q97.5">0.305</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,964</td>
<td class="gt_row gt_right" headers="ess_tail">3,016</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="variable">without covariates ('standardized' estimator)</td>
<td class="gt_row gt_right" headers="mean">0.189</td>
<td class="gt_row gt_right" headers="median">0.190</td>
<td class="gt_row gt_right" headers="sd">0.059</td>
<td class="gt_row gt_right" headers="mad">0.059</td>
<td class="gt_row gt_right" headers="q2.5">0.069</td>
<td class="gt_row gt_right" headers="q97.5">0.302</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">1,432</td>
<td class="gt_row gt_right" headers="ess_tail">1,975</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="variable">without covariates (directly from model parameters)</td>
<td class="gt_row gt_right" headers="mean">0.189</td>
<td class="gt_row gt_right" headers="median">0.190</td>
<td class="gt_row gt_right" headers="sd">0.059</td>
<td class="gt_row gt_right" headers="mad">0.059</td>
<td class="gt_row gt_right" headers="q2.5">0.069</td>
<td class="gt_row gt_right" headers="q97.5">0.302</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">1,432</td>
<td class="gt_row gt_right" headers="ess_tail">1,975</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see, the marginal treatment difference is very similar (in this case slightly attenuated) and the posterior distribution wider when do no adjust for covariates, as we would expect from the literature on the topic such as <span class="citation" data-cites="Moore2009">(<a href="02l_single_arm_pos.html#ref-Moore2009" role="doc-biblioref">Moore and Laan 2009</a>)</span> and <span class="citation" data-cites="Steingrimsson201718">(<a href="02l_single_arm_pos.html#ref-Steingrimsson201718" role="doc-biblioref">Steingrimsson, Hanley, and Rosenblum 2017</a>)</span>. In the absence of additional covariates, it’s equivalent to use “standardized” estimator compared with calculating the difference in proportions from model parameters, but the “standardized” estimator does not require a detailed understanding of the parameterization of the model.</p>
</section>
</section>
<section id="conclusions" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="conclusions"><span class="header-section-number">18.5</span> Conclusions</h2>
<p>Just as when using maximum-likelihood methods, we can use the “standardized” estimator for obtaining marginal (population-average) differences in proportions in the Bayesian setting. Obtaining credible intervals is easier in the Bayesian setting compared with the maximum likelihood setting, because we can simply apply transformations to MCMC samples.</p>
</section>
<section id="excercise" class="level2" data-number="18.6">
<h2 data-number="18.6" class="anchored" data-anchor-id="excercise"><span class="header-section-number">18.6</span> Excercise</h2>
<section id="excercise-1" class="level3" data-number="18.6.1">
<h3 data-number="18.6.1" class="anchored" data-anchor-id="excercise-1"><span class="header-section-number">18.6.1</span> Excercise 1</h3>
<p>Use the “standardized” estimator to obtain the posterior marginal ratio of proportions (i.e.&nbsp;<span class="math inline">\hat{\pi}_\text{drug} / \hat{\pi}_\text{placebo}</span>) with a credible interval in the example <code>trial_data</code>. Explore whether the rate-ratio is an appropriate summary measure for the treatment effect in this example.</p>
</section>
<section id="excercise-2" class="level3" data-number="18.6.2">
<h3 data-number="18.6.2" class="anchored" data-anchor-id="excercise-2"><span class="header-section-number">18.6.2</span> Excercise 2</h3>
<p>Analyze the data below from a hypothetical two-arm RCT of a blood pressure lowering drug compared with placebo with a linear regression model such as <code>CHG ~ 1 + TRT01P + BASE</code>. We might a-priori expect the residual standard deviation to be about 12 mmHg. Use this model to obtain the marginal population average difference in proportions of patients achieving a mean sitting systolic blood pressure &lt; 140 mmHg. How does the result compare to fitting a binomial regression model?</p>
<div class="cell">
<details class="code-fold">
<summary>Data for excercise 2</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bp_trial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">USUBJID =</span> <span class="dv">1</span>L<span class="sc">:</span><span class="dv">50</span>L, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRT01P =</span> <span class="fu">factor</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Drug"</span>)),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">factor</span>(<span class="st">"mean sitting Systolic Blood Pressure"</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE =</span> <span class="fu">c</span>(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="fl">151.5</span>, <span class="fl">146.6</span>, <span class="fl">142.5</span>, <span class="fl">152.2</span>, <span class="fl">142.9</span>, <span class="fl">140.4</span>, <span class="fl">144.9</span>, <span class="fl">145.5</span>, <span class="fl">142.9</span>, <span class="dv">146</span>, </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="fl">146.8</span>, <span class="fl">148.7</span>, <span class="fl">146.9</span>, <span class="dv">160</span>, <span class="fl">147.8</span>, <span class="fl">145.9</span>, <span class="fl">140.6</span>, <span class="fl">140.6</span>, <span class="dv">145</span>, <span class="fl">141.6</span>, <span class="fl">143.9</span>, </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="fl">143.8</span>, <span class="fl">143.7</span>, <span class="fl">143.9</span>, <span class="fl">141.3</span>, <span class="fl">149.6</span>, <span class="fl">146.6</span>, <span class="fl">149.1</span>, <span class="fl">150.7</span>, <span class="fl">141.9</span>, <span class="fl">142.9</span>, </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">140.5</span>, <span class="dv">155</span>, <span class="fl">145.9</span>, <span class="dv">145</span>, <span class="fl">148.9</span>, <span class="fl">144.9</span>, <span class="fl">149.8</span>, <span class="fl">141.5</span>, <span class="fl">151.8</span>, <span class="dv">146</span>, <span class="fl">140.2</span>, </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="fl">143.6</span>, <span class="dv">140</span>, <span class="fl">140.3</span>, <span class="fl">140.4</span>, <span class="fl">141.2</span>, <span class="fl">145.7</span>, <span class="fl">146.2</span>, <span class="dv">143</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="fl">123.2</span>, <span class="fl">134.8</span>, <span class="dv">123</span>, <span class="fl">140.4</span>, <span class="fl">120.2</span>, <span class="fl">138.7</span>, <span class="dv">153</span>, <span class="fl">142.3</span>, <span class="fl">132.6</span>, <span class="fl">105.9</span>, <span class="dv">137</span>, </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="fl">136.5</span>, <span class="dv">122</span>, <span class="fl">144.1</span>, <span class="fl">135.5</span>, <span class="fl">89.3</span>, <span class="fl">110.2</span>, <span class="fl">140.2</span>, <span class="fl">133.1</span>, <span class="fl">139.6</span>, <span class="fl">126.8</span>, </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="fl">135.6</span>, <span class="fl">136.7</span>, <span class="fl">151.5</span>, <span class="fl">125.6</span>, <span class="fl">133.9</span>, <span class="fl">133.8</span>, <span class="fl">144.1</span>, <span class="fl">145.5</span>, <span class="dv">94</span>, <span class="fl">156.3</span>, </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="fl">136.5</span>, <span class="fl">147.2</span>, <span class="fl">95.9</span>, <span class="dv">127</span>, <span class="fl">146.8</span>, <span class="fl">111.2</span>, <span class="fl">125.6</span>, <span class="fl">125.6</span>, <span class="fl">142.6</span>, <span class="fl">133.7</span>, </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="fl">130.6</span>, <span class="fl">125.8</span>, <span class="fl">138.9</span>, <span class="fl">118.3</span>, <span class="fl">135.1</span>, <span class="fl">123.4</span>, <span class="fl">139.5</span>, <span class="fl">114.7</span>, <span class="fl">138.2</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">CHG =</span> <span class="fu">c</span>(</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">28.3</span>, <span class="sc">-</span><span class="fl">11.8</span>, <span class="sc">-</span><span class="fl">19.5</span>, <span class="sc">-</span><span class="fl">11.8</span>, <span class="sc">-</span><span class="fl">22.7</span>, <span class="sc">-</span><span class="fl">1.7</span>, <span class="fl">8.1</span>, <span class="sc">-</span><span class="fl">3.2</span>, <span class="sc">-</span><span class="fl">10.3</span>, <span class="sc">-</span><span class="fl">40.1</span>, <span class="sc">-</span><span class="fl">9.8</span>,</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">12.2</span>, <span class="sc">-</span><span class="fl">24.9</span>, <span class="sc">-</span><span class="fl">15.9</span>, <span class="sc">-</span><span class="fl">12.3</span>, <span class="sc">-</span><span class="fl">56.6</span>, <span class="sc">-</span><span class="fl">30.4</span>, <span class="sc">-</span><span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">11.9</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">17.1</span>, <span class="sc">-</span><span class="fl">8.2</span>, </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="dv">7</span>, <span class="fl">7.6</span>, <span class="sc">-</span><span class="fl">15.7</span>, <span class="sc">-</span><span class="fl">15.7</span>, <span class="sc">-</span><span class="fl">12.8</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="fl">5.2</span>, <span class="sc">-</span><span class="fl">47.9</span>, <span class="fl">13.4</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="fl">7.8</span>, <span class="sc">-</span><span class="dv">50</span>, <span class="sc">-</span><span class="dv">18</span>, </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">33.7</span>, <span class="sc">-</span><span class="fl">24.2</span>, <span class="sc">-</span><span class="fl">15.9</span>, <span class="sc">-</span><span class="fl">9.2</span>, <span class="sc">-</span><span class="fl">12.3</span>, <span class="sc">-</span><span class="fl">9.6</span>, <span class="sc">-</span><span class="fl">17.8</span>, <span class="sc">-</span><span class="fl">1.1</span>, <span class="sc">-</span><span class="dv">22</span>, <span class="sc">-</span><span class="fl">5.3</span>, </span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">17.8</span>, <span class="sc">-</span><span class="fl">6.2</span>, <span class="sc">-</span><span class="fl">31.5</span>, <span class="sc">-</span><span class="fl">4.8</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Kerman2011" class="csl-entry" role="listitem">
Kerman, Jouni. 2011. <span>“<span class="nocase">Neutral noninformative and informative conjugate beta and gamma prior distributions</span>.”</span> <em>Electronic Journal of Statistics</em> 5 (none): 1450–70. <a href="https://doi.org/10.1214/11-EJS648">https://doi.org/10.1214/11-EJS648</a>.
</div>
<div id="ref-Moore2009" class="csl-entry" role="listitem">
Moore, K. L., and M. J. van der Laan. 2009. <span>“Covariate Adjustment in Randomized Trials with Binary Outcomes: Targeted Maximum Likelihood Estimation.”</span> <em>Statistics in Medicine</em> 28 (1): 39–64. <a href="https://doi.org/10.1002/sim.3445">https://doi.org/10.1002/sim.3445</a>.
</div>
<div id="ref-Steingrimsson201718" class="csl-entry" role="listitem">
Steingrimsson, Jon Arni, Daniel F. Hanley, and Michael Rosenblum. 2017. <span>“Improving Precision by Adjusting for Prognostic Baseline Variables in Randomized Trials with Binary Outcomes, Without Regression Model&nbsp;Assumptions.”</span> <em>Contemporary Clinical Trials</em> 54: 18–24. <a href="https://doi.org/10.1016/j.cct.2016.12.026">https://doi.org/10.1016/j.cct.2016.12.026</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02j_network_meta_analysis.html" class="pagination-link" aria-label="Network meta-analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/03a_stan_code.html" class="pagination-link" aria-label="Exposing stan code">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Björn Holzhauer - &lt;bjoern.holzhauer@novartis.com&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Difference in proportions from a fitted logistic regression {#sec-diffp}</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- https://raw.githubusercontent.com/Novartis/bamdd/main/src/_macros.qmd --&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>{{&lt; include _macros.qmd &gt;}}</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>This case study features:</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how to obtain a difference between proportions after</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  fitting a Bayesian logistic regression using the standardized</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  estimator approach</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>how to use sum-to-zero contrasts to express a-priori equal</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  uncertainty about multiple factor levels</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>that a normal prior distribution with a standard deviation</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  of 3.14 for the intercept of a logistic regression is already very</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  vague</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the use of <span class="in">`rvars`</span> and the convenient helper functions</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  such as <span class="in">`tidybayes::add_epred_rvars()`</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>collapsability and transportability of effect measures, as</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  well as population average and individual treatment effects</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r includestuff, include=FALSE, cache=FALSE}</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/02m_proportion_difference.qmd"</span>)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"src"</span>, <span class="st">"setup.R"</span>))</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these libraries first:</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basesetup,eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE,cache=FALSE}</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">678571</span>)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="co"># default controls args passed to Stan</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>, <span class="at">step_size=</span><span class="fl">0.1</span>)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="co"># nice common ggplot2 theme</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size=</span><span class="dv">18</span>))</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brmscachestuff, include=FALSE, cache=FALSE}</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="co"># speedup things by lowering adapt_delta for now, which speeds up things a lot</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="co"># do this only if caching is on (which is when we want things go fast)</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Can we set adapt_delta to low values based on knowing this is a non-production run??</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.8</span>)</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="co"># move caching directory to a cpu specific directory (for those using</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker)</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>, <span class="fu">Sys.info</span>()[<span class="st">"machine"</span>]))</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>, <span class="fu">Sys.info</span>()[<span class="st">"machine"</span>]), <span class="cn">FALSE</span>)</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a><span class="fu">### Different effect measures</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>Statisticians will often report results of an analysis in terms of the </span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>parameters of their analysis model, such as a (log-)odds ratio based on a </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>logistic regression for a binary outcome. However, physicians or patients may</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>struggle to understand these effect measures. They might instead prefer </span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>alternative effect measures such as a difference in proportion, the number of</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>patients they need to treat with a drug (instead of with placebo) before we</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>expect "it to make a difference for one of the patients" </span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>(aka "number needed to treat" or NNT) or the ratio of proportions (risk-ratio).</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>Even once we have chosen an effect measure, another question is whether we want</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>it in its marginal (population-average) or conditional (patient-specific) form.</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>Additionally, different effect measures may have other desirable properties such</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>as collapsability and transportability.</span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal (population-average) or conditional (patient-specific)</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>A patient (and their physician) will usually be interested in how much a </span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>treatment will help them ("How much would taking the drug reduced my risk of </span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>being hospitalized in the next year?") taking their specific situation into </span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>account. This is the **conditional** (on patient covariates) or </span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>**patient-specific** question.</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>In contrast, an insurance company or </span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>state healthcare system might be more interested in the effect an intervention </span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>has on a population level ("How much would giving the drug to all eligible </span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>patients reduce the number of hospitalizations in the next year?"). This is a</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>**marginal** or **population-average** effect question.</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>  The difference between conditional and marginal estimates is not whether they</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>  come from a covariate adjusted model. Marginal estimates can still be </span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>  obtained (with gain in precision) from covariate adjusted analyses.</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>Even when a treatment actually has the same causal effect for all</span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>patients, the population-average effect may not be the same as the</span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>patient specific effect.  In general, we call an effect measure</span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>**collapsible** when the population-average effect is the average of</span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>the effects for the members of the population. In contrast, an effect</span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>measure, for which this is not the case is **non-collapsible**.</span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>The difference in proportions is a **collapsible effect measure**. I.e. the </span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>marginal (population average) difference in proportions is the mean of the </span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>difference in proportions across the individuals in the population. </span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>This also means that, if the modelled difference in proportions is the same for </span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>all patients, then the marginal difference in proportions is the same as for </span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>each patient.</span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a>However, mathematically, a difference in proportions cannot be constant over </span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>differing control group proportions. It may just not vary to a degree we </span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>consider practically relevant. The difference in proportion for one patient </span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a>will not generally be the same as for another patient and there may be no </span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a>patient for whom the marginal difference in proportion applies (it is simply </span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a>an average across patients). Thus, the marginal difference in </span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>proportions will differ for two populations with different covariate </span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>distributions. For that reason </span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Harrell has discussed</span><span class="co">](https://www.fharrell.com/post/rct-mimic/)</span> that the </span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>marginal difference in proportions is not a **transportable** effect measure, </span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>while the odds ratio might be transportable (but is non-collapsible).</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>I.e. a marginal difference in proportions for a drug compared with placebo</span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>from a clinical trial may not be a good summary of what will happen in </span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a>clinical practice, because the distribution of characteristics of trial</span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a>participants will rarely exactly match the distribution of the real-world</span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a>patient population for the drug.</span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">The FDA guidance</span><span class="co">](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adjusting-covariates-randomized-clinical-trials-drugs-and-biological-products)</span> </span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a>illustrates the difference between the odds ratio and the difference in </span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>proportions. This example illustrates the non-collapsibility of the odds ratio </span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>in a hypothetical target population (the marginal odds ratio is lower than the </span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>odds ratio for both subgroups) and the collapsibility of the difference in </span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a>proportions (the marginal difference in proportions is exactly the weighted </span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a>average of the subgroup differences weighted by the percentage of the target </span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>population in the subgroup).</span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>+-------------------+-------------------+--------------+--------------+-------+---------------+</span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>                   <span class="pp">|</span> Percentage of     <span class="pp">|</span> Success rate <span class="pp">|</span> Success rate <span class="pp">|</span> Odds  <span class="pp">|</span> Difference in <span class="pp">|</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Population        <span class="pp">|</span> target population <span class="pp">|</span> New drug     <span class="pp">|</span> Placebo      <span class="pp">|</span> ratio <span class="pp">|</span> proportions   <span class="pp">|</span></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>+-------------------+-------------------+--------------+--------------+-------+---------------+</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Biomarkerpositive <span class="pp">|</span> 50%               <span class="pp">|</span> 80.0\%       <span class="pp">|</span> 33.3\%       <span class="pp">|</span> 8.0   <span class="pp">|</span> 46.7\%        <span class="pp">|</span></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>+-------------------+-------------------+--------------+--------------+-------+---------------+</span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Biomarkernegative <span class="pp">|</span> 50%               <span class="pp">|</span> 25.0\%       <span class="pp">|</span> 4.0\%        <span class="pp">|</span> 8.0   <span class="pp">|</span> 21.0\%        <span class="pp">|</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>+-------------------+-------------------+--------------+--------------+-------+---------------+</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Combined          <span class="pp">|</span> 100%              <span class="pp">|</span> 52.5\%       <span class="pp">|</span> 18.7\%       <span class="pp">|</span> 4.8   <span class="pp">|</span> 33.8\%        <span class="pp">|</span></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>+-------------------+-------------------+--------------+--------------+-------+---------------+</span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a>In this example, an conditional (on covariates) odds ratio of 8.0 applies to all </span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a>patients and would be a reasonable patient-specific effect measure.</span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a>For a population with 50\% biomarker-positive and 50\%</span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a>biomarker-negative patients a difference of proportion of 33.8\% is</span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a>the correct marginal (population-average) difference in</span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>proportions. However, this marginal effect applies to no patient (the</span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a>difference in proportions for a patient is either 46.7\% or 21.0\%</span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a>depending on the subgroup the patient is in). It also changes when we look</span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a>at a population with, say, 80\% biomarker-negative patients, then the</span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a>marginal difference becomes 26.1\%. If the data above have arisen from</span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a>a clinical trial, in which the equal size of the biomarker-positive</span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a>and -negative subgroups was solely an effect of ensuring equal</span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a>enrolment in both subgroups, then it seems hard to justify why the</span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a>equal weighting of the subgroup-specific differences in proportions is</span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a>relevant to clinical practice. It is, of course, possible to adjust a</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a>difference in proportions to a known covariate distribution for a</span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>population of interest.</span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal difference in proportions based on a covariate-adjusted Bayesian analysis</span></span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>In this case study, we illustrate how to obtain a marginal difference in </span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a>proportions based on a covariate-adjusted Bayesian analysis, as well as from </span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a>one not adjusted for covariates. The same approach can also be used for </span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>e.g. the ratio of proportions, the difference in exponential hazard rates or </span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a>the difference in the proportion of patients with an event after 1-year based </span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a>on a survival model, or the difference in the proportion of patients achieving </span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a>blood pressure control based on a linear regression.</span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example data</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a>The example concerns a hypothetical Phase IIA randomized controlled trial (RCT) </span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a>conducted in four clinical trial sites. The RCT compared a new drug with placebo </span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a>in terms of the proportion of patients with a disease achieving levels of a </span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a>blood biomarker above the lower limit of normal for a healthy population. </span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>Younger patients are more likely to have a faster progressing and more </span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a>aggressive form of the disease, so they are expected to be less likely to </span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>achieve this.</span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r thedata}</span></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Example data"</span></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> qlogis</span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a>inv_logit <span class="ot">=</span> plogis</span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a>trial_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">USUBJID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>, </span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRT01P =</span> <span class="fu">c</span>(</span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L</span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE =</span> <span class="fu">c</span>(</span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>        <span class="dv">77</span>L, <span class="dv">49</span>L, <span class="dv">51</span>L, <span class="dv">77</span>L, <span class="dv">73</span>L, <span class="dv">76</span>L, <span class="dv">58</span>L, <span class="dv">77</span>L, <span class="dv">69</span>L, <span class="dv">52</span>L, <span class="dv">45</span>L, <span class="dv">67</span>L, <span class="dv">42</span>L,</span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>        <span class="dv">42</span>L, <span class="dv">56</span>L, <span class="dv">76</span>L, <span class="dv">71</span>L, <span class="dv">46</span>L, <span class="dv">76</span>L, <span class="dv">54</span>L, <span class="dv">67</span>L, <span class="dv">40</span>L, <span class="dv">37</span>L, <span class="dv">70</span>L, <span class="dv">70</span>L, <span class="dv">45</span>L,</span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a>        <span class="dv">69</span>L, <span class="dv">67</span>L, <span class="dv">63</span>L, <span class="dv">35</span>L, <span class="dv">64</span>L, <span class="dv">62</span>L, <span class="dv">78</span>L, <span class="dv">53</span>L, <span class="dv">44</span>L, <span class="dv">55</span>L, <span class="dv">47</span>L, <span class="dv">46</span>L, <span class="dv">63</span>L,</span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a>        <span class="dv">65</span>L, <span class="dv">67</span>L, <span class="dv">79</span>L, <span class="dv">44</span>L, <span class="dv">56</span>L, <span class="dv">47</span>L, <span class="dv">61</span>L, <span class="dv">74</span>L, <span class="dv">52</span>L, <span class="dv">57</span>L, <span class="dv">65</span>L, <span class="dv">36</span>L, <span class="dv">58</span>L,</span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a>        <span class="dv">72</span>L, <span class="dv">59</span>L, <span class="dv">48</span>L, <span class="dv">72</span>L, <span class="dv">71</span>L, <span class="dv">45</span>L, <span class="dv">66</span>L, <span class="dv">80</span>L, <span class="dv">62</span>L, <span class="dv">75</span>L, <span class="dv">67</span>L, <span class="dv">67</span>L, <span class="dv">66</span>L,</span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a>        <span class="dv">49</span>L, <span class="dv">72</span>L, <span class="dv">55</span>L, <span class="dv">44</span>L, <span class="dv">68</span>L, <span class="dv">77</span>L, <span class="dv">59</span>L, <span class="dv">84</span>L, <span class="dv">78</span>L, <span class="dv">77</span>L, <span class="dv">71</span>L, <span class="dv">36</span>L, <span class="dv">72</span>L,</span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a>        <span class="dv">36</span>L, <span class="dv">39</span>L, <span class="dv">57</span>L, <span class="dv">79</span>L, <span class="dv">71</span>L, <span class="dv">43</span>L, <span class="dv">61</span>L, <span class="dv">72</span>L, <span class="dv">49</span>L, <span class="dv">56</span>L, <span class="dv">54</span>L, <span class="dv">75</span>L, <span class="dv">68</span>L,</span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a>        <span class="dv">45</span>L, <span class="dv">58</span>L, <span class="dv">46</span>L, <span class="dv">39</span>L, <span class="dv">65</span>L, <span class="dv">73</span>L, <span class="dv">72</span>L, <span class="dv">71</span>L, <span class="dv">49</span>L, <span class="dv">65</span>L, <span class="dv">70</span>L, <span class="dv">57</span>L, <span class="dv">47</span>L,</span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>        <span class="dv">62</span>L, <span class="dv">36</span>L, <span class="dv">76</span>L, <span class="dv">70</span>L, <span class="dv">84</span>L, <span class="dv">54</span>L, <span class="dv">76</span>L, <span class="dv">36</span>L, <span class="dv">51</span>L, <span class="dv">38</span>L, <span class="dv">56</span>L, <span class="dv">44</span>L, <span class="dv">58</span>L,</span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a>        <span class="dv">53</span>L, <span class="dv">47</span>L, <span class="dv">80</span>L, <span class="dv">75</span>L, <span class="dv">47</span>L, <span class="dv">61</span>L, <span class="dv">57</span>L, <span class="dv">49</span>L, <span class="dv">64</span>L, <span class="dv">53</span>L, <span class="dv">44</span>L, <span class="dv">47</span>L, <span class="dv">67</span>L,</span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a>        <span class="dv">40</span>L, <span class="dv">56</span>L, <span class="dv">69</span>L, <span class="dv">81</span>L, <span class="dv">67</span>L, <span class="dv">83</span>L, <span class="dv">84</span>L, <span class="dv">81</span>L, <span class="dv">81</span>L, <span class="dv">55</span>L, <span class="dv">38</span>L, <span class="dv">48</span>L, <span class="dv">61</span>L,</span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a>        <span class="dv">80</span>L, <span class="dv">51</span>L, <span class="dv">76</span>L, <span class="dv">82</span>L, <span class="dv">61</span>L, <span class="dv">44</span>L, <span class="dv">51</span>L, <span class="dv">48</span>L, <span class="dv">72</span>L, <span class="dv">56</span>L, <span class="dv">49</span>L, <span class="dv">73</span>L, <span class="dv">71</span>L,</span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a>        <span class="dv">61</span>L, <span class="dv">72</span>L, <span class="dv">47</span>L, <span class="dv">45</span>L, <span class="dv">42</span>L, <span class="dv">82</span>L, <span class="dv">84</span>L, <span class="dv">50</span>L, <span class="dv">46</span>L, <span class="dv">57</span>L, <span class="dv">66</span>L, <span class="dv">49</span>L, <span class="dv">74</span>L,</span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a>        <span class="dv">70</span>L, <span class="dv">47</span>L, <span class="dv">48</span>L, <span class="dv">75</span>L, <span class="dv">53</span>L, <span class="dv">67</span>L, <span class="dv">38</span>L, <span class="dv">58</span>L, <span class="dv">48</span>L, <span class="dv">65</span>L, <span class="dv">44</span>L, <span class="dv">47</span>L, <span class="dv">47</span>L,</span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a>        <span class="dv">61</span>L, <span class="dv">76</span>L, <span class="dv">77</span>L, <span class="dv">49</span>L, <span class="dv">81</span>L, <span class="dv">77</span>L, <span class="dv">70</span>L, <span class="dv">61</span>L, <span class="dv">83</span>L, <span class="dv">48</span>L, <span class="dv">48</span>L, <span class="dv">52</span>L, <span class="dv">56</span>L,</span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>        <span class="dv">74</span>L, <span class="dv">47</span>L, <span class="dv">54</span>L, <span class="dv">65</span>L, <span class="dv">45</span>L, <span class="dv">37</span>L, <span class="dv">65</span>L, <span class="dv">77</span>L, <span class="dv">44</span>L, <span class="dv">76</span>L, <span class="dv">52</span>L, <span class="dv">60</span>L, <span class="dv">37</span>L,</span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>        <span class="dv">38</span>L, <span class="dv">65</span>L, <span class="dv">81</span>L, <span class="dv">55</span>L, <span class="dv">68</span>L, <span class="dv">49</span>L, <span class="dv">84</span>L, <span class="dv">81</span>L, <span class="dv">72</span>L, <span class="dv">74</span>L, <span class="dv">62</span>L, <span class="dv">75</span>L, <span class="dv">53</span>L,</span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a>        <span class="dv">58</span>L, <span class="dv">64</span>L, <span class="dv">57</span>L, <span class="dv">61</span>L, <span class="dv">74</span>L, <span class="dv">64</span>L, <span class="dv">46</span>L, <span class="dv">37</span>L, <span class="dv">81</span>L, <span class="dv">83</span>L, <span class="dv">65</span>L, <span class="dv">69</span>L, <span class="dv">54</span>L,</span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a>        <span class="dv">77</span>L, <span class="dv">73</span>L, <span class="dv">38</span>L, <span class="dv">47</span>L, <span class="dv">50</span>L, <span class="dv">65</span>L, <span class="dv">83</span>L, <span class="dv">45</span>L, <span class="dv">55</span>L, <span class="dv">70</span>L, <span class="dv">49</span>L, <span class="dv">63</span>L, <span class="dv">64</span>L,</span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a>        <span class="dv">52</span>L, <span class="dv">41</span>L, <span class="dv">36</span>L</span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">SITEID =</span> <span class="fu">c</span>(</span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L,</span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L,</span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L,</span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L,</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L</span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L,</span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L</span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SITEID=</span><span class="fu">factor</span>(SITEID, <span class="at">levels=</span><span class="dv">1</span>L<span class="sc">:</span><span class="dv">4</span>L,</span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">paste0</span>(<span class="st">"Study site "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P=</span><span class="fu">factor</span>(TRT01P, <span class="at">levels=</span><span class="dv">0</span>L<span class="sc">:</span><span class="dv">1</span>L, </span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Drug"</span>)),</span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>         <span class="at">sAGE =</span> <span class="fu">scale</span>(AGE))</span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>trial_data <span class="sc">|&gt;</span></span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Responders =</span> <span class="fu">sum</span>(AVAL),</span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a>            <span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>            <span class="at">Proportion =</span> Responders<span class="sc">/</span>n,</span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Mean age</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(AGE),</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">SD age</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(AGE),</span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(<span class="st">"Mean age"</span>, <span class="st">"SD age"</span>), <span class="at">decimals=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span>Proportion, <span class="at">decimals=</span><span class="dv">2</span>)</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### Details of approach</span></span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>We are interested in comparing the two treatment groups in the RCT in terms of</span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>the marginal (population average) difference in the proportion of patients </span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a>achieving the "responder" definition for each treatment.</span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a>Obtaining pseudo-random samples from the posterior distribution for a difference</span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a>in proportions after fitting a Bayesian logistic regression in <span class="in">`brms`</span> is </span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a>particularly straightforward, if our model only includes treatment. </span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a>In that case, we simply get posterior MCMC samples for the logit for</span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a>the treatment and the control group, convert these to probabilities and</span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a>form the difference per MCMC sample to obtain MCMC samples for the difference</span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a>in proportions. Unlike with some frequentist methods, the properties of </span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a>transformed MCMC samples mean that these samples will automatically obey </span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>logical constraints (e.g. each proportion must lie in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>, the control </span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a>group proportion plus the difference in proportions must also result in </span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a>a proportion for the treatment group in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span> etc.). This makes it </span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a>extremely simple to obtain a valid point estimate with a sensible </span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>credible interval.</span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a>Things become a little bit more complicated, if there are further terms in </span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a>the model, in the case of our example age and clinical trial site ID. We might</span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a>include these terms in our model, because randomization was stratified by </span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a>trial site ("analyze as you randomize") and age is a known important predictor </span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>of response in this disease.</span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a>We now illustrate how we obtain a "standardized" estimator for the</span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a>marginal (population average or "unconditional") difference in</span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>proportions using the approach discussed by the [FDA guidance on</span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>adjusting for covariates in randomized clinical trials for drugs and</span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>biological</span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>products](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adjusting-covariates-randomized-clinical-trials-drugs-and-biological-products)</span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a>(see also <span class="co">[</span><span class="ot">@Moore2009</span><span class="co">]</span> and <span class="co">[</span><span class="ot">@Steingrimsson201718</span><span class="co">]</span>).  The only thing we do</span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a>differently compared to the mentioned papers is that instead of using</span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a>a logistic regression model fit with maximum likelihood, we use a</span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a>Bayesian logistic regression.</span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a>In the Bayesian framework the key steps for obtaining the "standardized" </span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a>estimator of a difference in proportions for a RCT are particularly easy:</span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Fit a model (here a Bayesian logistic regression) to the RCT data.</span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Predict the outcomes for each patient under treatment and control </span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a>(here we obtain pseudo-random samples for the posterior predicted </span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a>logit-probability for each patient).</span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Calculate the metric of interest for each patient for each MCMC sample </span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>(here we apply the inverse-logit transformation to the logit-probabilities </span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>and form the difference between the treatment and control ones making sure to</span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a>match the same indices so the same underlying set of underlying MCMC samples </span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a>of model parameters are used for the treatment and control prediction of each </span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a>patient).</span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Form the mean across patients.</span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Summarize the resulting MCMC samples for the posterior for the difference</span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a>in proportions.</span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model structure</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a>We choose a relatively simple (Bayesian) logistic regression model including</span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a>an intercept, treatment, site as a fixed effect, and age as a covariate. We </span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a>use a centered and scaled version of age to make it easier to reason about</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a>priors, because firstly the intercept and site effects now refer to a patient </span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a>with an average age for the study, and secondly the age coefficient now </span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a>describes the change in the logit with every standard deviation (in the study </span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a>population) of age. For full control over the design matrix, we</span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a>disable the default automatic centering of the design matrix with the</span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a><span class="in">`center=FALSE`</span> option here.</span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r specifymodel}</span></span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Our model"</span></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a>brms_model1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a>  AVAL <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> SITEID <span class="sc">+</span> sAGE <span class="sc">+</span> TRT01P,</span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span></span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a>  Note that the model used in Step 1 of the procedure for obtaining a </span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a>  "standardized" estimator in the previous subsection could include a</span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a>  treatment by baseline covariate interaction. Including such an interaction</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a>  makes sense when (we suspect that) the log-odds-ratio between treatment and </span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a>  control is not constant across all observed baseline covariate values.</span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a>Like for the centered and scaled version of age, we want the intercept term to</span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a>not to refer to a reference <span class="in">`SITEID`</span>. Thus, the use sum-to-zero contrasts for </span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a>the <span class="in">`SITEID`</span> factor variable, which means that there is a separate coefficient </span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a>for each factor-level of <span class="in">`SITEID`</span>, but they sum to zero (otherwise the model</span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a>would be overparameterized). Sum-to-zero contrasts also mean that we express</span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a>a-priori equal uncertainty about the probability for each trial site, while</span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a>with a reference category we have less prior uncertainty about the reference</span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>category and more uncertainty about the other categories. With the vague priors</span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a>we use in this case study, this consideration may be of minor relevance, but in</span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>other cases it may be more important.</span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sumtozerocontrast}</span></span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Setting sum-to-zero contrasts on SITEID factor variable"</span></span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(trial_data<span class="sc">$</span>SITEID) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(</span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">length</span>(<span class="fu">unique</span>(trial_data<span class="sc">$</span>SITEID)),</span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="cn">TRUE</span></span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choice of prior distributions</span></span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>We use a </span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">weakly informative prior</span><span class="co">](https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations#prior-for-the-regression-coefficients-in-logistic-regression-non-sparse-case)</span> </span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a>for the regression coefficients.</span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a>For the intercept of the model we use a normal distribution that </span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a>(on the logit-scale) approximates a vague Beta(0.5, 0.5) prior distribution for </span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a>a single proportion.</span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>The table below shows what normal and Student-t distributions match the moments</span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>(mean, variance and - for the Student-t distribution - excess kurtosis) </span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>of the distribution of logit-probabilities for three commonly used vague </span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a>Beta prior distributions for proportions.</span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r visualizeprior}</span></span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Beta prior approximations"</span></span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions to deal with finding appropriate logit-normal SD</span></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Density of logit-normal distribution</span></span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a><span class="co"># (see https://en.wikipedia.org/wiki/Logit-normal_distribution)</span></span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a>dlogitnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a>  tmp_ <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(sigma) <span class="sc">-</span></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">-</span></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">qlogis</span>(x) <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">/</span> sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span></span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(x) <span class="sc">-</span></span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log1p</span>(<span class="sc">-</span>x)</span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (log) tmp_ <span class="cf">else</span> <span class="fu">exp</span>(tmp_)</span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of logit-normal distribution (only for mu=0)</span></span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>vlogitnorm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>) {</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (mu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(sigma) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">integrate</span>(</span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a>      <span class="at">f =</span> \(x) (<span class="fu">plogis</span>(x) <span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, sigma),</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="cn">Inf</span></span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span>value</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (mu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(sigma) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(sigma, <span class="at">FUN =</span> \(y) {</span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a>      <span class="fu">integrate</span>(</span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a>        <span class="at">f =</span> \(x) (<span class="fu">plogis</span>(x) <span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, y),</span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="dv">1</span></span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">$</span>value</span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"vlogitnorm does not deal with mu neq 0"</span>)</span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance of the beta distribution</span></span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a>vbeta <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1 =</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">1</span>) {</span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>  shape1 <span class="sc">*</span> shape2 <span class="sc">/</span> (shape1 <span class="sc">+</span> shape2)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (shape1 <span class="sc">+</span> shape2 <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a><span class="co">#vbeta(shape1=0.5, shape2=0.5)</span></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a><span class="co"># Find SD of the logit-normal to match a particular beta-distribution</span></span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>find_logitnorm_sd <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1 =</span> <span class="fl">0.5</span>, <span class="at">shape2 =</span> <span class="fl">0.5</span>) {</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(shape1 <span class="sc">!=</span> shape2)) {</span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Cannot deal with unequal shape parameters"</span>)</span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(shape1) <span class="sc">==</span> <span class="dv">1</span>L <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(shape2) <span class="sc">==</span> <span class="dv">1</span>L) {</span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a>    ucminf<span class="sc">::</span><span class="fu">ucminf</span>(<span class="at">par =</span> <span class="fu">log</span>(<span class="fl">3.14</span>), <span class="at">fn =</span> \(x) {</span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">vbeta</span>(<span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2) <span class="sc">-</span> <span class="fu">vlogitnorm</span>(<span class="at">sigma =</span> <span class="fu">exp</span>(x)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a>    })<span class="sc">$</span>par <span class="sc">|&gt;</span></span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>()</span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(shape1) <span class="sc">==</span> <span class="fu">length</span>(shape2)) {</span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map2_dbl</span>(shape1, shape2, \(s1, s2) {</span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a>      ucminf<span class="sc">::</span><span class="fu">ucminf</span>(<span class="at">par =</span> <span class="fu">log</span>(<span class="fl">3.14</span>), <span class="at">fn =</span> \(x) {</span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">vbeta</span>(<span class="at">shape1 =</span> s1, <span class="at">shape2 =</span> s2) <span class="sc">-</span> <span class="fu">vlogitnorm</span>(<span class="at">sigma =</span> <span class="fu">exp</span>(x)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a>      })<span class="sc">$</span>par <span class="sc">|&gt;</span></span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a>        <span class="fu">exp</span>()</span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">1.0</span> <span class="sc">/</span> <span class="fl">3.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>), <span class="at">beta =</span> <span class="fu">c</span>(<span class="fl">1.0</span> <span class="sc">/</span> <span class="fl">3.0</span>, <span class="fl">0.5</span>, <span class="fl">1.0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Prior distribution for proportion</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Beta("</span>,</span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(alpha, <span class="dv">2</span>),</span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(beta, <span class="dv">2</span>),</span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="fu">sqrt</span>(<span class="fu">trigamma</span>(alpha) <span class="sc">+</span> <span class="fu">trigamma</span>(beta)),</span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Normal(mean, SD) matched on logit-scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a>      <span class="st">"N(0, "</span>,</span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale, <span class="dv">2</span>),</span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale2 =</span> <span class="fu">find_logitnorm_sd</span>(alpha, beta),</span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Normal(mean, SD) matched on probability scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a>      <span class="st">"N(0, "</span>,</span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale2, <span class="dv">2</span>),</span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a>    <span class="at">nu =</span> <span class="fu">round</span>(</span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span> <span class="sc">+</span></span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span> <span class="sc">*</span></span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">trigamma</span>(alpha) <span class="sc">+</span> <span class="fu">trigamma</span>(beta))<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">psigamma</span>(alpha, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">psigamma</span>(beta, <span class="dv">3</span>)),</span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Student-t(DF, location, scale) matched on logit-scale</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a>      <span class="st">"T("</span>,</span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>      nu,</span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>,</span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>      <span class="st">", "</span>,</span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(scale <span class="sc">*</span> <span class="fu">sqrt</span>((nu <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> nu), <span class="dv">2</span>),</span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a>      <span class="st">")"</span></span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Prior distribution for proportion</span><span class="st">`</span>,</span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"Normal"</span>),</span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Student-t(DF, location, scale) matched on logit-scale</span><span class="st">`</span></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Prior distribution for intercept on logit scale (moment matching)"</span>,</span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(</span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Normal(mean, SD) matched on logit-scale"</span>,</span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Normal(mean, SD) matched on probability scale"</span>,</span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Student-t(DF, location, scale) matched on logit-scale"</span></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>A Beta(1, 1) distribution gives a flat density across all probabilities, a </span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>Beta(1/2, 1/2) distribution is </span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Jeffreys prior</span><span class="co">](https://en.wikipedia.org/wiki/Jeffreys_prior)</span> for a single</span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>proportion and Beta(1/3, 1/3) is <span class="co">[</span><span class="ot">@Kerman2011</span><span class="co">]</span>. It is often</span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a>preferable to use at least weakly informative prior distributions instead of</span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a>such "default" vague prior distributions. However, note that these distributions</span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>that are frequently quoted as vague prior distributions for a proportion, do</span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>not translate into, say, a Normal(0, 10000) distribution, but rather into </span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a>distributions with scale parameters smaller than 5. </span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setprior}</span></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Our priors for the model"</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a>brm_prior1 <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>), <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>))</span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model fitting</span></span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fitmodel}</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Model fitting"</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a>brmfit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brms_model1,</span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> brm_prior1,</span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">3560295</span>,</span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trial_data</span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a>After fitting this logistic regression model, we obtain the following </span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a>posterior summaries on the logit-scale:</span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summaryfit}</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Model fit summary"</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit1)</span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>Note that the coefficient for fourth site is not shown despite the sum-to-zero </span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>constraint, but is defined to be <span class="in">`SITEID4 = ( - SITEID1 - SITEID2 - SITEID3 )`</span>.</span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a>Let's first pretend our covariate distribution is representative of the target</span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a>population of interest. In that case, we predict the causal effect of treatment</span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>for each patient in terms of the difference in proportions for the patient from </span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a>our model (i.e. the difference between the proportion our model predicts for </span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>each patient on drug and in the control group).</span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>This case also illustrates how using the </span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">rvar datatype</span><span class="co">](https://mc-stan.org/posterior/articles/rvar.html)</span> via the </span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a><span class="in">`posterior`</span> R package makes our code more concise and easier to understand:</span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using rvars</span></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a>The <span class="in">`add_epred_rvars`</span> function makes it easy to obtain the expectation </span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>of the posterior predictive distribution for each patient, including </span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>our uncertainty around it.</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarsdiff}</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Obtain marginal difference in proportions using rvars"</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>difference <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_rvars</span>(brmfit1, <span class="at">value =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"prob"</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a>difference</span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using predictive rvars</span></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a>Unlike <span class="in">`add_epred_rvars`</span>, the <span class="in">`add_predicted_rvars`</span> function </span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a>adds draws from the posterior predictive distribution. In this</span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a>case (i.e. for a binomial distribution) this results in the </span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a>same mean, but adds the additional variability coming from </span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a>the binomial distribution (as illustrated by the larger</span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>standard deviation of the resulting <span class="in">`rvar`</span>).</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarsdiffpred}</span></span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Obtain marginal difference in proportions using rvars of predictives"</span></span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a>pred_difference <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_rvars</span>(brmfit1, <span class="at">value =</span> <span class="st">"pred"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"pred"</span></span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a>pred_difference</span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a><span class="fu">## Not using rvars</span></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nonrvarsdiff}</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Obtain marginal difference in proportions not using rvars"</span></span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with each patient in control and test condition</span></span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> trial_data <span class="sc">|&gt;</span></span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TRT01P =</span> <span class="st">"Placebo"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">mutate</span>(trial_data, <span class="at">TRT01P =</span> <span class="st">"Drug"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVAL =</span> <span class="dv">0</span>L)</span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain predicted logit-proportion from model</span></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="ot">&lt;-</span> <span class="fu">posterior_linpred</span>(brmfit1, <span class="at">newdata =</span> new_data) <span class="sc">|&gt;</span></span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> \(x) <span class="fu">paste0</span>(<span class="st">"V"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))) <span class="sc">|&gt;</span></span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(USUBJID, TRT01P, SITEID, AGE)) <span class="sc">|&gt;</span></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(USUBJID, TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"V"</span>),</span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"m"</span>,</span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pred_logit"</span></span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">as.integer</span>(<span class="fu">str_extract</span>(m, <span class="st">"[0-9]+"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>, <span class="st">"m"</span>),</span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"pred_logit"</span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> <span class="fu">inv_logit</span>(Drug) <span class="sc">-</span> <span class="fu">inv_logit</span>(Placebo))</span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a>difference_oldstyle</span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span></span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a>  We ensure that we form the difference in model-predicted proportions (for drug</span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a>  minus placebo) for each patient for the same MCMC sample. That way the </span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a>  two  proportions are based on the same MCMC sample from the posterior </span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a>  distribution of the model parameters.</span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a>If we then average this difference across the patients in the study,</span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a>we obtain the **marginal (population average) difference in proportions** </span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a>for the study population.</span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a>  Note that we obtain the predicted probability on treatment and control for </span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a>  each patient and MCMC sample, form the difference and average these across </span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a>  patients. This is much more sample efficient than the (also valid) alternative </span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a>  of starting by sampling binary outcomes from the posterior predictive </span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a>  distribution on treatment and control for each patient and MCMC sample. </span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a>  The latter approach is inefficient, because we estimate proportions through </span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a>  Monte Carlo integration that we already had. Doing so is valid as we</span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a>  aim for the mean proportion difference here. As illustration, the</span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a>  predictive approach is also shown resulting in a less precise</span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a>  estimate of the population mean difference proportion.</span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Population average difference in proportions</span></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a>We can now obtain the **marginal (population average) difference in</span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a>proportions** for the study population by summarizing the posterior</span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a>samples for the difference in proportions for all patients in the</span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a>study population.</span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population average using rvars</span></span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarspopavg}</span></span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions via rvars"</span></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(difference,</span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize_draws</span>(</span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rvar_mean</span>(Difference),</span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a>            <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a>            <span class="co"># interval instead of 95%</span></span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mean"</span>,</span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median"</span>,</span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sd"</span>,</span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mad"</span>,</span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rhat"</span>,</span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_bulk"</span>,</span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_tail"</span></span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb27-766"><a href="#cb27-766" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb27-767"><a href="#cb27-767" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population average using predictive rvars</span></span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarspopavgpred}</span></span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions via predictive rvars"</span></span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(pred_difference,</span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize_draws</span>(</span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rvar_mean</span>(Difference),</span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a>            <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb27-784"><a href="#cb27-784" aria-hidden="true" tabindex="-1"></a>            <span class="co"># interval instead of 95%</span></span>
<span id="cb27-785"><a href="#cb27-785" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mean"</span>,</span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median"</span>,</span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sd"</span>,</span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mad"</span>,</span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rhat"</span>,</span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_bulk"</span>,</span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ess_tail"</span></span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">|&gt;</span></span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population average using rvars (multiple steps)</span></span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarsmultipopavg}</span></span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions via rvars"</span></span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we keep two steps of rvars to show how we would first obtain a</span></span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a><span class="co"># rvar of the average difference, before then getting summaries on it.</span></span>
<span id="cb27-812"><a href="#cb27-812" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(difference, <span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference)) <span class="sc">|&gt;</span></span>
<span id="cb27-813"><a href="#cb27-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(</span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a>    avg_diff,</span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note if we do not explicitly request summary</span></span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a>    <span class="co"># statistics, we would get these, but a 90% credible</span></span>
<span id="cb27-817"><a href="#cb27-817" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interval instead of 95%</span></span>
<span id="cb27-818"><a href="#cb27-818" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean"</span>,</span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a>    <span class="st">"median"</span>,</span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sd"</span>,</span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mad"</span>,</span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rhat"</span>,</span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ess_bulk"</span>,</span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ess_tail"</span></span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>avg_diff) <span class="sc">|&gt;</span></span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population average not using rvars</span></span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nonrvarspopavg}</span></span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions not using rvars"</span></span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Difference) <span class="sc">|&gt;</span></span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Parameter"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> is.numeric, <span class="at">decimals =</span> <span class="dv">3</span>)</span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a><span class="fu">### Potential interpretational issues</span></span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a>We can look at whether our model suggests that the difference in proportion </span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a>differs across different values of age and clinical trial site. In this case,</span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a>the difference in proportions varies, but the estimate is always somewhat close </span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a>to the overall median of </span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a><span class="in">`r difference |&gt; summarize(summarize_draws(rvar_mean(Difference))) |&gt; pull(median) |&gt; round(2)`</span>.</span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a>The largest deviations are seen for young patients in study site 4 and old</span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a>patients in study site 2. It is not really clear whether these differences</span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a>are just chance findings due to sampling variability, but plotting the model</span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a>predicted proportions for each treatment group separately clarifies this a</span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a>little.</span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot difference by SITEID and age using rvars</span></span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarsplotdiffsiteid}</span></span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions via rvars"</span></span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-874"><a href="#cb27-874" aria-hidden="true" tabindex="-1"></a>difference <span class="sc">|&gt;</span></span>
<span id="cb27-875"><a href="#cb27-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(</span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a>    avg_diff,</span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE, <span class="at">y =</span> q50, <span class="at">ymin =</span> q2<span class="fl">.5</span>, <span class="at">ymax =</span> q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb27-882"><a href="#cb27-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb27-883"><a href="#cb27-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> difference <span class="sc">|&gt;</span></span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">avg_diff =</span> <span class="fu">rvar_mean</span>(Difference)) <span class="sc">|&gt;</span></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(avg_diff)) <span class="sc">|&gt;</span></span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(median),</span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>)) <span class="sc">+</span></span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Posterior model-predicted</span><span class="sc">\n</span><span class="st">difference in proportions"</span>)</span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot difference by SITEID and age without rvars</span></span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nonrvarsplotdiffsiteid}</span></span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plot difference in proportions vs model terms"</span></span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(Difference),</span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl =</span> <span class="fu">quantile</span>(Difference, <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb27-910"><a href="#cb27-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl =</span> <span class="fu">quantile</span>(Difference, <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb27-911"><a href="#cb27-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE, <span class="at">y =</span> median, <span class="at">ymin =</span> lcl, <span class="at">ymax =</span> ucl)) <span class="sc">+</span></span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="fu">median</span>(<span class="fu">pull</span>(difference_oldstyle, Difference)),</span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>)) <span class="sc">+</span></span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Posterior model-predicted</span><span class="sc">\n</span><span class="st">difference in proportions"</span>)</span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-926"><a href="#cb27-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-927"><a href="#cb27-927" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a>As we can see, in the plot below, the largest deviations from the population</span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a>average difference in proportion occur when the model predicted proportions </span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a>for one treatment group get close to 0 (younger patients in site 4) or 1 </span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a>(older patients in site 2). Overall, the model predicted difference in </span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a>proportions never deviates from the population average by too much, because </span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a>while the predicted proportions for the two treatment groups vary across </span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a>different values of age and clinical trial site, they do not get very close to </span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a>0 or 1 where boundary effects occur.</span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot group-level predictions by SITEID and age using rvars</span></span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rvarsplotdiffsiteidage}</span></span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Summarize marginal difference in proportions via rvars"</span></span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a>marginal_difference <span class="ot">&lt;-</span> difference <span class="sc">|&gt;</span></span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_drug =</span> <span class="fu">rvar_mean</span>(Drug),</span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_placebo =</span> <span class="fu">rvar_mean</span>(Placebo),</span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(SITEID, AGE)</span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a>    marginal_difference,</span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_draws</span>(avg_drug, <span class="sc">~</span> <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a>    marginal_difference,</span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_draws</span>(avg_placebo, <span class="sc">~</span> <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">str_extract</span>(variable, <span class="st">"drug|placebo"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> AGE,</span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> variable,</span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> variable,</span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">`</span><span class="at">50%</span><span class="st">`</span>,</span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span></span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="cn">NULL</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="cn">NULL</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a>      <span class="at">SITEID =</span> <span class="st">"Study site 1"</span>,</span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>      <span class="at">AGE =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">75</span>),</span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>),</span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">"Drug"</span>, <span class="st">"Placebo"</span>),</span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span>,</span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_real_</span></span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> variable),</span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="st">"Set1"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Model predicted proportion"</span>) <span class="sc">+</span></span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot group-level predictions by SITEID and age without rvars</span></span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nonrvarsplotdiffsiteidage}</span></span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plot predicted proportions vs model terms"</span></span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a>difference_oldstyle <span class="sc">|&gt;</span></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITEID, AGE) <span class="sc">|&gt;</span></span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_pbo =</span> <span class="fu">median</span>(<span class="fu">inv_logit</span>(Placebo)),</span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl_pbo =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Placebo), <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl_pbo =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Placebo), <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_drug =</span> <span class="fu">median</span>(<span class="fu">inv_logit</span>(Drug)),</span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcl_drug =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Drug), <span class="at">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a>    <span class="at">ucl_drug =</span> <span class="fu">quantile</span>(<span class="fu">inv_logit</span>(Drug), <span class="at">probs =</span> <span class="fl">0.975</span>),</span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AGE)) <span class="sc">+</span></span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.3</span>),</span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> lcl_pbo, <span class="at">ymax =</span> ucl_pbo)</span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">y =</span> median_pbo)) <span class="sc">+</span></span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>),</span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> lcl_drug, <span class="at">ymax =</span> ucl_drug)</span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">y =</span> median_drug)) <span class="sc">+</span></span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">SITEID =</span> <span class="st">"Study site 1"</span>, <span class="at">AGE =</span> <span class="dv">45</span>, <span class="at">y =</span> <span class="fl">0.8</span>, <span class="at">label =</span> <span class="st">"Drug"</span>),</span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="dv">1</span>)</span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a>      <span class="at">SITEID =</span> <span class="st">"Study site 1"</span>,</span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a>      <span class="at">AGE =</span> <span class="dv">75</span>,</span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fl">0.2</span>,</span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="st">"Placebo"</span></span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">label =</span> label),</span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="dv">1</span>)</span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>SITEID) <span class="sc">+</span></span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Model predicted proportion"</span>)</span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1044"><a href="#cb27-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1045"><a href="#cb27-1045" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-1046"><a href="#cb27-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1047"><a href="#cb27-1047" aria-hidden="true" tabindex="-1"></a>Thus, in this case a marginal (population average) difference in proportion is </span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a>arguably still approximately a</span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a>reasonable summary of efficacy for all the studied patients, as well as the </span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a>population. However, it is not clear that this would be the case for </span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a>substantially younger or older patients, or for patients coming from clinical</span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a>centers that have higher or lower average response rates than the four study</span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a>sites used during the study.</span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a>While in the example, the marginal difference in proportions may be a </span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a>reasonable summary measure for efficacy, this would not be the case, if the </span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a>difference varied more substantially across values of predictors for the </span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a>outcome.</span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span></span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a>  Note that what matters is whether the difference in proportions differs across</span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a>  the values of predictors whether they are in the model or not. So, we also</span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a>  need to worry about whether we omitted any important predictors when we </span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a>  do this kind of assessment. We will explore this in the next subsection.</span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a>The other interpretational issue is whether the four particular clinical trial</span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a>sites adequately and fully represent the distribution of the hospitals or </span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a>doctor's offices, where the drug would be used in clinical practice. </span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a>That is likely not the case.  Firstly, there were just four sites in the RCT</span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a>making it hard to believe they could adequately represent all the hospitals </span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a>and physicians' practices that treat the disease under study. Secondly, </span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a>clinical trial sites are usually selected both because they see a sufficient</span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a>number of patients with the disease of interest, and because they have the </span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a>necessary experience and infrastructure to participate in a clinical trial.</span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a>That suggests that there would likely be a shift in distribution between the </span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a>clinical trial setting and clinical practice. Depending on the size and nature </span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a>of this shift, the non-transportability of the difference in proportions may be</span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a>of concern.</span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">### Omitting terms from the analysis model</span></span>
<span id="cb27-1082"><a href="#cb27-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1083"><a href="#cb27-1083" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"alert alert-info"</span><span class="dt">&gt;</span> Keeping the model "simple" by omitting</span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a>  terms from the model to avoid too much of a difference in</span>
<span id="cb27-1085"><a href="#cb27-1085" aria-hidden="true" tabindex="-1"></a>  model-predicted differences in proportions for patients does not</span>
<span id="cb27-1086"><a href="#cb27-1086" aria-hidden="true" tabindex="-1"></a>  address the potential problem, because the marginal difference in</span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a>  proportions is still an average across patients (and due to the</span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a>  collapsability of the effect measure it is unaffected by including</span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a>  or leaving out covariates).</span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a>For comparison purposes, let us fit a model without covariates </span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a>(other than treatment group).</span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nocovmodel, results='hide',message=FALSE,warning=FALSE}</span></span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "No covariate model"</span></span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a>brms_model2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a>  AVAL <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> TRT01P,</span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a>brm_prior2 <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>), <span class="at">coef =</span> Intercept) <span class="sc">+</span></span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>))</span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a>brmfit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brms_model2,</span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> brm_prior2,</span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> trial_data,</span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">356456</span>,</span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a>We can now illustrate that for a model with an intercept and a term</span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a>for treatment (but without further covariates) the standardized</span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a>estimator of <span class="co">[</span><span class="ot">@Steingrimsson201718</span><span class="co">]</span> gives identical results to what we</span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a>obtain directly from the model parameters via</span>
<span id="cb27-1120"><a href="#cb27-1120" aria-hidden="true" tabindex="-1"></a>$\text{logit}^{-1}(\beta_0 + \beta_1) - \text{logit}^{-1}(\beta_0)$,</span>
<span id="cb27-1121"><a href="#cb27-1121" aria-hidden="true" tabindex="-1"></a>where $\beta_0$ is the intercept and $\beta_1$ is the coefficient for</span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a>active drug.</span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1124"><a href="#cb27-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nocovmodelresults}</span></span>
<span id="cb27-1125"><a href="#cb27-1125" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-1126"><a href="#cb27-1126" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Different ways of getting marginal proportion difference"</span></span>
<span id="cb27-1127"><a href="#cb27-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb27-1128"><a href="#cb27-1128" aria-hidden="true" tabindex="-1"></a>difference2 <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb27-1129"><a href="#cb27-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_rvars</span>(brmfit2, <span class="at">value =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1130"><a href="#cb27-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-1131"><a href="#cb27-1131" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"USUBJID"</span>, <span class="st">"SITEID"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb27-1132"><a href="#cb27-1132" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"TRT01P"</span>,</span>
<span id="cb27-1133"><a href="#cb27-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"prob"</span></span>
<span id="cb27-1134"><a href="#cb27-1134" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-1135"><a href="#cb27-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> Drug <span class="sc">-</span> Placebo)</span>
<span id="cb27-1136"><a href="#cb27-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1137"><a href="#cb27-1137" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior as rvar and apply with rdo the inv_logit function</span></span>
<span id="cb27-1138"><a href="#cb27-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># by draw to the respective rvars. The use of rdo is necessary as</span></span>
<span id="cb27-1139"><a href="#cb27-1139" aria-hidden="true" tabindex="-1"></a><span class="co"># inv_logit does not accept rvar inputs otherwise. We could also adapt</span></span>
<span id="cb27-1140"><a href="#cb27-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># the inv_logit function using the rfun adapter. See ?posterior::rfun</span></span>
<span id="cb27-1141"><a href="#cb27-1141" aria-hidden="true" tabindex="-1"></a>difference2a <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb27-1142"><a href="#cb27-1142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_rvars</span>(brmfit2),</span>
<span id="cb27-1143"><a href="#cb27-1143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rdo</span>(<span class="fu">inv_logit</span>(b_Intercept <span class="sc">+</span> b_TRT01PDrug) <span class="sc">-</span> <span class="fu">inv_logit</span>(b_Intercept))</span>
<span id="cb27-1144"><a href="#cb27-1144" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1145"><a href="#cb27-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1146"><a href="#cb27-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(</span>
<span id="cb27-1147"><a href="#cb27-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb27-1148"><a href="#cb27-1148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference<span class="sc">$</span>Difference),</span>
<span id="cb27-1149"><a href="#cb27-1149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference2<span class="sc">$</span>Difference),</span>
<span id="cb27-1150"><a href="#cb27-1150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rvar_mean</span>(difference2a)</span>
<span id="cb27-1151"><a href="#cb27-1151" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-1152"><a href="#cb27-1152" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mean"</span>,</span>
<span id="cb27-1153"><a href="#cb27-1153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"median"</span>,</span>
<span id="cb27-1154"><a href="#cb27-1154" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sd"</span>,</span>
<span id="cb27-1155"><a href="#cb27-1155" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mad"</span>,</span>
<span id="cb27-1156"><a href="#cb27-1156" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">quantile2</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)),</span>
<span id="cb27-1157"><a href="#cb27-1157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rhat"</span>,</span>
<span id="cb27-1158"><a href="#cb27-1158" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ess_bulk"</span>,</span>
<span id="cb27-1159"><a href="#cb27-1159" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ess_tail"</span></span>
<span id="cb27-1160"><a href="#cb27-1160" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-1161"><a href="#cb27-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-1162"><a href="#cb27-1162" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">c</span>(</span>
<span id="cb27-1163"><a href="#cb27-1163" aria-hidden="true" tabindex="-1"></a>      <span class="st">"with covariates ('standardized' estimator)"</span>,</span>
<span id="cb27-1164"><a href="#cb27-1164" aria-hidden="true" tabindex="-1"></a>      <span class="st">"without covariates ('standardized' estimator)"</span>,</span>
<span id="cb27-1165"><a href="#cb27-1165" aria-hidden="true" tabindex="-1"></a>      <span class="st">"without covariates (directly from model parameters)"</span></span>
<span id="cb27-1166"><a href="#cb27-1166" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-1167"><a href="#cb27-1167" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-1168"><a href="#cb27-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-1169"><a href="#cb27-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb27-1170"><a href="#cb27-1170" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="st">"mad"</span>, <span class="st">"q2.5"</span>, <span class="st">"q97.5"</span>),</span>
<span id="cb27-1171"><a href="#cb27-1171" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">3</span></span>
<span id="cb27-1172"><a href="#cb27-1172" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-1173"><a href="#cb27-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-1174"><a href="#cb27-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">"rhat"</span>, <span class="at">decimals =</span> <span class="dv">2</span>)</span>
<span id="cb27-1175"><a href="#cb27-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1176"><a href="#cb27-1176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-1177"><a href="#cb27-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1178"><a href="#cb27-1178" aria-hidden="true" tabindex="-1"></a>As we can see, the marginal treatment difference is very similar (in this case </span>
<span id="cb27-1179"><a href="#cb27-1179" aria-hidden="true" tabindex="-1"></a>slightly attenuated) and</span>
<span id="cb27-1180"><a href="#cb27-1180" aria-hidden="true" tabindex="-1"></a>the posterior distribution wider when do no adjust for covariates, as we </span>
<span id="cb27-1181"><a href="#cb27-1181" aria-hidden="true" tabindex="-1"></a>would expect from the literature on the topic such as <span class="co">[</span><span class="ot">@Moore2009</span><span class="co">]</span> and </span>
<span id="cb27-1182"><a href="#cb27-1182" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@Steingrimsson201718</span><span class="co">]</span>. In the absence of additional covariates, it's </span>
<span id="cb27-1183"><a href="#cb27-1183" aria-hidden="true" tabindex="-1"></a>equivalent to use "standardized" estimator compared with calculating the </span>
<span id="cb27-1184"><a href="#cb27-1184" aria-hidden="true" tabindex="-1"></a>difference in proportions from model parameters, but the "standardized" </span>
<span id="cb27-1185"><a href="#cb27-1185" aria-hidden="true" tabindex="-1"></a>estimator does not require a detailed understanding of the </span>
<span id="cb27-1186"><a href="#cb27-1186" aria-hidden="true" tabindex="-1"></a>parameterization of the model.</span>
<span id="cb27-1187"><a href="#cb27-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1188"><a href="#cb27-1188" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb27-1189"><a href="#cb27-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1190"><a href="#cb27-1190" aria-hidden="true" tabindex="-1"></a>Just as when using maximum-likelihood methods, we can use the "standardized"</span>
<span id="cb27-1191"><a href="#cb27-1191" aria-hidden="true" tabindex="-1"></a>estimator for obtaining marginal (population-average) differences in proportions</span>
<span id="cb27-1192"><a href="#cb27-1192" aria-hidden="true" tabindex="-1"></a>in the Bayesian setting.</span>
<span id="cb27-1193"><a href="#cb27-1193" aria-hidden="true" tabindex="-1"></a>Obtaining credible intervals is easier in the Bayesian setting compared with</span>
<span id="cb27-1194"><a href="#cb27-1194" aria-hidden="true" tabindex="-1"></a>the maximum likelihood setting, because we can simply apply transformations to </span>
<span id="cb27-1195"><a href="#cb27-1195" aria-hidden="true" tabindex="-1"></a>MCMC samples.</span>
<span id="cb27-1196"><a href="#cb27-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1197"><a href="#cb27-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">## Excercise</span></span>
<span id="cb27-1198"><a href="#cb27-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1199"><a href="#cb27-1199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Excercise 1</span></span>
<span id="cb27-1200"><a href="#cb27-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1201"><a href="#cb27-1201" aria-hidden="true" tabindex="-1"></a>Use the "standardized" estimator to obtain the posterior marginal ratio of</span>
<span id="cb27-1202"><a href="#cb27-1202" aria-hidden="true" tabindex="-1"></a>proportions (i.e. $\hat{\pi}_\text{drug} / \hat{\pi}_\text{placebo}$) with a </span>
<span id="cb27-1203"><a href="#cb27-1203" aria-hidden="true" tabindex="-1"></a>credible interval in the example <span class="in">`trial_data`</span>. Explore whether the rate-ratio is </span>
<span id="cb27-1204"><a href="#cb27-1204" aria-hidden="true" tabindex="-1"></a>an appropriate summary measure for the treatment effect in this example.</span>
<span id="cb27-1205"><a href="#cb27-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1206"><a href="#cb27-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Excercise 2</span></span>
<span id="cb27-1207"><a href="#cb27-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1208"><a href="#cb27-1208" aria-hidden="true" tabindex="-1"></a>Analyze the data below from a hypothetical two-arm RCT of a blood pressure </span>
<span id="cb27-1209"><a href="#cb27-1209" aria-hidden="true" tabindex="-1"></a>lowering drug compared with placebo with a linear regression model such as</span>
<span id="cb27-1210"><a href="#cb27-1210" aria-hidden="true" tabindex="-1"></a><span class="in">`CHG ~ 1 + TRT01P + BASE`</span>. We might a-priori expect the residual standard </span>
<span id="cb27-1211"><a href="#cb27-1211" aria-hidden="true" tabindex="-1"></a>deviation to be about 12 mmHg. Use this model to obtain the marginal population</span>
<span id="cb27-1212"><a href="#cb27-1212" aria-hidden="true" tabindex="-1"></a>average difference in proportions of patients achieving a mean sitting </span>
<span id="cb27-1213"><a href="#cb27-1213" aria-hidden="true" tabindex="-1"></a>systolic blood pressure &lt; 140 mmHg. How does the result compare to fitting</span>
<span id="cb27-1214"><a href="#cb27-1214" aria-hidden="true" tabindex="-1"></a>a binomial regression model?</span>
<span id="cb27-1215"><a href="#cb27-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1216"><a href="#cb27-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r excercisetwo}</span></span>
<span id="cb27-1217"><a href="#cb27-1217" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb27-1218"><a href="#cb27-1218" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Data for excercise 2"</span></span>
<span id="cb27-1219"><a href="#cb27-1219" aria-hidden="true" tabindex="-1"></a>bp_trial <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb27-1220"><a href="#cb27-1220" aria-hidden="true" tabindex="-1"></a>    <span class="at">USUBJID =</span> <span class="dv">1</span>L<span class="sc">:</span><span class="dv">50</span>L, </span>
<span id="cb27-1221"><a href="#cb27-1221" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRT01P =</span> <span class="fu">factor</span>(</span>
<span id="cb27-1222"><a href="#cb27-1222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb27-1223"><a href="#cb27-1223" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb27-1224"><a href="#cb27-1224" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L),</span>
<span id="cb27-1225"><a href="#cb27-1225" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"Drug"</span>)),</span>
<span id="cb27-1226"><a href="#cb27-1226" aria-hidden="true" tabindex="-1"></a>    <span class="at">PARAM =</span> <span class="fu">factor</span>(<span class="st">"mean sitting Systolic Blood Pressure"</span>),</span>
<span id="cb27-1227"><a href="#cb27-1227" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE =</span> <span class="fu">c</span>(</span>
<span id="cb27-1228"><a href="#cb27-1228" aria-hidden="true" tabindex="-1"></a>        <span class="fl">151.5</span>, <span class="fl">146.6</span>, <span class="fl">142.5</span>, <span class="fl">152.2</span>, <span class="fl">142.9</span>, <span class="fl">140.4</span>, <span class="fl">144.9</span>, <span class="fl">145.5</span>, <span class="fl">142.9</span>, <span class="dv">146</span>, </span>
<span id="cb27-1229"><a href="#cb27-1229" aria-hidden="true" tabindex="-1"></a>        <span class="fl">146.8</span>, <span class="fl">148.7</span>, <span class="fl">146.9</span>, <span class="dv">160</span>, <span class="fl">147.8</span>, <span class="fl">145.9</span>, <span class="fl">140.6</span>, <span class="fl">140.6</span>, <span class="dv">145</span>, <span class="fl">141.6</span>, <span class="fl">143.9</span>, </span>
<span id="cb27-1230"><a href="#cb27-1230" aria-hidden="true" tabindex="-1"></a>        <span class="fl">143.8</span>, <span class="fl">143.7</span>, <span class="fl">143.9</span>, <span class="fl">141.3</span>, <span class="fl">149.6</span>, <span class="fl">146.6</span>, <span class="fl">149.1</span>, <span class="fl">150.7</span>, <span class="fl">141.9</span>, <span class="fl">142.9</span>, </span>
<span id="cb27-1231"><a href="#cb27-1231" aria-hidden="true" tabindex="-1"></a>        <span class="fl">140.5</span>, <span class="dv">155</span>, <span class="fl">145.9</span>, <span class="dv">145</span>, <span class="fl">148.9</span>, <span class="fl">144.9</span>, <span class="fl">149.8</span>, <span class="fl">141.5</span>, <span class="fl">151.8</span>, <span class="dv">146</span>, <span class="fl">140.2</span>, </span>
<span id="cb27-1232"><a href="#cb27-1232" aria-hidden="true" tabindex="-1"></a>        <span class="fl">143.6</span>, <span class="dv">140</span>, <span class="fl">140.3</span>, <span class="fl">140.4</span>, <span class="fl">141.2</span>, <span class="fl">145.7</span>, <span class="fl">146.2</span>, <span class="dv">143</span></span>
<span id="cb27-1233"><a href="#cb27-1233" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-1234"><a href="#cb27-1234" aria-hidden="true" tabindex="-1"></a>    <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb27-1235"><a href="#cb27-1235" aria-hidden="true" tabindex="-1"></a>        <span class="fl">123.2</span>, <span class="fl">134.8</span>, <span class="dv">123</span>, <span class="fl">140.4</span>, <span class="fl">120.2</span>, <span class="fl">138.7</span>, <span class="dv">153</span>, <span class="fl">142.3</span>, <span class="fl">132.6</span>, <span class="fl">105.9</span>, <span class="dv">137</span>, </span>
<span id="cb27-1236"><a href="#cb27-1236" aria-hidden="true" tabindex="-1"></a>        <span class="fl">136.5</span>, <span class="dv">122</span>, <span class="fl">144.1</span>, <span class="fl">135.5</span>, <span class="fl">89.3</span>, <span class="fl">110.2</span>, <span class="fl">140.2</span>, <span class="fl">133.1</span>, <span class="fl">139.6</span>, <span class="fl">126.8</span>, </span>
<span id="cb27-1237"><a href="#cb27-1237" aria-hidden="true" tabindex="-1"></a>        <span class="fl">135.6</span>, <span class="fl">136.7</span>, <span class="fl">151.5</span>, <span class="fl">125.6</span>, <span class="fl">133.9</span>, <span class="fl">133.8</span>, <span class="fl">144.1</span>, <span class="fl">145.5</span>, <span class="dv">94</span>, <span class="fl">156.3</span>, </span>
<span id="cb27-1238"><a href="#cb27-1238" aria-hidden="true" tabindex="-1"></a>        <span class="fl">136.5</span>, <span class="fl">147.2</span>, <span class="fl">95.9</span>, <span class="dv">127</span>, <span class="fl">146.8</span>, <span class="fl">111.2</span>, <span class="fl">125.6</span>, <span class="fl">125.6</span>, <span class="fl">142.6</span>, <span class="fl">133.7</span>, </span>
<span id="cb27-1239"><a href="#cb27-1239" aria-hidden="true" tabindex="-1"></a>        <span class="fl">130.6</span>, <span class="fl">125.8</span>, <span class="fl">138.9</span>, <span class="fl">118.3</span>, <span class="fl">135.1</span>, <span class="fl">123.4</span>, <span class="fl">139.5</span>, <span class="fl">114.7</span>, <span class="fl">138.2</span></span>
<span id="cb27-1240"><a href="#cb27-1240" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-1241"><a href="#cb27-1241" aria-hidden="true" tabindex="-1"></a>    <span class="at">CHG =</span> <span class="fu">c</span>(</span>
<span id="cb27-1242"><a href="#cb27-1242" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">28.3</span>, <span class="sc">-</span><span class="fl">11.8</span>, <span class="sc">-</span><span class="fl">19.5</span>, <span class="sc">-</span><span class="fl">11.8</span>, <span class="sc">-</span><span class="fl">22.7</span>, <span class="sc">-</span><span class="fl">1.7</span>, <span class="fl">8.1</span>, <span class="sc">-</span><span class="fl">3.2</span>, <span class="sc">-</span><span class="fl">10.3</span>, <span class="sc">-</span><span class="fl">40.1</span>, <span class="sc">-</span><span class="fl">9.8</span>,</span>
<span id="cb27-1243"><a href="#cb27-1243" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">12.2</span>, <span class="sc">-</span><span class="fl">24.9</span>, <span class="sc">-</span><span class="fl">15.9</span>, <span class="sc">-</span><span class="fl">12.3</span>, <span class="sc">-</span><span class="fl">56.6</span>, <span class="sc">-</span><span class="fl">30.4</span>, <span class="sc">-</span><span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">11.9</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">17.1</span>, <span class="sc">-</span><span class="fl">8.2</span>, </span>
<span id="cb27-1244"><a href="#cb27-1244" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="dv">7</span>, <span class="fl">7.6</span>, <span class="sc">-</span><span class="fl">15.7</span>, <span class="sc">-</span><span class="fl">15.7</span>, <span class="sc">-</span><span class="fl">12.8</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="fl">5.2</span>, <span class="sc">-</span><span class="fl">47.9</span>, <span class="fl">13.4</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="fl">7.8</span>, <span class="sc">-</span><span class="dv">50</span>, <span class="sc">-</span><span class="dv">18</span>, </span>
<span id="cb27-1245"><a href="#cb27-1245" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">2.1</span>, <span class="sc">-</span><span class="fl">33.7</span>, <span class="sc">-</span><span class="fl">24.2</span>, <span class="sc">-</span><span class="fl">15.9</span>, <span class="sc">-</span><span class="fl">9.2</span>, <span class="sc">-</span><span class="fl">12.3</span>, <span class="sc">-</span><span class="fl">9.6</span>, <span class="sc">-</span><span class="fl">17.8</span>, <span class="sc">-</span><span class="fl">1.1</span>, <span class="sc">-</span><span class="dv">22</span>, <span class="sc">-</span><span class="fl">5.3</span>, </span>
<span id="cb27-1246"><a href="#cb27-1246" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span><span class="fl">17.8</span>, <span class="sc">-</span><span class="fl">6.2</span>, <span class="sc">-</span><span class="fl">31.5</span>, <span class="sc">-</span><span class="fl">4.8</span></span>
<span id="cb27-1247"><a href="#cb27-1247" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-1248"><a href="#cb27-1248" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-1249"><a href="#cb27-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>