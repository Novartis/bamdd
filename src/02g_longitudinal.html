<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Bean - andrew.bean@novartis.com">

<title>12&nbsp; Longitudinal data – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/02h_mmrm.html" rel="next">
<link href="../src/02e_multiple_imputation.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b619e7580ba2a849d98fc8631a679bb4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="../resources/mathjax/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02g_longitudinal.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Longitudinal data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Parallel computation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">12.1</span> Background</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">12.2</span> Data</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models"><span class="header-section-number">12.3</span> Models</a>
  <ul class="collapse">
  <li><a href="#mean-models" id="toc-mean-models" class="nav-link" data-scroll-target="#mean-models"><span class="header-section-number">12.3.1</span> Mean models</a></li>
  <li><a href="#correlation-models" id="toc-correlation-models" class="nav-link" data-scroll-target="#correlation-models"><span class="header-section-number">12.3.2</span> Correlation models</a></li>
  <li><a href="#cross-sectional-approaches" id="toc-cross-sectional-approaches" class="nav-link" data-scroll-target="#cross-sectional-approaches"><span class="header-section-number">12.3.3</span> Cross-sectional approaches</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">12.4</span> Results</a>
  <ul class="collapse">
  <li><a href="#fitting-several-models" id="toc-fitting-several-models" class="nav-link" data-scroll-target="#fitting-several-models"><span class="header-section-number">12.4.1</span> Fitting several models</a></li>
  <li><a href="#pasi-change-from-baseline-emms-by-visit" id="toc-pasi-change-from-baseline-emms-by-visit" class="nav-link" data-scroll-target="#pasi-change-from-baseline-emms-by-visit"><span class="header-section-number">12.4.2</span> PASI change from baseline: EMMs by visit</a></li>
  <li><a href="#pasi-change-from-baseline-emm-contrasts-with-placebo-by-visit" id="toc-pasi-change-from-baseline-emm-contrasts-with-placebo-by-visit" class="nav-link" data-scroll-target="#pasi-change-from-baseline-emm-contrasts-with-placebo-by-visit"><span class="header-section-number">12.4.3</span> PASI change from baseline: EMM contrasts with placebo by visit</a></li>
  <li><a href="#estimates-of-week-12-efficacy" id="toc-estimates-of-week-12-efficacy" class="nav-link" data-scroll-target="#estimates-of-week-12-efficacy"><span class="header-section-number">12.4.4</span> Estimates of Week 12 efficacy</a></li>
  <li><a href="#assessing-model-fit" id="toc-assessing-model-fit" class="nav-link" data-scroll-target="#assessing-model-fit"><span class="header-section-number">12.4.5</span> Assessing model fit</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">12.5</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02g_longitudinal.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Longitudinal data</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-longitudinal-data" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrew Bean - <a href="mailto:andrew.bean@novartis.com" class="email">andrew.bean@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="background" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="background"><span class="header-section-number">12.1</span> Background</h2>
<p>Many clinical trials assess efficacy and other endpoints at numerous timepoints post-baseline. For example, consider the case where a continuous response endpoint is assessed every 2 weeks post baseline (Week 2, Week 4, …, Week 12). Although clinical interest may focus on the response rate at a particular visit (e.g.&nbsp;at Week 12), efficacy data at other visits is of course still of interest, either in its own right, to build understanding of the full time vs.&nbsp;efficacy profile, or as a means to increase statistical power for estimation at Week 12.</p>
<p>There are multiple approaches for proceeding with estimation of the Week 12 treatment effect. Adopting a <em>cross-sectional approach</em> , one could ignoring all other post-baseline assessments except Week 12. If certain patients missed the Week 12 assessment, this missing data would need to be handled using an appropriate pre-defined strategy (e.g.&nbsp;for response rate endpoints, imputing missing outcomes with nonresponder status, carrying the last observation forward, multiple imputation approaches, or even dropping missing data altogether). Such approaches may lose signifcant power or incur bias if there is substantial missing data.</p>
<p>Alternatively <em>longitudinal models</em> incorporate the full post-baseline set of assessments to facilitate modeling of efficacy at all visits. In some cases, these may substantially increase statistical power.</p>
<p>The <code>brms</code> package contains a deep suite of modelling tools for longitudinal data, including many options for modelling the mean trajectory across visits/time, and for modelling autocorrelated errors within patients across time. In this section we illustrate some potential uses of these tools in a clinical trial setting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8904568</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>adpasi <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"longitudinal.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(TRT01P <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">paste</span>(<span class="st">"Week"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P =</span> <span class="fu">factor</span>(TRT01P, <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="data"><span class="header-section-number">12.2</span> Data</h2>
<p>The example involves simulated results of a hypothetical Phase-II study of an experimental treatment for Psoriasis. Synthetic data are generated using the <code>mmrm</code> package. We consider a subset of the study involving 100 patients, 50 of whom were randomized to receive placebo, and 50 of whom received treatment.</p>
<p>Efficacy was assessed using the Psoriasis Area and Severity Index (PASI), a numerical score which measures the severity and extent of psoriasis. This is assessed at baseline, and again at 7 post-baseline timepoints.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/plot_pasi-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Two endpoints of interest based on the PASI score are (1) PASI change from baseline, and (2) the binary endpoint PASI 75, which defines a responder as any patient with at least a 75% change from baseline in PASI.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/plot_pasi75-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The data has been transformed to follow a typical CDISC Analysis Data Model (ADaM) format.</p>
</section>
<section id="models" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="models"><span class="header-section-number">12.3</span> Models</h2>
<p>There are a few key ingredients to a longitudinal model for the PASI score outcomes.</p>
<ol type="1">
<li><p>A <em>mean model</em> which describes the expected value of the response over time, across treatments, and across values of any other relevant covariates.</p></li>
<li><p>A <em>correlation model</em> which describes the correlation structure of the error terms.</p></li>
</ol>
<p><code>brms</code> offers many modelling options for each component.</p>
<section id="mean-models" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="mean-models"><span class="header-section-number">12.3.1</span> Mean models</h3>
<section id="cell-means-model" class="level4" data-number="12.3.1.1">
<h4 data-number="12.3.1.1" class="anchored" data-anchor-id="cell-means-model"><span class="header-section-number">12.3.1.1</span> Cell-means model</h4>
<p>The most common approach for modeling the mean in clinical trial practice is to adopt a specification which allows the mean to vary freely across visits, without any parametric specification of the trajectory of the mean over time. Here we will call this the “cell-means” model, where levels of the treatment group and visit comprise the cells.</p>
<p>In this approach, we include all treatment-by-visit interactions. In <code>brms</code>, the formula specification would be:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>CHG ~ BASE + TRT01P * AVISIT</code></pre>
</div>
</div>
</section>
<section id="linear-in-time-model" class="level4" data-number="12.3.1.2">
<h4 data-number="12.3.1.2" class="anchored" data-anchor-id="linear-in-time-model"><span class="header-section-number">12.3.1.2</span> Linear-in-time model</h4>
<p>A far stronger assumption would be to assume the mean response is linear in time (i.e.&nbsp;the number of weeks post baseline for visit). In this case, the formula specification would be</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>CHG ~ BASE + TRT01P * AVISITN</code></pre>
</div>
</div>
<p>Note the key difference is the use of <code>AVISITN</code> (a numeric variable indicating the number of weeks post baseline) rather than <code>AVISIT</code> (a factor variable for the visit id).</p>
<p>Such a model should be considered only for exploratory modelling purposes, and not for confirmatory analyses, the main reason being that the linearity assumption cannot be assessed at the trial design stage before having collected the data.</p>
<p>Even if the linearity assumption appeared reasonable over the time range explored in the trial, it should not be used to extrapolate outside the observed time period.</p>
</section>
<section id="quadratic-in-time-model" class="level4" data-number="12.3.1.3">
<h4 data-number="12.3.1.3" class="anchored" data-anchor-id="quadratic-in-time-model"><span class="header-section-number">12.3.1.3</span> Quadratic-in-time model</h4>
<p>In the previous section, we saw there was a hint of curvature in the sample mean response over time:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/plot_curvature-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Hence one might consider a mean model that assumes the mean response is quadratic in time rather than linear:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>CHG ~ BASE + TRT01P * AVISITN + TRT01P * AVISITN^2</code></pre>
</div>
</div>
<p>This model should similarly not be used to extrapolate outside the week 1-12 window.</p>
</section>
<section id="gaussian-process-prior" class="level4" data-number="12.3.1.4">
<h4 data-number="12.3.1.4" class="anchored" data-anchor-id="gaussian-process-prior"><span class="header-section-number">12.3.1.4</span> Gaussian process prior</h4>
<p>An interesting nonparametric alternative to the just-discussed specifications is based on a Gaussian process prior for the mean across visits within treatments. As in the case of the cell-means model, this model does not assume any parametric shape for the mean response over time. It assumes only that the mean response over time follows a continuous curve which is assigned a Gaussian process (GP) prior.</p>
<p>While the GP itself is a continuous-time process, the joint distribution of a realization at any discrete set of timepoints is multivariate normal.</p>
<p>In <code>brms</code>, the formula specification would be as follows:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>CHG ~ BASE + TRT01P + gp(AVISITN, by = TRT01P)</code></pre>
</div>
</div>
<p>The implication of this model is that there is a correlation between the mean response at any collection of visits, and the correlation between any pair of visits decays as the time between them increases, according to an exponential covariance function. See <code>?gp</code> for additional details on the <code>brms</code> implementation.</p>
</section>
</section>
<section id="correlation-models" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2" class="anchored" data-anchor-id="correlation-models"><span class="header-section-number">12.3.2</span> Correlation models</h3>
<p>The repeated measurement of an endpoint over time on the same patient induces <em>autocorrelation</em> between the within-patient measurements. To illustrate, consider if we ignored the correlations and fit a model with uncorrelated errors. Below are scatterplots and correlation coefficients for the residuals of such a fitted model. The correlations are quite strong, especially between visits that are closer in time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT, <span class="at">data =</span> pasi_data)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_fit)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> res) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, AVISIT, res) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> SUBJID, <span class="at">names_from =</span> AVISIT, <span class="at">values_from =</span> res) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SUBJID) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/corr_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Failing to model these within-subject correlations will result in a loss of statistical power (wider confidence intervals, less powerful tests). <code>brms</code> offers several options for modelling within-subject correlations.</p>
<section id="subject-level-random-effects" class="level4" data-number="12.3.2.1">
<h4 data-number="12.3.2.1" class="anchored" data-anchor-id="subject-level-random-effects"><span class="header-section-number">12.3.2.1</span> Subject-level random effects</h4>
<p>One way to achieve within-subject correlation is to use a model that includes a subject-level random effect. When the resulting mean response function is averaged over the distribution of the random effect terms (“integrating them out”), a uniform correlation is induced between all measurements on the same patient. The magnitude of the correlation is determined by the relative size of the random-effect variance and the error variance. (See exercise 1.)</p>
<p>In <code>brms</code>, a subject-level random intercept can be easily added in the formula specification. For example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>CHG ~ BASE + TRT01P * AVISIT + (1 | SUBJID)</code></pre>
</div>
</div>
</section>
<section id="autoregressive-correlation-structures" class="level4" data-number="12.3.2.2">
<h4 data-number="12.3.2.2" class="anchored" data-anchor-id="autoregressive-correlation-structures"><span class="header-section-number">12.3.2.2</span> Autoregressive correlation structures</h4>
<p>A very common model for serial correlation is based on an <em>autoregressive process</em>. Under such a process, the error term <span class="math inline">\(\varepsilon_t\)</span> at a timepoint <span class="math inline">\(t\)</span> is explicitly dependent on some collection of preceeding error terms. Under a first-order autoregressive process, for example, it is dependent only on one of its predecessors: <span class="math display">\[ \varepsilon_t = \alpha\varepsilon_{t-1} + Z_t,\]</span> for <span class="math inline">\(t\geq 2\)</span>, where <span class="math inline">\(Z_t\)</span> are iid <span class="math inline">\(\mathrm N(0, \sigma^2)\)</span>. The process is initialized with <span class="math inline">\(\varepsilon_1 \sim \mathrm N(0, \sigma^2 / (1 - \alpha^2))\)</span>.</p>
<p>The resulting covariance matrix of a collection <span class="math inline">\((\varepsilon_1,\ldots,\varepsilon_T)\)</span> has a simple form; the reader is referred to the SAS paper <a href="https://support.sas.com/resources/papers/proceedings/proceedings/sugi30/198-30.pdf">“Guidelines for Selecting the Covariance Structure in Mixed Model Analysis” by Chuck Kincaid</a> for detail on the AR structure (c.f. page 2), and other covariance structures.</p>
<p>The <code>autocor</code> argument of <code>brm()</code> and <code>brmsformula()</code> is used to set an autoregressive correlation strucutre. For order-1 autoregressive. Below is a choice of AR(1) autocorrelation that we might consider in the psoriasis example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>~ar(time = AVISIT, gr = SUBJID, p = 1)</code></pre>
</div>
</div>
<p>This choice implies that autocorrelation exists across visits within subjects.</p>
</section>
<section id="compound-symmetry" class="level4" data-number="12.3.2.3">
<h4 data-number="12.3.2.3" class="anchored" data-anchor-id="compound-symmetry"><span class="header-section-number">12.3.2.3</span> Compound symmetry</h4>
<p>Another choice offered by <code>brms</code> is that of compound symmetry. The reader is again referred to the SAS paper linked above and <code>?cosy</code> for more information.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>~cosy(time = AVISIT, gr = SUBJID)</code></pre>
</div>
</div>
</section>
<section id="other-choices" class="level4" data-number="12.3.2.4">
<h4 data-number="12.3.2.4" class="anchored" data-anchor-id="other-choices"><span class="header-section-number">12.3.2.4</span> Other choices</h4>
<p><code>brms</code> offers several other choices for autocorrelation models. See <code>?'autocor-terms'</code> for more a listing.</p>
<p>We note that currently, <em>unstructured</em> correlation models (a standard choice for MMRM specifications in clinical trial protocols) re not supported by <code>brms</code>.</p>
<p>However, fixed correlation structures are, and one could consider plugging in for this an unstructured correlation estimate from a frequentist MMRM. For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a MMRM using gls</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>gls_fit <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pasi_data,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">correlation =</span> nlme<span class="sc">::</span><span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> SUBJID))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated correlation matrices by subject</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>Sig_subj <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">corMatrix</span>(gls_fit<span class="sc">$</span>modelStruct[[<span class="dv">1</span>]])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>Sig_subj[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
            [,1]        [,2]      [,3]      [,4]        [,5]        [,6]
[1,]  1.00000000 0.896714971 0.5883171 0.2669088 -0.03659905 -0.05666876
[2,]  0.89671497 1.000000000 0.6313654 0.3841036  0.03162521  0.03550198
[3,]  0.58831712 0.631365431 1.0000000 0.4509002  0.37604603  0.21075194
[4,]  0.26690877 0.384103637 0.4509002 1.0000000  0.63152510  0.47401182
[5,] -0.03659905 0.031625213 0.3760460 0.6315251  1.00000000  0.77205541
[6,] -0.05666876 0.035501982 0.2107519 0.4740118  0.77205541  1.00000000
[7,] -0.08775131 0.008196384 0.2465146 0.5921762  0.79671624  0.74110361
             [,7]
[1,] -0.087751306
[2,]  0.008196384
[3,]  0.246514616
[4,]  0.592176181
[5,]  0.796716238
[6,]  0.741103610
[7,]  1.000000000</code></pre>
</div>
</div>
<p>A block-diagonal matrix containing these estimated within-subject correlations could be plugged in as the <code>M</code> argument of the <code>fcor()</code> function in <code>brms</code>.</p>
</section>
</section>
<section id="cross-sectional-approaches" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3" class="anchored" data-anchor-id="cross-sectional-approaches"><span class="header-section-number">12.3.3</span> Cross-sectional approaches</h3>
<p>For modeling a continuous endpoint such as PASI, the cross-sectional analogue of the longitudinal models we’ve discussed is the <em>ANCOVA</em> model, in which a linear regression model (conditioning as before on the baseline PASI covariate) is fit to the Week-12 cross section of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis data includes only the Week 12 cross section</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ancova_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL, AVISITN <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># formula specification for ANCOVA</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ancova_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>ancova_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  ancova_formula,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ancova_data</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>ancova_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  ancova_formula,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> ancova_prior,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ancova_data,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the next section, this model is also explored for the purposes of comparing to the longitudinal approaches</p>
</section>
</section>
<section id="results" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="results"><span class="header-section-number">12.4</span> Results</h2>
<p>A typical estimand for longitudinal or ANCOVA involve Least Squares means (LS means) or estimated marginal means (EMM). Inference for EMMs is extremely convenient with <code>brms</code> due to its integration with the <code>emmeans</code> R package. The EMM can be roughly understood as the average, stratified by treatment group and visit, of the mean prediction across subjects in the trial.</p>
<p>We begin by briefly illustrating how <code>emmeans</code> can be used with a <code>brmsfit</code> object to estimate LS means and their contrasts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>analysis_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>brms_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  brms_formula,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  brms_formula,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 12.1 seconds.
Chain 2 finished in 11.7 seconds.
Chain 3 finished in 12.2 seconds.
Chain 4 finished in 11.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 11.7 seconds.
Total execution time: 47.5 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CHG ~ BASE + TRT01P * AVISIT 
         autocor ~ cosy(time = AVISIT, gr = SUBJID)
   Data: analysis_data (Number of observations: 684) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Correlation Structures:
     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
cosy     0.41      0.04     0.33     0.51 1.00     3163     2356

Regression Coefficients:
                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
Intercept                 12.95      1.87     9.29    16.56 1.00     2673
BASE                      -0.70      0.08    -0.85    -0.54 1.00     3934
TRT01PTRT                 -3.56      1.59    -6.62    -0.45 1.00     1884
AVISITWeek2               -0.16      1.16    -2.47     2.11 1.00     2034
AVISITWeek4               -2.49      1.23    -4.87     0.02 1.00     2158
AVISITWeek6               -0.87      1.31    -3.46     1.70 1.00     2142
AVISITWeek8                1.10      1.34    -1.55     3.77 1.00     2250
AVISITWeek10              -1.22      1.32    -3.78     1.43 1.00     2184
AVISITWeek12              -3.66      1.17    -6.01    -1.41 1.00     2064
TRT01PTRT:AVISITWeek2     -4.13      1.75    -7.59    -0.71 1.00     1942
TRT01PTRT:AVISITWeek4     -6.15      1.79    -9.73    -2.59 1.00     2173
TRT01PTRT:AVISITWeek6     -9.30      1.83   -12.89    -5.67 1.00     1916
TRT01PTRT:AVISITWeek8    -12.69      1.85   -16.38    -9.16 1.00     1981
TRT01PTRT:AVISITWeek10   -10.77      1.89   -14.41    -7.06 1.00     2080
TRT01PTRT:AVISITWeek12    -7.38      1.73   -10.82    -4.09 1.00     1890
                       Tail_ESS
Intercept                  2488
BASE                       3210
TRT01PTRT                  2654
AVISITWeek2                2992
AVISITWeek4                2789
AVISITWeek6                2597
AVISITWeek8                2734
AVISITWeek10               2506
AVISITWeek12               2704
TRT01PTRT:AVISITWeek2      2370
TRT01PTRT:AVISITWeek4      2821
TRT01PTRT:AVISITWeek6      2290
TRT01PTRT:AVISITWeek8      2465
TRT01PTRT:AVISITWeek10     2343
TRT01PTRT:AVISITWeek12     2542

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     8.21      0.32     7.65     8.89 1.00     3278     2296

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the EMMs</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISIT"</span>), <span class="at">nesting =</span> <span class="fu">list</span>())</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>emm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> TRT01P AVISIT   emmean lower.HPD upper.HPD
 PBO    Week 1   -1.214     -3.38    0.8924
 TRT    Week 1   -4.782     -6.98   -2.3953
 PBO    Week 2   -1.378     -3.45    0.7517
 TRT    Week 2   -9.065    -11.30   -6.7377
 PBO    Week 4   -3.718     -6.02   -1.4343
 TRT    Week 4  -13.426    -15.69  -11.3379
 PBO    Week 6   -2.099     -4.40    0.3942
 TRT    Week 6  -14.976    -17.23  -12.6760
 PBO    Week 8   -0.144     -2.63    2.2711
 TRT    Week 8  -16.363    -18.77  -14.1551
 PBO    Week 10  -2.449     -4.94    0.0976
 TRT    Week 10 -16.780    -19.11  -14.3734
 PBO    Week 12  -4.874     -7.17   -2.7912
 TRT    Week 12 -15.795    -18.10  -13.5977

Point estimate displayed: median 
HPD interval probability: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate EMM contrasts</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>emm_contrasts <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"AVISIT"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>emm_contrasts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AVISIT = Week 1:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO    -3.58     -6.53    -0.391

AVISIT = Week 2:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO    -7.67    -10.81    -4.698

AVISIT = Week 4:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO    -9.70    -12.87    -6.692

AVISIT = Week 6:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO   -12.88    -16.12    -9.505

AVISIT = Week 8:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO   -16.24    -19.47   -12.831

AVISIT = Week 10:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO   -14.33    -17.57   -10.757

AVISIT = Week 12:
 contrast  estimate lower.HPD upper.HPD
 TRT - PBO   -10.93    -14.22    -8.029

Point estimate displayed: median 
HPD interval probability: 0.95 </code></pre>
</div>
</div>
<section id="fitting-several-models" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="fitting-several-models"><span class="header-section-number">12.4.1</span> Fitting several models</h3>
<p>In order to understand the impact of possible choices for the mean model and correlation model, we fit a series of models in loop.</p>
<p>Code to prepare a list of models to be fit:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>setup_analyses <span class="ot">&lt;-</span> <span class="cf">function</span>(adpasi){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  formulas <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>endpoint,   <span class="sc">~</span>formula_name,   <span class="sc">~</span>paramcd,     <span class="sc">~</span>family,                                             <span class="sc">~</span>formula, <span class="sc">~</span>correl, <span class="sc">~</span>longitudinal,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>,    <span class="st">"cell-means"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(),                         CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT,    <span class="cn">TRUE</span>,          <span class="cn">TRUE</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>,        <span class="st">"linear"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(),                        CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN,    <span class="cn">TRUE</span>,          <span class="cn">TRUE</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>,     <span class="st">"quadratic"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(), CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN <span class="sc">^</span> <span class="dv">2</span>,    <span class="cn">TRUE</span>,          <span class="cn">TRUE</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>,            <span class="st">"gp"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(),       CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),    <span class="cn">TRUE</span>,          <span class="cn">TRUE</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>,        <span class="st">"raneff"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(),          CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> SUBJID),   <span class="cn">FALSE</span>,          <span class="cn">TRUE</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">"PASI"</span>, <span class="st">"cross-section"</span>, <span class="st">"PASITSCO"</span>,  <span class="fu">gaussian</span>(),                                  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P,   <span class="cn">FALSE</span>,         <span class="cn">FALSE</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  datasets <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>paramcd, <span class="sc">~</span>longitudinal, <span class="sc">~</span>missing_approach,                                               <span class="sc">~</span>analysis_data,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PASITSCO"</span>,          <span class="cn">TRUE</span>,            <span class="st">"drop"</span>,                <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PASITSCO"</span>,         <span class="cn">FALSE</span>,            <span class="st">"drop"</span>, <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL, AVISITN <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  autocor <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>correl, <span class="sc">~</span>autocor_name, <span class="sc">~</span>autocor,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>       <span class="cn">TRUE</span>,         <span class="st">"AR1"</span>, <span class="sc">~</span> <span class="fu">ar</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID, <span class="at">p =</span> <span class="dv">1</span>),</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>       <span class="cn">TRUE</span>,        <span class="st">"COSY"</span>, <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  analyses <span class="ot">&lt;-</span> formulas <span class="sc">%&gt;%</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">full_join</span>(datasets, <span class="fu">c</span>(<span class="st">"paramcd"</span>, <span class="st">"longitudinal"</span>), <span class="at">multiple =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">full_join</span>(autocor, <span class="fu">c</span>(<span class="st">"correl"</span>), <span class="at">multiple =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">autocor_name =</span> <span class="st">"none"</span>))</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  analyses</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Code to fit the models in a loop using <code>clustermq</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/longitudinal/fit_models.R"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clustermq)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"src"</span>, <span class="st">"longitudinal"</span>, <span class="st">"setup_analyses.R"</span>))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># iter &lt;- Sys.getenv("BRMS_ITER")</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># chains &lt;- Sys.getenv("BRMS_CHAINS")</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>adpasi <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"longitudinal.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">paste</span>(<span class="st">"Week"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P =</span> <span class="fu">factor</span>(TRT01P, <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>analyses <span class="ot">&lt;-</span> <span class="fu">setup_analyses</span>(adpasi)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>analyses <span class="ot">&lt;-</span> <span class="fu">filter</span>(analyses, endpoint <span class="sc">==</span> <span class="st">"PASI"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> <span class="cf">function</span>(id, analysis_data, formula, formula_name,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                      family, correl, autocor, autocor_name,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">save_individuals =</span> <span class="cn">FALSE</span>){</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up the formula ---------------------------------------------------------</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(correl){</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    autocor <span class="ot">&lt;-</span> autocor</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    autocor <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  brms_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    formula,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">autocor =</span> autocor,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> family,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit the model --------------------------------------------------------------</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    brms_formula,</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">*** Fitting model"</span>, id, <span class="st">": "</span>, formula_name, <span class="st">", "</span>, autocor_name, <span class="st">"***</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>    brms_formula,</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> prior,</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">"rstan"</span>,</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(save_individuals) <span class="fu">saveRDS</span>(fit, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"reports"</span>, <span class="fu">paste0</span>(<span class="st">"longitudinal_fit_"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate marginal means ----------------------------------------------------</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">*** Estimating marginal means"</span>, id, <span class="st">": "</span>, formula_name, <span class="st">", "</span>, autocor_name, <span class="st">"***</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>  base <span class="ot">&lt;-</span> analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(SUBJID, BASE) <span class="sc">%&gt;%</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>  visits <span class="ot">&lt;-</span> analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(AVISIT, AVISITN) <span class="sc">%&gt;%</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>  treatments <span class="ot">&lt;-</span> analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TRT01P) <span class="sc">%&gt;%</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>  emm <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">lapply</span>(</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(visits, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(visits)),</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(visit){</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>      nd <span class="ot">&lt;-</span> visit <span class="sc">%&gt;%</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">crossing</span>(treatments) <span class="sc">%&gt;%</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">crossing</span>(base) <span class="sc">%&gt;%</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">split</span>(.<span class="sc">$</span>TRT01P)</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>      lp <span class="ot">&lt;-</span> <span class="fu">map</span>(nd, <span class="sc">~</span> <span class="fu">posterior_linpred</span>(fit, <span class="at">transform =</span> <span class="cn">TRUE</span>, <span class="at">newdata =</span> .))</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>      marginal_mean <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lp, rowMeans) <span class="sc">%&gt;%</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">diff =</span> .[[<span class="dv">2</span>]] <span class="sc">-</span> .[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="fu">names</span>(nd),</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">paste</span>(<span class="fu">rev</span>(<span class="fu">names</span>(nd)), <span class="at">collapse =</span> <span class="st">" - "</span>)))</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>        visit,</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise_draws</span>(<span class="fu">as_draws_df</span>(marginal_mean))</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>          <span class="at">TRT01P =</span> <span class="fu">factor</span>(variable, <span class="fu">levels</span>(analysis_data<span class="sc">$</span>TRT01P)),</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>          <span class="at">contrast =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.na</span>(TRT01P) <span class="sc">~</span> variable,</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(save_individuals) <span class="fu">saveRDS</span>(emm, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"reports"</span>, <span class="fu">paste0</span>(<span class="st">"longitudinal_emm"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(emm)</span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> clustermq<span class="sc">::</span><span class="fu">Q_rows</span>(</span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(analyses, id, analysis_data, formula, formula_name, family, correl, autocor, autocor_name),</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>  fit_model,</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">const =</span> <span class="fu">list</span>(<span class="at">save_individuals =</span> <span class="cn">FALSE</span>),</span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_jobs =</span> <span class="fu">nrow</span>(analyses),</span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">pkgs =</span> <span class="fu">c</span>(<span class="st">"brms"</span>, <span class="st">"emmeans"</span>, <span class="st">"tidyr"</span>, <span class="st">"dplyr"</span>, <span class="st">"purrr"</span>, <span class="st">"posterior"</span>),</span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">template =</span> <span class="fu">list</span>(</span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">walltime =</span> <span class="dv">120</span>,</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">job_name =</span> <span class="st">"longitudinal_child"</span>,</span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_file =</span> <span class="fu">here</span>(<span class="st">"reports"</span>, <span class="st">"longitudinal_child_%I.log"</span>),</span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">memory =</span> <span class="dv">8000</span>,</span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">job_size =</span> <span class="dv">1</span></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(emm, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"reports"</span>, <span class="st">"longitudinal_fits.rds"</span>))</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(analyses, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"reports"</span>, <span class="st">"longitudinal_analyses.rds"</span>))</span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>analyses<span class="sc">$</span>emm <span class="ot">&lt;-</span> emm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pasi-change-from-baseline-emms-by-visit" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="pasi-change-from-baseline-emms-by-visit"><span class="header-section-number">12.4.2</span> PASI change from baseline: EMMs by visit</h3>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/emm_by_visit-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pasi-change-from-baseline-emm-contrasts-with-placebo-by-visit" class="level3" data-number="12.4.3">
<h3 data-number="12.4.3" class="anchored" data-anchor-id="pasi-change-from-baseline-emm-contrasts-with-placebo-by-visit"><span class="header-section-number">12.4.3</span> PASI change from baseline: EMM contrasts with placebo by visit</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> analyses <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(formula_name, autocor_name, emm) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(emm) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(contrast)) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">formula_name =</span> <span class="fu">factor</span>(formula_name, <span class="fu">unique</span>(formula_name)),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">autocor_name =</span> <span class="fu">factor</span>(autocor_name, <span class="fu">unique</span>(autocor_name)),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">contrast =</span> <span class="fu">factor</span>(contrast, <span class="fu">unique</span>(contrast))) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_model =</span> formula_name,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">corr_model =</span> autocor_name</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>blank <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">slice</span>(<span class="fu">group_by</span>(contrast_results, mean_model, corr_model), <span class="dv">1</span>), <span class="at">estimate =</span> <span class="dv">0</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> contrast_results,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">group =</span> mean_model, <span class="at">color =</span> mean_model,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> median, <span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Visit"</span>, <span class="at">y =</span> <span class="st">"PASI change from baseline</span><span class="sc">\n</span><span class="st">Treatment - Control</span><span class="sc">\n</span><span class="st">Difference in Estimated Marginal Means"</span>) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_blank</span>(<span class="at">data =</span> blank) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> corr_model, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">levels</span>(pasi_data<span class="sc">$</span>AVISIT)) <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Mean model"</span>) <span class="sc">+</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/emm_contrasts_by_visit-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimates-of-week-12-efficacy" class="level3" data-number="12.4.4">
<h3 data-number="12.4.4" class="anchored" data-anchor-id="estimates-of-week-12-efficacy"><span class="header-section-number">12.4.4</span> Estimates of Week 12 efficacy</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(AVISITN <span class="sc">==</span> <span class="dv">12</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>mean_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"quadratic"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>         corr_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"COSY"</span>, <span class="st">"none"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">paste</span>(<span class="st">"mean model:"</span>, mean_model, <span class="st">"</span><span class="sc">\n</span><span class="st">correlation model:"</span>, corr_model)) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> median, <span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95)) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Modeling approach"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PASI change from baseline</span><span class="sc">\n</span><span class="st">Treatment - Control</span><span class="sc">\n</span><span class="st">Difference in Estimated Marginal Means"</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/wk12_compare-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assessing-model-fit" class="level3" data-number="12.4.5">
<h3 data-number="12.4.5" class="anchored" data-anchor-id="assessing-model-fit"><span class="header-section-number">12.4.5</span> Assessing model fit</h3>
<p>In this section we illustrate the use of side-by-side posterior predictive checks to compare the fit of two models: one with a GP prior for the mean structure and one with a linear-in-time model for the mean, each with compound-symmetric autocorration models.</p>
<p>The checks are done across timepoint (# of weeks since baseline), by treatment group and quartile of the distribution of baseline PASI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian process model -------------------------------------</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gp_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>gp_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  gp_formula,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>gp_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  gp_formula,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> gp_prior,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 34.2 seconds.
Chain 2 finished in 38.5 seconds.
Chain 3 finished in 36.1 seconds.
Chain 4 finished in 38.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 36.8 seconds.
Total execution time: 147.9 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 10 of 4000 (0.0%) transitions ended with a divergence.
See https://mc-stan.org/misc/warnings for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear mean model -------------------------------------</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>lm_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>lm_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  lm_formula,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  lm_formula,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> lm_prior,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 6.9 seconds.
Chain 2 finished in 7.3 seconds.
Chain 3 finished in 6.7 seconds.
Chain 4 finished in 6.9 seconds.

All 4 chains finished successfully.
Mean chain execution time: 7.0 seconds.
Total execution time: 28.5 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>base_quartiles <span class="ot">&lt;-</span> pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, BASE) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(BASE) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>quartile_center <span class="ot">&lt;-</span> (base_quartiles[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">+</span> base_quartiles[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>full_newdata <span class="ot">&lt;-</span> pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, BASE) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">base_catn =</span> <span class="fu">as.numeric</span>(<span class="fu">cut</span>(BASE, base_quartiles)),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">base_cat =</span> <span class="fu">paste</span>(<span class="st">"Baseline PASI quartile"</span>, base_catn),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">BASE =</span> quartile_center[base_catn])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>pp_checks <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(full_newdata, full_newdata<span class="sc">$</span>base_catn),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(nd){</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">pp_check</span>(gp_fit, <span class="at">type =</span> <span class="st">"ribbon_grouped"</span>, <span class="at">group =</span> <span class="st">"TRT01P"</span>, <span class="at">x =</span> <span class="st">"AVISITN"</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> <span class="fu">inner_join</span>(nd, <span class="fu">select</span>(pasi_data, <span class="sc">-</span>BASE), <span class="st">"SUBJID"</span>, <span class="at">multiple =</span> <span class="st">"all"</span>),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y_draw =</span> <span class="st">"points"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weeks post baseline"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Week 12 PASI change from baseline"</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Quartile"</span>, <span class="fu">unique</span>(nd<span class="sc">$</span>base_catn), <span class="st">"of Baseline PASI"</span>)) <span class="sc">+</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    p2 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">pp_check</span>(lm_fit, <span class="at">type =</span> <span class="st">"ribbon_grouped"</span>, <span class="at">group =</span> <span class="st">"TRT01P"</span>, <span class="at">x =</span> <span class="st">"AVISITN"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> <span class="fu">inner_join</span>(nd, <span class="fu">select</span>(pasi_data, <span class="sc">-</span>BASE), <span class="st">"SUBJID"</span>, <span class="at">multiple =</span> <span class="st">"all"</span>),</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y_draw =</span> <span class="st">"points"</span>) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weeks post baseline"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Week 12 PASI change from baseline"</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Quartile"</span>, <span class="fu">unique</span>(nd<span class="sc">$</span>base_catn), <span class="st">"of Baseline PASI"</span>)) <span class="sc">+</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp =</span> p1,</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">lm =</span> p2</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'ribbon_grouped' by default.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.
Using all posterior draws for ppc type 'ribbon_grouped' by default.</code></pre>
</div>
</div>
<p>Now we visualize the posterior predictive distribution against the observed data, first for the <em>Gaussian process</em> model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pp_checks[[<span class="dv">1</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">2</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">3</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">4</span>]]<span class="sc">$</span>gp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/gp_pp-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>and next for the <em>linear-in-time</em> model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pp_checks[[<span class="dv">1</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">2</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">3</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">4</span>]]<span class="sc">$</span>lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/lm_pp-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Another useful visualization for assessing model involves approximate leave-one-out (LOO) cross-validation techniques.</p>
<p>One can numerically compare the approximate expected log predictive density (ELPD) for holdout observations using <code>loo_compare</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>loo_gp <span class="ot">&lt;-</span> <span class="fu">loo</span>(gp_fit)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>loo_lm <span class="ot">&lt;-</span> <span class="fu">loo</span>(lm_fit)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo_gp, loo_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       elpd_diff se_diff
gp_fit   0.0       0.0  
lm_fit -20.8       5.2  </code></pre>
</div>
</div>
<p>This suggests the Gaussian-process based model has a superior model fit.</p>
<p>To visualize the predictive densities versus observed values, <code>pp_check()</code> with type <code>"loo_pit"</code>. In these visualizations, the observed outcomes are compared with their respective leave-one-out predictive distributions using the probability integral transformation (PIT). In an ideal model fit, the resulting PIT-transformed values would be uniformly distributed: i.e.&nbsp;the blue points and dashed lines would align with the distribution function of a Uniform(0,1) variable (solid line).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gp_loo <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(gp_fit, <span class="at">type =</span> <span class="st">"loo_pit_qq"</span>) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"LOO PIT: GP model"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lm_loo <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(lm_fit, <span class="at">type =</span> <span class="st">"loo_pit_qq"</span>) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"LOO PIT: linear-in-time model"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>gp_loo <span class="sc">+</span> lm_loo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02g_longitudinal_files/figure-html/plot_loo_pit-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">12.5</span> Exercises</h2>
<ol type="1">
<li>Using <code>brms</code>, fit a cross-sectional (non longitudinal) logistic regression model to the binary PASI 75 endpoint at Week 12. The only covariate term should be the treatment effect. Use the following analysis data (which uses only the Week 12 outcomes, and uses nonresponder imputation for any missing outcomes at Week 12). Use the <code>emmeans</code> package and function to estimate the marginal mean Week 12 response rates by treatment. Use <code>emmeans::contrast</code> to estimate the treatment-vs-control contrasts in response rates.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>adpasi <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"longitudinal.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(TRT01P <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">paste</span>(<span class="st">"Week"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P =</span> <span class="fu">factor</span>(TRT01P, <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>analysis_data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, NRFL, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(AVAL <span class="sc">~</span> TRT01P, <span class="at">family =</span> <span class="fu">bernoulli</span>(), <span class="at">data =</span> analysis_data1,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>emm1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit1, <span class="fu">c</span>(<span class="st">"TRT01P"</span>), <span class="at">transform =</span> <span class="st">"response"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>emm1</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm1, <span class="at">method =</span> <span class="st">"revpairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Fit a longitudinal model to the binary PASI 75 endpoint. Use a Gaussian process prior (stratified by treatment arm) for the mean across weeks and an AR(1) process to model autocorrelation in the residuals. Use the following analysis data (in which any missing assessments are not imputed). Use the <code>emmeans</code> package and function to estimate the marginal mean response rates by treatment and visit. Use <code>emmeans::contrast</code> to estimate the treatment-vs-control contrasts in response rates by visit. How does the inference for Week 12 response rate difference compare to the cross-sectional model fit from 1?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>analysis_data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, <span class="sc">!</span>MISSFL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    AVAL <span class="sc">~</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data2,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>emm2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit2, <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISITN"</span>), <span class="at">cov.keep =</span> <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISITN"</span>), <span class="at">nesting =</span> <span class="fu">list</span>(<span class="st">"AVISTN"</span> <span class="ot">=</span> <span class="st">"AVISIT"</span>), <span class="at">transform =</span> <span class="st">"response"</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>emm2</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm2, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"AVISITN"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Use Leave-One-Out cross validation to compare the model fits to the observed Week 12 data. (Hint: use <code>loo(fit, newdata = newdata)</code> with the below choice of newdata, then use <code>loo_compare</code>). Which model has better predictive power?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, <span class="sc">!</span>MISSFL, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit1, <span class="at">newdata =</span> newdata)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>loo2 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit2, <span class="at">newdata =</span> newdata)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo1, loo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>(Advanced) In this exercise, we will use a model fit to the continuous PASI change from baseline to do inference on the binary 75 response rate. First, fit a GP-based model to the PASI endpoint using the following code:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pasi_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pasi_data,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, create two sets of covariate values that includes “counterfactuals” for each patient as if they received both treatment and control. The following code is convenient:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>x_treatment <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">filter</span>(pasi_data, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>),</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">TRT01P =</span> <span class="fu">factor</span>(<span class="st">"TRT"</span>, <span class="fu">levels</span>(pasi_data<span class="sc">$</span>TRT01P)))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>x_control <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">filter</span>(pasi_data, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">TRT01P =</span> <span class="fu">factor</span>(<span class="st">"PBO"</span>, <span class="fu">levels</span>(pasi_data<span class="sc">$</span>TRT01P)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, for each of <code>x_treatment</code> and <code>x_control</code>:</p>
<ul>
<li>use <code>posterior_predict</code> using the <code>newdata</code> argument to sample from the posterior predictive distribution for PASI change from baseline at each level <code>x_treatment</code> and <code>x_control</code>, respectively. The result of <code>posterior_predict</code> whose columns are posterior predictions of PASI change from baseline for individual patients.</li>
<li>Divide these predictions by the baseline PASI for the respective patients to obtain predictive draws for PASI % change from baseline.</li>
<li>Convert the result to binary indicators of PASI % change from baseline being below <span class="math inline">\(-75\%\)</span>.</li>
<li>For each MCMC iteration, compute the percentage of responders to obtain a vector of posterior draws for the marginal mean response rates for <code>x_treatment</code> and <code>x_control</code>, respectively.</li>
<li>How do the median and credible intervals for the marginal mean response rates compare to the results of <code>emmeans</code> from exercises 1 and 2?</li>
<li>Graph the posterior density for the difference in marginal mean response rates for treatment minus control.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted change from baseline</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pasi_chg_treatment <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(pasi_fit, <span class="at">newdata =</span> x_treatment)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>pasi_chg_control <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(pasi_fit, <span class="at">newdata =</span> x_control)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted % change from baseline</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>pasi_pchg_treatment <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pasi_chg_treatment, <span class="dv">2</span>, x_treatment<span class="sc">$</span>BASE, <span class="st">'/'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>pasi_pchg_control <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pasi_chg_control, <span class="dv">2</span>, x_control<span class="sc">$</span>BASE, <span class="st">'/'</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted PASI 75 response</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>pasi_rr_treatment <span class="ot">&lt;-</span> pasi_pchg_treatment <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.75</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>pasi_rr_control <span class="ot">&lt;-</span> pasi_pchg_control <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.75</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal PASI 75 response rates</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>marginal_rr_treatment <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(pasi_rr_treatment)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>marginal_rr_control <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(pasi_rr_control)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="co"># How do the median and credible intervals compare to emm1 and emm2?</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">cbind</span>(<span class="at">trt =</span> marginal_rr_treatment,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">ctrl =</span> marginal_rr_control), <span class="dv">2</span>, median)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>coda<span class="sc">::</span><span class="fu">HPDinterval</span>(coda<span class="sc">::</span><span class="fu">as.mcmc</span>(<span class="fu">cbind</span>(<span class="at">trt =</span> marginal_rr_treatment,</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">ctrl =</span> marginal_rr_control)))</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>emm1</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>emm2</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize posterior distribution for marginal mean response rates by treatment</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">cbind</span>(marginal_rr_control, marginal_rr_treatment),</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="st">"control"</span>, <span class="fu">length</span>(marginal_rr_treatment)),</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rep</span>(<span class="st">"treatment"</span>, <span class="fu">length</span>(marginal_rr_treatment))),</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="st">"control"</span>, <span class="fu">length</span>(marginal_rr_treatment)),</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rep</span>(<span class="st">"treatment"</span>, <span class="fu">length</span>(marginal_rr_treatment))),</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"density"</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Marginal mean response rate"</span>,</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Posterior density"</span>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize posterior distribution for difference in response rates</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> marginal_rr_treatment <span class="sc">-</span> marginal_rr_control,</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"density"</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference in marginal mean response rate"</span>,</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Posterior density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02e_multiple_imputation.html" class="pagination-link" aria-label="Multiple imputation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/02h_mmrm.html" class="pagination-link" aria-label="Bayesian Mixed effects Model for Repeated Measures">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Andrew Bean - &lt;andrew.bean@novartis.com&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Longitudinal data {#sec-longitudinal-data}</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>Many clinical trials assess efficacy and other endpoints at numerous timepoints post-baseline. For example, consider the case where a continuous response endpoint is assessed every 2 weeks post baseline (Week 2, Week 4, ..., Week 12). Although clinical interest may focus on the response rate at a particular visit (e.g. at Week 12), efficacy data at other visits is of course still of interest, either in its own right, to build understanding of the full time vs. efficacy profile, or as a means to increase statistical power for estimation at Week 12.</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>There are multiple approaches for proceeding with estimation of the Week 12 treatment effect. Adopting a *cross-sectional approach* , one could ignoring all other post-baseline assessments except Week 12. If certain patients missed the Week 12 assessment, this missing data would need to be handled using an appropriate pre-defined strategy (e.g. for response rate endpoints, imputing missing outcomes with nonresponder status, carrying the last observation forward, multiple imputation approaches, or even dropping missing data altogether). Such approaches may lose signifcant power or incur bias if there is substantial missing data.</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>Alternatively *longitudinal models* incorporate the full post-baseline set of assessments to facilitate modeling of efficacy at all visits. In some cases, these may substantially increase statistical power.</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>The <span class="in">`brms`</span> package contains a deep suite of modelling tools for longitudinal data, including many options for modelling the mean trajectory across visits/time, and for modelling autocorrelated errors within patients across time. In this section we illustrate some potential uses of these tools in a clinical trial setting.</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="dummy"}</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview Video</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>{{&lt; video videos/brms-case-3-longitudinal-data.mp4 &gt;}}</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE}</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8904568</span>)</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>)</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE, eval=TRUE}</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible to the reader additional setup steps, which are optional</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="co"># {{&lt; include setup.R &gt;}}</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"setup.R"</span>)</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_data, echo = TRUE}</span></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>adpasi <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"longitudinal.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(TRT01P <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">paste</span>(<span class="st">"Week"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))),</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P =</span> <span class="fu">factor</span>(TRT01P, <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)))</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>)</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>The example involves simulated results of a hypothetical Phase-II study of an experimental treatment for Psoriasis. Synthetic data are generated using the <span class="in">`mmrm`</span> package. We consider a subset of the study involving 100 patients, 50 of whom were randomized to receive placebo, and 50 of whom received treatment. </span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>Efficacy was assessed using the Psoriasis Area and Severity Index (PASI), a numerical score which measures the severity and extent of psoriasis. This is assessed at baseline, and again at 7 post-baseline timepoints.</span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_pasi, echo = FALSE, fig.width = 10, fig.height = 10/1.62, echo = FALSE}</span></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>adp_with_base <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>  adpasi <span class="sc">%&gt;%</span></span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(SUBJID, TRT01P, AVISIT, AVAL, PCHG),</span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a>  adpasi <span class="sc">%&gt;%</span></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(SUBJID, TRT01P, <span class="at">AVISIT =</span> <span class="st">"Baseline"</span>, <span class="at">AVAL =</span> BASE, <span class="at">PCHG =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="fu">levels</span>(adpasi<span class="sc">$</span>AVISIT))))</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(adp_with_base,</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> TRT01P, <span class="at">y =</span> AVAL, <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> AVISIT) <span class="sc">+</span></span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"PASI score"</span>, <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Boxplots of PASI score by treatment group and visit"</span>) <span class="sc">+</span></span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">"Treatment group"</span>) <span class="sc">+</span></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>Two endpoints of interest based on the PASI score are (1) PASI change from baseline, and (2) the binary endpoint PASI 75, which defines a responder as any patient with at least a 75% change from baseline in PASI. </span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_pasi75, echo = FALSE, fig.width = 10, fig.height = 7}</span></span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> adpasi <span class="sc">%&gt;%</span></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, TRT01P) <span class="sc">%&gt;%</span></span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(TRT01P, <span class="at">name =</span> <span class="st">"N"</span>)</span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> adp_with_base <span class="sc">%&gt;%</span></span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(SUBJID, TRT01P, AVISIT, <span class="at">AVAL =</span> PCHG) <span class="sc">%&gt;%</span></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(SUBJID, AVISIT) <span class="sc">%&gt;%</span></span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">y =</span> AVAL, <span class="at">color =</span> TRT01P, <span class="at">group =</span> SUBJID)) <span class="sc">+</span></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"PASI %</span><span class="sc">\n</span><span class="st">change from baseline"</span>) <span class="sc">+</span></span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">0.75</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> adpasi <span class="sc">%&gt;%</span></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, NRFL, AVAL <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="fu">levels</span>(adpasi<span class="sc">$</span>AVISIT)))) <span class="sc">%&gt;%</span></span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(TRT01P, AVISIT) <span class="sc">%&gt;%</span></span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(TRT01P, AVISIT, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(N, <span class="st">"TRT01P"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">y =</span> n <span class="sc">/</span> N, <span class="at">group =</span> TRT01P, <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"PASI 75 response rate</span><span class="sc">\n</span><span class="st">(Nonresponder imputation)"</span>) <span class="sc">+</span></span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">"Treatment group"</span>) <span class="sc">+</span></span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a>The data has been transformed to follow a typical CDISC Analysis Data Model (ADaM) format.</span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a>There are a few key ingredients to a longitudinal model for the PASI score outcomes.</span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A *mean model* which describes the expected value of the response over time, across treatments, and across values of any other relevant covariates.</span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A *correlation model* which describes the correlation structure of the error terms.</span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> offers many modelling options for each component.</span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean models</span></span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cell-means model</span></span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a>The most common approach for modeling the mean in clinical trial practice is to adopt a specification which allows the mean to vary freely across visits, without any parametric specification of the trajectory of the mean over time. Here we will call this the "cell-means" model, where levels of the treatment group and visit comprise the cells.</span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a>In this approach, we include all treatment-by-visit interactions. In <span class="in">`brms`</span>, the formula specification would be:</span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cell_means_formula, echo = FALSE}</span></span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a>CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT</span>
<span id="cb51-152"><a href="#cb51-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Linear-in-time model</span></span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a>A far stronger assumption would be to assume the mean response is linear in time (i.e. the number of weeks post baseline for visit). In this case, the formula specification would be</span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r linear_formula, echo = FALSE}</span></span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a>CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN</span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a>Note the key difference is the use of <span class="in">`AVISITN`</span> (a numeric variable indicating the number of weeks post baseline) rather than <span class="in">`AVISIT`</span> (a factor variable for the visit id).</span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a>Such a model should be considered only for exploratory modelling purposes, and not for confirmatory analyses, the main reason being that the linearity assumption cannot be assessed at the trial design stage before having collected the data.</span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a>Even if the linearity assumption appeared reasonable over the time range explored in the trial, it should not be used to extrapolate outside the observed time period.</span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Quadratic-in-time model</span></span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a>In the previous section, we saw there was a hint of curvature in the sample mean response over time:</span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_curvature, fig.width = 6, fig.height = 6/1.62, echo = FALSE}</span></span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a>adp_with_base <span class="sc">%&gt;%</span></span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01P, AVISIT) <span class="sc">%&gt;%</span></span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">AVAL =</span> <span class="fu">mean</span>(PCHG), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">y =</span> AVAL, <span class="at">group =</span> TRT01P, <span class="at">color =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Treatment group"</span>) <span class="sc">+</span></span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Visit"</span>,</span>
<span id="cb51-182"><a href="#cb51-182" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PASI % change from baseline"</span>) <span class="sc">+</span></span>
<span id="cb51-183"><a href="#cb51-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a>Hence one might consider a mean model that assumes the mean response is quadratic in time rather than linear:</span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r quadratic_formula, echo = FALSE}</span></span>
<span id="cb51-190"><a href="#cb51-190" aria-hidden="true" tabindex="-1"></a>CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb51-191"><a href="#cb51-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-193"><a href="#cb51-193" aria-hidden="true" tabindex="-1"></a>This model should similarly not be used to extrapolate outside the week 1-12 window.</span>
<span id="cb51-194"><a href="#cb51-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-195"><a href="#cb51-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Gaussian process prior</span></span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-198"><a href="#cb51-198" aria-hidden="true" tabindex="-1"></a>An interesting nonparametric alternative to the just-discussed specifications is based on a Gaussian process prior for the mean across visits within treatments. As in the case of the cell-means model, this model does not assume any parametric shape for the mean response over time. It assumes only that the mean response over time follows a continuous curve which is assigned a Gaussian process (GP) prior.</span>
<span id="cb51-199"><a href="#cb51-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a>While the GP itself is a continuous-time process, the joint distribution of a realization at any discrete set of timepoints is multivariate normal. </span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a>In <span class="in">`brms`</span>, the formula specification would be as follows:</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gp_formula, echo = FALSE}</span></span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a>CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P)</span>
<span id="cb51-206"><a href="#cb51-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-207"><a href="#cb51-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a>The implication of this model is that there is a correlation between the mean response at any collection of visits, and the correlation between any pair of visits decays as the time between them increases, according to an exponential covariance function. See <span class="in">`?gp`</span> for additional details on the <span class="in">`brms`</span> implementation. </span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-210"><a href="#cb51-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlation models</span></span>
<span id="cb51-211"><a href="#cb51-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a>The repeated measurement of an endpoint over time on the same patient induces *autocorrelation* between the within-patient measurements. To illustrate, consider if we ignored the correlations and fit a model with uncorrelated errors. Below are scatterplots and correlation coefficients for the residuals of such a fitted model. The correlations are quite strong, especially between visits that are closer in time.</span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r corr_plot, echo = TRUE, message = FALSE, warning = FALSE}</span></span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>)</span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT, <span class="at">data =</span> pasi_data)</span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_fit)</span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a>pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> res) <span class="sc">%&gt;%</span></span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, AVISIT, res) <span class="sc">%&gt;%</span></span>
<span id="cb51-221"><a href="#cb51-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> SUBJID, <span class="at">names_from =</span> AVISIT, <span class="at">values_from =</span> res) <span class="sc">%&gt;%</span></span>
<span id="cb51-222"><a href="#cb51-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SUBJID) <span class="sc">%&gt;%</span></span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>()</span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a>Failing to model these within-subject correlations will result in a loss of statistical power (wider confidence intervals, less powerful tests). <span class="in">`brms`</span> offers several options for modelling within-subject correlations.</span>
<span id="cb51-227"><a href="#cb51-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-228"><a href="#cb51-228" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Subject-level random effects</span></span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a>One way to achieve within-subject correlation is to use a model that includes a subject-level random effect. When the resulting mean response function is averaged over the distribution of the random effect terms ("integrating them out"), a uniform correlation is induced between all measurements on the same patient. The magnitude of the correlation is determined by the relative size of the random-effect variance and the error variance. (See exercise 1.)</span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a>In <span class="in">`brms`</span>, a subject-level random intercept can be easily added in the formula specification. For example:</span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raneff, echo = FALSE}</span></span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a>CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> SUBJID)</span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Autoregressive correlation structures</span></span>
<span id="cb51-239"><a href="#cb51-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-240"><a href="#cb51-240" aria-hidden="true" tabindex="-1"></a>A very common model for serial correlation is based on an *autoregressive process*. Under such a process, the error term $\varepsilon_t$ at a timepoint $t$ is explicitly dependent on some collection of preceeding error terms. Under a first-order autoregressive process, for example, it is dependent only on one of its predecessors:</span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a>$$ \varepsilon_t = \alpha\varepsilon_{t-1} + Z_t,$$</span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a>for $t\geq 2$, where $Z_t$ are iid $\mathrm N(0, \sigma^2)$. The process is initialized with $\varepsilon_1 \sim \mathrm N(0, \sigma^2 / (1 - \alpha^2))$.</span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a>The resulting covariance matrix of a collection $(\varepsilon_1,\ldots,\varepsilon_T)$ has a simple form; the reader is referred to the SAS paper <span class="co">[</span><span class="ot">"Guidelines for Selecting the Covariance Structure in Mixed Model Analysis" by Chuck Kincaid</span><span class="co">](https://support.sas.com/resources/papers/proceedings/proceedings/sugi30/198-30.pdf)</span> for detail on the AR structure (c.f. page 2), and other covariance structures.</span>
<span id="cb51-245"><a href="#cb51-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-246"><a href="#cb51-246" aria-hidden="true" tabindex="-1"></a>The <span class="in">`autocor`</span> argument of <span class="in">`brm()`</span> and <span class="in">`brmsformula()`</span> is used to set an autoregressive correlation strucutre. For order-1 autoregressive. Below is a choice of AR(1) autocorrelation that we might consider in the psoriasis example:</span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ar, echo = FALSE}</span></span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span> <span class="fu">ar</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID, <span class="at">p =</span> <span class="dv">1</span>)</span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a>This choice implies that autocorrelation exists across visits within subjects.</span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-254"><a href="#cb51-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-255"><a href="#cb51-255" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Compound symmetry</span></span>
<span id="cb51-256"><a href="#cb51-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-257"><a href="#cb51-257" aria-hidden="true" tabindex="-1"></a>Another choice offered by <span class="in">`brms`</span> is that of compound symmetry. The reader is again referred to the SAS paper linked above and <span class="in">`?cosy`</span> for more information.</span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cosy, echo = FALSE}</span></span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a><span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Other choices</span></span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> offers several other choices for autocorrelation models. See <span class="in">`?'autocor-terms'`</span> for more a listing.</span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-267"><a href="#cb51-267" aria-hidden="true" tabindex="-1"></a>We note that currently, *unstructured* correlation models (a standard choice for MMRM specifications in clinical trial protocols) re not supported by <span class="in">`brms`</span>. </span>
<span id="cb51-268"><a href="#cb51-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a>However, fixed correlation structures are, and one could consider plugging in for this an unstructured correlation estimate from a frequentist MMRM. For example,</span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gls_fit, echo = TRUE}</span></span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a MMRM using gls</span></span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a>gls_fit <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">gls</span>(CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT,</span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pasi_data,</span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a>                     <span class="at">correlation =</span> nlme<span class="sc">::</span><span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> SUBJID))</span>
<span id="cb51-276"><a href="#cb51-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-277"><a href="#cb51-277" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated correlation matrices by subject</span></span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a>Sig_subj <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">corMatrix</span>(gls_fit<span class="sc">$</span>modelStruct[[<span class="dv">1</span>]])</span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a>Sig_subj[<span class="dv">1</span>]</span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a>A block-diagonal matrix containing these estimated within-subject correlations could be plugged in as the <span class="in">`M`</span> argument of the <span class="in">`fcor()`</span> function in <span class="in">`brms`</span>.</span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-sectional approaches</span></span>
<span id="cb51-285"><a href="#cb51-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-286"><a href="#cb51-286" aria-hidden="true" tabindex="-1"></a>For modeling a continuous endpoint such as PASI, the cross-sectional analogue of the longitudinal models we've discussed is the *ANCOVA* model, in which a linear regression model (conditioning as before on the baseline PASI covariate) is fit to the Week-12 cross section of data. </span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ancova_syntax, echo = TRUE, eval = FALSE, message = FALSE}</span></span>
<span id="cb51-289"><a href="#cb51-289" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis data includes only the Week 12 cross section</span></span>
<span id="cb51-290"><a href="#cb51-290" aria-hidden="true" tabindex="-1"></a>ancova_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL, AVISITN <span class="sc">==</span> <span class="dv">12</span>)</span>
<span id="cb51-291"><a href="#cb51-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-292"><a href="#cb51-292" aria-hidden="true" tabindex="-1"></a><span class="co"># formula specification for ANCOVA</span></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a>ancova_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P,</span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-299"><a href="#cb51-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-300"><a href="#cb51-300" aria-hidden="true" tabindex="-1"></a>ancova_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a>  ancova_formula,</span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ancova_data</span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a>ancova_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-306"><a href="#cb51-306" aria-hidden="true" tabindex="-1"></a>  ancova_formula,</span>
<span id="cb51-307"><a href="#cb51-307" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> ancova_prior,</span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ancova_data,</span>
<span id="cb51-309"><a href="#cb51-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb51-310"><a href="#cb51-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-315"><a href="#cb51-315" aria-hidden="true" tabindex="-1"></a>In the next section, this model is also explored for the purposes of comparing to the longitudinal approaches</span>
<span id="cb51-316"><a href="#cb51-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a>A typical estimand for longitudinal or ANCOVA involve Least Squares means (LS means) or estimated marginal means (EMM). Inference for EMMs is extremely convenient with <span class="in">`brms`</span> due to its integration with the <span class="in">`emmeans`</span> R package. The EMM can be roughly understood as the average, stratified by treatment group and visit, of the mean prediction across subjects in the trial.</span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a>We begin by briefly illustrating how <span class="in">`emmeans`</span> can be used with a <span class="in">`brmsfit`</span> object to estimate LS means and their contrasts. </span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cell_mean_example, echo = TRUE, message = FALSE}</span></span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a>analysis_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PASITSCO"</span>, DROPFL)</span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a>brms_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb51-327"><a href="#cb51-327" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISIT,</span>
<span id="cb51-328"><a href="#cb51-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb51-332"><a href="#cb51-332" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-333"><a href="#cb51-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a>  brms_formula,</span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a>  brms_formula,</span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior,</span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb51-349"><a href="#cb51-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-350"><a href="#cb51-350" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the EMMs</span></span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit, <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISIT"</span>), <span class="at">nesting =</span> <span class="fu">list</span>())</span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a>emm</span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate EMM contrasts</span></span>
<span id="cb51-355"><a href="#cb51-355" aria-hidden="true" tabindex="-1"></a>emm_contrasts <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"AVISIT"</span>)</span>
<span id="cb51-356"><a href="#cb51-356" aria-hidden="true" tabindex="-1"></a>emm_contrasts</span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-359"><a href="#cb51-359" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting several models</span></span>
<span id="cb51-360"><a href="#cb51-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a>In order to understand the impact of possible choices for the mean model </span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a>and correlation model, we fit a series of models in loop.</span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a>Code to prepare a list of models to be fit:</span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup_analyses}</span></span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: !expr '!file.exists(here::here("reports/longitudinal_fits.rds"))'</span></span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: FALSE</span></span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: FALSE</span></span>
<span id="cb51-371"><a href="#cb51-371" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-372"><a href="#cb51-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| file: !expr 'here::here("src/longitudinal/setup_analyses.R")'</span></span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a>Code to fit the models in a loop using <span class="in">`clustermq`</span>:</span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_models}</span></span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: !expr '!file.exists(here::here("reports/longitudinal_fits.rds"))'</span></span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: FALSE</span></span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: FALSE</span></span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-384"><a href="#cb51-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| file: !expr 'here::here("src/longitudinal/fit_models.R")'</span></span>
<span id="cb51-385"><a href="#cb51-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-388"><a href="#cb51-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_fits}</span></span>
<span id="cb51-389"><a href="#cb51-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: !expr '!exists("analyses")'</span></span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: FALSE</span></span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a>analyses <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"reports"</span>, <span class="st">"longitudinal_analyses.rds"</span>))</span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a>analyses<span class="sc">$</span>emm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"reports"</span>, <span class="st">"longitudinal_fits.rds"</span>))</span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a>analyses <span class="ot">&lt;-</span> <span class="fu">filter</span>(analyses, endpoint <span class="sc">==</span> <span class="st">"PASI"</span>)</span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### PASI change from baseline: EMMs by visit</span></span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r emm_by_visit, echo = FALSE, fig.width = 14, fig.height = 9}</span></span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a>emm_results <span class="ot">&lt;-</span> analyses <span class="sc">%&gt;%</span></span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(formula_name, autocor_name, emm) <span class="sc">%&gt;%</span></span>
<span id="cb51-403"><a href="#cb51-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(emm) <span class="sc">%&gt;%</span></span>
<span id="cb51-404"><a href="#cb51-404" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(TRT01P)) <span class="sc">%&gt;%</span></span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">formula_name =</span> <span class="fu">factor</span>(formula_name, <span class="fu">unique</span>(formula_name)),</span>
<span id="cb51-406"><a href="#cb51-406" aria-hidden="true" tabindex="-1"></a>         <span class="at">autocor_name =</span> <span class="fu">factor</span>(autocor_name, <span class="fu">unique</span>(autocor_name))) <span class="sc">%&gt;%</span></span>
<span id="cb51-407"><a href="#cb51-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_model =</span> formula_name,</span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">corr_model =</span> autocor_name</span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a>blank <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">slice</span>(<span class="fu">group_by</span>(emm_results, mean_model, corr_model), <span class="dv">1</span>), <span class="at">emmean =</span> <span class="dv">0</span>)</span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> emm_results,</span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">group =</span> TRT01P, <span class="at">color =</span> TRT01P,</span>
<span id="cb51-417"><a href="#cb51-417" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> median, <span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95)</span>
<span id="cb51-418"><a href="#cb51-418" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Visit"</span>, <span class="at">y =</span> <span class="st">"PASI score change from baseline</span><span class="sc">\n</span><span class="st">Estimated Marginal Mean"</span>) <span class="sc">+</span></span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_blank</span>(<span class="at">data =</span> blank) <span class="sc">+</span></span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(mean_model <span class="sc">~</span> corr_model, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb51-424"><a href="#cb51-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Treatment group"</span>) <span class="sc">+</span></span>
<span id="cb51-425"><a href="#cb51-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-427"><a href="#cb51-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-428"><a href="#cb51-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a><span class="fu">### PASI change from baseline: EMM contrasts with placebo by visit</span></span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r emm_contrasts_by_visit, fig.width = 14, fig.height = 6}</span></span>
<span id="cb51-434"><a href="#cb51-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-435"><a href="#cb51-435" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> analyses <span class="sc">%&gt;%</span></span>
<span id="cb51-436"><a href="#cb51-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(formula_name, autocor_name, emm) <span class="sc">%&gt;%</span></span>
<span id="cb51-437"><a href="#cb51-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(emm) <span class="sc">%&gt;%</span></span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(contrast)) <span class="sc">%&gt;%</span></span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">formula_name =</span> <span class="fu">factor</span>(formula_name, <span class="fu">unique</span>(formula_name)),</span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a>         <span class="at">autocor_name =</span> <span class="fu">factor</span>(autocor_name, <span class="fu">unique</span>(autocor_name)),</span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a>         <span class="at">contrast =</span> <span class="fu">factor</span>(contrast, <span class="fu">unique</span>(contrast))) <span class="sc">%&gt;%</span></span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_model =</span> formula_name,</span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">corr_model =</span> autocor_name</span>
<span id="cb51-445"><a href="#cb51-445" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-446"><a href="#cb51-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a>blank <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">slice</span>(<span class="fu">group_by</span>(contrast_results, mean_model, corr_model), <span class="dv">1</span>), <span class="at">estimate =</span> <span class="dv">0</span>)</span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-449"><a href="#cb51-449" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb51-450"><a href="#cb51-450" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> contrast_results,</span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> AVISIT, <span class="at">group =</span> mean_model, <span class="at">color =</span> mean_model,</span>
<span id="cb51-452"><a href="#cb51-452" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> median, <span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95)</span>
<span id="cb51-453"><a href="#cb51-453" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Visit"</span>, <span class="at">y =</span> <span class="st">"PASI change from baseline</span><span class="sc">\n</span><span class="st">Treatment - Control</span><span class="sc">\n</span><span class="st">Difference in Estimated Marginal Means"</span>) <span class="sc">+</span></span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_blank</span>(<span class="at">data =</span> blank) <span class="sc">+</span></span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> corr_model, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">levels</span>(pasi_data<span class="sc">$</span>AVISIT)) <span class="sc">+</span></span>
<span id="cb51-460"><a href="#cb51-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Mean model"</span>) <span class="sc">+</span></span>
<span id="cb51-461"><a href="#cb51-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-462"><a href="#cb51-462" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-463"><a href="#cb51-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-464"><a href="#cb51-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-465"><a href="#cb51-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimates of Week 12 efficacy</span></span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wk12_compare, fig.width = 9, fig.height = 9 / 1.62}</span></span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="sc">%&gt;%</span></span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(AVISITN <span class="sc">==</span> <span class="dv">12</span>,</span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>mean_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"linear"</span>, <span class="st">"quadratic"</span>),</span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>         corr_model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"COSY"</span>, <span class="st">"none"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">paste</span>(<span class="st">"mean model:"</span>, mean_model, <span class="st">"</span><span class="sc">\n</span><span class="st">correlation model:"</span>, corr_model)) <span class="sc">%&gt;%</span></span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> median, <span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95)) <span class="sc">+</span></span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Modeling approach"</span>,</span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"PASI change from baseline</span><span class="sc">\n</span><span class="st">Treatment - Control</span><span class="sc">\n</span><span class="st">Difference in Estimated Marginal Means"</span>) <span class="sc">+</span></span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-479"><a href="#cb51-479" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-480"><a href="#cb51-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-481"><a href="#cb51-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-482"><a href="#cb51-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-483"><a href="#cb51-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assessing model fit</span></span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a>In this section we illustrate the use of side-by-side posterior predictive checks to compare the fit of two models: one with a GP prior for the mean structure and one with a linear-in-time model for the mean, each with compound-symmetric autocorration models.</span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a>The checks are done across timepoint (# of weeks since baseline), by treatment group and quartile of the distribution of baseline PASI.</span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gp_lm_comparison, eval = TRUE, echo = TRUE}</span></span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Gaussian process model -------------------------------------</span></span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a>gp_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb51-495"><a href="#cb51-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-496"><a href="#cb51-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a>gp_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a>  gp_formula,</span>
<span id="cb51-501"><a href="#cb51-501" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb51-502"><a href="#cb51-502" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a>gp_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a>  gp_formula,</span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> gp_prior,</span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear mean model -------------------------------------</span></span>
<span id="cb51-514"><a href="#cb51-514" aria-hidden="true" tabindex="-1"></a>lm_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb51-515"><a href="#cb51-515" aria-hidden="true" tabindex="-1"></a>  CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">*</span> AVISITN,</span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a>  <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID),</span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">FALSE</span></span>
<span id="cb51-520"><a href="#cb51-520" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-521"><a href="#cb51-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a>lm_prior <span class="ot">&lt;-</span> <span class="fu">get_prior</span>(</span>
<span id="cb51-523"><a href="#cb51-523" aria-hidden="true" tabindex="-1"></a>  lm_formula,</span>
<span id="cb51-524"><a href="#cb51-524" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data</span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-527"><a href="#cb51-527" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-528"><a href="#cb51-528" aria-hidden="true" tabindex="-1"></a>  lm_formula,</span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> lm_prior,</span>
<span id="cb51-530"><a href="#cb51-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data,</span>
<span id="cb51-531"><a href="#cb51-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">46474576</span>,</span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-535"><a href="#cb51-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-536"><a href="#cb51-536" aria-hidden="true" tabindex="-1"></a>base_quartiles <span class="ot">&lt;-</span> pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, BASE) <span class="sc">%&gt;%</span></span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(BASE) <span class="sc">%&gt;%</span></span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a>quartile_center <span class="ot">&lt;-</span> (base_quartiles[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">+</span> base_quartiles[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a>full_newdata <span class="ot">&lt;-</span> pasi_data <span class="sc">%&gt;%</span></span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SUBJID, BASE) <span class="sc">%&gt;%</span></span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">base_catn =</span> <span class="fu">as.numeric</span>(<span class="fu">cut</span>(BASE, base_quartiles)),</span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a>         <span class="at">base_cat =</span> <span class="fu">paste</span>(<span class="st">"Baseline PASI quartile"</span>, base_catn),</span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a>         <span class="at">BASE =</span> quartile_center[base_catn])</span>
<span id="cb51-550"><a href="#cb51-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-551"><a href="#cb51-551" aria-hidden="true" tabindex="-1"></a>pp_checks <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb51-552"><a href="#cb51-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(full_newdata, full_newdata<span class="sc">$</span>base_catn),</span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(nd){</span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">pp_check</span>(gp_fit, <span class="at">type =</span> <span class="st">"ribbon_grouped"</span>, <span class="at">group =</span> <span class="st">"TRT01P"</span>, <span class="at">x =</span> <span class="st">"AVISITN"</span>,</span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> <span class="fu">inner_join</span>(nd, <span class="fu">select</span>(pasi_data, <span class="sc">-</span>BASE), <span class="st">"SUBJID"</span>, <span class="at">multiple =</span> <span class="st">"all"</span>),</span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y_draw =</span> <span class="st">"points"</span>) <span class="sc">+</span></span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weeks post baseline"</span>,</span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Week 12 PASI change from baseline"</span>,</span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Quartile"</span>, <span class="fu">unique</span>(nd<span class="sc">$</span>base_catn), <span class="st">"of Baseline PASI"</span>)) <span class="sc">+</span></span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>)</span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-564"><a href="#cb51-564" aria-hidden="true" tabindex="-1"></a>    p2 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">pp_check</span>(lm_fit, <span class="at">type =</span> <span class="st">"ribbon_grouped"</span>, <span class="at">group =</span> <span class="st">"TRT01P"</span>, <span class="at">x =</span> <span class="st">"AVISITN"</span>,</span>
<span id="cb51-565"><a href="#cb51-565" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> <span class="fu">inner_join</span>(nd, <span class="fu">select</span>(pasi_data, <span class="sc">-</span>BASE), <span class="st">"SUBJID"</span>, <span class="at">multiple =</span> <span class="st">"all"</span>),</span>
<span id="cb51-566"><a href="#cb51-566" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y_draw =</span> <span class="st">"points"</span>) <span class="sc">+</span></span>
<span id="cb51-567"><a href="#cb51-567" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Weeks post baseline"</span>,</span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Week 12 PASI change from baseline"</span>,</span>
<span id="cb51-569"><a href="#cb51-569" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Quartile"</span>, <span class="fu">unique</span>(nd<span class="sc">$</span>base_catn), <span class="st">"of Baseline PASI"</span>)) <span class="sc">+</span></span>
<span id="cb51-570"><a href="#cb51-570" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">30</span>)</span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp =</span> p1,</span>
<span id="cb51-575"><a href="#cb51-575" aria-hidden="true" tabindex="-1"></a>      <span class="at">lm =</span> p2</span>
<span id="cb51-576"><a href="#cb51-576" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-580"><a href="#cb51-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-581"><a href="#cb51-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-582"><a href="#cb51-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-583"><a href="#cb51-583" aria-hidden="true" tabindex="-1"></a>Now we visualize the posterior predictive distribution against the</span>
<span id="cb51-584"><a href="#cb51-584" aria-hidden="true" tabindex="-1"></a>observed data, first for the *Gaussian process* model:</span>
<span id="cb51-585"><a href="#cb51-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-586"><a href="#cb51-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gp_pp, warning = FALSE, fig.height = 15, fig.width = 8}</span></span>
<span id="cb51-587"><a href="#cb51-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-588"><a href="#cb51-588" aria-hidden="true" tabindex="-1"></a>pp_checks[[<span class="dv">1</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">2</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">3</span>]]<span class="sc">$</span>gp <span class="sc">/</span> pp_checks[[<span class="dv">4</span>]]<span class="sc">$</span>gp</span>
<span id="cb51-589"><a href="#cb51-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-590"><a href="#cb51-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-591"><a href="#cb51-591" aria-hidden="true" tabindex="-1"></a>and next for the *linear-in-time* model:</span>
<span id="cb51-592"><a href="#cb51-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-593"><a href="#cb51-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm_pp, warning = FALSE, fig.height = 15, fig.width = 8}</span></span>
<span id="cb51-594"><a href="#cb51-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-595"><a href="#cb51-595" aria-hidden="true" tabindex="-1"></a>pp_checks[[<span class="dv">1</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">2</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">3</span>]]<span class="sc">$</span>lm <span class="sc">/</span> pp_checks[[<span class="dv">4</span>]]<span class="sc">$</span>lm</span>
<span id="cb51-596"><a href="#cb51-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-597"><a href="#cb51-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-598"><a href="#cb51-598" aria-hidden="true" tabindex="-1"></a>Another useful visualization for assessing model involves approximate</span>
<span id="cb51-599"><a href="#cb51-599" aria-hidden="true" tabindex="-1"></a>leave-one-out (LOO) cross-validation techniques.</span>
<span id="cb51-600"><a href="#cb51-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-601"><a href="#cb51-601" aria-hidden="true" tabindex="-1"></a>One can numerically compare the approximate expected log predictive</span>
<span id="cb51-602"><a href="#cb51-602" aria-hidden="true" tabindex="-1"></a>density (ELPD) for holdout observations using <span class="in">`loo_compare`</span>.</span>
<span id="cb51-603"><a href="#cb51-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-604"><a href="#cb51-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_comparison}</span></span>
<span id="cb51-605"><a href="#cb51-605" aria-hidden="true" tabindex="-1"></a>loo_gp <span class="ot">&lt;-</span> <span class="fu">loo</span>(gp_fit)</span>
<span id="cb51-606"><a href="#cb51-606" aria-hidden="true" tabindex="-1"></a>loo_lm <span class="ot">&lt;-</span> <span class="fu">loo</span>(lm_fit)</span>
<span id="cb51-607"><a href="#cb51-607" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo_gp, loo_lm)</span>
<span id="cb51-608"><a href="#cb51-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-609"><a href="#cb51-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-610"><a href="#cb51-610" aria-hidden="true" tabindex="-1"></a>This suggests the Gaussian-process based model has a superior model</span>
<span id="cb51-611"><a href="#cb51-611" aria-hidden="true" tabindex="-1"></a>fit.</span>
<span id="cb51-612"><a href="#cb51-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-613"><a href="#cb51-613" aria-hidden="true" tabindex="-1"></a>To visualize the predictive densities versus observed values,</span>
<span id="cb51-614"><a href="#cb51-614" aria-hidden="true" tabindex="-1"></a><span class="in">`pp_check()`</span> with type <span class="in">`"loo_pit"`</span>. In these visualizations, the</span>
<span id="cb51-615"><a href="#cb51-615" aria-hidden="true" tabindex="-1"></a>observed outcomes are compared with their respective leave-one-out</span>
<span id="cb51-616"><a href="#cb51-616" aria-hidden="true" tabindex="-1"></a>predictive distributions using the probability integral transformation</span>
<span id="cb51-617"><a href="#cb51-617" aria-hidden="true" tabindex="-1"></a>(PIT). In an ideal model fit, the resulting PIT-transformed values</span>
<span id="cb51-618"><a href="#cb51-618" aria-hidden="true" tabindex="-1"></a>would be uniformly distributed: i.e. the blue points and dashed lines</span>
<span id="cb51-619"><a href="#cb51-619" aria-hidden="true" tabindex="-1"></a>would align with the distribution function of a Uniform(0,1) variable</span>
<span id="cb51-620"><a href="#cb51-620" aria-hidden="true" tabindex="-1"></a>(solid line).</span>
<span id="cb51-621"><a href="#cb51-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-622"><a href="#cb51-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_loo_pit}</span></span>
<span id="cb51-623"><a href="#cb51-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: FALSE</span></span>
<span id="cb51-624"><a href="#cb51-624" aria-hidden="true" tabindex="-1"></a>gp_loo <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(gp_fit, <span class="at">type =</span> <span class="st">"loo_pit_qq"</span>) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"LOO PIT: GP model"</span>)</span>
<span id="cb51-625"><a href="#cb51-625" aria-hidden="true" tabindex="-1"></a>lm_loo <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(lm_fit, <span class="at">type =</span> <span class="st">"loo_pit_qq"</span>) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"LOO PIT: linear-in-time model"</span>)</span>
<span id="cb51-626"><a href="#cb51-626" aria-hidden="true" tabindex="-1"></a>gp_loo <span class="sc">+</span> lm_loo</span>
<span id="cb51-627"><a href="#cb51-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-628"><a href="#cb51-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-629"><a href="#cb51-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-630"><a href="#cb51-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-631"><a href="#cb51-631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb51-632"><a href="#cb51-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-633"><a href="#cb51-633" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Using <span class="in">`brms`</span>, fit a cross-sectional (non longitudinal) logistic regression model to the binary PASI 75 endpoint at Week 12. The only covariate term should be the treatment effect. Use the following analysis data (which uses only the Week 12 outcomes, and uses nonresponder imputation for any missing outcomes at Week 12). Use the <span class="in">`emmeans`</span> package and function to estimate the marginal mean Week 12 response rates by treatment. Use <span class="in">`emmeans::contrast`</span> to estimate the treatment-vs-control contrasts in response rates.</span>
<span id="cb51-634"><a href="#cb51-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-635"><a href="#cb51-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-636"><a href="#cb51-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ex1_data, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-637"><a href="#cb51-637" aria-hidden="true" tabindex="-1"></a>adpasi <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"longitudinal.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-638"><a href="#cb51-638" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(TRT01P <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-639"><a href="#cb51-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AVISIT =</span> <span class="fu">factor</span>(AVISIT, <span class="fu">paste</span>(<span class="st">"Week"</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)))),</span>
<span id="cb51-640"><a href="#cb51-640" aria-hidden="true" tabindex="-1"></a>         <span class="at">TRT01P =</span> <span class="fu">factor</span>(TRT01P, <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"TRT"</span>)))</span>
<span id="cb51-641"><a href="#cb51-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-642"><a href="#cb51-642" aria-hidden="true" tabindex="-1"></a>analysis_data1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, NRFL, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>)</span>
<span id="cb51-643"><a href="#cb51-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-644"><a href="#cb51-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-645"><a href="#cb51-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ex1_sol, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-646"><a href="#cb51-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-647"><a href="#cb51-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-648"><a href="#cb51-648" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb51-649"><a href="#cb51-649" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(AVAL <span class="sc">~</span> TRT01P, <span class="at">family =</span> <span class="fu">bernoulli</span>(), <span class="at">data =</span> analysis_data1,</span>
<span id="cb51-650"><a href="#cb51-650" aria-hidden="true" tabindex="-1"></a>            <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb51-651"><a href="#cb51-651" aria-hidden="true" tabindex="-1"></a>emm1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit1, <span class="fu">c</span>(<span class="st">"TRT01P"</span>), <span class="at">transform =</span> <span class="st">"response"</span>)</span>
<span id="cb51-652"><a href="#cb51-652" aria-hidden="true" tabindex="-1"></a>emm1</span>
<span id="cb51-653"><a href="#cb51-653" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm1, <span class="at">method =</span> <span class="st">"revpairwise"</span>)</span>
<span id="cb51-654"><a href="#cb51-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-655"><a href="#cb51-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-656"><a href="#cb51-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-657"><a href="#cb51-657" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Fit a longitudinal model to the binary PASI 75 endpoint. Use a Gaussian process prior (stratified by treatment arm) for the mean across weeks and an AR(1) process to model autocorrelation in the residuals. Use the following analysis data (in which any missing assessments are not imputed). Use the <span class="in">`emmeans`</span> package and function to estimate the marginal mean response rates by treatment and visit. Use <span class="in">`emmeans::contrast`</span> to estimate the treatment-vs-control contrasts in response rates by visit. How does the inference for Week 12 response rate difference compare to the cross-sectional model fit from 1?</span>
<span id="cb51-658"><a href="#cb51-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-659"><a href="#cb51-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-660"><a href="#cb51-660" aria-hidden="true" tabindex="-1"></a>analysis_data2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, <span class="sc">!</span>MISSFL)</span>
<span id="cb51-661"><a href="#cb51-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-662"><a href="#cb51-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-663"><a href="#cb51-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-664"><a href="#cb51-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-665"><a href="#cb51-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-666"><a href="#cb51-666" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb51-667"><a href="#cb51-667" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-668"><a href="#cb51-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb51-669"><a href="#cb51-669" aria-hidden="true" tabindex="-1"></a>    AVAL <span class="sc">~</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb51-670"><a href="#cb51-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb51-671"><a href="#cb51-671" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-672"><a href="#cb51-672" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data2,</span>
<span id="cb51-673"><a href="#cb51-673" aria-hidden="true" tabindex="-1"></a>  <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb51-674"><a href="#cb51-674" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb51-675"><a href="#cb51-675" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-676"><a href="#cb51-676" aria-hidden="true" tabindex="-1"></a>emm2 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit2, <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISITN"</span>), <span class="at">cov.keep =</span> <span class="fu">c</span>(<span class="st">"TRT01P"</span>, <span class="st">"AVISITN"</span>), <span class="at">nesting =</span> <span class="fu">list</span>(<span class="st">"AVISTN"</span> <span class="ot">=</span> <span class="st">"AVISIT"</span>), <span class="at">transform =</span> <span class="st">"response"</span>)</span>
<span id="cb51-677"><a href="#cb51-677" aria-hidden="true" tabindex="-1"></a>emm2</span>
<span id="cb51-678"><a href="#cb51-678" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm2, <span class="at">method =</span> <span class="st">"revpairwise"</span>, <span class="at">by =</span> <span class="st">"AVISITN"</span>)</span>
<span id="cb51-679"><a href="#cb51-679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-680"><a href="#cb51-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-681"><a href="#cb51-681" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use Leave-One-Out cross validation to compare the model fits to the observed Week 12 data. (Hint: use <span class="in">`loo(fit, newdata = newdata)`</span> with the below choice of newdata, then use <span class="in">`loo_compare`</span>). Which model has better predictive power?</span>
<span id="cb51-682"><a href="#cb51-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-683"><a href="#cb51-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-684"><a href="#cb51-684" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">filter</span>(adpasi, PARAMCD <span class="sc">==</span> <span class="st">"PSRS75"</span>, <span class="sc">!</span>MISSFL, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>)</span>
<span id="cb51-685"><a href="#cb51-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-686"><a href="#cb51-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-687"><a href="#cb51-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-688"><a href="#cb51-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-689"><a href="#cb51-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-690"><a href="#cb51-690" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb51-691"><a href="#cb51-691" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit1, <span class="at">newdata =</span> newdata)</span>
<span id="cb51-692"><a href="#cb51-692" aria-hidden="true" tabindex="-1"></a>loo2 <span class="ot">&lt;-</span> <span class="fu">loo</span>(fit2, <span class="at">newdata =</span> newdata)</span>
<span id="cb51-693"><a href="#cb51-693" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo1, loo2)</span>
<span id="cb51-694"><a href="#cb51-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-695"><a href="#cb51-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-696"><a href="#cb51-696" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>(Advanced) In this exercise, we will use a model fit to the continuous PASI change from baseline to do inference on the binary 75 response rate. First, fit a GP-based model to the PASI endpoint using the following code:</span>
<span id="cb51-697"><a href="#cb51-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-698"><a href="#cb51-698" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-699"><a href="#cb51-699" aria-hidden="true" tabindex="-1"></a>pasi_fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-700"><a href="#cb51-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb51-701"><a href="#cb51-701" aria-hidden="true" tabindex="-1"></a>    CHG <span class="sc">~</span> BASE <span class="sc">+</span> TRT01P <span class="sc">+</span> <span class="fu">gp</span>(AVISITN, <span class="at">by =</span> TRT01P),</span>
<span id="cb51-702"><a href="#cb51-702" aria-hidden="true" tabindex="-1"></a>    <span class="at">autocor =</span> <span class="sc">~</span> <span class="fu">cosy</span>(<span class="at">time =</span> AVISIT, <span class="at">gr =</span> SUBJID)</span>
<span id="cb51-703"><a href="#cb51-703" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-704"><a href="#cb51-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pasi_data,</span>
<span id="cb51-705"><a href="#cb51-705" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb51-706"><a href="#cb51-706" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-707"><a href="#cb51-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-708"><a href="#cb51-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-709"><a href="#cb51-709" aria-hidden="true" tabindex="-1"></a>Next, create two sets of covariate values that includes "counterfactuals" for each patient as if they received both treatment and control. The following code is convenient:</span>
<span id="cb51-710"><a href="#cb51-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-711"><a href="#cb51-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-712"><a href="#cb51-712" aria-hidden="true" tabindex="-1"></a>x_treatment <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">filter</span>(pasi_data, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>),</span>
<span id="cb51-713"><a href="#cb51-713" aria-hidden="true" tabindex="-1"></a>                      <span class="at">TRT01P =</span> <span class="fu">factor</span>(<span class="st">"TRT"</span>, <span class="fu">levels</span>(pasi_data<span class="sc">$</span>TRT01P)))</span>
<span id="cb51-714"><a href="#cb51-714" aria-hidden="true" tabindex="-1"></a>x_control <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">filter</span>(pasi_data, AVISIT <span class="sc">==</span> <span class="st">"Week 12"</span>),</span>
<span id="cb51-715"><a href="#cb51-715" aria-hidden="true" tabindex="-1"></a>                    <span class="at">TRT01P =</span> <span class="fu">factor</span>(<span class="st">"PBO"</span>, <span class="fu">levels</span>(pasi_data<span class="sc">$</span>TRT01P)))</span>
<span id="cb51-716"><a href="#cb51-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-717"><a href="#cb51-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-718"><a href="#cb51-718" aria-hidden="true" tabindex="-1"></a>Next, for each of <span class="in">`x_treatment`</span> and <span class="in">`x_control`</span>:</span>
<span id="cb51-719"><a href="#cb51-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-720"><a href="#cb51-720" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>use <span class="in">`posterior_predict`</span> using the <span class="in">`newdata`</span> argument to sample from the posterior predictive distribution for PASI change from baseline at each level <span class="in">`x_treatment`</span> and <span class="in">`x_control`</span>, respectively. The result of <span class="in">`posterior_predict`</span> whose columns are posterior predictions of PASI change from baseline for individual patients. </span>
<span id="cb51-721"><a href="#cb51-721" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Divide these predictions by the baseline PASI for the respective patients to obtain predictive draws for PASI % change from baseline. </span>
<span id="cb51-722"><a href="#cb51-722" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Convert the result to binary indicators of PASI % change from baseline being below $-75\%$.</span>
<span id="cb51-723"><a href="#cb51-723" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>For each MCMC iteration, compute the percentage of responders to obtain a vector of posterior draws for the marginal mean response rates for <span class="in">`x_treatment`</span> and <span class="in">`x_control`</span>, respectively. </span>
<span id="cb51-724"><a href="#cb51-724" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>How do the median and credible intervals for the marginal mean response rates compare to the results of <span class="in">`emmeans`</span> from exercises 1 and 2?</span>
<span id="cb51-725"><a href="#cb51-725" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Graph the posterior density for the difference in marginal mean response rates for treatment minus control. </span>
<span id="cb51-726"><a href="#cb51-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-727"><a href="#cb51-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = TRUE, eval = FALSE}</span></span>
<span id="cb51-728"><a href="#cb51-728" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb51-729"><a href="#cb51-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-730"><a href="#cb51-730" aria-hidden="true" tabindex="-1"></a><span class="co"># solution</span></span>
<span id="cb51-731"><a href="#cb51-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-732"><a href="#cb51-732" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted change from baseline</span></span>
<span id="cb51-733"><a href="#cb51-733" aria-hidden="true" tabindex="-1"></a>pasi_chg_treatment <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(pasi_fit, <span class="at">newdata =</span> x_treatment)</span>
<span id="cb51-734"><a href="#cb51-734" aria-hidden="true" tabindex="-1"></a>pasi_chg_control <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(pasi_fit, <span class="at">newdata =</span> x_control)</span>
<span id="cb51-735"><a href="#cb51-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-736"><a href="#cb51-736" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted % change from baseline</span></span>
<span id="cb51-737"><a href="#cb51-737" aria-hidden="true" tabindex="-1"></a>pasi_pchg_treatment <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pasi_chg_treatment, <span class="dv">2</span>, x_treatment<span class="sc">$</span>BASE, <span class="st">'/'</span>)</span>
<span id="cb51-738"><a href="#cb51-738" aria-hidden="true" tabindex="-1"></a>pasi_pchg_control <span class="ot">&lt;-</span> <span class="fu">sweep</span>(pasi_chg_control, <span class="dv">2</span>, x_control<span class="sc">$</span>BASE, <span class="st">'/'</span>)</span>
<span id="cb51-739"><a href="#cb51-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-740"><a href="#cb51-740" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted PASI 75 response</span></span>
<span id="cb51-741"><a href="#cb51-741" aria-hidden="true" tabindex="-1"></a>pasi_rr_treatment <span class="ot">&lt;-</span> pasi_pchg_treatment <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.75</span></span>
<span id="cb51-742"><a href="#cb51-742" aria-hidden="true" tabindex="-1"></a>pasi_rr_control <span class="ot">&lt;-</span> pasi_pchg_control <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.75</span></span>
<span id="cb51-743"><a href="#cb51-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-744"><a href="#cb51-744" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal PASI 75 response rates</span></span>
<span id="cb51-745"><a href="#cb51-745" aria-hidden="true" tabindex="-1"></a>marginal_rr_treatment <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(pasi_rr_treatment)</span>
<span id="cb51-746"><a href="#cb51-746" aria-hidden="true" tabindex="-1"></a>marginal_rr_control <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(pasi_rr_control)</span>
<span id="cb51-747"><a href="#cb51-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-748"><a href="#cb51-748" aria-hidden="true" tabindex="-1"></a><span class="co"># How do the median and credible intervals compare to emm1 and emm2?</span></span>
<span id="cb51-749"><a href="#cb51-749" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">cbind</span>(<span class="at">trt =</span> marginal_rr_treatment,</span>
<span id="cb51-750"><a href="#cb51-750" aria-hidden="true" tabindex="-1"></a>            <span class="at">ctrl =</span> marginal_rr_control), <span class="dv">2</span>, median)</span>
<span id="cb51-751"><a href="#cb51-751" aria-hidden="true" tabindex="-1"></a>coda<span class="sc">::</span><span class="fu">HPDinterval</span>(coda<span class="sc">::</span><span class="fu">as.mcmc</span>(<span class="fu">cbind</span>(<span class="at">trt =</span> marginal_rr_treatment,</span>
<span id="cb51-752"><a href="#cb51-752" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">ctrl =</span> marginal_rr_control)))</span>
<span id="cb51-753"><a href="#cb51-753" aria-hidden="true" tabindex="-1"></a>emm1</span>
<span id="cb51-754"><a href="#cb51-754" aria-hidden="true" tabindex="-1"></a>emm2</span>
<span id="cb51-755"><a href="#cb51-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-756"><a href="#cb51-756" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize posterior distribution for marginal mean response rates by treatment</span></span>
<span id="cb51-757"><a href="#cb51-757" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(</span>
<span id="cb51-758"><a href="#cb51-758" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">cbind</span>(marginal_rr_control, marginal_rr_treatment),</span>
<span id="cb51-759"><a href="#cb51-759" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="st">"control"</span>, <span class="fu">length</span>(marginal_rr_treatment)),</span>
<span id="cb51-760"><a href="#cb51-760" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rep</span>(<span class="st">"treatment"</span>, <span class="fu">length</span>(marginal_rr_treatment))),</span>
<span id="cb51-761"><a href="#cb51-761" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="st">"control"</span>, <span class="fu">length</span>(marginal_rr_treatment)),</span>
<span id="cb51-762"><a href="#cb51-762" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rep</span>(<span class="st">"treatment"</span>, <span class="fu">length</span>(marginal_rr_treatment))),</span>
<span id="cb51-763"><a href="#cb51-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"density"</span></span>
<span id="cb51-764"><a href="#cb51-764" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb51-765"><a href="#cb51-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Marginal mean response rate"</span>,</span>
<span id="cb51-766"><a href="#cb51-766" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Posterior density"</span>)</span>
<span id="cb51-767"><a href="#cb51-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-768"><a href="#cb51-768" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize posterior distribution for difference in response rates</span></span>
<span id="cb51-769"><a href="#cb51-769" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(</span>
<span id="cb51-770"><a href="#cb51-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> marginal_rr_treatment <span class="sc">-</span> marginal_rr_control,</span>
<span id="cb51-771"><a href="#cb51-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">"density"</span></span>
<span id="cb51-772"><a href="#cb51-772" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb51-773"><a href="#cb51-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference in marginal mean response rate"</span>,</span>
<span id="cb51-774"><a href="#cb51-774" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Posterior density"</span>)</span>
<span id="cb51-775"><a href="#cb51-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-776"><a href="#cb51-776" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>