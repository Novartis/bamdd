<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Björn Holzhauer - bjoern.holzhauer@novartis.com">
<meta name="author" content="Sebastian Weber - sebastian.weber@novartis.com">

<title>9&nbsp; Dose finding – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/02c_dose_escalation.html" rel="next">
<link href="../src/02l_single_arm_pos.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-211643d51178a3b3a2246e12448a6b35.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="../resources/mathjax/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02b_dose_finding.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Dose finding</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02m_proportion_difference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">configure here</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background-what-role-does-dose-response-modeling-play-in-drug-development" id="toc-background-what-role-does-dose-response-modeling-play-in-drug-development" class="nav-link active" data-scroll-target="#background-what-role-does-dose-response-modeling-play-in-drug-development"><span class="header-section-number">9.1</span> Background: What role does dose response modeling play in drug development?</a></li>
  <li><a href="#data-pathway-asthma-example" id="toc-data-pathway-asthma-example" class="nav-link" data-scroll-target="#data-pathway-asthma-example"><span class="header-section-number">9.2</span> Data: PATHWAY asthma example</a></li>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description"><span class="header-section-number">9.3</span> Model description</a>
  <ul class="collapse">
  <li><a href="#the-likelihood-function-into-which-we-put-the-dose-response-model" id="toc-the-likelihood-function-into-which-we-put-the-dose-response-model" class="nav-link" data-scroll-target="#the-likelihood-function-into-which-we-put-the-dose-response-model"><span class="header-section-number">9.3.1</span> The likelihood function into which we put the dose response model</a></li>
  <li><a href="#the-sigmoid-emax-and-the-emax-model" id="toc-the-sigmoid-emax-and-the-emax-model" class="nav-link" data-scroll-target="#the-sigmoid-emax-and-the-emax-model"><span class="header-section-number">9.3.2</span> The sigmoid-Emax and the Emax model</a></li>
  <li><a href="#the-modified-beta-model" id="toc-the-modified-beta-model" class="nav-link" data-scroll-target="#the-modified-beta-model"><span class="header-section-number">9.3.3</span> The modified beta model</a></li>
  <li><a href="#exponential-model-and-linear-and-quadratic-functions-of-dose-or-log-dose" id="toc-exponential-model-and-linear-and-quadratic-functions-of-dose-or-log-dose" class="nav-link" data-scroll-target="#exponential-model-and-linear-and-quadratic-functions-of-dose-or-log-dose"><span class="header-section-number">9.3.4</span> Exponential model, and linear and quadratic functions of dose or log-dose</a></li>
  <li><a href="#bayesian-model-averaging" id="toc-bayesian-model-averaging" class="nav-link" data-scroll-target="#bayesian-model-averaging"><span class="header-section-number">9.3.5</span> Bayesian Model averaging</a></li>
  </ul></li>
  <li><a href="#implementation-and-results" id="toc-implementation-and-results" class="nav-link" data-scroll-target="#implementation-and-results"><span class="header-section-number">9.4</span> Implementation and results</a>
  <ul class="collapse">
  <li><a href="#sigmoid-emax-model-with-brms" id="toc-sigmoid-emax-model-with-brms" class="nav-link" data-scroll-target="#sigmoid-emax-model-with-brms"><span class="header-section-number">9.4.1</span> Sigmoid-Emax model with <code>brms</code></a></li>
  <li><a href="#modified-beta-model-with-brms" id="toc-modified-beta-model-with-brms" class="nav-link" data-scroll-target="#modified-beta-model-with-brms"><span class="header-section-number">9.4.2</span> Modified beta model with <code>brms</code></a></li>
  <li><a href="#perform-bayesian-model-averaging" id="toc-perform-bayesian-model-averaging" class="nav-link" data-scroll-target="#perform-bayesian-model-averaging"><span class="header-section-number">9.4.3</span> Perform Bayesian model averaging</a></li>
  <li><a href="#going-beyond-the-default-mcp-mod-models" id="toc-going-beyond-the-default-mcp-mod-models" class="nav-link" data-scroll-target="#going-beyond-the-default-mcp-mod-models"><span class="header-section-number">9.4.4</span> Going beyond the default MCP-Mod models</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">9.5</span> Conclusion</a></li>
  <li><a href="#excercises" id="toc-excercises" class="nav-link" data-scroll-target="#excercises"><span class="header-section-number">9.6</span> Excercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-peanut-allergy" id="toc-exercise-1-peanut-allergy" class="nav-link" data-scroll-target="#exercise-1-peanut-allergy"><span class="header-section-number">9.6.1</span> Exercise 1: Peanut allergy</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02b_dose_finding.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Dose finding</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-dose-finding" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Dose finding</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Björn Holzhauer - <a href="mailto:bjoern.holzhauer@novartis.com" class="email">bjoern.holzhauer@novartis.com</a> </p>
             <p>Sebastian Weber - <a href="mailto:sebastian.weber@novartis.com" class="email">sebastian.weber@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>This case study features specifically</p>
<ul>
<li>Modeling non-linear summary dose-response data</li>
<li>Performing Bayesian model averaging</li>
<li>Comparing prior and posterior distributions</li>
<li>How priors can be composed in a modular manner</li>
</ul>
<p>To run the R code of this section please ensure to load these libraries and options first:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/02b_dose_finding.qmd"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8979476</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="background-what-role-does-dose-response-modeling-play-in-drug-development" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="background-what-role-does-dose-response-modeling-play-in-drug-development"><span class="header-section-number">9.1</span> Background: What role does dose response modeling play in drug development?</h2>
<p>In clinical drug development, one key question is what dose of a drug should be used to treat a disease. Ideally, we would want a dose that achieves (nearly) optimal efficacy, while at the same time minimizing side effects to optimize the benefit-risk balance. In many therapeutic areas the relationship between dose and efficacy is characterized in Phase IIb clinical trials that randomize patients to received either one of several doses of a drug or a matching placebo.</p>
<p>In such studies, it would be inefficient to try a lot of doses and just look at the performance of each dose in isolation. Instead, we know that biologically there should be some smooth function that describes the relationship between dose and efficacy. We can exploit this knowledge to make the analysis of such studies more efficient. There are a number of methods for analyzing such trials that exploit that the true expected difference to placebo will follow some smooth function of the dose. However, we typically do not know what smooth function best approximates the true underlying dose response function. Obvious candidate functions include monotone functions that eventually plateau, and functions that initially achieve a maximum and then decline.</p>
</section>
<section id="data-pathway-asthma-example" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="data-pathway-asthma-example"><span class="header-section-number">9.2</span> Data: PATHWAY asthma example</h2>
<p>We will use the PATHWAY trial as an example. This was a placebo-controlled randomized trial of three different tezepelumab dosing regimens compared with placebo in severe asthma. Two of the tezepelumab dosing regimens were given every 4 weeks. We will treat the third regimen of 280 mg every 2 weeks as if it had been 560 mg every 4 weeks. The primary endpoint of PATHWAY was the annualized rate of asthma exacerbations. The plot below shows the published estimates with 95% confidence intervals per dose. Many standard dose response modeling approaches do not require access to individual patient data - which in this case is not publically available -, but can be conducted given estimates and standard error for each dose.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the PATHWAY DRF data by group</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pathway <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">210</span>, <span class="dv">280</span><span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">"placebo"</span>, <span class="st">"tezepelumab 70 mg q4w"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"tezepelumab 210 mg q4w"</span>, <span class="st">"tezepelumab 280 mg q2w"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">est =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.26</span>, <span class="fl">0.19</span>, <span class="fl">0.22</span>)),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stderr =</span> <span class="fu">c</span>(<span class="fl">0.10304</span>, <span class="fl">0.17689</span>, <span class="fl">0.22217</span>, <span class="fl">0.19108</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple plot of the data</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>pathway <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>est, <span class="at">label=</span><span class="fu">str_wrap</span>(group, <span class="dv">12</span>), <span class="at">col=</span>group,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>est<span class="sc">-</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="at">ymax=</span>est<span class="sc">+</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">log</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)), <span class="at">labels=</span><span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Annualized rate (95% CI)"</span>) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose (mg/month)"</span>) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">nudge_x=</span><span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="sc">-</span><span class="dv">30</span>), <span class="at">segment.color =</span> <span class="cn">NA</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/get_annualized_rates-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Or to show this as rate ratios compared with the placebo group:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the PATHWAY DRF log-rate-ratios vs. placebo</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pathway_deltas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">210</span>, <span class="dv">280</span><span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> <span class="fu">c</span>(<span class="st">"reference level"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 70 mg q4w vs. placebo"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 210 mg q4w vs. placebo"</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 280 mg q2w vs. placebo"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">logRR=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">log</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="fl">-0.61</span>, <span class="dv">1</span><span class="fl">-0.71</span>, <span class="dv">1</span><span class="fl">-0.66</span>))),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.lower90 =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="cn">NA_real_</span>, <span class="dv">1</span><span class="fl">-0.75</span>, <span class="dv">1</span><span class="fl">-0.82</span>, <span class="dv">1</span><span class="fl">-0.79</span>)), <span class="co"># Paper reports 90% CIs</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.upper90 =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="cn">NA_real_</span>, <span class="dv">1</span><span class="fl">-0.39</span>, <span class="dv">1</span><span class="fl">-0.53</span>, <span class="dv">1</span><span class="fl">-0.47</span>)),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stderr =</span> (.upper90<span class="sc">-</span>.lower90)<span class="sc">/</span><span class="dv">2</span><span class="sc">/</span><span class="fu">qnorm</span>(<span class="fl">0.95</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.lower =</span> logRR<span class="sc">-</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># Get 95% CIs</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.upper =</span> logRR<span class="sc">+</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log-rate ratios</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>pathway_deltas <span class="sc">|&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>logRR, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">str_wrap</span>(group, <span class="dv">12</span>), <span class="at">col=</span>group,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>.lower, <span class="at">ymax=</span>.upper)) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">log</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)), <span class="at">labels=</span><span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">600</span>)) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Exacerbation rate ratio (95% CI)"</span>) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose (mg/month)"</span>) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">nudge_x=</span><span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="sc">-</span><span class="dv">30</span>), <span class="at">nudge_y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="cn">NA</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/get_pathway_deltas-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-description" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="model-description"><span class="header-section-number">9.3</span> Model description</h2>
<p>To conduct dose response analyses under model uncertainty a number of approaches such as the Multiple Comparison Procedures and Modeling (MCP-Mod) <span class="citation" data-cites="bretz2010practical">(<a href="02l_single_arm_pos.html#ref-bretz2010practical" role="doc-biblioref">Bretz, Dette, and Pinheiro 2010</a>)</span>, the generalized MCP-Mod approach <span class="citation" data-cites="pinheiro2014gmcpmod">(<a href="02l_single_arm_pos.html#ref-pinheiro2014gmcpmod" role="doc-biblioref">Pinheiro et al. 2014</a>)</span> and Gaussian process based approaches are popular. Within the generalized MCP-Mod framework model averaging is an attractive approach <span class="citation" data-cites="bornkamp2015drfviewpoint">(<a href="02l_single_arm_pos.html#ref-bornkamp2015drfviewpoint" role="doc-biblioref">Bornkamp 2015</a>)</span> for dealing with model uncertainty that has performed well in simulation studies <span class="citation" data-cites="schorning2016selectavg">(<a href="02l_single_arm_pos.html#ref-schorning2016selectavg" role="doc-biblioref">Schorning et al. 2016</a>)</span>. Here, we take a Bayesian approach to model averaging in the MCP-Mod framework, which is called BMA-Mod (BMA stands for Bayesian model averaging) <span class="citation" data-cites="gould2019bmamod">(<a href="02l_single_arm_pos.html#ref-gould2019bmamod" role="doc-biblioref">Gould 2019</a>)</span>.</p>
<p>While more complex mechanistic pharmacokinetic/pharmacodynamic (PK/PD) models are often important, here, we discuss directly modelling the relationship between dose and some clinical outcome in patients.</p>
<p>BMA-Mod, just as MCP-Mod, uses a set of candidate models that might describe dose response relationships. In the subsections that follow, we describe each model.</p>
<section id="the-likelihood-function-into-which-we-put-the-dose-response-model" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="the-likelihood-function-into-which-we-put-the-dose-response-model"><span class="header-section-number">9.3.1</span> The likelihood function into which we put the dose response model</h3>
<p>No matter whether we use summary data consiting of estimates with standard errors with each treatment group, or whether we have individual patient data (IPD) for a continuous, binary, count, time-to-event or ordinal outcome, our regression model will be one of the dose response models we will describe in the subsequent sections.</p>
<p>What will differ is the likelihood function, into which we insert the dose response function. In the PATHWAY example, we will use that the estimates for log-mean-event-rate for each dose level <span class="math inline">\(i=1,\ldots,I\)</span> are approximately indpendent with <span class="math inline">\(\hat{\theta}_i \sim N(\theta_i,
\text{SE}(\hat{\theta}_i))\)</span> distributions. Thus, we can use a Gaussian likelihood with known standard deviation. In case of IPD, we would instead use suitable IPD-likelihoods. This only requires minimal changes in the code for the examples.</p>
</section>
<section id="the-sigmoid-emax-and-the-emax-model" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="the-sigmoid-emax-and-the-emax-model"><span class="header-section-number">9.3.2</span> The sigmoid-Emax and the Emax model</h3>
<p>A very popular dose response model is the <strong>sigmoid-Emax model</strong>. This model assumes that the outcome for each dose group can be described by a function of the form <span class="math display">\[f(\text{dose}; \text{parameters}) =
\text{E}_0 + \text{E}_\text{max} \times
\frac{\text{dose}^h}{\text{dose}^h + \text{ED}_{50}^h}.\]</span> This is a monotone curve that starts at no difference to placebo at dose 0 (the expected placebo response is <span class="math inline">\(\text{E}_0\)</span>) and plateaus at a maximum effect of size <span class="math inline">\(\text{E}_\text{max} \in (-\infty, \infty)\)</span>. 50% of the maximum effect is reached at the dose <span class="math inline">\(\text{ED}_{50} \in (0,
\infty)\)</span>. The steepness of the curve is determined by the so-called Hill parameter <span class="math inline">\(h \in (0, \infty)\)</span>. For <span class="math inline">\(h=1\)</span>, we have the simple <strong>Emax model</strong>, for <span class="math inline">\(h&gt;1\)</span> the dose response curve is steeper around <span class="math inline">\(\text{ED}_{50}\)</span> (and plateaus faster) than for a simple Emax model, while for <span class="math inline">\(h&lt;1\)</span> the curve is less steep. Typical values of <span class="math inline">\(h\)</span> are smaller than 5 and usually at most 3, so assigning a prior that puts most of the prior weight for <span class="math inline">\(\log h\)</span> between <span class="math inline">\(-\log 5\)</span> and <span class="math inline">\(\log 5\)</span> makes sense.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/sigemax_plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Emax model is a simple model with some biological plausibility. It is the equation that results from assuming the drug concentrations at the site of drug action are proportional to the administered dose, that drug binds to and unbinds from a receptor at a rate proportional to the drug concentration, and that drugs effects are proportional to receptor occupancy. And, it assumes that all these relationships are exactly the same for all patients. All of these assumptions can be relaxed/avoided when individual patient data (and even better, if also the necessary data for PK/PD modeling) are available.</p>
</section>
<section id="the-modified-beta-model" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="the-modified-beta-model"><span class="header-section-number">9.3.3</span> The modified beta model</h3>
<p>Another possible dose response model is the modified beta model. <span class="math display">\[f(\text{dose}; \text{parameters}) = \text{E}_0 + \text{E}_{\text{max
}2} \times \frac{(\delta_1 + \delta_2)^{\delta_1 +
\delta_2}}{\delta_1^{\delta_1} + \delta_2^{\delta_2}} \times
(\frac{\text{dose}}{S})^{\delta_1} \times
(1-\frac{\text{dose}}{S})^{\delta_2}\]</span> This model is capable of describing a non-monotone dose response.</p>
</section>
<section id="exponential-model-and-linear-and-quadratic-functions-of-dose-or-log-dose" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4" class="anchored" data-anchor-id="exponential-model-and-linear-and-quadratic-functions-of-dose-or-log-dose"><span class="header-section-number">9.3.4</span> Exponential model, and linear and quadratic functions of dose or log-dose</h3>
<p>The exponential model <span class="math display">\[f(\text{dose}; \text{parameters}) = b_1 + b_2 (\exp(b_3 \times \text{dose})-1)\]</span> with <span class="math inline">\(b_3&lt;0\)</span> was also discussed by <span class="citation" data-cites="gould2019bmamod">(<a href="02l_single_arm_pos.html#ref-gould2019bmamod" role="doc-biblioref">Gould 2019</a>)</span>.</p>
<p><span class="citation" data-cites="gould2019bmamod">(<a href="02l_single_arm_pos.html#ref-gould2019bmamod" role="doc-biblioref">Gould 2019</a>)</span> also considered linear and quadratic functions of dose or log-dose. I.e. <span class="math display">\[f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta \times \text{dose},\]</span> <span class="math display">\[f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta \times \log (\text{dose}),\]</span> <span class="math display">\[f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta_1 \times \text{dose} + \beta_2 \times \text{dose}^2\]</span> or <span class="math display">\[f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta_1 \times \log (\text{dose}) + \beta_2 \times (\log (\text{dose}))^2.\]</span> These models are perhaps better suited towards modeling the dose-response relationship within the range of tested dose and would not necessarily be expected to extrapolate well beyond the data range. Nevertheless, they may be useful for providing a more flexible set of models.</p>
</section>
<section id="bayesian-model-averaging" class="level3" data-number="9.3.5">
<h3 data-number="9.3.5" class="anchored" data-anchor-id="bayesian-model-averaging"><span class="header-section-number">9.3.5</span> Bayesian Model averaging</h3>
<p>If we have multiple models that are similarly plausible given our prior information and the data we observed, then picking a single model out of these ignores the model uncertainty. For this reason, model averaging is known to be a good approach for dealing with model uncertainty. It assigns greater weight to more plausible models and can - given enough evidence - give all weight to a single clearly best model (and also give near-zero weight to clearly inappropriate models). So, - given enough data - it effectively results in model selection, but as long as we only have limited information multiple models will contribute to our inference.</p>
<p><span class="citation" data-cites="gould2019bmamod">(<a href="02l_single_arm_pos.html#ref-gould2019bmamod" role="doc-biblioref">Gould 2019</a>)</span> proposes to use a weighted combination of the predictions for each dose level from each of the candidate models and suggests to base the posterior model weigths on predictive likelihood weights <span class="citation" data-cites="ando2010predlikeli">(<a href="02l_single_arm_pos.html#ref-ando2010predlikeli" role="doc-biblioref">Ando and Tsay 2010</a>)</span>.</p>
</section>
</section>
<section id="implementation-and-results" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="implementation-and-results"><span class="header-section-number">9.4</span> Implementation and results</h2>
<p>We will now fit the various dose response models introduced in the statistical model section using <code>brms</code>. We will start with the sigmoid-Emax model and look at the things <code>brms</code> let us do easily with a single fitted model. We will not repeat that level of exploration for other models, but you may wish to do so in practice.</p>
<section id="sigmoid-emax-model-with-brms" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="sigmoid-emax-model-with-brms"><span class="header-section-number">9.4.1</span> Sigmoid-Emax model with <code>brms</code></h3>
<p>We use the capabilities of <code>brms</code> for fitting non-linear models. For example, a sigmoid-Emax model can be fitted as follows:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a sigmoid Emax model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>model_sigmoid <span class="ot">&lt;-</span> <span class="fu">bf</span>(est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span> E0 <span class="sc">+</span> sEmax <span class="sc">*</span> dose<span class="sc">^</span>h<span class="sc">/</span>(dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)), <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                    E0 <span class="sc">~</span> <span class="dv">1</span>, logED50 <span class="sc">~</span> <span class="dv">1</span>, logh <span class="sc">~</span> <span class="dv">1</span>, sEmax <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nl=</span><span class="cn">TRUE</span>, <span class="at">family=</span><span class="fu">gaussian</span>())</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>prior_sigmoid <span class="ot">&lt;-</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>E0) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>logh) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>sEmax) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">4</span>, <span class="dv">2</span>), <span class="at">nlpar=</span>logED50)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_sigmoid,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>pathway,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> prior_sigmoid,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.9</span>),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed=</span><span class="dv">3624</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">refresh=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Note that with individual patient data, we would not write <code>est | se(stderr) ~</code>, but would instead use <code>outcome ~</code> and <code>bf() + negbinomial()</code> (and similarly, e.g.&nbsp;<code>+ gaussian()</code> for continuous data). With the settings above, you might still experience a divergent transition or two and you may wish to increase <code>adapt_delta</code> to <code>0.95</code> or <code>0.99</code>, or alternatively try to come up with a way to reparameterize the model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize model fit</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_sigmoid)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: est | se(stderr) ~ E0 + sEmax * dose^h/(dose^h + ED50^h) 
         h ~ exp(logh)
         ED50 ~ exp(logED50)
         E0 ~ 1
         logED50 ~ 1
         logh ~ 1
         sEmax ~ 1
   Data: pathway (Number of observations: 4) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
E0_Intercept         -0.42      0.10    -0.61    -0.22 1.00     2148     2448
logED50_Intercept     2.69      1.35    -0.34     5.12 1.00     1557     1400
logh_Intercept       -0.04      0.99    -1.89     1.98 1.00     1256     1539
sEmax_Intercept      -1.29      0.32    -2.08    -0.84 1.00     1233     1284

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>So what does the model fit look like? We have two options for looking at this. The easiest and fastest uses the <code>conditional_effects</code> function from <code>brms</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit_sigmoid, <span class="st">"dose"</span>), </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">points =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Ignoring unknown labels:
• fill : "NA"
• colour : "NA"
Ignoring unknown labels:
• fill : "NA"
• colour : "NA"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The downside is that in a controlled trial we are primarily interested in the contrast with placebo and that we would like to see the confidence intervals around the point estimates for each dose. We can obtain that with a little bit more code:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plot_dose_response <span class="ot">&lt;-</span> <span class="cf">function</span>(model, newdata) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We are going to predict the annualized rate for all doses from 0,1,2,...600.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We are setting stderr=0 to avoid predicting with sampling variability.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">missing</span>(newdata)) {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    newdata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">seq</span>(<span class="dv">0</span>L, <span class="dv">600</span>L, <span class="at">length.out =</span> <span class="dv">101</span>), <span class="at">stderr =</span> <span class="dv">0</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  pred_newdata <span class="ot">&lt;-</span> newdata <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    tidybayes<span class="sc">::</span><span class="fu">add_predicted_rvars</span>(model) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">logRR =</span> .prediction <span class="sc">-</span> .prediction[dose <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>.prediction)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  pred_newdata <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">ydist =</span> logRR)) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pathway_deltas,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pathway_deltas,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="dv">100</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)), <span class="st">"%"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative rate reduction"</span>) <span class="sc">+</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Total tezepelumab dose [mg/month]"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>dr_sigmoid <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">+</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">300</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>), <span class="at">label =</span> <span class="st">"SigMod Emax model fit"</span>, <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_sigmoid)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/predict_sigemax-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also plot the dose response curve for each MCMC sample:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> dr_sigmoid<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_rvars</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_draws</span>(<span class="dv">500</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR, <span class="at">group =</span> <span class="fu">factor</span>(.draw))) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pathway_deltas <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="cn">NA_integer_</span>)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pathway_deltas <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="cn">NA_integer_</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">10</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">paste</span>(<span class="dv">100</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)), <span class="st">"%"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Relative rate reduction"</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Total tezepelumab dose [mg/month]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/plot_each_curve-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By rearranging the sigmoid-Emax model equation, we can directly compute the implied posterior for the dose leading to a 50% relative rate reduction (provided that Emax is sufficiently large). For the calculation we use from the R package posterior its <code>rvars</code> functionality, which simplifies these calulations.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior as rvars collection of draws</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>post_sigmoid_rvs <span class="ot">&lt;-</span> <span class="fu">as_draws_rvars</span>(fit_sigmoid)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># target effect we look for</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>logRR_target <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fl">0.5</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># determine draws for which Emax is sufficiently large for the effect</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># we are looking for</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>large_Emax_rv <span class="ot">&lt;-</span> <span class="fu">with</span>(post_sigmoid_rvs, b_sEmax_Intercept <span class="sc">&lt;</span> logRR_target)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of doses having the target effect (if possible),</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># (Emax/logRR_target - 1)^(-1/h) * ED50</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># in log space this is</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -1/h * log(Emax/logRR_target - 1) + log(ED50)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>log_dose_min_rv <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  post_sigmoid_rvs,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvar_ifelse</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    large_Emax_rv,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> b_logh_Intercept) <span class="sc">*</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(b_sEmax_Intercept <span class="sc">/</span> logRR_target <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>      b_logED50_Intercept,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Inf</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># restrict the posterior draws to cases whenever we can actually reach</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># the desired effect</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>log_dose_min_rv <span class="ot">&lt;-</span> <span class="fu">subset_draws</span>(</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  log_dose_min_rv,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">draw =</span> <span class="fu">which</span>(<span class="fu">draws_of</span>(large_Emax_rv))</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">dose_min =</span> <span class="fu">exp</span>(log_dose_min_rv)) <span class="sc">|&gt;</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">dist =</span> dose_min)) <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_halfeye</span>() <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose [mg/month]"</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/plot_dose_with_50rrr-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As the plot below shows the data resulted in a substantially different posterior distribution compared with the prior distribution for the <code>logED50</code> parameter and the <code>Emax</code> parameter. These parameters are reasonably well-identified even with just 3 doses - although the ED50 would be better estimated, if doses with approximately 50% of the Emax (maximum relative rate reduction) had been included in the study. In contrast, the log-Hill-parameter is poorly identified, when there are very few doses (as in this study), which is why the posterior distribution is more or less the prior distribution for the <code>logED50</code> parameter.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>compare_prior_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(param, fit) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">&lt;-</span> fit<span class="sc">$</span>prior <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">parse_dist</span>(prior) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">.variable =</span> nlpar) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.variable <span class="sc">==</span> param, source <span class="sc">==</span> <span class="st">"user"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  model_param <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"b"</span>, param, <span class="st">"Intercept"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">post =</span> <span class="fu">as_draws_rvars</span>(fit)[[model_param]])</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(post, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">xdist =</span> post)) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slabinterval</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slab</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> prior,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"darkblue"</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_thickness_shared</span>() <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(param) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),   <span class="co"># removes y-axis ticks</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),   <span class="co"># removes y-axis text</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()    <span class="co"># removes y-axis title</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>cmp_sigmoid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(prior_sigmoid<span class="sc">$</span>nlpar, compare_prior_posterior, fit_sigmoid)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># turns the list of plots into a call of plot1 + plot2 + ... which</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># merges the different plots into a single one</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(<span class="st">"+"</span>, cmp_sigmoid)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/paramident-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modified-beta-model-with-brms" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="modified-beta-model-with-brms"><span class="header-section-number">9.4.2</span> Modified beta model with <code>brms</code></h3>
<p>We now fit the modified beta model that can capture non-monotone dose response relationships.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try a modified beta model</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>model_beta <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      E0 <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        bEmax <span class="sc">*</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>          (delta1 <span class="sc">+</span> delta2)<span class="sc">^</span>(delta1 <span class="sc">+</span> delta2) <span class="sc">/</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>          (delta1<span class="sc">^</span>delta1 <span class="sc">*</span> delta2<span class="sc">^</span>delta2) <span class="sc">*</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>          (dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta1 <span class="sc">*</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">1</span> <span class="sc">-</span> dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta2,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    delta1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    delta2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    bEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>prior_beta <span class="ot">&lt;-</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> E0) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> bEmax) <span class="sc">+</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> delta1, <span class="at">lb =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> delta2, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>fit_beta <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_beta,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_beta,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7304</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let us summarize the model fit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_beta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: est | se(stderr) ~ E0 + bEmax * (delta1 + delta2)^(delta1 + delta2)/(delta1^delta1 * delta2^delta2) * (dose/850)^delta1 * (1 - dose/850)^delta2 
         E0 ~ 1
         delta1 ~ 1
         delta2 ~ 1
         bEmax ~ 1
   Data: pathway (Number of observations: 4) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
E0_Intercept        -0.42      0.10    -0.62    -0.22 1.00     1914     2200
delta1_Intercept     0.45      0.21     0.13     0.96 1.00     1485     1915
delta2_Intercept     0.75      0.40     0.16     1.69 1.00     1518     1756
bEmax_Intercept     -1.30      0.21    -1.74    -0.91 1.00     1602     1963

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>So what does the model fit look like? We could, again, just use <code>plot(conditional_effects(fit_beta, "dose"), points = TRUE)</code> or get a slightly more tailored plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dr_beta <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_beta) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"modified-beta model fit"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkblue"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_beta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/predict_modbeta-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s also consider how informative the data is wrt to each parameter’s prior:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cmp_beta <span class="ot">&lt;-</span> <span class="fu">lapply</span>(prior_beta<span class="sc">$</span>nlpar, compare_prior_posterior, fit_beta)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(<span class="st">"+"</span>, cmp_beta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="perform-bayesian-model-averaging" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="perform-bayesian-model-averaging"><span class="header-section-number">9.4.3</span> Perform Bayesian model averaging</h3>
<p>Now we have two fitted model. We can see both of them together below:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dr_sigmoid <span class="sc">+</span> dr_beta</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/show_both_plots-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>In practice, we do not really know, whether one of these is the true data generating model. In fact, realistically both models are going to be at least somewhat misspecified, because we made no attempt to fully model the full complexity of the underlying biological system. So, really, the question is which of the two models provides the better approximation. At a glance both seem to fit the data somewhat decently, so it seems unlikely that we can completely rule one of the two models out. That is where Bayesian model averaging comes in.</p>
<p>First, we need to compare how well each model fits. As it turns out, when you just have 4 data points (due to us using summary data), it is problematic to just use the “standard” <code>brms::loo</code> function to perform approximate leave-one-out cross-validation (LOO-CV) based on the posterior likelihood as implemented in the <code>loo</code> package, as can be seen by running</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(fit_sigmoid)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 1 observations with a pareto_k &gt; 0.7 in model 'fit_sigmoid'. We recommend to set 'moment_match = TRUE'
in order to perform moment matching for problematic observations.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 4 log-likelihood matrix.

         Estimate  SE
elpd_loo      0.8 0.3
p_loo         1.5 0.7
looic        -1.7 0.7
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.1]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     3     75.0%   862     
   (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;    
   (1, Inf)   (very bad) 1     25.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<p>and</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(fit_beta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 3 observations with a pareto_k &gt; 0.7 in model 'fit_beta'. We recommend to set 'moment_match = TRUE' in
order to perform moment matching for problematic observations.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 4 log-likelihood matrix.

         Estimate  SE
elpd_loo     -0.1 0.3
p_loo         2.3 0.8
looic         0.1 0.6
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 0.7]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     1     25.0%   943     
   (0.7, 1]   (bad)      2     50.0%   &lt;NA&gt;    
   (1, Inf)   (very bad) 1     25.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<p>Instead, we actually fit each model leaving each dose group out. We could probably do something more sophisticated by simulating consistent individual patient data (and then performing approximate LOO-CV) or parametric sampling from the normal distribution around the point estimates.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_sigmoid, <span class="at">folds =</span> <span class="st">"loo"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_beta <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_beta, <span class="at">folds =</span> <span class="st">"loo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, we can compare the models via</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo_exact_fit_sigmoid, loo_exact_fit_beta)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            elpd_diff se_diff
fit_sigmoid  0.0       0.0   
fit_beta    -1.7       0.9   </code></pre>
</div>
</div>
<section id="approach-1-manual-without-brms" class="level4" data-number="9.4.3.1">
<h4 data-number="9.4.3.1" class="anchored" data-anchor-id="approach-1-manual-without-brms"><span class="header-section-number">9.4.3.1</span> Approach 1 (manual without <code>brms</code>)</h4>
<p>Let us say that we a-priori assign a 75% probability to the SigEmax model and 25% to the modified beta model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># follows: </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Gould, A. L. (2019). BMA‐Mod: A Bayesian model averaging strategy</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for determining dose‐response relationships in the presence of model</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># uncertainty. Biometrical Journal, 61(5), 1141-1159.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># https://dx.doi.org/10.1002/bimj.201700211</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>prior_weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>posterior_weigths <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  prior_weights[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">exp</span>(loo_exact_fit_sigmoid<span class="sc">$</span>estimates[<span class="st">"elpd_kfold"</span>, <span class="st">"Estimate"</span>]),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  prior_weights[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">exp</span>(loo_exact_fit_beta<span class="sc">$</span>estimates[<span class="st">"elpd_kfold"</span>, <span class="st">"Estimate"</span>])</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>(posterior_weigths <span class="ot">&lt;-</span> posterior_weigths <span class="sc">/</span> <span class="fu">sum</span>(posterior_weigths))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.94522422 0.05477578</code></pre>
</div>
</div>
<p>As we can see, using leaving-one-dose-group out cross-validation, suggests that the SigEmax model should be given most of the weight. A-posteriori, we assign 94.5% weight to the SigEmax model and 5.5% weight to the modified beta model. However, if we had done approximate LOO-CV with individual patient data, the modified beta model might have been given more weight.</p>
<p>When we average the predictions of the two models with these weights, we get the dose response curve below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bma_curve <span class="ot">&lt;-</span> dr_sigmoid<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dr_beta<span class="sc">$</span>data, <span class="at">by =</span> <span class="st">"dose"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">logRR =</span> posterior_weigths[<span class="dv">1</span>] <span class="sc">*</span> logRR.x <span class="sc">+</span> posterior_weigths[<span class="dv">2</span>] <span class="sc">*</span> logRR.y</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>logRR.x, <span class="sc">-</span>logRR.y)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>dr_bma <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">%+%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  bma_curve <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Bayesian model averaging"</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkgreen"</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: &lt;ggplot&gt; %+% x was deprecated in ggplot2 4.0.0.
ℹ Please use &lt;ggplot&gt; + x instead.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  ((dr_sigmoid <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Sigmoid Emax model"</span>)) <span class="sc">|</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    (dr_beta <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Modified beta model"</span>))) <span class="sc">/</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    (dr_bma <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Bayesian model averaging"</span>) <span class="sc">|</span> <span class="fu">plot_spacer</span>())</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/bma_curves-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="approach-2-using-brms-functions" class="level4" data-number="9.4.3.2">
<h4 data-number="9.4.3.2" class="anchored" data-anchor-id="approach-2-using-brms-functions"><span class="header-section-number">9.4.3.2</span> Approach 2: Using <code>brms</code> functions</h4>
<p>Before, we needed to do a lot of manual work to get model-averaged predictions, but the below using <code>brms::pp_average</code> would be a lot simpler, if we could rely on the approximate LOO-CV.</p>
<section id="approach-2a-not-appropriate-here" class="level5" data-number="9.4.3.2.1">
<h5 data-number="9.4.3.2.1" class="anchored" data-anchor-id="approach-2a-not-appropriate-here"><span class="header-section-number">9.4.3.2.1</span> Approach 2a: Not appropriate here</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dr_curve_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">seq</span>(<span class="dv">0</span>L, <span class="dv">600</span>L, <span class="at">length.out =</span> <span class="dv">101</span>), <span class="at">stderr =</span> <span class="dv">0</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>bma_brms_curve <span class="ot">&lt;-</span> dr_curve_data <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">epred_bma =</span> <span class="fu">rvar</span>(<span class="fu">pp_average</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      fit_sigmoid,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      fit_beta,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"posterior_epred"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">newdata =</span> dr_curve_data,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Not a good option in this case</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> <span class="st">"loo"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">summary =</span> <span class="cn">FALSE</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forming differences to placebo by merging with the placebo</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (dose=0) predictions for each sample</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">logRR =</span> epred_bma <span class="sc">-</span> epred_bma[dose <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="approach-2b-using-leave-one-dose-out-cv" class="level5" data-number="9.4.3.2.2">
<h5 data-number="9.4.3.2.2" class="anchored" data-anchor-id="approach-2b-using-leave-one-dose-out-cv"><span class="header-section-number">9.4.3.2.2</span> Approach 2b: Using leave-one-dose-out CV</h5>
<p>Because we want to avoid using approximate LOO-CV in this case, we first replace the internally calculated approximate LOO-CV results with our own</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit_sigmoid<span class="sc">$</span>criteria<span class="sc">$</span>loo <span class="ot">&lt;-</span> loo_exact_fit_sigmoid</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fit_beta<span class="sc">$</span>criteria<span class="sc">$</span>loo <span class="ot">&lt;-</span> loo_exact_fit_beta</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>(w_dose <span class="ot">&lt;-</span> <span class="fu">model_weights</span>(fit_sigmoid, fit_beta, <span class="at">weights =</span> <span class="st">"loo"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>fit_sigmoid    fit_beta 
  0.8518975   0.1481025 </code></pre>
</div>
</div>
<p>We can then do the following:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bma_curve_pred <span class="ot">&lt;-</span> dr_curve_data <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_rvars</span>(fit_sigmoid, <span class="at">value=</span><span class="st">".epred1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_rvars</span>(fit_beta, <span class="at">value=</span><span class="st">".epred2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epred_bma =</span> .epred1 <span class="sc">*</span> w_dose[<span class="dv">1</span>] <span class="sc">+</span> .epred2 <span class="sc">*</span> w_dose[<span class="dv">2</span>],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">logRR =</span> epred_bma <span class="sc">-</span> epred_bma[dose <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>dr_bma2 <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">%+%</span> bma_curve_pred <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">300</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>), <span class="at">label =</span> <span class="st">"BMA (LOO weights)"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_bma2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="why-did-we-do-this-form-of-bayesian-model-averaging" class="level4" data-number="9.4.3.3">
<h4 data-number="9.4.3.3" class="anchored" data-anchor-id="why-did-we-do-this-form-of-bayesian-model-averaging"><span class="header-section-number">9.4.3.3</span> Why did we do this form of Bayesian model averaging?</h4>
<p>Why are we doing it like this? Can we not just fit a single model like this (as an example where we average a sigmoid-Emax and a modified beta model)?</p>
<p><span class="math display">\[
\begin{aligned}
f(\text{dose}; \text{parameters}) = &amp; \text{E}_0 + w \times \text{E}_{\text{maxSigmoid}} \times \frac{\text{dose}^h}{\text{dose}^h + \text{ED}_{50}^h} \\
  &amp; + (1-w) \times \text{E}_{\text{maxBeta}} \times \frac{(\delta_1 + \delta_2)^{\delta_1 + \delta_2}}{\delta_1^{\delta_1} + \delta_2^{\delta_2}} \times (\frac{\text{dose}}{S})^{\delta_1} \times (1-\frac{\text{dose}}{S})^{\delta_2}
\end{aligned}
\]</span></p>
<p><code>brms</code> certainly lets us specify such a model (see below). Nonethelessm such a model is harder to fit as we fit jointly both models simultaneousy. Fitting each model separatley is from a numerical perspective more stable and robust in comparison to fitting each model individually. Still, note that in the above formulation the <span class="math inline">\(\text{E}_0\)</span> parameter is shared between the models such that the above model differs from a fit of each model individually.</p>
<p>An important step in the model below is to align the parameter domain with the priors. That is, we continue using the apprioate transformed parameters which are positive and we restrict the weighting parameter to the domain 0 to 1 (we could also fit this parameter on the logit scale). It is important to pass these parameter range limits to Stan using the lower bound (<code>lb</code>) and upper bound (<code>ub</code>) information to Stan via the respective arguments of the <code>prior</code> function call declaring the parameter prior:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model_avg <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>      mwgtSigmoid <span class="sc">*</span> sEmax <span class="sc">*</span> dose<span class="sc">^</span>h <span class="sc">/</span> (dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span><span class="sc">-</span>mwgtSigmoid) <span class="sc">*</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        bEmax <span class="sc">*</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        (delta1 <span class="sc">+</span> delta2)<span class="sc">^</span>(delta1 <span class="sc">+</span> delta2) <span class="sc">/</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        (delta1<span class="sc">^</span>delta1 <span class="sc">*</span> delta2<span class="sc">^</span>delta2) <span class="sc">*</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        (dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta1 <span class="sc">*</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">-</span> dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta2,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)), <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  sEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  bEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  delta1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  delta2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  mwgtSigmoid <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>prior_avg <span class="ot">&lt;-</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  prior_sigmoid <span class="sc">+</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note that we have to drop the E0 prior from the modified beta</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prior, which can be easily done as prior specifications from brms</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are essentially data frames.</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prior_beta, nlpar <span class="sc">!=</span> <span class="st">"E0"</span>) <span class="sc">+</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> mwgtSigmoid, <span class="at">lb=</span><span class="dv">0</span>, <span class="at">ub=</span><span class="dv">1</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>fit_mod_avg <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  model_avg,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_avg,</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">456456</span>,</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.8 seconds.
Chain 2 finished in 1.1 seconds.
Chain 3 finished in 1.0 seconds.
Chain 4 finished in 0.8 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.9 seconds.
Total execution time: 4.0 seconds.</code></pre>
</div>
</div>
<p>Considering the summary of the model:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mod_avg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: est | se(stderr) ~ E0 + mwgtSigmoid * sEmax * dose^h/(dose^h + ED50^h) + (1 - mwgtSigmoid) * bEmax * (delta1 + delta2)^(delta1 + delta2)/(delta1^delta1 * delta2^delta2) * (dose/850)^delta1 * (1 - dose/850)^delta2 
         h ~ exp(logh)
         ED50 ~ exp(logED50)
         E0 ~ 1
         sEmax ~ 1
         logED50 ~ 1
         logh ~ 1
         bEmax ~ 1
         delta1 ~ 1
         delta2 ~ 1
         mwgtSigmoid ~ 1
   Data: pathway (Number of observations: 4) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
E0_Intercept             -0.43      0.10    -0.63    -0.22 1.00     3615     2592
sEmax_Intercept          -1.27      0.77    -2.50     0.75 1.01      930     1033
logED50_Intercept         2.91      1.62    -0.29     6.40 1.00     1763     1386
logh_Intercept            0.06      0.95    -1.80     1.94 1.00     3339     2274
bEmax_Intercept          -0.61      0.97    -2.19     1.49 1.00     1218     2672
delta1_Intercept          1.30      1.91     0.13     6.35 1.00     1636     2615
delta2_Intercept          1.46      2.25     0.14     6.32 1.00     2624     2109
mwgtSigmoid_Intercept     0.64      0.28     0.05     0.99 1.01      795     1154

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Now, let’s compare all four different models graphically:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dr_mod_avg <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_mod_avg) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Average model"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkred"</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  ((dr_sigmoid <span class="sc">+</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Sigmoid Emax model"</span>)) <span class="sc">|</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    (dr_beta <span class="sc">+</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Modified beta model"</span>))) <span class="sc">/</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    (dr_bma <span class="sc">+</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Bayesian model averaging"</span>) <span class="sc">|</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>      dr_mod_avg <span class="sc">+</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Average model"</span>))</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/bma_curves_complete-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="going-beyond-the-default-mcp-mod-models" class="level3" data-number="9.4.4">
<h3 data-number="9.4.4" class="anchored" data-anchor-id="going-beyond-the-default-mcp-mod-models"><span class="header-section-number">9.4.4</span> Going beyond the default MCP-Mod models</h3>
<p>So far, a lot of what we did could also be done in a frequentist manner using the MCP-Mod approach. However, with <code>brms</code> it is easy to make our models more complex when necessary. For example, we assumed that a 280 mg q2w dose is equivalent to a 560 mg q4w dose. This is of course only the case in terms of the total amount of drug injected over the trial period. However, the two dose regimens differ in terms of their blood concentrations over time as shown in the plot below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>sim_1st_order_pk <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">injected =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">5</span>)),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="dv">1</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">thalf =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">V =</span> <span class="dv">10</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">2</span>) <span class="sc">/</span> thalf</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  concentration <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(injected))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(injected)) {</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>      concentration[i] <span class="ot">&lt;-</span> concentration[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        k <span class="sc">*</span> concentration[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        dose <span class="sc">*</span> injected[i] <span class="sc">/</span> V</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>      concentration[i] <span class="ot">&lt;-</span> dose <span class="sc">*</span> injected[i] <span class="sc">/</span> V</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(concentration)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>regimen, <span class="sc">~</span>dose, <span class="sc">~</span>schedule,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q4wk"</span>, <span class="dv">280</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">12</span>),</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q2w"</span>, <span class="dv">280</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">24</span>),</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q4wk"</span>, <span class="dv">560</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">12</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> <span class="fu">list</span>(<span class="fu">sim_1st_order_pk</span>(schedule, <span class="at">dose =</span> dose))) <span class="sc">|&gt;</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(concentration) <span class="sc">|&gt;</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">dose_regimen =</span> <span class="fu">paste0</span>(dose, <span class="st">" mg "</span>, regimen),</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(regimen, dose)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> concentration, <span class="at">col =</span> dose_regimen)) <span class="sc">+</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>) <span class="sc">*</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">5000</span>, <span class="dv">8025</span>),</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">20</span>, <span class="dv">90</span>),</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"560 mg q4wk"</span>, <span class="st">"280 mg q4wk"</span>, <span class="st">"280 mg q2wk"</span>),</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">75</span>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time in trial (months)"</span>) <span class="sc">+</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Drug concentration [mg/L]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/simplepk-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These differences in pharmacokinetic profiles likely lead to at least somewhat different efficacy outcomes. For example, if efficacy is more driven by the peak concentration achieved in each dosing interval, 280 mg q2w might be less effective than a 560 mg q4w regiment would have been. On the other hand, if efficacy is more determined by the minimum concentration maintained throughout time, then 280 mg q2w could be more effective than 560 mg q4w. If the main determinant of efficacy is the average drug concentration over time, and peaks and troughs do not matter (at least within the concentrations seen), then the two dosing regimens might be exactly identical.</p>
<p>So, we could update our previous sigmoid Emax model and add an extra term that describes how the 280 mg q2w dose might relate to q4w doses. Note that assuming a monotone concentration response, a 280 mg q2w regimen cannot be worse than a 280 mg q4w regimen - this is also illustrated by the plot showing that the concentrations of 280 mg q2w are (unsurprisingly) always above those of 280 mg q4w. This gives us a lower bound for the efficacy of 280 mg q2w. Similarly, its peak concentrations stay below 2.5 times the peak concentrations of 280 mg q2w, which gives us an upper bound. We will specify a log-normal prior with mean 0 and SD 0.67 for a regimen factor that indicates what q4w dose a q2w dose is equivalent to.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model_sigmoid_alt <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">+</span> sEmax <span class="sc">*</span> (dose <span class="sc">*</span> dosefactor)<span class="sc">^</span>h <span class="sc">/</span> ((dose <span class="sc">*</span> dosefactor)<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(dosefactor <span class="sc">~</span> <span class="fu">exp</span>((dose <span class="sc">==</span> <span class="dv">560</span>) <span class="sc">*</span> regimen)),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  sEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  regimen <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>prior_sigmoid_alt <span class="ot">&lt;-</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  prior_sigmoid <span class="sc">+</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.67</span>), <span class="at">nlpar =</span> regimen)</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>fit_sigmoid_alt <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  model_sigmoid_alt,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_sigmoid_alt,</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>),</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5768768</span>,</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s summarize the model results:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_sigmoid_alt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 divergent transitions after warmup. Increasing adapt_delta above 0.9 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity 
Formula: est | se(stderr) ~ E0 + sEmax * (dose * dosefactor)^h/((dose * dosefactor)^h + ED50^h) 
         h ~ exp(logh)
         ED50 ~ exp(logED50)
         dosefactor ~ exp((dose == 560) * regimen)
         E0 ~ 1
         logED50 ~ 1
         logh ~ 1
         sEmax ~ 1
         regimen ~ 1
   Data: pathway (Number of observations: 4) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
E0_Intercept         -0.41      0.10    -0.60    -0.22 1.00     2704     2567
logED50_Intercept     2.70      1.37    -0.33     5.22 1.00     1603     1343
logh_Intercept       -0.04      0.96    -1.88     1.85 1.00     1651     2055
sEmax_Intercept      -1.30      0.33    -2.12    -0.84 1.00     1328     1185
regimen_Intercept    -0.06      0.68    -1.40     1.33 1.00     3206     2391

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>As we can see, we can fit such a model, but the marginal posterior for the log-regimen factor is still a N(0, 0.67) distribution. Thus, the data do not inform this parameter very well - which should not surprise us. However, if we had information external to the PATHWAY trial, such as the elicited judgments of experts, we could incorporate it via this type of model.</p>
</section>
</section>
<section id="conclusion" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">9.5</span> Conclusion</h2>
<p>As we could see <code>brms</code> makes it surprisingly easy to fit non-linear dose response models and to perform model averaging. Taking a Bayesian approach to dose response modeling is attractive for a number of reasons: * using prior information e.g.&nbsp;on expected placebo outcomes, the maximum plausible treatment effect and typical dose response patterns, * (weakly-)informative priors avoid issues with maximum likelihood estimation such as infinitely steep sigmoid Emax models (common when the lowest tested dose has the best point estimate), * the convenience of obtaining predictions about things that are transformations of the model parameters (e.g.&nbsp;the dose with at least a certain effect), and * the straightforward way, in which we can extend the basic models to account for the specifics of our dose finding study.</p>
</section>
<section id="excercises" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="excercises"><span class="header-section-number">9.6</span> Excercises</h2>
<section id="exercise-1-peanut-allergy" class="level3" data-number="9.6.1">
<h3 data-number="9.6.1" class="anchored" data-anchor-id="exercise-1-peanut-allergy"><span class="header-section-number">9.6.1</span> Exercise 1: Peanut allergy</h3>
<p>In a hypothetical phase 2b trial children and adolescents with peanut allergy were randomly assigned to placebo or 5 doses (5 to 300 mg) of a new drug. After 26 weeks the patients underwent a double-blind placebo-controlled food challenge and the primary endpoint was the proportion of patients that could ingest 600 mg or more of peanut protein without experiencing dose-limiting symptoms. The plots below show an overview of the data. Note that no placebo patients were considered “responders” per the primary endpoint definition.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>peanut <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">TRT01P =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ),<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"5 mg"</span>, <span class="st">"15 mg"</span>, <span class="st">"50 mg"</span>, <span class="st">"150 mg"</span>, <span class="st">"300 mg"</span>), <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L,</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L),</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L,</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L,</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L,</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L,</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L,</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>    <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L,</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">0</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L,</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L,</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L,</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L,</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L,</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L,</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L,</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L),</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">PARAM =</span> <span class="fu">structure</span>(</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerated amount of peanut protein (mg)"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">USUBJID =</span> <span class="fu">c</span>(</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>    <span class="dv">129</span>L, <span class="dv">103</span>L, <span class="dv">104</span>L, <span class="dv">185</span>L, <span class="dv">34</span>L, <span class="dv">15</span>L, <span class="dv">140</span>L, <span class="dv">151</span>L, <span class="dv">7</span>L, <span class="dv">144</span>L, <span class="dv">200</span>L, <span class="dv">23</span>L, <span class="dv">138</span>L, <span class="dv">115</span>L, <span class="dv">255</span>L, <span class="dv">147</span>L, <span class="dv">224</span>L, <span class="dv">101</span>L, <span class="dv">156</span>L, <span class="dv">284</span>L,</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>    <span class="dv">136</span>L, <span class="dv">248</span>L, <span class="dv">179</span>L, <span class="dv">298</span>L, <span class="dv">168</span>L, <span class="dv">295</span>L, <span class="dv">289</span>L, <span class="dv">241</span>L, <span class="dv">36</span>L, <span class="dv">27</span>L, <span class="dv">123</span>L, <span class="dv">266</span>L, <span class="dv">11</span>L, <span class="dv">291</span>L, <span class="dv">236</span>L, <span class="dv">130</span>L, <span class="dv">173</span>L, <span class="dv">195</span>L, <span class="dv">203</span>L, <span class="dv">160</span>L,</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>    <span class="dv">274</span>L, <span class="dv">167</span>L, <span class="dv">290</span>L, <span class="dv">94</span>L, <span class="dv">9</span>L, <span class="dv">269</span>L, <span class="dv">122</span>L, <span class="dv">135</span>L, <span class="dv">64</span>L, <span class="dv">26</span>L, <span class="dv">95</span>L, <span class="dv">10</span>L, <span class="dv">5</span>L, <span class="dv">234</span>L, <span class="dv">161</span>L, <span class="dv">299</span>L, <span class="dv">88</span>L, <span class="dv">69</span>L, <span class="dv">35</span>L, <span class="dv">233</span>L, <span class="dv">286</span>L,</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>    <span class="dv">85</span>L, <span class="dv">91</span>L, <span class="dv">189</span>L, <span class="dv">80</span>L, <span class="dv">152</span>L, <span class="dv">223</span>L, <span class="dv">287</span>L, <span class="dv">244</span>L, <span class="dv">57</span>L, <span class="dv">108</span>L, <span class="dv">18</span>L, <span class="dv">62</span>L, <span class="dv">157</span>L, <span class="dv">300</span>L, <span class="dv">283</span>L, <span class="dv">164</span>L, <span class="dv">243</span>L, <span class="dv">89</span>L, <span class="dv">220</span>L, <span class="dv">24</span>L, <span class="dv">271</span>L,</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>    <span class="dv">166</span>L, <span class="dv">118</span>L, <span class="dv">201</span>L, <span class="dv">127</span>L, <span class="dv">121</span>L, <span class="dv">41</span>L, <span class="dv">267</span>L, <span class="dv">213</span>L, <span class="dv">49</span>L, <span class="dv">73</span>L, <span class="dv">202</span>L, <span class="dv">134</span>L, <span class="dv">112</span>L, <span class="dv">25</span>L, <span class="dv">227</span>L, <span class="dv">29</span>L, <span class="dv">251</span>L, <span class="dv">273</span>L, <span class="dv">119</span>L, <span class="dv">132</span>L,</span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>    <span class="dv">74</span>L, <span class="dv">270</span>L, <span class="dv">83</span>L, <span class="dv">37</span>L, <span class="dv">181</span>L, <span class="dv">258</span>L, <span class="dv">253</span>L, <span class="dv">48</span>L, <span class="dv">120</span>L, <span class="dv">54</span>L, <span class="dv">277</span>L, <span class="dv">176</span>L, <span class="dv">65</span>L, <span class="dv">264</span>L, <span class="dv">107</span>L, <span class="dv">171</span>L, <span class="dv">262</span>L, <span class="dv">162</span>L, <span class="dv">187</span>L, <span class="dv">272</span>L,</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>    <span class="dv">288</span>L, <span class="dv">294</span>L, <span class="dv">245</span>L, <span class="dv">109</span>L, <span class="dv">172</span>L, <span class="dv">204</span>L, <span class="dv">275</span>L, <span class="dv">22</span>L, <span class="dv">66</span>L, <span class="dv">186</span>L, <span class="dv">247</span>L, <span class="dv">17</span>L, <span class="dv">149</span>L, <span class="dv">141</span>L, <span class="dv">177</span>L, <span class="dv">280</span>L, <span class="dv">216</span>L, <span class="dv">40</span>L, <span class="dv">75</span>L, <span class="dv">263</span>L,</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>    <span class="dv">246</span>L, <span class="dv">14</span>L, <span class="dv">81</span>L, <span class="dv">260</span>L, <span class="dv">153</span>L, <span class="dv">45</span>L, <span class="dv">237</span>L, <span class="dv">8</span>L, <span class="dv">117</span>L, <span class="dv">86</span>L, <span class="dv">296</span>L, <span class="dv">146</span>L, <span class="dv">154</span>L, <span class="dv">116</span>L, <span class="dv">38</span>L, <span class="dv">100</span>L, <span class="dv">191</span>L, <span class="dv">175</span>L, <span class="dv">92</span>L, <span class="dv">158</span>L, <span class="dv">192</span>L,</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>    <span class="dv">180</span>L, <span class="dv">256</span>L, <span class="dv">254</span>L, <span class="dv">125</span>L, <span class="dv">222</span>L, <span class="dv">145</span>L, <span class="dv">261</span>L, <span class="dv">155</span>L, <span class="dv">159</span>L, <span class="dv">3</span>L, <span class="dv">206</span>L, <span class="dv">278</span>L, <span class="dv">19</span>L, <span class="dv">31</span>L, <span class="dv">63</span>L, <span class="dv">208</span>L, <span class="dv">55</span>L, <span class="dv">259</span>L, <span class="dv">218</span>L, <span class="dv">111</span>L,</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a>    <span class="dv">226</span>L, <span class="dv">33</span>L, <span class="dv">2</span>L, <span class="dv">44</span>L, <span class="dv">297</span>L, <span class="dv">53</span>L, <span class="dv">87</span>L, <span class="dv">16</span>L, <span class="dv">28</span>L, <span class="dv">90</span>L, <span class="dv">207</span>L, <span class="dv">56</span>L, <span class="dv">137</span>L, <span class="dv">128</span>L, <span class="dv">178</span>L, <span class="dv">142</span>L, <span class="dv">143</span>L, <span class="dv">148</span>L, <span class="dv">193</span>L, <span class="dv">229</span>L, <span class="dv">265</span>L,</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a>    <span class="dv">97</span>L, <span class="dv">252</span>L, <span class="dv">205</span>L, <span class="dv">150</span>L, <span class="dv">165</span>L, <span class="dv">188</span>L, <span class="dv">52</span>L, <span class="dv">99</span>L, <span class="dv">93</span>L, <span class="dv">1</span>L, <span class="dv">221</span>L, <span class="dv">124</span>L, <span class="dv">210</span>L, <span class="dv">6</span>L, <span class="dv">232</span>L, <span class="dv">21</span>L, <span class="dv">211</span>L, <span class="dv">163</span>L, <span class="dv">96</span>L, <span class="dv">60</span>L, <span class="dv">183</span>L,</span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a>    <span class="dv">190</span>L, <span class="dv">242</span>L, <span class="dv">42</span>L, <span class="dv">46</span>L, <span class="dv">67</span>L, <span class="dv">126</span>L, <span class="dv">209</span>L, <span class="dv">72</span>L, <span class="dv">194</span>L, <span class="dv">238</span>L, <span class="dv">184</span>L, <span class="dv">39</span>L, <span class="dv">105</span>L, <span class="dv">249</span>L, <span class="dv">61</span>L, <span class="dv">113</span>L, <span class="dv">30</span>L, <span class="dv">77</span>L, <span class="dv">12</span>L, <span class="dv">4</span>L, <span class="dv">51</span>L,</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>    <span class="dv">139</span>L, <span class="dv">20</span>L, <span class="dv">268</span>L, <span class="dv">215</span>L, <span class="dv">292</span>L, <span class="dv">217</span>L, <span class="dv">199</span>L, <span class="dv">32</span>L, <span class="dv">276</span>L, <span class="dv">47</span>L, <span class="dv">225</span>L, <span class="dv">230</span>L, <span class="dv">79</span>L, <span class="dv">71</span>L, <span class="dv">98</span>L, <span class="dv">50</span>L, <span class="dv">13</span>L, <span class="dv">76</span>L, <span class="dv">231</span>L, <span class="dv">250</span>L, <span class="dv">58</span>L,</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a>    <span class="dv">68</span>L, <span class="dv">239</span>L, <span class="dv">198</span>L, <span class="dv">293</span>L, <span class="dv">212</span>L, <span class="dv">110</span>L, <span class="dv">59</span>L, <span class="dv">182</span>L, <span class="dv">133</span>L, <span class="dv">170</span>L, <span class="dv">43</span>L, <span class="dv">282</span>L, <span class="dv">281</span>L, <span class="dv">131</span>L, <span class="dv">114</span>L, <span class="dv">196</span>L, <span class="dv">214</span>L, <span class="dv">285</span>L, <span class="dv">70</span>L, <span class="dv">102</span>L,</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a>    <span class="dv">279</span>L, <span class="dv">106</span>L, <span class="dv">197</span>L, <span class="dv">257</span>L, <span class="dv">228</span>L, <span class="dv">84</span>L, <span class="dv">235</span>L, <span class="dv">78</span>L, <span class="dv">169</span>L, <span class="dv">240</span>L, <span class="dv">219</span>L, <span class="dv">174</span>L, <span class="dv">82</span>L),</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT1 =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerating &gt;=600 mg of peanut protein without dose-limiting symptoms"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT1FL =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Y"</span>), <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT2 =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerating &gt;=1000 mg of peanut protein without dose-limiting symptoms"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT2FL =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Y"</span>), <span class="at">class =</span> <span class="st">"factor"</span> ) )</span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a>peanut <span class="sc">|&gt;</span></span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(AVAL), <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">preserve =</span> <span class="st">"single"</span>)) <span class="sc">+</span></span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a>      <span class="st">"royalblue"</span>,</span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#fb6a4a"</span>,</span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#ef3b2c"</span>,</span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#cb181d"</span>,</span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#a50f15"</span>,</span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#67000d"</span></span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Peanut protein tolerated without dose-limiting symptoms (mg)"</span>) <span class="sc">+</span></span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Patients"</span>) <span class="sc">+</span></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/peanutdata-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>peanut <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">proportion =</span> <span class="fu">sum</span>(CRIT1FL <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TRT01P, <span class="at">y =</span> proportion, <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(proportion)),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rep</span>(<span class="fl">1.5</span>, <span class="dv">5</span>))</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"royalblue"</span>,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#fb6a4a"</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#ef3b2c"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#cb181d"</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#a50f15"</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#67000d"</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tolerating &gt;=600 mg of peanut protein without dose-limiting symptoms"</span>) <span class="sc">+</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Percentage of patients"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/peanutdata-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Fit a sigmoid Emax logistic regression model (i.e.&nbsp;<code>family=binomial(link="logit")</code>). To accelerate likelihood evaluations, first summarize data as “responders” <code>y</code> out of <code>n</code> patients per dose. We expect the true placebo proportion to be around 0.05 (-2.944 on the logit scale) with much more than 0.1 or much less than 0.02 considered unlikely. It is a-priori at least possible that there is a huge treatment effect such as 95% versus 5% responders (difference on the log-scale close to 6), but we are at least mildly skeptical. The dose response is a-priori somewhat likely to follow a Emax curve (with Hill parameter near 1), but we wish to allow for the possibility of a steeper or shallower curve. The dose with half the effect (ED50) might be near 15 mg, but have considerable uncertainty around that.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> E0 <span class="sc">+</span> Emax <span class="sc">*</span> dose<span class="sc">^</span>h <span class="sc">/</span> (dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    Emax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> logit)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">2.944</span>, <span class="fl">0.38</span>), <span class="at">nlpar =</span> E0) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> logh) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">nlpar =</span> Emax) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">2.7</span>, <span class="fl">2.5</span>), <span class="at">nlpar =</span> logED50),</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> peanut <span class="sc">|&gt;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TRT01P, dose) <span class="sc">|&gt;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">sum</span>(CRIT1FL <span class="sc">==</span> <span class="st">"Y"</span>), <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now use <code>tibble(dose = seq(0, 300, 1), n=1) |&gt; tidybayes::add_epred_rvars(object=fit_sigmoid)</code> to obtain predicted proportions for every dose from 0 to 300 mg. Then, plot the curve of predicted proportions for each of these doses using <code>ggplot2</code> and <code>ggdist</code> (using <code>ydist=.epred</code> in the aesthetics and the <code>ggdist::stat_lineribbon()</code> geom).</p>
<p>Next obtain the posterior distribution for the difference in proportions for each of these dose levels compared with placebo.</p>
<p>Try to perform a more efficient statistical analysis by either using an ordinal outcome using <code>family = cumulative(link = "logit", threshold = "flexible")</code> or by treating the data about the logarithm of the amount of protein tolerated as interval censored (<span class="math inline">\(-\infty\)</span> to &lt;log(3), &gt;= log(3) to &lt;log(10) mg, …) using <code>logAVAL | cens("interval", logAVALnext) ~</code> with <code>family = gaussian()</code>. For the latter approach you might have to set <code>log(0)</code> to a very low number such as -28 (approximate log(weight) of one single peanut protein molecule) and assume the upper interval end when a patient could tolerate 1000 mg to, say, <code>log(30000)</code> (approximately 100 peanut kernels). How would you change the prior distributions for these two models? Note, if we had a baseline amount of protein tolerated, we could treat this as a monotonic covariate e.g.&nbsp;using <code>mo(BASE)</code> or assume a particular functional form.</p>
<p>The data below are from a non-clinical study published by Goodner and Horsfall in 1935 (Goodner, K. and Horsfall Jr, F.L., 1935. The protective action of type I antipneumococcus serum in mice: I. The quantitative aspects of the mouse protection test. The Journal of Experimental Medicine, 62(3), pp.359-374.). Mice were given injections of different amounts from a pneumococcus culture, which at the doses given would in the absence of treatment be invariably fatal, mixed together with different doses of type I antipenumococcus horse and rabbit sera. Over several days it was recorded whether each mouse survived or died. This is an example of a dose response curve that appears to have been accepted to be truly non-monotonic in the scientific literature.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>( <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">29</span><span class="sc">*</span><span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">2</span>L, <span class="dv">32</span><span class="sc">*</span><span class="dv">3</span>)),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L), </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"rabbit"</span>, <span class="st">"horse"</span>)),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fl">0.4</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">5</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">6</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">7</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">7</span>L,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="dv">1</span>L<span class="sc">:</span><span class="dv">5</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">each=</span><span class="dv">3</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.4</span>, <span class="dv">18</span>), <span class="fu">rep</span>(<span class="fl">0.2</span>, <span class="dv">21</span>), <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="dv">24</span>), </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="fl">0.05</span>, <span class="dv">24</span>), <span class="fu">rep</span>(<span class="fl">0.4</span>, <span class="dv">15</span>), <span class="fu">rep</span>(<span class="fl">0.2</span>, <span class="dv">27</span>), </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="dv">27</span>), <span class="fu">rep</span>(<span class="fl">0.05</span>,<span class="dv">27</span>)),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Died =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">18</span>),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>L,<span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">5</span>), <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">0</span>L, <span class="dv">14</span>),<span class="dv">1</span>L, <span class="dv">0</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">24</span>), </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">15</span>),</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">8</span>),<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>),<span class="dv">0</span>L, <span class="dv">0</span>L,<span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>), <span class="dv">0</span>L,<span class="dv">1</span>L,<span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">9</span>),<span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">4</span>),<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">6</span>),</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">12</span>),<span class="dv">1</span>L, <span class="dv">0</span>L,<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">7</span>))) <span class="sc">|&gt;</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="dv">1</span>L<span class="sc">-</span>Died)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Displayed in a fashion similar to the original article, the data look as in the figure below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/plot_mice_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An alternative display showing the proportion of mice that survived versus the amount of serum given as displayed in the figure below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02b_dose_finding_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Excercises in increasing order of complexity:</p>
<ol type="1">
<li><p>Fit a sigmoid Emax model to the horse serum data of each individual mouse assuming a Bernoulli distribution after choosing reasonable weakly informative priors, but remember that 0 cc. of serum was stated to result in a death rate of near 100%. Perform model checking.</p></li>
<li><p>Fit a modified beta model to the horse serum data and also perform Bayesian model averaging. Does this result in a better fit?</p></li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-ando2010predlikeli" class="csl-entry" role="listitem">
Ando, Tomohiro, and Ruey Tsay. 2010. <span>“Predictive Likelihood for Bayesian Model Selection and Averaging.”</span> <em>International Journal of Forecasting</em> 26 (4): 744–63. <a href="https://doi.org/10.1016/j.ijforecast.2009.08.001">https://doi.org/10.1016/j.ijforecast.2009.08.001</a>.
</div>
<div id="ref-bornkamp2015drfviewpoint" class="csl-entry" role="listitem">
Bornkamp, Björn. 2015. <span>“Viewpoint: Model Selection Uncertainty, Pre-Specification, and Model Averaging.”</span> <em>Pharmaceutical Statistics</em> 14 (2): 79–81. <a href="https://doi.org/10.1002/pst.1671">https://doi.org/10.1002/pst.1671</a>.
</div>
<div id="ref-bretz2010practical" class="csl-entry" role="listitem">
Bretz, Frank, Holger Dette, and Jose C. Pinheiro. 2010. <span>“Practical Considerations for Optimal Designs in Clinical Dose Finding Studies.”</span> <em>Statistics in Medicine</em> 29 (7-8): 731–42. <a href="https://doi.org/10.1002/sim.3802">https://doi.org/10.1002/sim.3802</a>.
</div>
<div id="ref-gould2019bmamod" class="csl-entry" role="listitem">
Gould, A. Lawrence. 2019. <span>“BMA-Mod: A Bayesian Model Averaging Strategy for Determining Dose-Response Relationships in the Presence of Model Uncertainty.”</span> <em>Biometrical Journal</em> 61 (5): 1141–59. <a href="https://doi.org/10.1002/bimj.201700211">https://doi.org/10.1002/bimj.201700211</a>.
</div>
<div id="ref-pinheiro2014gmcpmod" class="csl-entry" role="listitem">
Pinheiro, José, Björn Bornkamp, Ekkehard Glimm, and Frank Bretz. 2014. <span>“Model-Based Dose Finding Under Model Uncertainty Using General Parametric Models.”</span> <em>Statistics in Medicine</em> 33 (10): 1646–61. <a href="https://doi.org/10.1002/sim.6052">https://doi.org/10.1002/sim.6052</a>.
</div>
<div id="ref-schorning2016selectavg" class="csl-entry" role="listitem">
Schorning, Kirsten, Björn Bornkamp, Frank Bretz, and Holger Dette. 2016. <span>“Model Selection Versus Model Averaging in Dose Finding Studies.”</span> <em>Statistics in Medicine</em> 35 (22): 4021–40. <a href="https://doi.org/10.1002/sim.6991">https://doi.org/10.1002/sim.6991</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02l_single_arm_pos.html" class="pagination-link" aria-label="Probability of success from a single arm trial">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/02c_dose_escalation.html" class="pagination-link" aria-label="Oncology dose escalation">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Björn Holzhauer - &lt;bjoern.holzhauer@novartis.com&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Sebastian Weber - &lt;sebastian.weber@novartis.com&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dose finding {#sec-dose-finding}</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>This case study features specifically</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modeling non-linear summary dose-response data</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Performing Bayesian model averaging</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Comparing prior and posterior distributions</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How priors can be composed in a modular manner</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>libraries and options first:</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show_packages, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE,cache=FALSE}</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"src/02b_dose_finding.qmd"</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8979476</span>)</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background: What role does dose response modeling play in drug development?</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>In clinical drug development, one key question is what dose of a drug</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>should be used to treat a disease. Ideally, we would want a dose that</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>achieves (nearly) optimal efficacy, while at the same time minimizing</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>side effects to optimize the benefit-risk balance. In many</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>therapeutic areas the relationship between dose and efficacy is</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>characterized in Phase IIb clinical trials that randomize patients to</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>received either one of several doses of a drug or a matching placebo.</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>In such studies, it would be inefficient to try a lot of doses and</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>just look at the performance of each dose in isolation. Instead, we</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>know that biologically there should be some smooth function that</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>describes the relationship between dose and efficacy. We can exploit</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>this knowledge to make the analysis of such studies more efficient.</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>There are a number of methods for analyzing such trials that exploit</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>that the true expected difference to placebo will follow some smooth</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>function of the dose. However, we typically do not know what smooth</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>function best approximates the true underlying dose response function.</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>Obvious candidate functions include monotone functions that eventually</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>plateau, and functions that initially achieve a maximum and then</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>decline.</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="dummy"}</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview Video</span></span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a>{{&lt; video videos/brms-case-2-dose-finding.mp4 &gt;}}</span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data: PATHWAY asthma example</span></span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a>We will use the PATHWAY trial as an example. This was a</span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a>placebo-controlled randomized trial of three different tezepelumab</span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a>dosing regimens compared with placebo in severe asthma. Two of the</span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a>tezepelumab dosing regimens were given every 4 weeks. We will treat</span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a>the third regimen of 280 mg every 2 weeks as if it had been 560 mg</span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a>every 4 weeks. The primary endpoint of PATHWAY was the annualized rate</span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a>of asthma exacerbations. The plot below shows the published estimates</span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a>with 95\% confidence intervals per dose. Many standard dose response</span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a>modeling approaches do not require access to individual patient data -</span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a>which in this case is not publically available -, but can be conducted</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a>given estimates and standard error for each dose.</span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE, eval=TRUE, cache=FALSE}</span></span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible to the reader additional setup steps, which are optional</span></span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"src"</span>, <span class="st">"setup.R"</span>))</span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_annualized_rates}</span></span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the PATHWAY DRF data by group</span></span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true" tabindex="-1"></a>pathway <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">210</span>, <span class="dv">280</span><span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">"placebo"</span>, <span class="st">"tezepelumab 70 mg q4w"</span>,</span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"tezepelumab 210 mg q4w"</span>, <span class="st">"tezepelumab 280 mg q2w"</span>),</span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true" tabindex="-1"></a>                  <span class="at">est =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.67</span>, <span class="fl">0.26</span>, <span class="fl">0.19</span>, <span class="fl">0.22</span>)),</span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stderr =</span> <span class="fu">c</span>(<span class="fl">0.10304</span>, <span class="fl">0.17689</span>, <span class="fl">0.22217</span>, <span class="fl">0.19108</span>))</span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple plot of the data</span></span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true" tabindex="-1"></a>pathway <span class="sc">|&gt;</span></span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>est, <span class="at">label=</span><span class="fu">str_wrap</span>(group, <span class="dv">12</span>), <span class="at">col=</span>group,</span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>est<span class="sc">-</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="at">ymax=</span>est<span class="sc">+</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))) <span class="sc">+</span></span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">log</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)), <span class="at">labels=</span><span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Annualized rate (95% CI)"</span>) <span class="sc">+</span></span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose (mg/month)"</span>) <span class="sc">+</span></span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">nudge_x=</span><span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="sc">-</span><span class="dv">30</span>), <span class="at">segment.color =</span> <span class="cn">NA</span>)</span>
<span id="cb53-110"><a href="#cb53-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-111"><a href="#cb53-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-112"><a href="#cb53-112" aria-hidden="true" tabindex="-1"></a>Or to show this as rate ratios compared with the placebo group:</span>
<span id="cb53-113"><a href="#cb53-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-114"><a href="#cb53-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_pathway_deltas}</span></span>
<span id="cb53-115"><a href="#cb53-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-116"><a href="#cb53-116" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-117"><a href="#cb53-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-118"><a href="#cb53-118" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the PATHWAY DRF log-rate-ratios vs. placebo</span></span>
<span id="cb53-119"><a href="#cb53-119" aria-hidden="true" tabindex="-1"></a>pathway_deltas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">210</span>, <span class="dv">280</span><span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb53-120"><a href="#cb53-120" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> <span class="fu">c</span>(<span class="st">"reference level"</span>,</span>
<span id="cb53-121"><a href="#cb53-121" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 70 mg q4w vs. placebo"</span>,</span>
<span id="cb53-122"><a href="#cb53-122" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 210 mg q4w vs. placebo"</span>, </span>
<span id="cb53-123"><a href="#cb53-123" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"tezepelumab 280 mg q2w vs. placebo"</span>),</span>
<span id="cb53-124"><a href="#cb53-124" aria-hidden="true" tabindex="-1"></a>                         <span class="at">logRR=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">log</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="fl">-0.61</span>, <span class="dv">1</span><span class="fl">-0.71</span>, <span class="dv">1</span><span class="fl">-0.66</span>))),</span>
<span id="cb53-125"><a href="#cb53-125" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.lower90 =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="cn">NA_real_</span>, <span class="dv">1</span><span class="fl">-0.75</span>, <span class="dv">1</span><span class="fl">-0.82</span>, <span class="dv">1</span><span class="fl">-0.79</span>)), <span class="co"># Paper reports 90% CIs</span></span>
<span id="cb53-126"><a href="#cb53-126" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.upper90 =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="cn">NA_real_</span>, <span class="dv">1</span><span class="fl">-0.39</span>, <span class="dv">1</span><span class="fl">-0.53</span>, <span class="dv">1</span><span class="fl">-0.47</span>)),</span>
<span id="cb53-127"><a href="#cb53-127" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stderr =</span> (.upper90<span class="sc">-</span>.lower90)<span class="sc">/</span><span class="dv">2</span><span class="sc">/</span><span class="fu">qnorm</span>(<span class="fl">0.95</span>),</span>
<span id="cb53-128"><a href="#cb53-128" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.lower =</span> logRR<span class="sc">-</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>), <span class="co"># Get 95% CIs</span></span>
<span id="cb53-129"><a href="#cb53-129" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.upper =</span> logRR<span class="sc">+</span>stderr<span class="sc">*</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))</span>
<span id="cb53-130"><a href="#cb53-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot log-rate ratios</span></span>
<span id="cb53-131"><a href="#cb53-131" aria-hidden="true" tabindex="-1"></a>pathway_deltas <span class="sc">|&gt;</span></span>
<span id="cb53-132"><a href="#cb53-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>logRR, </span>
<span id="cb53-133"><a href="#cb53-133" aria-hidden="true" tabindex="-1"></a>             <span class="at">label=</span><span class="fu">str_wrap</span>(group, <span class="dv">12</span>), <span class="at">col=</span>group,</span>
<span id="cb53-134"><a href="#cb53-134" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span>.lower, <span class="at">ymax=</span>.upper)) <span class="sc">+</span></span>
<span id="cb53-135"><a href="#cb53-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-136"><a href="#cb53-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb53-137"><a href="#cb53-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb53-138"><a href="#cb53-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">log</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)), <span class="at">labels=</span><span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb53-139"><a href="#cb53-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">600</span>)) <span class="sc">+</span></span>
<span id="cb53-140"><a href="#cb53-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Exacerbation rate ratio (95% CI)"</span>) <span class="sc">+</span></span>
<span id="cb53-141"><a href="#cb53-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose (mg/month)"</span>) <span class="sc">+</span></span>
<span id="cb53-142"><a href="#cb53-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">nudge_x=</span><span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="sc">-</span><span class="dv">30</span>), <span class="at">nudge_y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb53-143"><a href="#cb53-143" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="cn">NA</span>)</span>
<span id="cb53-144"><a href="#cb53-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-145"><a href="#cb53-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-146"><a href="#cb53-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model description</span></span>
<span id="cb53-147"><a href="#cb53-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-148"><a href="#cb53-148" aria-hidden="true" tabindex="-1"></a>To conduct dose response analyses under model uncertainty a number of</span>
<span id="cb53-149"><a href="#cb53-149" aria-hidden="true" tabindex="-1"></a>approaches such as the Multiple Comparison Procedures and Modeling</span>
<span id="cb53-150"><a href="#cb53-150" aria-hidden="true" tabindex="-1"></a>(MCP-Mod) <span class="co">[</span><span class="ot">@bretz2010practical</span><span class="co">]</span>, the generalized MCP-Mod approach</span>
<span id="cb53-151"><a href="#cb53-151" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@pinheiro2014gmcpmod</span><span class="co">]</span> and Gaussian process based approaches are</span>
<span id="cb53-152"><a href="#cb53-152" aria-hidden="true" tabindex="-1"></a>popular.  Within the generalized MCP-Mod framework model averaging is</span>
<span id="cb53-153"><a href="#cb53-153" aria-hidden="true" tabindex="-1"></a>an attractive approach <span class="co">[</span><span class="ot">@bornkamp2015drfviewpoint</span><span class="co">]</span> for dealing with</span>
<span id="cb53-154"><a href="#cb53-154" aria-hidden="true" tabindex="-1"></a>model uncertainty that has performed well in simulation studies</span>
<span id="cb53-155"><a href="#cb53-155" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@schorning2016selectavg</span><span class="co">]</span>. Here, we take a Bayesian approach to model</span>
<span id="cb53-156"><a href="#cb53-156" aria-hidden="true" tabindex="-1"></a>averaging in the MCP-Mod framework, which is called BMA-Mod (BMA</span>
<span id="cb53-157"><a href="#cb53-157" aria-hidden="true" tabindex="-1"></a>stands for Bayesian model averaging) <span class="co">[</span><span class="ot">@gould2019bmamod</span><span class="co">]</span>.</span>
<span id="cb53-158"><a href="#cb53-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-159"><a href="#cb53-159" aria-hidden="true" tabindex="-1"></a>While more complex mechanistic pharmacokinetic/pharmacodynamic (PK/PD)</span>
<span id="cb53-160"><a href="#cb53-160" aria-hidden="true" tabindex="-1"></a>models are often important, here, we discuss directly modelling the</span>
<span id="cb53-161"><a href="#cb53-161" aria-hidden="true" tabindex="-1"></a>relationship between dose and some clinical outcome in patients.</span>
<span id="cb53-162"><a href="#cb53-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-163"><a href="#cb53-163" aria-hidden="true" tabindex="-1"></a>BMA-Mod, just as MCP-Mod, uses a set of candidate models that might</span>
<span id="cb53-164"><a href="#cb53-164" aria-hidden="true" tabindex="-1"></a>describe dose response relationships.  In the subsections that follow,</span>
<span id="cb53-165"><a href="#cb53-165" aria-hidden="true" tabindex="-1"></a>we describe each model.</span>
<span id="cb53-166"><a href="#cb53-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-167"><a href="#cb53-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### The likelihood function into which we put the dose response model</span></span>
<span id="cb53-168"><a href="#cb53-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-169"><a href="#cb53-169" aria-hidden="true" tabindex="-1"></a>No matter whether we use summary data consiting of estimates with</span>
<span id="cb53-170"><a href="#cb53-170" aria-hidden="true" tabindex="-1"></a>standard errors with each treatment group, or whether we have</span>
<span id="cb53-171"><a href="#cb53-171" aria-hidden="true" tabindex="-1"></a>individual patient data (IPD) for a continuous, binary, count,</span>
<span id="cb53-172"><a href="#cb53-172" aria-hidden="true" tabindex="-1"></a>time-to-event or ordinal outcome, our regression model will be one of</span>
<span id="cb53-173"><a href="#cb53-173" aria-hidden="true" tabindex="-1"></a>the dose response models we will describe in the subsequent sections.</span>
<span id="cb53-174"><a href="#cb53-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-175"><a href="#cb53-175" aria-hidden="true" tabindex="-1"></a>What will differ is the likelihood function, into which we insert the</span>
<span id="cb53-176"><a href="#cb53-176" aria-hidden="true" tabindex="-1"></a>dose response function.  In the PATHWAY example, we will use that the</span>
<span id="cb53-177"><a href="#cb53-177" aria-hidden="true" tabindex="-1"></a>estimates for log-mean-event-rate for each dose level $i=1,\ldots,I$</span>
<span id="cb53-178"><a href="#cb53-178" aria-hidden="true" tabindex="-1"></a>are approximately indpendent with $\hat{\theta}_i \sim N(\theta_i,</span>
<span id="cb53-179"><a href="#cb53-179" aria-hidden="true" tabindex="-1"></a>\text{SE}(\hat{\theta}_i))$ distributions.  Thus, we can use a</span>
<span id="cb53-180"><a href="#cb53-180" aria-hidden="true" tabindex="-1"></a>Gaussian likelihood with known standard deviation. In case of IPD, we</span>
<span id="cb53-181"><a href="#cb53-181" aria-hidden="true" tabindex="-1"></a>would instead use suitable IPD-likelihoods. This only requires minimal</span>
<span id="cb53-182"><a href="#cb53-182" aria-hidden="true" tabindex="-1"></a>changes in the code for the examples.</span>
<span id="cb53-183"><a href="#cb53-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-184"><a href="#cb53-184" aria-hidden="true" tabindex="-1"></a><span class="fu">### The sigmoid-Emax and the Emax model</span></span>
<span id="cb53-185"><a href="#cb53-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-186"><a href="#cb53-186" aria-hidden="true" tabindex="-1"></a>A very popular dose response model is the **sigmoid-Emax model**. This</span>
<span id="cb53-187"><a href="#cb53-187" aria-hidden="true" tabindex="-1"></a>model assumes that the outcome for each dose group can be described by</span>
<span id="cb53-188"><a href="#cb53-188" aria-hidden="true" tabindex="-1"></a>a function of the form $$f(\text{dose}; \text{parameters}) =</span>
<span id="cb53-189"><a href="#cb53-189" aria-hidden="true" tabindex="-1"></a>\text{E}_0 + \text{E}_\text{max} \times</span>
<span id="cb53-190"><a href="#cb53-190" aria-hidden="true" tabindex="-1"></a>\frac{\text{dose}^h}{\text{dose}^h + \text{ED}_{50}^h}.$$ This is a</span>
<span id="cb53-191"><a href="#cb53-191" aria-hidden="true" tabindex="-1"></a>monotone curve that starts at no difference to placebo at dose 0 (the</span>
<span id="cb53-192"><a href="#cb53-192" aria-hidden="true" tabindex="-1"></a>expected placebo response is $\text{E}_0$) and plateaus at a maximum</span>
<span id="cb53-193"><a href="#cb53-193" aria-hidden="true" tabindex="-1"></a>effect of size $\text{E}_\text{max} \in (-\infty, \infty)$. 50\% of</span>
<span id="cb53-194"><a href="#cb53-194" aria-hidden="true" tabindex="-1"></a>the maximum effect is reached at the dose $\text{ED}_{50} \in (0,</span>
<span id="cb53-195"><a href="#cb53-195" aria-hidden="true" tabindex="-1"></a>\infty)$.  The steepness of the curve is determined by the so-called</span>
<span id="cb53-196"><a href="#cb53-196" aria-hidden="true" tabindex="-1"></a>Hill parameter $h \in (0, \infty)$. For $h=1$, we have the simple</span>
<span id="cb53-197"><a href="#cb53-197" aria-hidden="true" tabindex="-1"></a>**Emax model**, for $h&gt;1$ the dose response curve is steeper around</span>
<span id="cb53-198"><a href="#cb53-198" aria-hidden="true" tabindex="-1"></a>$\text{ED}_{50}$ (and plateaus faster) than for a simple Emax model,</span>
<span id="cb53-199"><a href="#cb53-199" aria-hidden="true" tabindex="-1"></a>while for $h&lt;1$ the curve is less steep.  Typical values of $h$ are</span>
<span id="cb53-200"><a href="#cb53-200" aria-hidden="true" tabindex="-1"></a>smaller than 5 and usually at most 3, so assigning a prior that puts</span>
<span id="cb53-201"><a href="#cb53-201" aria-hidden="true" tabindex="-1"></a>most of the prior weight for $\log h$ between $-\log 5$ and $\log 5$</span>
<span id="cb53-202"><a href="#cb53-202" aria-hidden="true" tabindex="-1"></a>makes sense.</span>
<span id="cb53-203"><a href="#cb53-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-204"><a href="#cb53-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sigemax_plots, echo=FALSE}</span></span>
<span id="cb53-205"><a href="#cb53-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot some example sigEmax curves</span></span>
<span id="cb53-206"><a href="#cb53-206" aria-hidden="true" tabindex="-1"></a>sig_curves <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb53-207"><a href="#cb53-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dose =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="fl">0.1</span>),</span>
<span id="cb53-208"><a href="#cb53-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emax =</span> <span class="dv">1</span>,</span>
<span id="cb53-209"><a href="#cb53-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">E0 =</span> <span class="dv">0</span>,</span>
<span id="cb53-210"><a href="#cb53-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">ED50 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">25</span>),</span>
<span id="cb53-211"><a href="#cb53-211" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb53-212"><a href="#cb53-212" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb53-213"><a href="#cb53-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-214"><a href="#cb53-214" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Dose response</span><span class="st">`</span> <span class="ot">=</span> E0 <span class="sc">+</span> Emax <span class="sc">*</span> Dose<span class="sc">^</span>h <span class="sc">/</span> (Dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb53-215"><a href="#cb53-215" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"ED50="</span>, ED50, <span class="st">"/h="</span>, <span class="fu">round</span>(h, <span class="dv">2</span>))</span>
<span id="cb53-216"><a href="#cb53-216" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-217"><a href="#cb53-217" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb53-218"><a href="#cb53-218" aria-hidden="true" tabindex="-1"></a>  sig_curves,</span>
<span id="cb53-219"><a href="#cb53-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Dose, <span class="at">y =</span> <span class="st">`</span><span class="at">Dose response</span><span class="st">`</span>, <span class="at">color =</span> text, <span class="at">label =</span> text)</span>
<span id="cb53-220"><a href="#cb53-220" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb53-221"><a href="#cb53-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb53-222"><a href="#cb53-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>))) <span class="sc">+</span></span>
<span id="cb53-223"><a href="#cb53-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb53-224"><a href="#cb53-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(sig_curves, Dose <span class="sc">==</span> <span class="dv">50</span>),</span>
<span id="cb53-225"><a href="#cb53-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.iter =</span> <span class="dv">100</span>,</span>
<span id="cb53-226"><a href="#cb53-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">30</span>, <span class="sc">-</span><span class="dv">16</span>, <span class="dv">30</span>, <span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb53-227"><a href="#cb53-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.color =</span> <span class="cn">NA</span>,</span>
<span id="cb53-228"><a href="#cb53-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.02</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.02</span>, <span class="sc">-</span><span class="fl">0.03</span>, <span class="sc">-</span><span class="fl">0.1</span>)</span>
<span id="cb53-229"><a href="#cb53-229" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-230"><a href="#cb53-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-231"><a href="#cb53-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-232"><a href="#cb53-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-233"><a href="#cb53-233" aria-hidden="true" tabindex="-1"></a>The Emax model is a simple model with some biological plausibility.</span>
<span id="cb53-234"><a href="#cb53-234" aria-hidden="true" tabindex="-1"></a>It is the equation that results from assuming the drug concentrations</span>
<span id="cb53-235"><a href="#cb53-235" aria-hidden="true" tabindex="-1"></a>at the site of drug action are proportional to the administered dose,</span>
<span id="cb53-236"><a href="#cb53-236" aria-hidden="true" tabindex="-1"></a>that drug binds to and unbinds from a receptor at a rate proportional</span>
<span id="cb53-237"><a href="#cb53-237" aria-hidden="true" tabindex="-1"></a>to the drug concentration, and that drugs effects are proportional to</span>
<span id="cb53-238"><a href="#cb53-238" aria-hidden="true" tabindex="-1"></a>receptor occupancy.  And, it assumes that all these relationships are</span>
<span id="cb53-239"><a href="#cb53-239" aria-hidden="true" tabindex="-1"></a>exactly the same for all patients.  All of these assumptions can be</span>
<span id="cb53-240"><a href="#cb53-240" aria-hidden="true" tabindex="-1"></a>relaxed/avoided when individual patient data (and even better, if also</span>
<span id="cb53-241"><a href="#cb53-241" aria-hidden="true" tabindex="-1"></a>the necessary data for PK/PD modeling) are available.</span>
<span id="cb53-242"><a href="#cb53-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-243"><a href="#cb53-243" aria-hidden="true" tabindex="-1"></a><span class="fu">### The modified beta model</span></span>
<span id="cb53-244"><a href="#cb53-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-245"><a href="#cb53-245" aria-hidden="true" tabindex="-1"></a>Another possible dose response model is the modified beta model.</span>
<span id="cb53-246"><a href="#cb53-246" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = \text{E}_0 + \text{E}_{\text{max</span>
<span id="cb53-247"><a href="#cb53-247" aria-hidden="true" tabindex="-1"></a>}2} \times \frac{(\delta_1 + \delta_2)^{\delta_1 +</span>
<span id="cb53-248"><a href="#cb53-248" aria-hidden="true" tabindex="-1"></a>\delta_2}}{\delta_1^{\delta_1} + \delta_2^{\delta_2}} \times</span>
<span id="cb53-249"><a href="#cb53-249" aria-hidden="true" tabindex="-1"></a>(\frac{\text{dose}}{S})^{\delta_1} \times</span>
<span id="cb53-250"><a href="#cb53-250" aria-hidden="true" tabindex="-1"></a>(1-\frac{\text{dose}}{S})^{\delta_2}$$ This model is capable of</span>
<span id="cb53-251"><a href="#cb53-251" aria-hidden="true" tabindex="-1"></a>describing a non-monotone dose response.</span>
<span id="cb53-252"><a href="#cb53-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-253"><a href="#cb53-253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exponential model, and linear and quadratic functions of dose or log-dose</span></span>
<span id="cb53-254"><a href="#cb53-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-255"><a href="#cb53-255" aria-hidden="true" tabindex="-1"></a>The exponential model</span>
<span id="cb53-256"><a href="#cb53-256" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = b_1 + b_2 (\exp(b_3 \times \text{dose})-1)$$</span>
<span id="cb53-257"><a href="#cb53-257" aria-hidden="true" tabindex="-1"></a>with $b_3&lt;0$ was also discussed by <span class="co">[</span><span class="ot">@gould2019bmamod</span><span class="co">]</span>.</span>
<span id="cb53-258"><a href="#cb53-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-259"><a href="#cb53-259" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@gould2019bmamod</span><span class="co">]</span> also considered linear and quadratic functions of dose or log-dose. I.e.</span>
<span id="cb53-260"><a href="#cb53-260" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta \times \text{dose},$$</span>
<span id="cb53-261"><a href="#cb53-261" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta \times \log (\text{dose}),$$</span>
<span id="cb53-262"><a href="#cb53-262" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta_1 \times \text{dose} + \beta_2 \times \text{dose}^2$$</span>
<span id="cb53-263"><a href="#cb53-263" aria-hidden="true" tabindex="-1"></a>or</span>
<span id="cb53-264"><a href="#cb53-264" aria-hidden="true" tabindex="-1"></a>$$f(\text{dose}; \text{parameters}) = \text{E}_0 + \beta_1 \times \log (\text{dose}) + \beta_2 \times (\log (\text{dose}))^2.$$</span>
<span id="cb53-265"><a href="#cb53-265" aria-hidden="true" tabindex="-1"></a>These models are perhaps better suited towards modeling the dose-response relationship within the range of tested dose </span>
<span id="cb53-266"><a href="#cb53-266" aria-hidden="true" tabindex="-1"></a>and would not necessarily be expected to extrapolate well beyond the data range. Nevertheless, they may be useful for providing a more flexible set of models.</span>
<span id="cb53-267"><a href="#cb53-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-268"><a href="#cb53-268" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Model averaging</span></span>
<span id="cb53-269"><a href="#cb53-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-270"><a href="#cb53-270" aria-hidden="true" tabindex="-1"></a>If we have multiple models that are similarly plausible given our</span>
<span id="cb53-271"><a href="#cb53-271" aria-hidden="true" tabindex="-1"></a>prior information and the data we observed, then picking a single</span>
<span id="cb53-272"><a href="#cb53-272" aria-hidden="true" tabindex="-1"></a>model out of these ignores the model uncertainty.  For this reason,</span>
<span id="cb53-273"><a href="#cb53-273" aria-hidden="true" tabindex="-1"></a>model averaging is known to be a good approach for dealing with model</span>
<span id="cb53-274"><a href="#cb53-274" aria-hidden="true" tabindex="-1"></a>uncertainty.  It assigns greater weight to more plausible models and</span>
<span id="cb53-275"><a href="#cb53-275" aria-hidden="true" tabindex="-1"></a>can - given enough evidence - give all weight to a single clearly best</span>
<span id="cb53-276"><a href="#cb53-276" aria-hidden="true" tabindex="-1"></a>model (and also give near-zero weight to clearly inappropriate</span>
<span id="cb53-277"><a href="#cb53-277" aria-hidden="true" tabindex="-1"></a>models).  So, - given enough data - it effectively results in model</span>
<span id="cb53-278"><a href="#cb53-278" aria-hidden="true" tabindex="-1"></a>selection, but as long as we only have limited information multiple</span>
<span id="cb53-279"><a href="#cb53-279" aria-hidden="true" tabindex="-1"></a>models will contribute to our inference.</span>
<span id="cb53-280"><a href="#cb53-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-281"><a href="#cb53-281" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@gould2019bmamod</span><span class="co">]</span> proposes to use a weighted combination of the</span>
<span id="cb53-282"><a href="#cb53-282" aria-hidden="true" tabindex="-1"></a>predictions for each dose level from each of the candidate models and</span>
<span id="cb53-283"><a href="#cb53-283" aria-hidden="true" tabindex="-1"></a>suggests to base the posterior model weigths on predictive likelihood</span>
<span id="cb53-284"><a href="#cb53-284" aria-hidden="true" tabindex="-1"></a>weights <span class="co">[</span><span class="ot">@ando2010predlikeli</span><span class="co">]</span>.</span>
<span id="cb53-285"><a href="#cb53-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-286"><a href="#cb53-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-287"><a href="#cb53-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation and results</span></span>
<span id="cb53-288"><a href="#cb53-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-289"><a href="#cb53-289" aria-hidden="true" tabindex="-1"></a>We will now fit the various dose response models introduced in the</span>
<span id="cb53-290"><a href="#cb53-290" aria-hidden="true" tabindex="-1"></a>statistical model section using <span class="in">`brms`</span>.  We will start with the</span>
<span id="cb53-291"><a href="#cb53-291" aria-hidden="true" tabindex="-1"></a>sigmoid-Emax model and look at the things <span class="in">`brms`</span> let us do easily with</span>
<span id="cb53-292"><a href="#cb53-292" aria-hidden="true" tabindex="-1"></a>a single fitted model.  We will not repeat that level of exploration</span>
<span id="cb53-293"><a href="#cb53-293" aria-hidden="true" tabindex="-1"></a>for other models, but you may wish to do so in practice.</span>
<span id="cb53-294"><a href="#cb53-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-295"><a href="#cb53-295" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sigmoid-Emax model with `brms`</span></span>
<span id="cb53-296"><a href="#cb53-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-297"><a href="#cb53-297" aria-hidden="true" tabindex="-1"></a>We use the capabilities of <span class="in">`brms`</span> for fitting non-linear models. For</span>
<span id="cb53-298"><a href="#cb53-298" aria-hidden="true" tabindex="-1"></a>example, a sigmoid-Emax model can be fitted as follows:</span>
<span id="cb53-299"><a href="#cb53-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-300"><a href="#cb53-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_sigemax, results='hide', message=FALSE, warning=FALSE}</span></span>
<span id="cb53-301"><a href="#cb53-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a sigmoid Emax model</span></span>
<span id="cb53-302"><a href="#cb53-302" aria-hidden="true" tabindex="-1"></a>model_sigmoid <span class="ot">&lt;-</span> <span class="fu">bf</span>(est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span> E0 <span class="sc">+</span> sEmax <span class="sc">*</span> dose<span class="sc">^</span>h<span class="sc">/</span>(dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb53-303"><a href="#cb53-303" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)), <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb53-304"><a href="#cb53-304" aria-hidden="true" tabindex="-1"></a>                    E0 <span class="sc">~</span> <span class="dv">1</span>, logED50 <span class="sc">~</span> <span class="dv">1</span>, logh <span class="sc">~</span> <span class="dv">1</span>, sEmax <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb53-305"><a href="#cb53-305" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nl=</span><span class="cn">TRUE</span>, <span class="at">family=</span><span class="fu">gaussian</span>())</span>
<span id="cb53-306"><a href="#cb53-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-307"><a href="#cb53-307" aria-hidden="true" tabindex="-1"></a>prior_sigmoid <span class="ot">&lt;-</span></span>
<span id="cb53-308"><a href="#cb53-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>E0) <span class="sc">+</span></span>
<span id="cb53-309"><a href="#cb53-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>logh) <span class="sc">+</span></span>
<span id="cb53-310"><a href="#cb53-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar=</span>sEmax) <span class="sc">+</span></span>
<span id="cb53-311"><a href="#cb53-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">4</span>, <span class="dv">2</span>), <span class="at">nlpar=</span>logED50)</span>
<span id="cb53-312"><a href="#cb53-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-313"><a href="#cb53-313" aria-hidden="true" tabindex="-1"></a>fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_sigmoid,</span>
<span id="cb53-314"><a href="#cb53-314" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>pathway,</span>
<span id="cb53-315"><a href="#cb53-315" aria-hidden="true" tabindex="-1"></a>                   <span class="at">prior =</span> prior_sigmoid,</span>
<span id="cb53-316"><a href="#cb53-316" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.9</span>),</span>
<span id="cb53-317"><a href="#cb53-317" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed=</span><span class="dv">3624</span>,</span>
<span id="cb53-318"><a href="#cb53-318" aria-hidden="true" tabindex="-1"></a>                   <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb53-319"><a href="#cb53-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-320"><a href="#cb53-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-321"><a href="#cb53-321" aria-hidden="true" tabindex="-1"></a>Note that with individual patient data, we would not write <span class="in">`est | se(stderr) ~`</span>,</span>
<span id="cb53-322"><a href="#cb53-322" aria-hidden="true" tabindex="-1"></a>but would instead use <span class="in">`outcome ~ `</span> and  <span class="in">`bf() + negbinomial()`</span> </span>
<span id="cb53-323"><a href="#cb53-323" aria-hidden="true" tabindex="-1"></a>(and similarly, e.g. <span class="in">`+ gaussian()`</span> for continuous data). With the settings above,</span>
<span id="cb53-324"><a href="#cb53-324" aria-hidden="true" tabindex="-1"></a>you might still experience a divergent transition or two and you may wish to increase</span>
<span id="cb53-325"><a href="#cb53-325" aria-hidden="true" tabindex="-1"></a><span class="in">`adapt_delta`</span> to <span class="in">`0.95`</span> or <span class="in">`0.99`</span>, or alternatively try to come up with a way </span>
<span id="cb53-326"><a href="#cb53-326" aria-hidden="true" tabindex="-1"></a>to reparameterize the model.</span>
<span id="cb53-327"><a href="#cb53-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-328"><a href="#cb53-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarize_fit1}</span></span>
<span id="cb53-329"><a href="#cb53-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize model fit</span></span>
<span id="cb53-330"><a href="#cb53-330" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_sigmoid)</span>
<span id="cb53-331"><a href="#cb53-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-332"><a href="#cb53-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-333"><a href="#cb53-333" aria-hidden="true" tabindex="-1"></a>So what does the model fit look like? We have two options for looking at this. </span>
<span id="cb53-334"><a href="#cb53-334" aria-hidden="true" tabindex="-1"></a>The easiest and fastest uses the <span class="in">`conditional_effects`</span> function from</span>
<span id="cb53-335"><a href="#cb53-335" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span>.</span>
<span id="cb53-336"><a href="#cb53-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-337"><a href="#cb53-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb53-338"><a href="#cb53-338" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">conditional_effects</span>(fit_sigmoid, <span class="st">"dose"</span>), </span>
<span id="cb53-339"><a href="#cb53-339" aria-hidden="true" tabindex="-1"></a>     <span class="at">points =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-340"><a href="#cb53-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-341"><a href="#cb53-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-342"><a href="#cb53-342" aria-hidden="true" tabindex="-1"></a>The downside is that in a controlled trial we are primarily interested in </span>
<span id="cb53-343"><a href="#cb53-343" aria-hidden="true" tabindex="-1"></a>the contrast with placebo and that we would like to see the confidence</span>
<span id="cb53-344"><a href="#cb53-344" aria-hidden="true" tabindex="-1"></a>intervals around the point estimates for each dose. We can obtain that </span>
<span id="cb53-345"><a href="#cb53-345" aria-hidden="true" tabindex="-1"></a>with a little bit more code:</span>
<span id="cb53-346"><a href="#cb53-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-347"><a href="#cb53-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r predict_sigemax, results='hide',cache=FALSE}</span></span>
<span id="cb53-348"><a href="#cb53-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-349"><a href="#cb53-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-350"><a href="#cb53-350" aria-hidden="true" tabindex="-1"></a>plot_dose_response <span class="ot">&lt;-</span> <span class="cf">function</span>(model, newdata) {</span>
<span id="cb53-351"><a href="#cb53-351" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We are going to predict the annualized rate for all doses from 0,1,2,...600.</span></span>
<span id="cb53-352"><a href="#cb53-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We are setting stderr=0 to avoid predicting with sampling variability.</span></span>
<span id="cb53-353"><a href="#cb53-353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">missing</span>(newdata)) {</span>
<span id="cb53-354"><a href="#cb53-354" aria-hidden="true" tabindex="-1"></a>    newdata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">seq</span>(<span class="dv">0</span>L, <span class="dv">600</span>L, <span class="at">length.out =</span> <span class="dv">101</span>), <span class="at">stderr =</span> <span class="dv">0</span>)</span>
<span id="cb53-355"><a href="#cb53-355" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-356"><a href="#cb53-356" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-357"><a href="#cb53-357" aria-hidden="true" tabindex="-1"></a>  pred_newdata <span class="ot">&lt;-</span> newdata <span class="sc">|&gt;</span></span>
<span id="cb53-358"><a href="#cb53-358" aria-hidden="true" tabindex="-1"></a>    tidybayes<span class="sc">::</span><span class="fu">add_predicted_rvars</span>(model) <span class="sc">|&gt;</span></span>
<span id="cb53-359"><a href="#cb53-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">logRR =</span> .prediction <span class="sc">-</span> .prediction[dose <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">|&gt;</span></span>
<span id="cb53-360"><a href="#cb53-360" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>.prediction)</span>
<span id="cb53-361"><a href="#cb53-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-362"><a href="#cb53-362" aria-hidden="true" tabindex="-1"></a>  pred_newdata <span class="sc">|&gt;</span></span>
<span id="cb53-363"><a href="#cb53-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">ydist =</span> logRR)) <span class="sc">+</span></span>
<span id="cb53-364"><a href="#cb53-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-365"><a href="#cb53-365" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>)) <span class="sc">+</span></span>
<span id="cb53-366"><a href="#cb53-366" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb53-367"><a href="#cb53-367" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pathway_deltas,</span>
<span id="cb53-368"><a href="#cb53-368" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR),</span>
<span id="cb53-369"><a href="#cb53-369" aria-hidden="true" tabindex="-1"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb53-370"><a href="#cb53-370" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb53-371"><a href="#cb53-371" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(</span>
<span id="cb53-372"><a href="#cb53-372" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> pathway_deltas,</span>
<span id="cb53-373"><a href="#cb53-373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb53-374"><a href="#cb53-374" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb53-375"><a href="#cb53-375" aria-hidden="true" tabindex="-1"></a>      <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb53-376"><a href="#cb53-376" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb53-377"><a href="#cb53-377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb53-378"><a href="#cb53-378" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb53-379"><a href="#cb53-379" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="dv">100</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)), <span class="st">"%"</span>)</span>
<span id="cb53-380"><a href="#cb53-380" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb53-381"><a href="#cb53-381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Relative rate reduction"</span>) <span class="sc">+</span></span>
<span id="cb53-382"><a href="#cb53-382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Total tezepelumab dose [mg/month]"</span>)</span>
<span id="cb53-383"><a href="#cb53-383" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-384"><a href="#cb53-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-385"><a href="#cb53-385" aria-hidden="true" tabindex="-1"></a>dr_sigmoid <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">+</span></span>
<span id="cb53-386"><a href="#cb53-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb53-387"><a href="#cb53-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">300</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>), <span class="at">label =</span> <span class="st">"SigMod Emax model fit"</span>, <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb53-388"><a href="#cb53-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-389"><a href="#cb53-389" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_sigmoid)</span>
<span id="cb53-390"><a href="#cb53-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-391"><a href="#cb53-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-392"><a href="#cb53-392" aria-hidden="true" tabindex="-1"></a>We can also plot the dose response curve for each MCMC sample:</span>
<span id="cb53-393"><a href="#cb53-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-394"><a href="#cb53-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_each_curve}</span></span>
<span id="cb53-395"><a href="#cb53-395" aria-hidden="true" tabindex="-1"></a> dr_sigmoid<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb53-396"><a href="#cb53-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_rvars</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-397"><a href="#cb53-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_draws</span>(<span class="dv">500</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-398"><a href="#cb53-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> logRR, <span class="at">group =</span> <span class="fu">factor</span>(.draw))) <span class="sc">+</span></span>
<span id="cb53-399"><a href="#cb53-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-400"><a href="#cb53-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb53-401"><a href="#cb53-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pathway_deltas <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="cn">NA_integer_</span>)) <span class="sc">+</span></span>
<span id="cb53-402"><a href="#cb53-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(</span>
<span id="cb53-403"><a href="#cb53-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pathway_deltas <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="cn">NA_integer_</span>),</span>
<span id="cb53-404"><a href="#cb53-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb53-405"><a href="#cb53-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">10</span></span>
<span id="cb53-406"><a href="#cb53-406" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-407"><a href="#cb53-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb53-408"><a href="#cb53-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)),</span>
<span id="cb53-409"><a href="#cb53-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">paste</span>(<span class="dv">100</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)), <span class="st">"%"</span>)</span>
<span id="cb53-410"><a href="#cb53-410" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-411"><a href="#cb53-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Relative rate reduction"</span>) <span class="sc">+</span></span>
<span id="cb53-412"><a href="#cb53-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Total tezepelumab dose [mg/month]"</span>)</span>
<span id="cb53-413"><a href="#cb53-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-414"><a href="#cb53-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-415"><a href="#cb53-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-416"><a href="#cb53-416" aria-hidden="true" tabindex="-1"></a>By rearranging the sigmoid-Emax model equation, we can directly</span>
<span id="cb53-417"><a href="#cb53-417" aria-hidden="true" tabindex="-1"></a>compute the implied posterior for the dose leading to a 50% relative</span>
<span id="cb53-418"><a href="#cb53-418" aria-hidden="true" tabindex="-1"></a>rate reduction (provided that Emax is sufficiently large). For the</span>
<span id="cb53-419"><a href="#cb53-419" aria-hidden="true" tabindex="-1"></a>calculation we use from the R package posterior its <span class="in">`rvars`</span></span>
<span id="cb53-420"><a href="#cb53-420" aria-hidden="true" tabindex="-1"></a>functionality, which simplifies these calulations.</span>
<span id="cb53-421"><a href="#cb53-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-422"><a href="#cb53-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_dose_with_50rrr, results='hide', message=FALSE, warning=FALSE}</span></span>
<span id="cb53-423"><a href="#cb53-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-424"><a href="#cb53-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-425"><a href="#cb53-425" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior as rvars collection of draws</span></span>
<span id="cb53-426"><a href="#cb53-426" aria-hidden="true" tabindex="-1"></a>post_sigmoid_rvs <span class="ot">&lt;-</span> <span class="fu">as_draws_rvars</span>(fit_sigmoid)</span>
<span id="cb53-427"><a href="#cb53-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-428"><a href="#cb53-428" aria-hidden="true" tabindex="-1"></a><span class="co"># target effect we look for</span></span>
<span id="cb53-429"><a href="#cb53-429" aria-hidden="true" tabindex="-1"></a>logRR_target <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fl">0.5</span>)</span>
<span id="cb53-430"><a href="#cb53-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-431"><a href="#cb53-431" aria-hidden="true" tabindex="-1"></a><span class="co"># determine draws for which Emax is sufficiently large for the effect</span></span>
<span id="cb53-432"><a href="#cb53-432" aria-hidden="true" tabindex="-1"></a><span class="co"># we are looking for</span></span>
<span id="cb53-433"><a href="#cb53-433" aria-hidden="true" tabindex="-1"></a>large_Emax_rv <span class="ot">&lt;-</span> <span class="fu">with</span>(post_sigmoid_rvs, b_sEmax_Intercept <span class="sc">&lt;</span> logRR_target)</span>
<span id="cb53-434"><a href="#cb53-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-435"><a href="#cb53-435" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of doses having the target effect (if possible),</span></span>
<span id="cb53-436"><a href="#cb53-436" aria-hidden="true" tabindex="-1"></a><span class="co"># (Emax/logRR_target - 1)^(-1/h) * ED50</span></span>
<span id="cb53-437"><a href="#cb53-437" aria-hidden="true" tabindex="-1"></a><span class="co"># in log space this is</span></span>
<span id="cb53-438"><a href="#cb53-438" aria-hidden="true" tabindex="-1"></a><span class="co"># -1/h * log(Emax/logRR_target - 1) + log(ED50)</span></span>
<span id="cb53-439"><a href="#cb53-439" aria-hidden="true" tabindex="-1"></a>log_dose_min_rv <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb53-440"><a href="#cb53-440" aria-hidden="true" tabindex="-1"></a>  post_sigmoid_rvs,</span>
<span id="cb53-441"><a href="#cb53-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvar_ifelse</span>(</span>
<span id="cb53-442"><a href="#cb53-442" aria-hidden="true" tabindex="-1"></a>    large_Emax_rv,</span>
<span id="cb53-443"><a href="#cb53-443" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span></span>
<span id="cb53-444"><a href="#cb53-444" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> b_logh_Intercept) <span class="sc">*</span></span>
<span id="cb53-445"><a href="#cb53-445" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(b_sEmax_Intercept <span class="sc">/</span> logRR_target <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb53-446"><a href="#cb53-446" aria-hidden="true" tabindex="-1"></a>      b_logED50_Intercept,</span>
<span id="cb53-447"><a href="#cb53-447" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Inf</span></span>
<span id="cb53-448"><a href="#cb53-448" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-449"><a href="#cb53-449" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-450"><a href="#cb53-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-451"><a href="#cb53-451" aria-hidden="true" tabindex="-1"></a><span class="co"># restrict the posterior draws to cases whenever we can actually reach</span></span>
<span id="cb53-452"><a href="#cb53-452" aria-hidden="true" tabindex="-1"></a><span class="co"># the desired effect</span></span>
<span id="cb53-453"><a href="#cb53-453" aria-hidden="true" tabindex="-1"></a>log_dose_min_rv <span class="ot">&lt;-</span> <span class="fu">subset_draws</span>(</span>
<span id="cb53-454"><a href="#cb53-454" aria-hidden="true" tabindex="-1"></a>  log_dose_min_rv,</span>
<span id="cb53-455"><a href="#cb53-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">draw =</span> <span class="fu">which</span>(<span class="fu">draws_of</span>(large_Emax_rv))</span>
<span id="cb53-456"><a href="#cb53-456" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-457"><a href="#cb53-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-458"><a href="#cb53-458" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">dose_min =</span> <span class="fu">exp</span>(log_dose_min_rv)) <span class="sc">|&gt;</span></span>
<span id="cb53-459"><a href="#cb53-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">dist =</span> dose_min)) <span class="sc">+</span></span>
<span id="cb53-460"><a href="#cb53-460" aria-hidden="true" tabindex="-1"></a>  ggdist<span class="sc">::</span><span class="fu">stat_halfeye</span>() <span class="sc">+</span></span>
<span id="cb53-461"><a href="#cb53-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb53-462"><a href="#cb53-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tezepelumab dose [mg/month]"</span>) <span class="sc">+</span></span>
<span id="cb53-463"><a href="#cb53-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb53-464"><a href="#cb53-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-465"><a href="#cb53-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-466"><a href="#cb53-466" aria-hidden="true" tabindex="-1"></a>As the plot below shows the data resulted in a substantially different</span>
<span id="cb53-467"><a href="#cb53-467" aria-hidden="true" tabindex="-1"></a>posterior distribution compared with the prior distribution for the</span>
<span id="cb53-468"><a href="#cb53-468" aria-hidden="true" tabindex="-1"></a><span class="in">`logED50`</span> parameter and the <span class="in">`Emax`</span> parameter.  These parameters are</span>
<span id="cb53-469"><a href="#cb53-469" aria-hidden="true" tabindex="-1"></a>reasonably well-identified even with just 3 doses - although the ED50</span>
<span id="cb53-470"><a href="#cb53-470" aria-hidden="true" tabindex="-1"></a>would be better estimated, if doses with approximately 50\% of the</span>
<span id="cb53-471"><a href="#cb53-471" aria-hidden="true" tabindex="-1"></a>Emax (maximum relative rate reduction) had been included in the study.</span>
<span id="cb53-472"><a href="#cb53-472" aria-hidden="true" tabindex="-1"></a>In contrast, the log-Hill-parameter is poorly identified, when there</span>
<span id="cb53-473"><a href="#cb53-473" aria-hidden="true" tabindex="-1"></a>are very few doses (as in this study), which is why the posterior</span>
<span id="cb53-474"><a href="#cb53-474" aria-hidden="true" tabindex="-1"></a>distribution is more or less the prior distribution for the <span class="in">`logED50`</span></span>
<span id="cb53-475"><a href="#cb53-475" aria-hidden="true" tabindex="-1"></a>parameter.</span>
<span id="cb53-476"><a href="#cb53-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-477"><a href="#cb53-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r paramident}</span></span>
<span id="cb53-478"><a href="#cb53-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-479"><a href="#cb53-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-480"><a href="#cb53-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-481"><a href="#cb53-481" aria-hidden="true" tabindex="-1"></a>compare_prior_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(param, fit) {</span>
<span id="cb53-482"><a href="#cb53-482" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">&lt;-</span> fit<span class="sc">$</span>prior <span class="sc">|&gt;</span></span>
<span id="cb53-483"><a href="#cb53-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">parse_dist</span>(prior) <span class="sc">|&gt;</span></span>
<span id="cb53-484"><a href="#cb53-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">.variable =</span> nlpar) <span class="sc">|&gt;</span></span>
<span id="cb53-485"><a href="#cb53-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(.variable <span class="sc">==</span> param, source <span class="sc">==</span> <span class="st">"user"</span>)</span>
<span id="cb53-486"><a href="#cb53-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-487"><a href="#cb53-487" aria-hidden="true" tabindex="-1"></a>  model_param <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"b"</span>, param, <span class="st">"Intercept"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb53-488"><a href="#cb53-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-489"><a href="#cb53-489" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">post =</span> <span class="fu">as_draws_rvars</span>(fit)[[model_param]])</span>
<span id="cb53-490"><a href="#cb53-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(post, <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">xdist =</span> post)) <span class="sc">+</span></span>
<span id="cb53-491"><a href="#cb53-491" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slabinterval</span>() <span class="sc">+</span></span>
<span id="cb53-492"><a href="#cb53-492" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slab</span>(</span>
<span id="cb53-493"><a href="#cb53-493" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> prior,</span>
<span id="cb53-494"><a href="#cb53-494" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xdist =</span> .dist_obj),</span>
<span id="cb53-495"><a href="#cb53-495" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb53-496"><a href="#cb53-496" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"darkblue"</span></span>
<span id="cb53-497"><a href="#cb53-497" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb53-498"><a href="#cb53-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_thickness_shared</span>() <span class="sc">+</span></span>
<span id="cb53-499"><a href="#cb53-499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb53-500"><a href="#cb53-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(param) <span class="sc">+</span></span>
<span id="cb53-501"><a href="#cb53-501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb53-502"><a href="#cb53-502" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),   <span class="co"># removes y-axis ticks</span></span>
<span id="cb53-503"><a href="#cb53-503" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),   <span class="co"># removes y-axis text</span></span>
<span id="cb53-504"><a href="#cb53-504" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()    <span class="co"># removes y-axis title</span></span>
<span id="cb53-505"><a href="#cb53-505" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-506"><a href="#cb53-506" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-507"><a href="#cb53-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-508"><a href="#cb53-508" aria-hidden="true" tabindex="-1"></a>cmp_sigmoid <span class="ot">&lt;-</span> <span class="fu">lapply</span>(prior_sigmoid<span class="sc">$</span>nlpar, compare_prior_posterior, fit_sigmoid)</span>
<span id="cb53-509"><a href="#cb53-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-510"><a href="#cb53-510" aria-hidden="true" tabindex="-1"></a><span class="co"># turns the list of plots into a call of plot1 + plot2 + ... which</span></span>
<span id="cb53-511"><a href="#cb53-511" aria-hidden="true" tabindex="-1"></a><span class="co"># merges the different plots into a single one</span></span>
<span id="cb53-512"><a href="#cb53-512" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(<span class="st">"+"</span>, cmp_sigmoid)</span>
<span id="cb53-513"><a href="#cb53-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-514"><a href="#cb53-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-515"><a href="#cb53-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-516"><a href="#cb53-516" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified beta model with `brms`</span></span>
<span id="cb53-517"><a href="#cb53-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-518"><a href="#cb53-518" aria-hidden="true" tabindex="-1"></a>We now fit the modified beta model that can capture non-monotone dose</span>
<span id="cb53-519"><a href="#cb53-519" aria-hidden="true" tabindex="-1"></a>response relationships.</span>
<span id="cb53-520"><a href="#cb53-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-521"><a href="#cb53-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_modbeta, results='hide', message = FALSE}</span></span>
<span id="cb53-522"><a href="#cb53-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Try a modified beta model</span></span>
<span id="cb53-523"><a href="#cb53-523" aria-hidden="true" tabindex="-1"></a>model_beta <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb53-524"><a href="#cb53-524" aria-hidden="true" tabindex="-1"></a>    est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb53-525"><a href="#cb53-525" aria-hidden="true" tabindex="-1"></a>      E0 <span class="sc">+</span></span>
<span id="cb53-526"><a href="#cb53-526" aria-hidden="true" tabindex="-1"></a>        bEmax <span class="sc">*</span></span>
<span id="cb53-527"><a href="#cb53-527" aria-hidden="true" tabindex="-1"></a>          (delta1 <span class="sc">+</span> delta2)<span class="sc">^</span>(delta1 <span class="sc">+</span> delta2) <span class="sc">/</span></span>
<span id="cb53-528"><a href="#cb53-528" aria-hidden="true" tabindex="-1"></a>          (delta1<span class="sc">^</span>delta1 <span class="sc">*</span> delta2<span class="sc">^</span>delta2) <span class="sc">*</span></span>
<span id="cb53-529"><a href="#cb53-529" aria-hidden="true" tabindex="-1"></a>          (dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta1 <span class="sc">*</span></span>
<span id="cb53-530"><a href="#cb53-530" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">1</span> <span class="sc">-</span> dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta2,</span>
<span id="cb53-531"><a href="#cb53-531" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-532"><a href="#cb53-532" aria-hidden="true" tabindex="-1"></a>    delta1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-533"><a href="#cb53-533" aria-hidden="true" tabindex="-1"></a>    delta2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-534"><a href="#cb53-534" aria-hidden="true" tabindex="-1"></a>    bEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-535"><a href="#cb53-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb53-536"><a href="#cb53-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb53-537"><a href="#cb53-537" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-538"><a href="#cb53-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-539"><a href="#cb53-539" aria-hidden="true" tabindex="-1"></a>prior_beta <span class="ot">&lt;-</span></span>
<span id="cb53-540"><a href="#cb53-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> E0) <span class="sc">+</span></span>
<span id="cb53-541"><a href="#cb53-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> bEmax) <span class="sc">+</span> </span>
<span id="cb53-542"><a href="#cb53-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> delta1, <span class="at">lb =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-543"><a href="#cb53-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> delta2, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb53-544"><a href="#cb53-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-545"><a href="#cb53-545" aria-hidden="true" tabindex="-1"></a>fit_beta <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_beta,</span>
<span id="cb53-546"><a href="#cb53-546" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb53-547"><a href="#cb53-547" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_beta,</span>
<span id="cb53-548"><a href="#cb53-548" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>),</span>
<span id="cb53-549"><a href="#cb53-549" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">7304</span>,</span>
<span id="cb53-550"><a href="#cb53-550" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb53-551"><a href="#cb53-551" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-552"><a href="#cb53-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-553"><a href="#cb53-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-554"><a href="#cb53-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-555"><a href="#cb53-555" aria-hidden="true" tabindex="-1"></a>Let us summarize the model fit:</span>
<span id="cb53-556"><a href="#cb53-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-557"><a href="#cb53-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarize_modbetafit}</span></span>
<span id="cb53-558"><a href="#cb53-558" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_beta)</span>
<span id="cb53-559"><a href="#cb53-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-560"><a href="#cb53-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-561"><a href="#cb53-561" aria-hidden="true" tabindex="-1"></a>So what does the model fit look like? We could, again, just use </span>
<span id="cb53-562"><a href="#cb53-562" aria-hidden="true" tabindex="-1"></a><span class="in">`plot(conditional_effects(fit_beta, "dose"), points = TRUE)`</span> or </span>
<span id="cb53-563"><a href="#cb53-563" aria-hidden="true" tabindex="-1"></a>get a slightly more tailored plot.</span>
<span id="cb53-564"><a href="#cb53-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-565"><a href="#cb53-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r predict_modbeta, cache=FALSE}</span></span>
<span id="cb53-566"><a href="#cb53-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-567"><a href="#cb53-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-568"><a href="#cb53-568" aria-hidden="true" tabindex="-1"></a>dr_beta <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_beta) <span class="sc">+</span></span>
<span id="cb53-569"><a href="#cb53-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb53-570"><a href="#cb53-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb53-571"><a href="#cb53-571" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb53-572"><a href="#cb53-572" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb53-573"><a href="#cb53-573" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb53-574"><a href="#cb53-574" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"modified-beta model fit"</span>,</span>
<span id="cb53-575"><a href="#cb53-575" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkblue"</span></span>
<span id="cb53-576"><a href="#cb53-576" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-577"><a href="#cb53-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-578"><a href="#cb53-578" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_beta)</span>
<span id="cb53-579"><a href="#cb53-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-580"><a href="#cb53-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-581"><a href="#cb53-581" aria-hidden="true" tabindex="-1"></a>Let's also consider how informative the data is wrt to each</span>
<span id="cb53-582"><a href="#cb53-582" aria-hidden="true" tabindex="-1"></a>parameter's prior:</span>
<span id="cb53-583"><a href="#cb53-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-586"><a href="#cb53-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb53-587"><a href="#cb53-587" aria-hidden="true" tabindex="-1"></a>cmp_beta <span class="ot">&lt;-</span> <span class="fu">lapply</span>(prior_beta<span class="sc">$</span>nlpar, compare_prior_posterior, fit_beta)</span>
<span id="cb53-588"><a href="#cb53-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-589"><a href="#cb53-589" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(<span class="st">"+"</span>, cmp_beta)</span>
<span id="cb53-590"><a href="#cb53-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-591"><a href="#cb53-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-592"><a href="#cb53-592" aria-hidden="true" tabindex="-1"></a><span class="fu">### Perform Bayesian model averaging</span></span>
<span id="cb53-593"><a href="#cb53-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-594"><a href="#cb53-594" aria-hidden="true" tabindex="-1"></a>Now we have two fitted model. We can see both of them together below:</span>
<span id="cb53-595"><a href="#cb53-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-596"><a href="#cb53-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show_both_plots, fig.width = 10}</span></span>
<span id="cb53-597"><a href="#cb53-597" aria-hidden="true" tabindex="-1"></a>dr_sigmoid <span class="sc">+</span> dr_beta</span>
<span id="cb53-598"><a href="#cb53-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-599"><a href="#cb53-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-600"><a href="#cb53-600" aria-hidden="true" tabindex="-1"></a>In practice, we do not really know, whether one of these is the true</span>
<span id="cb53-601"><a href="#cb53-601" aria-hidden="true" tabindex="-1"></a>data generating model.  In fact, realistically both models are going</span>
<span id="cb53-602"><a href="#cb53-602" aria-hidden="true" tabindex="-1"></a>to be at least somewhat misspecified, because we made no attempt to</span>
<span id="cb53-603"><a href="#cb53-603" aria-hidden="true" tabindex="-1"></a>fully model the full complexity of the underlying biological system.</span>
<span id="cb53-604"><a href="#cb53-604" aria-hidden="true" tabindex="-1"></a>So, really, the question is which of the two models provides the</span>
<span id="cb53-605"><a href="#cb53-605" aria-hidden="true" tabindex="-1"></a>better approximation.  At a glance both seem to fit the data somewhat</span>
<span id="cb53-606"><a href="#cb53-606" aria-hidden="true" tabindex="-1"></a>decently, so it seems unlikely that we can completely rule one of the</span>
<span id="cb53-607"><a href="#cb53-607" aria-hidden="true" tabindex="-1"></a>two models out. That is where Bayesian model averaging comes in.</span>
<span id="cb53-608"><a href="#cb53-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-609"><a href="#cb53-609" aria-hidden="true" tabindex="-1"></a>First, we need to compare how well each model fits.  As it turns out,</span>
<span id="cb53-610"><a href="#cb53-610" aria-hidden="true" tabindex="-1"></a>when you just have 4 data points (due to us using summary data), it is</span>
<span id="cb53-611"><a href="#cb53-611" aria-hidden="true" tabindex="-1"></a>problematic to just use the "standard" <span class="in">`brms::loo`</span> function to perform</span>
<span id="cb53-612"><a href="#cb53-612" aria-hidden="true" tabindex="-1"></a>approximate leave-one-out cross-validation (LOO-CV) based on the</span>
<span id="cb53-613"><a href="#cb53-613" aria-hidden="true" tabindex="-1"></a>posterior likelihood as implemented in the <span class="in">`loo`</span> package, as can be</span>
<span id="cb53-614"><a href="#cb53-614" aria-hidden="true" tabindex="-1"></a>seen by running</span>
<span id="cb53-615"><a href="#cb53-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-616"><a href="#cb53-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_1}</span></span>
<span id="cb53-617"><a href="#cb53-617" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(fit_sigmoid)</span>
<span id="cb53-618"><a href="#cb53-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-619"><a href="#cb53-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-620"><a href="#cb53-620" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb53-621"><a href="#cb53-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-622"><a href="#cb53-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_2}</span></span>
<span id="cb53-623"><a href="#cb53-623" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(fit_beta)</span>
<span id="cb53-624"><a href="#cb53-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-625"><a href="#cb53-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-626"><a href="#cb53-626" aria-hidden="true" tabindex="-1"></a>Instead, we actually fit each model leaving each dose group out. We</span>
<span id="cb53-627"><a href="#cb53-627" aria-hidden="true" tabindex="-1"></a>could probably do something more sophisticated by simulating</span>
<span id="cb53-628"><a href="#cb53-628" aria-hidden="true" tabindex="-1"></a>consistent individual patient data (and then performing approximate</span>
<span id="cb53-629"><a href="#cb53-629" aria-hidden="true" tabindex="-1"></a>LOO-CV) or parametric sampling from the normal distribution around the</span>
<span id="cb53-630"><a href="#cb53-630" aria-hidden="true" tabindex="-1"></a>point estimates.</span>
<span id="cb53-631"><a href="#cb53-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-632"><a href="#cb53-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_exact_code, eval=FALSE, message = FALSE}</span></span>
<span id="cb53-633"><a href="#cb53-633" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_sigmoid, <span class="at">folds =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-634"><a href="#cb53-634" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_beta <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_beta, <span class="at">folds =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-635"><a href="#cb53-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-636"><a href="#cb53-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-637"><a href="#cb53-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_exact, eval=TRUE, include=FALSE}</span></span>
<span id="cb53-638"><a href="#cb53-638" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_sigmoid, <span class="at">folds =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-639"><a href="#cb53-639" aria-hidden="true" tabindex="-1"></a>loo_exact_fit_beta <span class="ot">&lt;-</span> <span class="fu">kfold</span>(fit_beta, <span class="at">folds =</span> <span class="st">"loo"</span>)</span>
<span id="cb53-640"><a href="#cb53-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-641"><a href="#cb53-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-642"><a href="#cb53-642" aria-hidden="true" tabindex="-1"></a>Now, we can compare the models via</span>
<span id="cb53-643"><a href="#cb53-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-644"><a href="#cb53-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loo_compare}</span></span>
<span id="cb53-645"><a href="#cb53-645" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(loo_exact_fit_sigmoid, loo_exact_fit_beta)</span>
<span id="cb53-646"><a href="#cb53-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-647"><a href="#cb53-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-648"><a href="#cb53-648" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Approach 1 (manual without `brms`)</span></span>
<span id="cb53-649"><a href="#cb53-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-650"><a href="#cb53-650" aria-hidden="true" tabindex="-1"></a>Let us say that we a-priori assign a 75% probability to the SigEmax</span>
<span id="cb53-651"><a href="#cb53-651" aria-hidden="true" tabindex="-1"></a>model and 25% to the modified beta model.</span>
<span id="cb53-652"><a href="#cb53-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-653"><a href="#cb53-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get_post_wgts}</span></span>
<span id="cb53-654"><a href="#cb53-654" aria-hidden="true" tabindex="-1"></a><span class="co"># follows: </span></span>
<span id="cb53-655"><a href="#cb53-655" aria-hidden="true" tabindex="-1"></a><span class="co"># Gould, A. L. (2019). BMA‐Mod: A Bayesian model averaging strategy</span></span>
<span id="cb53-656"><a href="#cb53-656" aria-hidden="true" tabindex="-1"></a><span class="co"># for determining dose‐response relationships in the presence of model</span></span>
<span id="cb53-657"><a href="#cb53-657" aria-hidden="true" tabindex="-1"></a><span class="co"># uncertainty. Biometrical Journal, 61(5), 1141-1159.</span></span>
<span id="cb53-658"><a href="#cb53-658" aria-hidden="true" tabindex="-1"></a><span class="co"># https://dx.doi.org/10.1002/bimj.201700211</span></span>
<span id="cb53-659"><a href="#cb53-659" aria-hidden="true" tabindex="-1"></a>prior_weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>)</span>
<span id="cb53-660"><a href="#cb53-660" aria-hidden="true" tabindex="-1"></a>posterior_weigths <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb53-661"><a href="#cb53-661" aria-hidden="true" tabindex="-1"></a>  prior_weights[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">exp</span>(loo_exact_fit_sigmoid<span class="sc">$</span>estimates[<span class="st">"elpd_kfold"</span>, <span class="st">"Estimate"</span>]),</span>
<span id="cb53-662"><a href="#cb53-662" aria-hidden="true" tabindex="-1"></a>  prior_weights[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">exp</span>(loo_exact_fit_beta<span class="sc">$</span>estimates[<span class="st">"elpd_kfold"</span>, <span class="st">"Estimate"</span>])</span>
<span id="cb53-663"><a href="#cb53-663" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-664"><a href="#cb53-664" aria-hidden="true" tabindex="-1"></a>(posterior_weigths <span class="ot">&lt;-</span> posterior_weigths <span class="sc">/</span> <span class="fu">sum</span>(posterior_weigths))</span>
<span id="cb53-665"><a href="#cb53-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-666"><a href="#cb53-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-667"><a href="#cb53-667" aria-hidden="true" tabindex="-1"></a>As we can see, using leaving-one-dose-group out cross-validation,</span>
<span id="cb53-668"><a href="#cb53-668" aria-hidden="true" tabindex="-1"></a>suggests that the SigEmax model should be given most of the weight.</span>
<span id="cb53-669"><a href="#cb53-669" aria-hidden="true" tabindex="-1"></a>A-posteriori, we assign <span class="in">`r 100*round(posterior_weigths[1], 3)`</span>\%</span>
<span id="cb53-670"><a href="#cb53-670" aria-hidden="true" tabindex="-1"></a>weight to the SigEmax model and `r 100*round(posterior_weigths<span class="co">[</span><span class="ot">2</span><span class="co">]</span>,</span>
<span id="cb53-671"><a href="#cb53-671" aria-hidden="true" tabindex="-1"></a>3)`\% weight to the modified beta model. However, if we had done</span>
<span id="cb53-672"><a href="#cb53-672" aria-hidden="true" tabindex="-1"></a>approximate LOO-CV with individual patient data, the modified beta</span>
<span id="cb53-673"><a href="#cb53-673" aria-hidden="true" tabindex="-1"></a>model might have been given more weight.</span>
<span id="cb53-674"><a href="#cb53-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-675"><a href="#cb53-675" aria-hidden="true" tabindex="-1"></a>When we average the predictions of the two models with these weights,</span>
<span id="cb53-676"><a href="#cb53-676" aria-hidden="true" tabindex="-1"></a>we get the dose response curve below.</span>
<span id="cb53-677"><a href="#cb53-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-678"><a href="#cb53-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bma_curves, fig.width=10, fig.height=10, cache=FALSE}</span></span>
<span id="cb53-679"><a href="#cb53-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-680"><a href="#cb53-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-681"><a href="#cb53-681" aria-hidden="true" tabindex="-1"></a>bma_curve <span class="ot">&lt;-</span> dr_sigmoid<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb53-682"><a href="#cb53-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dr_beta<span class="sc">$</span>data, <span class="at">by =</span> <span class="st">"dose"</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-683"><a href="#cb53-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-684"><a href="#cb53-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">logRR =</span> posterior_weigths[<span class="dv">1</span>] <span class="sc">*</span> logRR.x <span class="sc">+</span> posterior_weigths[<span class="dv">2</span>] <span class="sc">*</span> logRR.y</span>
<span id="cb53-685"><a href="#cb53-685" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-686"><a href="#cb53-686" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>logRR.x, <span class="sc">-</span>logRR.y)</span>
<span id="cb53-687"><a href="#cb53-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-688"><a href="#cb53-688" aria-hidden="true" tabindex="-1"></a>dr_bma <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">%+%</span></span>
<span id="cb53-689"><a href="#cb53-689" aria-hidden="true" tabindex="-1"></a>  bma_curve <span class="sc">+</span></span>
<span id="cb53-690"><a href="#cb53-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>) <span class="sc">+</span></span>
<span id="cb53-691"><a href="#cb53-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb53-692"><a href="#cb53-692" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb53-693"><a href="#cb53-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb53-694"><a href="#cb53-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb53-695"><a href="#cb53-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Bayesian model averaging"</span>,</span>
<span id="cb53-696"><a href="#cb53-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkgreen"</span></span>
<span id="cb53-697"><a href="#cb53-697" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-698"><a href="#cb53-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-699"><a href="#cb53-699" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb53-700"><a href="#cb53-700" aria-hidden="true" tabindex="-1"></a>  ((dr_sigmoid <span class="sc">+</span></span>
<span id="cb53-701"><a href="#cb53-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-702"><a href="#cb53-702" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Sigmoid Emax model"</span>)) <span class="sc">|</span></span>
<span id="cb53-703"><a href="#cb53-703" aria-hidden="true" tabindex="-1"></a>    (dr_beta <span class="sc">+</span></span>
<span id="cb53-704"><a href="#cb53-704" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-705"><a href="#cb53-705" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Modified beta model"</span>))) <span class="sc">/</span></span>
<span id="cb53-706"><a href="#cb53-706" aria-hidden="true" tabindex="-1"></a>    (dr_bma <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Bayesian model averaging"</span>) <span class="sc">|</span> <span class="fu">plot_spacer</span>())</span>
<span id="cb53-707"><a href="#cb53-707" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-708"><a href="#cb53-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-709"><a href="#cb53-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-710"><a href="#cb53-710" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Approach 2: Using `brms` functions</span></span>
<span id="cb53-711"><a href="#cb53-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-712"><a href="#cb53-712" aria-hidden="true" tabindex="-1"></a>Before, we needed to do a lot of manual work to get model-averaged</span>
<span id="cb53-713"><a href="#cb53-713" aria-hidden="true" tabindex="-1"></a>predictions, but the below using <span class="in">`brms::pp_average`</span> would be a lot</span>
<span id="cb53-714"><a href="#cb53-714" aria-hidden="true" tabindex="-1"></a>simpler, if we could rely on the approximate LOO-CV.</span>
<span id="cb53-715"><a href="#cb53-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-716"><a href="#cb53-716" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Approach 2a: Not appropriate here</span></span>
<span id="cb53-717"><a href="#cb53-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-718"><a href="#cb53-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brms_bma, eval=FALSE}</span></span>
<span id="cb53-719"><a href="#cb53-719" aria-hidden="true" tabindex="-1"></a>dr_curve_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dose =</span> <span class="fu">seq</span>(<span class="dv">0</span>L, <span class="dv">600</span>L, <span class="at">length.out =</span> <span class="dv">101</span>), <span class="at">stderr =</span> <span class="dv">0</span>)</span>
<span id="cb53-720"><a href="#cb53-720" aria-hidden="true" tabindex="-1"></a>bma_brms_curve <span class="ot">&lt;-</span> dr_curve_data <span class="sc">|&gt;</span></span>
<span id="cb53-721"><a href="#cb53-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-722"><a href="#cb53-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">epred_bma =</span> <span class="fu">rvar</span>(<span class="fu">pp_average</span>(</span>
<span id="cb53-723"><a href="#cb53-723" aria-hidden="true" tabindex="-1"></a>      fit_sigmoid,</span>
<span id="cb53-724"><a href="#cb53-724" aria-hidden="true" tabindex="-1"></a>      fit_beta,</span>
<span id="cb53-725"><a href="#cb53-725" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"posterior_epred"</span>,</span>
<span id="cb53-726"><a href="#cb53-726" aria-hidden="true" tabindex="-1"></a>      <span class="at">newdata =</span> dr_curve_data,</span>
<span id="cb53-727"><a href="#cb53-727" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Not a good option in this case</span></span>
<span id="cb53-728"><a href="#cb53-728" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> <span class="st">"loo"</span>,</span>
<span id="cb53-729"><a href="#cb53-729" aria-hidden="true" tabindex="-1"></a>      <span class="at">summary =</span> <span class="cn">FALSE</span></span>
<span id="cb53-730"><a href="#cb53-730" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb53-731"><a href="#cb53-731" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forming differences to placebo by merging with the placebo</span></span>
<span id="cb53-732"><a href="#cb53-732" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (dose=0) predictions for each sample</span></span>
<span id="cb53-733"><a href="#cb53-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">logRR =</span> epred_bma <span class="sc">-</span> epred_bma[dose <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb53-734"><a href="#cb53-734" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-735"><a href="#cb53-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-736"><a href="#cb53-736" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Approach 2b: Using leave-one-dose-out CV</span></span>
<span id="cb53-737"><a href="#cb53-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-738"><a href="#cb53-738" aria-hidden="true" tabindex="-1"></a>Because we want to avoid using approximate LOO-CV in this case, </span>
<span id="cb53-739"><a href="#cb53-739" aria-hidden="true" tabindex="-1"></a>we first replace the internally calculated approximate LOO-CV</span>
<span id="cb53-740"><a href="#cb53-740" aria-hidden="true" tabindex="-1"></a>results with our own</span>
<span id="cb53-741"><a href="#cb53-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-744"><a href="#cb53-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb53-745"><a href="#cb53-745" aria-hidden="true" tabindex="-1"></a>fit_sigmoid<span class="sc">$</span>criteria<span class="sc">$</span>loo <span class="ot">&lt;-</span> loo_exact_fit_sigmoid</span>
<span id="cb53-746"><a href="#cb53-746" aria-hidden="true" tabindex="-1"></a>fit_beta<span class="sc">$</span>criteria<span class="sc">$</span>loo <span class="ot">&lt;-</span> loo_exact_fit_beta</span>
<span id="cb53-747"><a href="#cb53-747" aria-hidden="true" tabindex="-1"></a>(w_dose <span class="ot">&lt;-</span> <span class="fu">model_weights</span>(fit_sigmoid, fit_beta, <span class="at">weights =</span> <span class="st">"loo"</span>))</span>
<span id="cb53-748"><a href="#cb53-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-749"><a href="#cb53-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-750"><a href="#cb53-750" aria-hidden="true" tabindex="-1"></a>We can then do the following:</span>
<span id="cb53-751"><a href="#cb53-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-752"><a href="#cb53-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb53-753"><a href="#cb53-753" aria-hidden="true" tabindex="-1"></a>bma_curve_pred <span class="ot">&lt;-</span> dr_curve_data <span class="sc">|&gt;</span></span>
<span id="cb53-754"><a href="#cb53-754" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_rvars</span>(fit_sigmoid, <span class="at">value=</span><span class="st">".epred1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-755"><a href="#cb53-755" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_epred_rvars</span>(fit_beta, <span class="at">value=</span><span class="st">".epred2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-756"><a href="#cb53-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">epred_bma =</span> .epred1 <span class="sc">*</span> w_dose[<span class="dv">1</span>] <span class="sc">+</span> .epred2 <span class="sc">*</span> w_dose[<span class="dv">2</span>],</span>
<span id="cb53-757"><a href="#cb53-757" aria-hidden="true" tabindex="-1"></a>         <span class="at">logRR =</span> epred_bma <span class="sc">-</span> epred_bma[dose <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb53-758"><a href="#cb53-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-759"><a href="#cb53-759" aria-hidden="true" tabindex="-1"></a>dr_bma2 <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_sigmoid) <span class="sc">%+%</span> bma_curve_pred <span class="sc">+</span></span>
<span id="cb53-760"><a href="#cb53-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>) <span class="sc">+</span></span>
<span id="cb53-761"><a href="#cb53-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">300</span>, <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>), <span class="at">label =</span> <span class="st">"BMA (LOO weights)"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>)</span>
<span id="cb53-762"><a href="#cb53-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-763"><a href="#cb53-763" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dr_bma2)</span>
<span id="cb53-764"><a href="#cb53-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-765"><a href="#cb53-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-766"><a href="#cb53-766" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Why did we do this form of Bayesian model averaging?</span></span>
<span id="cb53-767"><a href="#cb53-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-768"><a href="#cb53-768" aria-hidden="true" tabindex="-1"></a>Why are we doing it like this? Can we not just fit a single model like</span>
<span id="cb53-769"><a href="#cb53-769" aria-hidden="true" tabindex="-1"></a>this (as an example where we average a sigmoid-Emax and a modified</span>
<span id="cb53-770"><a href="#cb53-770" aria-hidden="true" tabindex="-1"></a>beta model)?</span>
<span id="cb53-771"><a href="#cb53-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-772"><a href="#cb53-772" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb53-773"><a href="#cb53-773" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb53-774"><a href="#cb53-774" aria-hidden="true" tabindex="-1"></a>f(\text{dose}; \text{parameters}) = &amp; \text{E}_0 + w \times \text{E}_{\text{maxSigmoid}} \times \frac{\text{dose}^h}{\text{dose}^h + \text{ED}_{50}^h} <span class="sc">\\</span></span>
<span id="cb53-775"><a href="#cb53-775" aria-hidden="true" tabindex="-1"></a>  &amp; + (1-w) \times \text{E}_{\text{maxBeta}} \times \frac{(\delta_1 + \delta_2)^{\delta_1 + \delta_2}}{\delta_1^{\delta_1} + \delta_2^{\delta_2}} \times (\frac{\text{dose}}{S})^{\delta_1} \times (1-\frac{\text{dose}}{S})^{\delta_2}</span>
<span id="cb53-776"><a href="#cb53-776" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb53-777"><a href="#cb53-777" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb53-778"><a href="#cb53-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-779"><a href="#cb53-779" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> certainly lets us specify such a model (see</span>
<span id="cb53-780"><a href="#cb53-780" aria-hidden="true" tabindex="-1"></a>below). Nonethelessm such a model is harder to fit as we fit jointly</span>
<span id="cb53-781"><a href="#cb53-781" aria-hidden="true" tabindex="-1"></a>both models simultaneousy. Fitting each model separatley is from a</span>
<span id="cb53-782"><a href="#cb53-782" aria-hidden="true" tabindex="-1"></a>numerical perspective more stable and robust in comparison to fitting</span>
<span id="cb53-783"><a href="#cb53-783" aria-hidden="true" tabindex="-1"></a>each model individually. Still, note that in the above formulation the</span>
<span id="cb53-784"><a href="#cb53-784" aria-hidden="true" tabindex="-1"></a>$\text{E}_0$ parameter is shared between the models such that the</span>
<span id="cb53-785"><a href="#cb53-785" aria-hidden="true" tabindex="-1"></a>above model differs from a fit of each model individually.</span>
<span id="cb53-786"><a href="#cb53-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-787"><a href="#cb53-787" aria-hidden="true" tabindex="-1"></a>An important step in the model below is to align the parameter domain</span>
<span id="cb53-788"><a href="#cb53-788" aria-hidden="true" tabindex="-1"></a>with the priors. That is, we continue using the apprioate transformed</span>
<span id="cb53-789"><a href="#cb53-789" aria-hidden="true" tabindex="-1"></a>parameters which are positive and we restrict the weighting parameter</span>
<span id="cb53-790"><a href="#cb53-790" aria-hidden="true" tabindex="-1"></a>to the domain 0 to 1 (we could also fit this parameter on the logit</span>
<span id="cb53-791"><a href="#cb53-791" aria-hidden="true" tabindex="-1"></a>scale). It is important to pass these parameter range limits to Stan</span>
<span id="cb53-792"><a href="#cb53-792" aria-hidden="true" tabindex="-1"></a>using the lower bound (<span class="in">`lb`</span>) and upper bound (<span class="in">`ub`</span>) information to</span>
<span id="cb53-793"><a href="#cb53-793" aria-hidden="true" tabindex="-1"></a>Stan via the respective arguments of the <span class="in">`prior`</span> function call</span>
<span id="cb53-794"><a href="#cb53-794" aria-hidden="true" tabindex="-1"></a>declaring the parameter prior:</span>
<span id="cb53-795"><a href="#cb53-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-796"><a href="#cb53-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_mod_avg}</span></span>
<span id="cb53-797"><a href="#cb53-797" aria-hidden="true" tabindex="-1"></a>model_avg <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb53-798"><a href="#cb53-798" aria-hidden="true" tabindex="-1"></a>  est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb53-799"><a href="#cb53-799" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">+</span></span>
<span id="cb53-800"><a href="#cb53-800" aria-hidden="true" tabindex="-1"></a>      mwgtSigmoid <span class="sc">*</span> sEmax <span class="sc">*</span> dose<span class="sc">^</span>h <span class="sc">/</span> (dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h) <span class="sc">+</span></span>
<span id="cb53-801"><a href="#cb53-801" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span><span class="sc">-</span>mwgtSigmoid) <span class="sc">*</span></span>
<span id="cb53-802"><a href="#cb53-802" aria-hidden="true" tabindex="-1"></a>        bEmax <span class="sc">*</span></span>
<span id="cb53-803"><a href="#cb53-803" aria-hidden="true" tabindex="-1"></a>        (delta1 <span class="sc">+</span> delta2)<span class="sc">^</span>(delta1 <span class="sc">+</span> delta2) <span class="sc">/</span></span>
<span id="cb53-804"><a href="#cb53-804" aria-hidden="true" tabindex="-1"></a>        (delta1<span class="sc">^</span>delta1 <span class="sc">*</span> delta2<span class="sc">^</span>delta2) <span class="sc">*</span></span>
<span id="cb53-805"><a href="#cb53-805" aria-hidden="true" tabindex="-1"></a>        (dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta1 <span class="sc">*</span></span>
<span id="cb53-806"><a href="#cb53-806" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">-</span> dose <span class="sc">/</span> <span class="dv">850</span>)<span class="sc">^</span>delta2,</span>
<span id="cb53-807"><a href="#cb53-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)), <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb53-808"><a href="#cb53-808" aria-hidden="true" tabindex="-1"></a>  E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-809"><a href="#cb53-809" aria-hidden="true" tabindex="-1"></a>  sEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-810"><a href="#cb53-810" aria-hidden="true" tabindex="-1"></a>  logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-811"><a href="#cb53-811" aria-hidden="true" tabindex="-1"></a>  logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-812"><a href="#cb53-812" aria-hidden="true" tabindex="-1"></a>  bEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-813"><a href="#cb53-813" aria-hidden="true" tabindex="-1"></a>  delta1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-814"><a href="#cb53-814" aria-hidden="true" tabindex="-1"></a>  delta2 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-815"><a href="#cb53-815" aria-hidden="true" tabindex="-1"></a>  mwgtSigmoid <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-816"><a href="#cb53-816" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb53-817"><a href="#cb53-817" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-818"><a href="#cb53-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-819"><a href="#cb53-819" aria-hidden="true" tabindex="-1"></a>prior_avg <span class="ot">&lt;-</span></span>
<span id="cb53-820"><a href="#cb53-820" aria-hidden="true" tabindex="-1"></a>  prior_sigmoid <span class="sc">+</span></span>
<span id="cb53-821"><a href="#cb53-821" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note that we have to drop the E0 prior from the modified beta</span></span>
<span id="cb53-822"><a href="#cb53-822" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prior, which can be easily done as prior specifications from brms</span></span>
<span id="cb53-823"><a href="#cb53-823" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are essentially data frames.</span></span>
<span id="cb53-824"><a href="#cb53-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prior_beta, nlpar <span class="sc">!=</span> <span class="st">"E0"</span>) <span class="sc">+</span></span>
<span id="cb53-825"><a href="#cb53-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> mwgtSigmoid, <span class="at">lb=</span><span class="dv">0</span>, <span class="at">ub=</span><span class="dv">1</span>)</span>
<span id="cb53-826"><a href="#cb53-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-827"><a href="#cb53-827" aria-hidden="true" tabindex="-1"></a>fit_mod_avg <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb53-828"><a href="#cb53-828" aria-hidden="true" tabindex="-1"></a>  model_avg,</span>
<span id="cb53-829"><a href="#cb53-829" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb53-830"><a href="#cb53-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_avg,</span>
<span id="cb53-831"><a href="#cb53-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb53-832"><a href="#cb53-832" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">456456</span>,</span>
<span id="cb53-833"><a href="#cb53-833" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>)</span>
<span id="cb53-834"><a href="#cb53-834" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-835"><a href="#cb53-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-836"><a href="#cb53-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-837"><a href="#cb53-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-838"><a href="#cb53-838" aria-hidden="true" tabindex="-1"></a>Considering the summary of the model:</span>
<span id="cb53-839"><a href="#cb53-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-842"><a href="#cb53-842" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb53-843"><a href="#cb53-843" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mod_avg)</span>
<span id="cb53-844"><a href="#cb53-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-845"><a href="#cb53-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-846"><a href="#cb53-846" aria-hidden="true" tabindex="-1"></a>Now, let's compare all four different models graphically:</span>
<span id="cb53-847"><a href="#cb53-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-848"><a href="#cb53-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bma_curves_complete, fig.width=10, fig.height=10, cache=FALSE}</span></span>
<span id="cb53-849"><a href="#cb53-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-850"><a href="#cb53-850" aria-hidden="true" tabindex="-1"></a>dr_mod_avg <span class="ot">&lt;-</span> <span class="fu">plot_dose_response</span>(fit_mod_avg) <span class="sc">+</span></span>
<span id="cb53-851"><a href="#cb53-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>) <span class="sc">+</span></span>
<span id="cb53-852"><a href="#cb53-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb53-853"><a href="#cb53-853" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb53-854"><a href="#cb53-854" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">300</span>,</span>
<span id="cb53-855"><a href="#cb53-855" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">log</span>(<span class="fl">0.6</span>),</span>
<span id="cb53-856"><a href="#cb53-856" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Average model"</span>,</span>
<span id="cb53-857"><a href="#cb53-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkred"</span></span>
<span id="cb53-858"><a href="#cb53-858" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-859"><a href="#cb53-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-860"><a href="#cb53-860" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb53-861"><a href="#cb53-861" aria-hidden="true" tabindex="-1"></a>  ((dr_sigmoid <span class="sc">+</span></span>
<span id="cb53-862"><a href="#cb53-862" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-863"><a href="#cb53-863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Sigmoid Emax model"</span>)) <span class="sc">|</span></span>
<span id="cb53-864"><a href="#cb53-864" aria-hidden="true" tabindex="-1"></a>    (dr_beta <span class="sc">+</span></span>
<span id="cb53-865"><a href="#cb53-865" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-866"><a href="#cb53-866" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Modified beta model"</span>))) <span class="sc">/</span></span>
<span id="cb53-867"><a href="#cb53-867" aria-hidden="true" tabindex="-1"></a>    (dr_bma <span class="sc">+</span></span>
<span id="cb53-868"><a href="#cb53-868" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Bayesian model averaging"</span>) <span class="sc">|</span></span>
<span id="cb53-869"><a href="#cb53-869" aria-hidden="true" tabindex="-1"></a>      dr_mod_avg <span class="sc">+</span></span>
<span id="cb53-870"><a href="#cb53-870" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb53-871"><a href="#cb53-871" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Average model"</span>))</span>
<span id="cb53-872"><a href="#cb53-872" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-873"><a href="#cb53-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-874"><a href="#cb53-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-875"><a href="#cb53-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-876"><a href="#cb53-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-877"><a href="#cb53-877" aria-hidden="true" tabindex="-1"></a><span class="fu">### Going beyond the default MCP-Mod models</span></span>
<span id="cb53-878"><a href="#cb53-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-879"><a href="#cb53-879" aria-hidden="true" tabindex="-1"></a>So far, a lot of what we did could also be done in a frequentist</span>
<span id="cb53-880"><a href="#cb53-880" aria-hidden="true" tabindex="-1"></a>manner using the MCP-Mod approach.  However, with <span class="in">`brms`</span> it is easy to</span>
<span id="cb53-881"><a href="#cb53-881" aria-hidden="true" tabindex="-1"></a>make our models more complex when necessary.  For example, we assumed</span>
<span id="cb53-882"><a href="#cb53-882" aria-hidden="true" tabindex="-1"></a>that a 280 mg q2w dose is equivalent to a 560 mg q4w dose.  This is of</span>
<span id="cb53-883"><a href="#cb53-883" aria-hidden="true" tabindex="-1"></a>course only the case in terms of the total amount of drug injected</span>
<span id="cb53-884"><a href="#cb53-884" aria-hidden="true" tabindex="-1"></a>over the trial period.  However, the two dose regimens differ in terms</span>
<span id="cb53-885"><a href="#cb53-885" aria-hidden="true" tabindex="-1"></a>of their blood concentrations over time as shown in the plot below.</span>
<span id="cb53-886"><a href="#cb53-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-887"><a href="#cb53-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simplepk}</span></span>
<span id="cb53-888"><a href="#cb53-888" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-889"><a href="#cb53-889" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-890"><a href="#cb53-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-891"><a href="#cb53-891" aria-hidden="true" tabindex="-1"></a>sim_1st_order_pk <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb53-892"><a href="#cb53-892" aria-hidden="true" tabindex="-1"></a>  <span class="at">injected =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">5</span>)),</span>
<span id="cb53-893"><a href="#cb53-893" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="dv">1</span>,</span>
<span id="cb53-894"><a href="#cb53-894" aria-hidden="true" tabindex="-1"></a>  <span class="at">thalf =</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb53-895"><a href="#cb53-895" aria-hidden="true" tabindex="-1"></a>  <span class="at">V =</span> <span class="dv">10</span></span>
<span id="cb53-896"><a href="#cb53-896" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb53-897"><a href="#cb53-897" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">=</span> <span class="fu">log</span>(<span class="dv">2</span>) <span class="sc">/</span> thalf</span>
<span id="cb53-898"><a href="#cb53-898" aria-hidden="true" tabindex="-1"></a>  concentration <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(injected))</span>
<span id="cb53-899"><a href="#cb53-899" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(injected)) {</span>
<span id="cb53-900"><a href="#cb53-900" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb53-901"><a href="#cb53-901" aria-hidden="true" tabindex="-1"></a>      concentration[i] <span class="ot">&lt;-</span> concentration[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span></span>
<span id="cb53-902"><a href="#cb53-902" aria-hidden="true" tabindex="-1"></a>        k <span class="sc">*</span> concentration[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb53-903"><a href="#cb53-903" aria-hidden="true" tabindex="-1"></a>        dose <span class="sc">*</span> injected[i] <span class="sc">/</span> V</span>
<span id="cb53-904"><a href="#cb53-904" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb53-905"><a href="#cb53-905" aria-hidden="true" tabindex="-1"></a>      concentration[i] <span class="ot">&lt;-</span> dose <span class="sc">*</span> injected[i] <span class="sc">/</span> V</span>
<span id="cb53-906"><a href="#cb53-906" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-907"><a href="#cb53-907" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-908"><a href="#cb53-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(concentration)</span>
<span id="cb53-909"><a href="#cb53-909" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-910"><a href="#cb53-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-911"><a href="#cb53-911" aria-hidden="true" tabindex="-1"></a><span class="co"># fmt: skip</span></span>
<span id="cb53-912"><a href="#cb53-912" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>regimen, <span class="sc">~</span>dose, <span class="sc">~</span>schedule,</span>
<span id="cb53-913"><a href="#cb53-913" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q4wk"</span>, <span class="dv">280</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">12</span>),</span>
<span id="cb53-914"><a href="#cb53-914" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q2w"</span>, <span class="dv">280</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">14</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">24</span>),</span>
<span id="cb53-915"><a href="#cb53-915" aria-hidden="true" tabindex="-1"></a>        <span class="st">"q4wk"</span>, <span class="dv">560</span>, <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span> <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">12</span>)</span>
<span id="cb53-916"><a href="#cb53-916" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb53-917"><a href="#cb53-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-918"><a href="#cb53-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">concentration =</span> <span class="fu">list</span>(<span class="fu">sim_1st_order_pk</span>(schedule, <span class="at">dose =</span> dose))) <span class="sc">|&gt;</span></span>
<span id="cb53-919"><a href="#cb53-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-920"><a href="#cb53-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(concentration) <span class="sc">|&gt;</span></span>
<span id="cb53-921"><a href="#cb53-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-922"><a href="#cb53-922" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb53-923"><a href="#cb53-923" aria-hidden="true" tabindex="-1"></a>    <span class="at">dose_regimen =</span> <span class="fu">paste0</span>(dose, <span class="st">" mg "</span>, regimen),</span>
<span id="cb53-924"><a href="#cb53-924" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(regimen, dose)</span>
<span id="cb53-925"><a href="#cb53-925" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-926"><a href="#cb53-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-927"><a href="#cb53-927" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">|&gt;</span></span>
<span id="cb53-928"><a href="#cb53-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> concentration, <span class="at">col =</span> dose_regimen)) <span class="sc">+</span></span>
<span id="cb53-929"><a href="#cb53-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb53-930"><a href="#cb53-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb53-931"><a href="#cb53-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>) <span class="sc">*</span> <span class="dv">28</span> <span class="sc">*</span> <span class="dv">24</span>, <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb53-932"><a href="#cb53-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb53-933"><a href="#cb53-933" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb53-934"><a href="#cb53-934" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">5000</span>, <span class="dv">8025</span>),</span>
<span id="cb53-935"><a href="#cb53-935" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">20</span>, <span class="dv">90</span>),</span>
<span id="cb53-936"><a href="#cb53-936" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"560 mg q4wk"</span>, <span class="st">"280 mg q4wk"</span>, <span class="st">"280 mg q2wk"</span>),</span>
<span id="cb53-937"><a href="#cb53-937" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">75</span>)</span>
<span id="cb53-938"><a href="#cb53-938" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-939"><a href="#cb53-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time in trial (months)"</span>) <span class="sc">+</span></span>
<span id="cb53-940"><a href="#cb53-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Drug concentration [mg/L]"</span>)</span>
<span id="cb53-941"><a href="#cb53-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-942"><a href="#cb53-942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-943"><a href="#cb53-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-944"><a href="#cb53-944" aria-hidden="true" tabindex="-1"></a>These differences in pharmacokinetic profiles likely lead to at least</span>
<span id="cb53-945"><a href="#cb53-945" aria-hidden="true" tabindex="-1"></a>somewhat different efficacy outcomes.  For example, if efficacy is</span>
<span id="cb53-946"><a href="#cb53-946" aria-hidden="true" tabindex="-1"></a>more driven by the peak concentration achieved in each dosing</span>
<span id="cb53-947"><a href="#cb53-947" aria-hidden="true" tabindex="-1"></a>interval, 280 mg q2w might be less effective than a 560 mg q4w</span>
<span id="cb53-948"><a href="#cb53-948" aria-hidden="true" tabindex="-1"></a>regiment would have been.  On the other hand, if efficacy is more</span>
<span id="cb53-949"><a href="#cb53-949" aria-hidden="true" tabindex="-1"></a>determined by the minimum concentration maintained throughout time,</span>
<span id="cb53-950"><a href="#cb53-950" aria-hidden="true" tabindex="-1"></a>then 280 mg q2w could be more effective than 560 mg q4w.  If the main</span>
<span id="cb53-951"><a href="#cb53-951" aria-hidden="true" tabindex="-1"></a>determinant of efficacy is the average drug concentration over time,</span>
<span id="cb53-952"><a href="#cb53-952" aria-hidden="true" tabindex="-1"></a>and peaks and troughs do not matter (at least within the</span>
<span id="cb53-953"><a href="#cb53-953" aria-hidden="true" tabindex="-1"></a>concentrations seen), then the two dosing regimens might be exactly</span>
<span id="cb53-954"><a href="#cb53-954" aria-hidden="true" tabindex="-1"></a>identical.</span>
<span id="cb53-955"><a href="#cb53-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-956"><a href="#cb53-956" aria-hidden="true" tabindex="-1"></a>So, we could update our previous sigmoid Emax model and add an extra</span>
<span id="cb53-957"><a href="#cb53-957" aria-hidden="true" tabindex="-1"></a>term that describes how the 280 mg q2w dose might relate to q4w doses.</span>
<span id="cb53-958"><a href="#cb53-958" aria-hidden="true" tabindex="-1"></a>Note that assuming a monotone concentration response, a 280 mg q2w</span>
<span id="cb53-959"><a href="#cb53-959" aria-hidden="true" tabindex="-1"></a>regimen cannot be worse than a 280 mg q4w regimen - this is also</span>
<span id="cb53-960"><a href="#cb53-960" aria-hidden="true" tabindex="-1"></a>illustrated by the plot showing that the concentrations of 280 mg q2w</span>
<span id="cb53-961"><a href="#cb53-961" aria-hidden="true" tabindex="-1"></a>are (unsurprisingly) always above those of 280 mg q4w.  This gives us</span>
<span id="cb53-962"><a href="#cb53-962" aria-hidden="true" tabindex="-1"></a>a lower bound for the efficacy of 280 mg q2w. Similarly, its peak</span>
<span id="cb53-963"><a href="#cb53-963" aria-hidden="true" tabindex="-1"></a>concentrations stay below 2.5 times the peak concentrations of 280 mg</span>
<span id="cb53-964"><a href="#cb53-964" aria-hidden="true" tabindex="-1"></a>q2w, which gives us an upper bound. We will specify a log-normal prior</span>
<span id="cb53-965"><a href="#cb53-965" aria-hidden="true" tabindex="-1"></a>with mean 0 and SD 0.67 for a regimen factor that indicates what q4w</span>
<span id="cb53-966"><a href="#cb53-966" aria-hidden="true" tabindex="-1"></a>dose a q2w dose is equivalent to.</span>
<span id="cb53-967"><a href="#cb53-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-968"><a href="#cb53-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-969"><a href="#cb53-969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r adding_regimen_factor, results='hide', message = FALSE}</span></span>
<span id="cb53-970"><a href="#cb53-970" aria-hidden="true" tabindex="-1"></a>model_sigmoid_alt <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb53-971"><a href="#cb53-971" aria-hidden="true" tabindex="-1"></a>  est <span class="sc">|</span> <span class="fu">se</span>(stderr) <span class="sc">~</span></span>
<span id="cb53-972"><a href="#cb53-972" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">+</span> sEmax <span class="sc">*</span> (dose <span class="sc">*</span> dosefactor)<span class="sc">^</span>h <span class="sc">/</span> ((dose <span class="sc">*</span> dosefactor)<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb53-973"><a href="#cb53-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)),</span>
<span id="cb53-974"><a href="#cb53-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb53-975"><a href="#cb53-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(dosefactor <span class="sc">~</span> <span class="fu">exp</span>((dose <span class="sc">==</span> <span class="dv">560</span>) <span class="sc">*</span> regimen)),</span>
<span id="cb53-976"><a href="#cb53-976" aria-hidden="true" tabindex="-1"></a>  E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-977"><a href="#cb53-977" aria-hidden="true" tabindex="-1"></a>  logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-978"><a href="#cb53-978" aria-hidden="true" tabindex="-1"></a>  logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-979"><a href="#cb53-979" aria-hidden="true" tabindex="-1"></a>  sEmax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-980"><a href="#cb53-980" aria-hidden="true" tabindex="-1"></a>  regimen <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-981"><a href="#cb53-981" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb53-982"><a href="#cb53-982" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb53-983"><a href="#cb53-983" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-984"><a href="#cb53-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-985"><a href="#cb53-985" aria-hidden="true" tabindex="-1"></a>prior_sigmoid_alt <span class="ot">&lt;-</span></span>
<span id="cb53-986"><a href="#cb53-986" aria-hidden="true" tabindex="-1"></a>  prior_sigmoid <span class="sc">+</span></span>
<span id="cb53-987"><a href="#cb53-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.67</span>), <span class="at">nlpar =</span> regimen)</span>
<span id="cb53-988"><a href="#cb53-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-989"><a href="#cb53-989" aria-hidden="true" tabindex="-1"></a>fit_sigmoid_alt <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb53-990"><a href="#cb53-990" aria-hidden="true" tabindex="-1"></a>  model_sigmoid_alt,</span>
<span id="cb53-991"><a href="#cb53-991" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> pathway,</span>
<span id="cb53-992"><a href="#cb53-992" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> prior_sigmoid_alt,</span>
<span id="cb53-993"><a href="#cb53-993" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.9</span>),</span>
<span id="cb53-994"><a href="#cb53-994" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5768768</span>,</span>
<span id="cb53-995"><a href="#cb53-995" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb53-996"><a href="#cb53-996" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-997"><a href="#cb53-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-998"><a href="#cb53-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-999"><a href="#cb53-999" aria-hidden="true" tabindex="-1"></a>Let's summarize the model results:</span>
<span id="cb53-1000"><a href="#cb53-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1001"><a href="#cb53-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarize_arf_results}</span></span>
<span id="cb53-1002"><a href="#cb53-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_sigmoid_alt)</span>
<span id="cb53-1003"><a href="#cb53-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1004"><a href="#cb53-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1005"><a href="#cb53-1005" aria-hidden="true" tabindex="-1"></a>As we can see, we can fit such a model, but the marginal posterior for</span>
<span id="cb53-1006"><a href="#cb53-1006" aria-hidden="true" tabindex="-1"></a>the log-regimen factor is still a N(0, 0.67) distribution.  Thus, the</span>
<span id="cb53-1007"><a href="#cb53-1007" aria-hidden="true" tabindex="-1"></a>data do not inform this parameter very well - which should not</span>
<span id="cb53-1008"><a href="#cb53-1008" aria-hidden="true" tabindex="-1"></a>surprise us.  However, if we had information external to the PATHWAY</span>
<span id="cb53-1009"><a href="#cb53-1009" aria-hidden="true" tabindex="-1"></a>trial, such as the elicited judgments of experts, we could incorporate</span>
<span id="cb53-1010"><a href="#cb53-1010" aria-hidden="true" tabindex="-1"></a>it via this type of model.</span>
<span id="cb53-1011"><a href="#cb53-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1012"><a href="#cb53-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb53-1013"><a href="#cb53-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1014"><a href="#cb53-1014" aria-hidden="true" tabindex="-1"></a>As we could see <span class="in">`brms`</span> makes it surprisingly easy to fit non-linear</span>
<span id="cb53-1015"><a href="#cb53-1015" aria-hidden="true" tabindex="-1"></a>dose response models and to perform model averaging.  Taking a</span>
<span id="cb53-1016"><a href="#cb53-1016" aria-hidden="true" tabindex="-1"></a>Bayesian approach to dose response modeling is attractive for a number</span>
<span id="cb53-1017"><a href="#cb53-1017" aria-hidden="true" tabindex="-1"></a>of reasons:</span>
<span id="cb53-1018"><a href="#cb53-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>using prior information e.g. on expected placebo outcomes, the</span>
<span id="cb53-1019"><a href="#cb53-1019" aria-hidden="true" tabindex="-1"></a>  maximum plausible treatment effect and typical dose response</span>
<span id="cb53-1020"><a href="#cb53-1020" aria-hidden="true" tabindex="-1"></a>  patterns,</span>
<span id="cb53-1021"><a href="#cb53-1021" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>(weakly-)informative priors avoid issues with maximum likelihood</span>
<span id="cb53-1022"><a href="#cb53-1022" aria-hidden="true" tabindex="-1"></a>  estimation such as infinitely steep sigmoid Emax models (common when</span>
<span id="cb53-1023"><a href="#cb53-1023" aria-hidden="true" tabindex="-1"></a>  the lowest tested dose has the best point estimate),</span>
<span id="cb53-1024"><a href="#cb53-1024" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the convenience of obtaining predictions about things that are</span>
<span id="cb53-1025"><a href="#cb53-1025" aria-hidden="true" tabindex="-1"></a>  transformations of the model parameters (e.g. the dose with at least</span>
<span id="cb53-1026"><a href="#cb53-1026" aria-hidden="true" tabindex="-1"></a>  a certain effect), and</span>
<span id="cb53-1027"><a href="#cb53-1027" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the straightforward way, in which we can extend the basic models to</span>
<span id="cb53-1028"><a href="#cb53-1028" aria-hidden="true" tabindex="-1"></a>  account for the specifics of our dose finding study.</span>
<span id="cb53-1029"><a href="#cb53-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1030"><a href="#cb53-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">## Excercises</span></span>
<span id="cb53-1031"><a href="#cb53-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1032"><a href="#cb53-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Peanut allergy</span></span>
<span id="cb53-1033"><a href="#cb53-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1034"><a href="#cb53-1034" aria-hidden="true" tabindex="-1"></a>In a hypothetical phase 2b trial children and adolescents with peanut</span>
<span id="cb53-1035"><a href="#cb53-1035" aria-hidden="true" tabindex="-1"></a>allergy were randomly assigned to placebo or 5 doses (5 to 300 mg) of</span>
<span id="cb53-1036"><a href="#cb53-1036" aria-hidden="true" tabindex="-1"></a>a new drug.  After 26 weeks the patients underwent a double-blind</span>
<span id="cb53-1037"><a href="#cb53-1037" aria-hidden="true" tabindex="-1"></a>placebo-controlled food challenge and the primary endpoint was the</span>
<span id="cb53-1038"><a href="#cb53-1038" aria-hidden="true" tabindex="-1"></a>proportion of patients that could ingest 600 mg or more of peanut</span>
<span id="cb53-1039"><a href="#cb53-1039" aria-hidden="true" tabindex="-1"></a>protein without experiencing dose-limiting symptoms. The plots below</span>
<span id="cb53-1040"><a href="#cb53-1040" aria-hidden="true" tabindex="-1"></a>show an overview of the data. Note that no placebo patients were</span>
<span id="cb53-1041"><a href="#cb53-1041" aria-hidden="true" tabindex="-1"></a>considered "responders" per the primary endpoint definition.</span>
<span id="cb53-1042"><a href="#cb53-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1043"><a href="#cb53-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```{r peanutdata}</span></span>
<span id="cb53-1044"><a href="#cb53-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-1045"><a href="#cb53-1045" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-1046"><a href="#cb53-1046" aria-hidden="true" tabindex="-1"></a>peanut <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb53-1047"><a href="#cb53-1047" aria-hidden="true" tabindex="-1"></a>  <span class="at">TRT01P =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb53-1048"><a href="#cb53-1048" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L,</span>
<span id="cb53-1049"><a href="#cb53-1049" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">6</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb53-1050"><a href="#cb53-1050" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb53-1051"><a href="#cb53-1051" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L,</span>
<span id="cb53-1052"><a href="#cb53-1052" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L,</span>
<span id="cb53-1053"><a href="#cb53-1053" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">4</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L,</span>
<span id="cb53-1054"><a href="#cb53-1054" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L,</span>
<span id="cb53-1055"><a href="#cb53-1055" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1056"><a href="#cb53-1056" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1057"><a href="#cb53-1057" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1058"><a href="#cb53-1058" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L</span>
<span id="cb53-1059"><a href="#cb53-1059" aria-hidden="true" tabindex="-1"></a>  ),<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PBO"</span>, <span class="st">"5 mg"</span>, <span class="st">"15 mg"</span>, <span class="st">"50 mg"</span>, <span class="st">"150 mg"</span>, <span class="st">"300 mg"</span>), <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb53-1060"><a href="#cb53-1060" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(</span>
<span id="cb53-1061"><a href="#cb53-1061" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L,</span>
<span id="cb53-1062"><a href="#cb53-1062" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L,</span>
<span id="cb53-1063"><a href="#cb53-1063" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb53-1064"><a href="#cb53-1064" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb53-1065"><a href="#cb53-1065" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L,</span>
<span id="cb53-1066"><a href="#cb53-1066" aria-hidden="true" tabindex="-1"></a>    <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">150</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L,</span>
<span id="cb53-1067"><a href="#cb53-1067" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L,</span>
<span id="cb53-1068"><a href="#cb53-1068" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">50</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L,</span>
<span id="cb53-1069"><a href="#cb53-1069" aria-hidden="true" tabindex="-1"></a>    <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L,</span>
<span id="cb53-1070"><a href="#cb53-1070" aria-hidden="true" tabindex="-1"></a>    <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">15</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb53-1071"><a href="#cb53-1071" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L,</span>
<span id="cb53-1072"><a href="#cb53-1072" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb53-1073"><a href="#cb53-1073" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb53-1074"><a href="#cb53-1074" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L),</span>
<span id="cb53-1075"><a href="#cb53-1075" aria-hidden="true" tabindex="-1"></a>  <span class="at">AVAL =</span> <span class="fu">c</span>(</span>
<span id="cb53-1076"><a href="#cb53-1076" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L,</span>
<span id="cb53-1077"><a href="#cb53-1077" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L,</span>
<span id="cb53-1078"><a href="#cb53-1078" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L,</span>
<span id="cb53-1079"><a href="#cb53-1079" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L,</span>
<span id="cb53-1080"><a href="#cb53-1080" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L,</span>
<span id="cb53-1081"><a href="#cb53-1081" aria-hidden="true" tabindex="-1"></a>    <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L,</span>
<span id="cb53-1082"><a href="#cb53-1082" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1000</span>L, <span class="dv">0</span>L, <span class="dv">1000</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L,</span>
<span id="cb53-1083"><a href="#cb53-1083" aria-hidden="true" tabindex="-1"></a>    <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">1000</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L,</span>
<span id="cb53-1084"><a href="#cb53-1084" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">1000</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L,</span>
<span id="cb53-1085"><a href="#cb53-1085" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L,</span>
<span id="cb53-1086"><a href="#cb53-1086" aria-hidden="true" tabindex="-1"></a>    <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">1000</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">600</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L,</span>
<span id="cb53-1087"><a href="#cb53-1087" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L,</span>
<span id="cb53-1088"><a href="#cb53-1088" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">300</span>L, <span class="dv">600</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">100</span>L, <span class="dv">300</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">10</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L,</span>
<span id="cb53-1089"><a href="#cb53-1089" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">100</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">10</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">100</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">300</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L,</span>
<span id="cb53-1090"><a href="#cb53-1090" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">3</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L),</span>
<span id="cb53-1091"><a href="#cb53-1091" aria-hidden="true" tabindex="-1"></a>  <span class="at">PARAM =</span> <span class="fu">structure</span>(</span>
<span id="cb53-1092"><a href="#cb53-1092" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb53-1093"><a href="#cb53-1093" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1094"><a href="#cb53-1094" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1095"><a href="#cb53-1095" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1096"><a href="#cb53-1096" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1097"><a href="#cb53-1097" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1098"><a href="#cb53-1098" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1099"><a href="#cb53-1099" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1100"><a href="#cb53-1100" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1101"><a href="#cb53-1101" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1102"><a href="#cb53-1102" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1103"><a href="#cb53-1103" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb53-1104"><a href="#cb53-1104" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerated amount of peanut protein (mg)"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb53-1105"><a href="#cb53-1105" aria-hidden="true" tabindex="-1"></a>  <span class="at">USUBJID =</span> <span class="fu">c</span>(</span>
<span id="cb53-1106"><a href="#cb53-1106" aria-hidden="true" tabindex="-1"></a>    <span class="dv">129</span>L, <span class="dv">103</span>L, <span class="dv">104</span>L, <span class="dv">185</span>L, <span class="dv">34</span>L, <span class="dv">15</span>L, <span class="dv">140</span>L, <span class="dv">151</span>L, <span class="dv">7</span>L, <span class="dv">144</span>L, <span class="dv">200</span>L, <span class="dv">23</span>L, <span class="dv">138</span>L, <span class="dv">115</span>L, <span class="dv">255</span>L, <span class="dv">147</span>L, <span class="dv">224</span>L, <span class="dv">101</span>L, <span class="dv">156</span>L, <span class="dv">284</span>L,</span>
<span id="cb53-1107"><a href="#cb53-1107" aria-hidden="true" tabindex="-1"></a>    <span class="dv">136</span>L, <span class="dv">248</span>L, <span class="dv">179</span>L, <span class="dv">298</span>L, <span class="dv">168</span>L, <span class="dv">295</span>L, <span class="dv">289</span>L, <span class="dv">241</span>L, <span class="dv">36</span>L, <span class="dv">27</span>L, <span class="dv">123</span>L, <span class="dv">266</span>L, <span class="dv">11</span>L, <span class="dv">291</span>L, <span class="dv">236</span>L, <span class="dv">130</span>L, <span class="dv">173</span>L, <span class="dv">195</span>L, <span class="dv">203</span>L, <span class="dv">160</span>L,</span>
<span id="cb53-1108"><a href="#cb53-1108" aria-hidden="true" tabindex="-1"></a>    <span class="dv">274</span>L, <span class="dv">167</span>L, <span class="dv">290</span>L, <span class="dv">94</span>L, <span class="dv">9</span>L, <span class="dv">269</span>L, <span class="dv">122</span>L, <span class="dv">135</span>L, <span class="dv">64</span>L, <span class="dv">26</span>L, <span class="dv">95</span>L, <span class="dv">10</span>L, <span class="dv">5</span>L, <span class="dv">234</span>L, <span class="dv">161</span>L, <span class="dv">299</span>L, <span class="dv">88</span>L, <span class="dv">69</span>L, <span class="dv">35</span>L, <span class="dv">233</span>L, <span class="dv">286</span>L,</span>
<span id="cb53-1109"><a href="#cb53-1109" aria-hidden="true" tabindex="-1"></a>    <span class="dv">85</span>L, <span class="dv">91</span>L, <span class="dv">189</span>L, <span class="dv">80</span>L, <span class="dv">152</span>L, <span class="dv">223</span>L, <span class="dv">287</span>L, <span class="dv">244</span>L, <span class="dv">57</span>L, <span class="dv">108</span>L, <span class="dv">18</span>L, <span class="dv">62</span>L, <span class="dv">157</span>L, <span class="dv">300</span>L, <span class="dv">283</span>L, <span class="dv">164</span>L, <span class="dv">243</span>L, <span class="dv">89</span>L, <span class="dv">220</span>L, <span class="dv">24</span>L, <span class="dv">271</span>L,</span>
<span id="cb53-1110"><a href="#cb53-1110" aria-hidden="true" tabindex="-1"></a>    <span class="dv">166</span>L, <span class="dv">118</span>L, <span class="dv">201</span>L, <span class="dv">127</span>L, <span class="dv">121</span>L, <span class="dv">41</span>L, <span class="dv">267</span>L, <span class="dv">213</span>L, <span class="dv">49</span>L, <span class="dv">73</span>L, <span class="dv">202</span>L, <span class="dv">134</span>L, <span class="dv">112</span>L, <span class="dv">25</span>L, <span class="dv">227</span>L, <span class="dv">29</span>L, <span class="dv">251</span>L, <span class="dv">273</span>L, <span class="dv">119</span>L, <span class="dv">132</span>L,</span>
<span id="cb53-1111"><a href="#cb53-1111" aria-hidden="true" tabindex="-1"></a>    <span class="dv">74</span>L, <span class="dv">270</span>L, <span class="dv">83</span>L, <span class="dv">37</span>L, <span class="dv">181</span>L, <span class="dv">258</span>L, <span class="dv">253</span>L, <span class="dv">48</span>L, <span class="dv">120</span>L, <span class="dv">54</span>L, <span class="dv">277</span>L, <span class="dv">176</span>L, <span class="dv">65</span>L, <span class="dv">264</span>L, <span class="dv">107</span>L, <span class="dv">171</span>L, <span class="dv">262</span>L, <span class="dv">162</span>L, <span class="dv">187</span>L, <span class="dv">272</span>L,</span>
<span id="cb53-1112"><a href="#cb53-1112" aria-hidden="true" tabindex="-1"></a>    <span class="dv">288</span>L, <span class="dv">294</span>L, <span class="dv">245</span>L, <span class="dv">109</span>L, <span class="dv">172</span>L, <span class="dv">204</span>L, <span class="dv">275</span>L, <span class="dv">22</span>L, <span class="dv">66</span>L, <span class="dv">186</span>L, <span class="dv">247</span>L, <span class="dv">17</span>L, <span class="dv">149</span>L, <span class="dv">141</span>L, <span class="dv">177</span>L, <span class="dv">280</span>L, <span class="dv">216</span>L, <span class="dv">40</span>L, <span class="dv">75</span>L, <span class="dv">263</span>L,</span>
<span id="cb53-1113"><a href="#cb53-1113" aria-hidden="true" tabindex="-1"></a>    <span class="dv">246</span>L, <span class="dv">14</span>L, <span class="dv">81</span>L, <span class="dv">260</span>L, <span class="dv">153</span>L, <span class="dv">45</span>L, <span class="dv">237</span>L, <span class="dv">8</span>L, <span class="dv">117</span>L, <span class="dv">86</span>L, <span class="dv">296</span>L, <span class="dv">146</span>L, <span class="dv">154</span>L, <span class="dv">116</span>L, <span class="dv">38</span>L, <span class="dv">100</span>L, <span class="dv">191</span>L, <span class="dv">175</span>L, <span class="dv">92</span>L, <span class="dv">158</span>L, <span class="dv">192</span>L,</span>
<span id="cb53-1114"><a href="#cb53-1114" aria-hidden="true" tabindex="-1"></a>    <span class="dv">180</span>L, <span class="dv">256</span>L, <span class="dv">254</span>L, <span class="dv">125</span>L, <span class="dv">222</span>L, <span class="dv">145</span>L, <span class="dv">261</span>L, <span class="dv">155</span>L, <span class="dv">159</span>L, <span class="dv">3</span>L, <span class="dv">206</span>L, <span class="dv">278</span>L, <span class="dv">19</span>L, <span class="dv">31</span>L, <span class="dv">63</span>L, <span class="dv">208</span>L, <span class="dv">55</span>L, <span class="dv">259</span>L, <span class="dv">218</span>L, <span class="dv">111</span>L,</span>
<span id="cb53-1115"><a href="#cb53-1115" aria-hidden="true" tabindex="-1"></a>    <span class="dv">226</span>L, <span class="dv">33</span>L, <span class="dv">2</span>L, <span class="dv">44</span>L, <span class="dv">297</span>L, <span class="dv">53</span>L, <span class="dv">87</span>L, <span class="dv">16</span>L, <span class="dv">28</span>L, <span class="dv">90</span>L, <span class="dv">207</span>L, <span class="dv">56</span>L, <span class="dv">137</span>L, <span class="dv">128</span>L, <span class="dv">178</span>L, <span class="dv">142</span>L, <span class="dv">143</span>L, <span class="dv">148</span>L, <span class="dv">193</span>L, <span class="dv">229</span>L, <span class="dv">265</span>L,</span>
<span id="cb53-1116"><a href="#cb53-1116" aria-hidden="true" tabindex="-1"></a>    <span class="dv">97</span>L, <span class="dv">252</span>L, <span class="dv">205</span>L, <span class="dv">150</span>L, <span class="dv">165</span>L, <span class="dv">188</span>L, <span class="dv">52</span>L, <span class="dv">99</span>L, <span class="dv">93</span>L, <span class="dv">1</span>L, <span class="dv">221</span>L, <span class="dv">124</span>L, <span class="dv">210</span>L, <span class="dv">6</span>L, <span class="dv">232</span>L, <span class="dv">21</span>L, <span class="dv">211</span>L, <span class="dv">163</span>L, <span class="dv">96</span>L, <span class="dv">60</span>L, <span class="dv">183</span>L,</span>
<span id="cb53-1117"><a href="#cb53-1117" aria-hidden="true" tabindex="-1"></a>    <span class="dv">190</span>L, <span class="dv">242</span>L, <span class="dv">42</span>L, <span class="dv">46</span>L, <span class="dv">67</span>L, <span class="dv">126</span>L, <span class="dv">209</span>L, <span class="dv">72</span>L, <span class="dv">194</span>L, <span class="dv">238</span>L, <span class="dv">184</span>L, <span class="dv">39</span>L, <span class="dv">105</span>L, <span class="dv">249</span>L, <span class="dv">61</span>L, <span class="dv">113</span>L, <span class="dv">30</span>L, <span class="dv">77</span>L, <span class="dv">12</span>L, <span class="dv">4</span>L, <span class="dv">51</span>L,</span>
<span id="cb53-1118"><a href="#cb53-1118" aria-hidden="true" tabindex="-1"></a>    <span class="dv">139</span>L, <span class="dv">20</span>L, <span class="dv">268</span>L, <span class="dv">215</span>L, <span class="dv">292</span>L, <span class="dv">217</span>L, <span class="dv">199</span>L, <span class="dv">32</span>L, <span class="dv">276</span>L, <span class="dv">47</span>L, <span class="dv">225</span>L, <span class="dv">230</span>L, <span class="dv">79</span>L, <span class="dv">71</span>L, <span class="dv">98</span>L, <span class="dv">50</span>L, <span class="dv">13</span>L, <span class="dv">76</span>L, <span class="dv">231</span>L, <span class="dv">250</span>L, <span class="dv">58</span>L,</span>
<span id="cb53-1119"><a href="#cb53-1119" aria-hidden="true" tabindex="-1"></a>    <span class="dv">68</span>L, <span class="dv">239</span>L, <span class="dv">198</span>L, <span class="dv">293</span>L, <span class="dv">212</span>L, <span class="dv">110</span>L, <span class="dv">59</span>L, <span class="dv">182</span>L, <span class="dv">133</span>L, <span class="dv">170</span>L, <span class="dv">43</span>L, <span class="dv">282</span>L, <span class="dv">281</span>L, <span class="dv">131</span>L, <span class="dv">114</span>L, <span class="dv">196</span>L, <span class="dv">214</span>L, <span class="dv">285</span>L, <span class="dv">70</span>L, <span class="dv">102</span>L,</span>
<span id="cb53-1120"><a href="#cb53-1120" aria-hidden="true" tabindex="-1"></a>    <span class="dv">279</span>L, <span class="dv">106</span>L, <span class="dv">197</span>L, <span class="dv">257</span>L, <span class="dv">228</span>L, <span class="dv">84</span>L, <span class="dv">235</span>L, <span class="dv">78</span>L, <span class="dv">169</span>L, <span class="dv">240</span>L, <span class="dv">219</span>L, <span class="dv">174</span>L, <span class="dv">82</span>L),</span>
<span id="cb53-1121"><a href="#cb53-1121" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT1 =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb53-1122"><a href="#cb53-1122" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1123"><a href="#cb53-1123" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1124"><a href="#cb53-1124" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1125"><a href="#cb53-1125" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1126"><a href="#cb53-1126" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1127"><a href="#cb53-1127" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1128"><a href="#cb53-1128" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1129"><a href="#cb53-1129" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1130"><a href="#cb53-1130" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1131"><a href="#cb53-1131" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1132"><a href="#cb53-1132" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb53-1133"><a href="#cb53-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerating &gt;=600 mg of peanut protein without dose-limiting symptoms"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb53-1134"><a href="#cb53-1134" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT1FL =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb53-1135"><a href="#cb53-1135" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1136"><a href="#cb53-1136" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1137"><a href="#cb53-1137" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1138"><a href="#cb53-1138" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1139"><a href="#cb53-1139" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1140"><a href="#cb53-1140" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1141"><a href="#cb53-1141" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1142"><a href="#cb53-1142" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1143"><a href="#cb53-1143" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1144"><a href="#cb53-1144" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1145"><a href="#cb53-1145" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb53-1146"><a href="#cb53-1146" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Y"</span>), <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb53-1147"><a href="#cb53-1147" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT2 =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb53-1148"><a href="#cb53-1148" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1149"><a href="#cb53-1149" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1150"><a href="#cb53-1150" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1151"><a href="#cb53-1151" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1152"><a href="#cb53-1152" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1153"><a href="#cb53-1153" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1154"><a href="#cb53-1154" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1155"><a href="#cb53-1155" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1156"><a href="#cb53-1156" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1157"><a href="#cb53-1157" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1158"><a href="#cb53-1158" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb53-1159"><a href="#cb53-1159" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="st">"Tolerating &gt;=1000 mg of peanut protein without dose-limiting symptoms"</span>, <span class="at">class =</span> <span class="st">"factor"</span>),</span>
<span id="cb53-1160"><a href="#cb53-1160" aria-hidden="true" tabindex="-1"></a>  <span class="at">CRIT2FL =</span> <span class="fu">structure</span>(<span class="fu">c</span>(</span>
<span id="cb53-1161"><a href="#cb53-1161" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1162"><a href="#cb53-1162" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1163"><a href="#cb53-1163" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1164"><a href="#cb53-1164" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,</span>
<span id="cb53-1165"><a href="#cb53-1165" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1166"><a href="#cb53-1166" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1167"><a href="#cb53-1167" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1168"><a href="#cb53-1168" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">2</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1169"><a href="#cb53-1169" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1170"><a href="#cb53-1170" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L,</span>
<span id="cb53-1171"><a href="#cb53-1171" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L),</span>
<span id="cb53-1172"><a href="#cb53-1172" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"Y"</span>), <span class="at">class =</span> <span class="st">"factor"</span> ) )</span>
<span id="cb53-1173"><a href="#cb53-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1174"><a href="#cb53-1174" aria-hidden="true" tabindex="-1"></a>peanut <span class="sc">|&gt;</span></span>
<span id="cb53-1175"><a href="#cb53-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(AVAL), <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb53-1176"><a href="#cb53-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">preserve =</span> <span class="st">"single"</span>)) <span class="sc">+</span></span>
<span id="cb53-1177"><a href="#cb53-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb53-1178"><a href="#cb53-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb53-1179"><a href="#cb53-1179" aria-hidden="true" tabindex="-1"></a>      <span class="st">"royalblue"</span>,</span>
<span id="cb53-1180"><a href="#cb53-1180" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#fb6a4a"</span>,</span>
<span id="cb53-1181"><a href="#cb53-1181" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#ef3b2c"</span>,</span>
<span id="cb53-1182"><a href="#cb53-1182" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#cb181d"</span>,</span>
<span id="cb53-1183"><a href="#cb53-1183" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#a50f15"</span>,</span>
<span id="cb53-1184"><a href="#cb53-1184" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#67000d"</span></span>
<span id="cb53-1185"><a href="#cb53-1185" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-1186"><a href="#cb53-1186" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1187"><a href="#cb53-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Peanut protein tolerated without dose-limiting symptoms (mg)"</span>) <span class="sc">+</span></span>
<span id="cb53-1188"><a href="#cb53-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Patients"</span>) <span class="sc">+</span></span>
<span id="cb53-1189"><a href="#cb53-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb53-1190"><a href="#cb53-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1191"><a href="#cb53-1191" aria-hidden="true" tabindex="-1"></a>peanut <span class="sc">|&gt;</span></span>
<span id="cb53-1192"><a href="#cb53-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TRT01P) <span class="sc">|&gt;</span></span>
<span id="cb53-1193"><a href="#cb53-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">proportion =</span> <span class="fu">sum</span>(CRIT1FL <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb53-1194"><a href="#cb53-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TRT01P, <span class="at">y =</span> proportion, <span class="at">fill =</span> TRT01P)) <span class="sc">+</span></span>
<span id="cb53-1195"><a href="#cb53-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb53-1196"><a href="#cb53-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb53-1197"><a href="#cb53-1197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(proportion)),</span>
<span id="cb53-1198"><a href="#cb53-1198" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">7</span>,</span>
<span id="cb53-1199"><a href="#cb53-1199" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">rep</span>(<span class="fl">1.5</span>, <span class="dv">5</span>))</span>
<span id="cb53-1200"><a href="#cb53-1200" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1201"><a href="#cb53-1201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb53-1202"><a href="#cb53-1202" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb53-1203"><a href="#cb53-1203" aria-hidden="true" tabindex="-1"></a>      <span class="st">"royalblue"</span>,</span>
<span id="cb53-1204"><a href="#cb53-1204" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#fb6a4a"</span>,</span>
<span id="cb53-1205"><a href="#cb53-1205" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#ef3b2c"</span>,</span>
<span id="cb53-1206"><a href="#cb53-1206" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#cb181d"</span>,</span>
<span id="cb53-1207"><a href="#cb53-1207" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#a50f15"</span>,</span>
<span id="cb53-1208"><a href="#cb53-1208" aria-hidden="true" tabindex="-1"></a>      <span class="st">"#67000d"</span></span>
<span id="cb53-1209"><a href="#cb53-1209" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-1210"><a href="#cb53-1210" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1211"><a href="#cb53-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb53-1212"><a href="#cb53-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Tolerating &gt;=600 mg of peanut protein without dose-limiting symptoms"</span>) <span class="sc">+</span></span>
<span id="cb53-1213"><a href="#cb53-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Percentage of patients"</span>)</span>
<span id="cb53-1214"><a href="#cb53-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1215"><a href="#cb53-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1216"><a href="#cb53-1216" aria-hidden="true" tabindex="-1"></a>Fit a sigmoid Emax logistic regression model </span>
<span id="cb53-1217"><a href="#cb53-1217" aria-hidden="true" tabindex="-1"></a>(i.e. <span class="in">`family=binomial(link="logit")`</span>). </span>
<span id="cb53-1218"><a href="#cb53-1218" aria-hidden="true" tabindex="-1"></a>To accelerate likelihood evaluations, first summarize data as "responders" <span class="in">`y`</span></span>
<span id="cb53-1219"><a href="#cb53-1219" aria-hidden="true" tabindex="-1"></a>out of <span class="in">`n`</span> patients per dose. </span>
<span id="cb53-1220"><a href="#cb53-1220" aria-hidden="true" tabindex="-1"></a>We expect the true placebo proportion to be around 0.05 (-2.944 on the logit </span>
<span id="cb53-1221"><a href="#cb53-1221" aria-hidden="true" tabindex="-1"></a>scale) with much more than 0.1 or much less than 0.02 considered unlikely.</span>
<span id="cb53-1222"><a href="#cb53-1222" aria-hidden="true" tabindex="-1"></a>It is a-priori at least possible that there is a huge treatment effect such </span>
<span id="cb53-1223"><a href="#cb53-1223" aria-hidden="true" tabindex="-1"></a>as 95\% versus 5\% responders (difference on the log-scale close to 6),</span>
<span id="cb53-1224"><a href="#cb53-1224" aria-hidden="true" tabindex="-1"></a>but we are at least mildly skeptical.</span>
<span id="cb53-1225"><a href="#cb53-1225" aria-hidden="true" tabindex="-1"></a>The dose response is a-priori somewhat likely to follow a Emax curve (with Hill</span>
<span id="cb53-1226"><a href="#cb53-1226" aria-hidden="true" tabindex="-1"></a>parameter near 1), but we wish to allow for the possibility of a steeper or </span>
<span id="cb53-1227"><a href="#cb53-1227" aria-hidden="true" tabindex="-1"></a>shallower curve. The dose with half the effect (ED50) might be near 15 mg, but </span>
<span id="cb53-1228"><a href="#cb53-1228" aria-hidden="true" tabindex="-1"></a>have considerable uncertainty around that.</span>
<span id="cb53-1229"><a href="#cb53-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1230"><a href="#cb53-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r peanutmodel1, eval = FALSE}</span></span>
<span id="cb53-1231"><a href="#cb53-1231" aria-hidden="true" tabindex="-1"></a>fit_sigmoid <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb53-1232"><a href="#cb53-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(</span>
<span id="cb53-1233"><a href="#cb53-1233" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> E0 <span class="sc">+</span> Emax <span class="sc">*</span> dose<span class="sc">^</span>h <span class="sc">/</span> (dose<span class="sc">^</span>h <span class="sc">+</span> ED50<span class="sc">^</span>h),</span>
<span id="cb53-1234"><a href="#cb53-1234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nlf</span>(h <span class="sc">~</span> <span class="fu">exp</span>(logh)),</span>
<span id="cb53-1235"><a href="#cb53-1235" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nlf</span>(ED50 <span class="sc">~</span> <span class="fu">exp</span>(logED50)),</span>
<span id="cb53-1236"><a href="#cb53-1236" aria-hidden="true" tabindex="-1"></a>    E0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-1237"><a href="#cb53-1237" aria-hidden="true" tabindex="-1"></a>    logED50 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-1238"><a href="#cb53-1238" aria-hidden="true" tabindex="-1"></a>    logh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-1239"><a href="#cb53-1239" aria-hidden="true" tabindex="-1"></a>    Emax <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb53-1240"><a href="#cb53-1240" aria-hidden="true" tabindex="-1"></a>    <span class="at">nl =</span> <span class="cn">TRUE</span>,</span>
<span id="cb53-1241"><a href="#cb53-1241" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> logit)</span>
<span id="cb53-1242"><a href="#cb53-1242" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb53-1243"><a href="#cb53-1243" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> </span>
<span id="cb53-1244"><a href="#cb53-1244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">2.944</span>, <span class="fl">0.38</span>), <span class="at">nlpar =</span> E0) <span class="sc">+</span></span>
<span id="cb53-1245"><a href="#cb53-1245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> logh) <span class="sc">+</span></span>
<span id="cb53-1246"><a href="#cb53-1246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="at">nlpar =</span> Emax) <span class="sc">+</span></span>
<span id="cb53-1247"><a href="#cb53-1247" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">2.7</span>, <span class="fl">2.5</span>), <span class="at">nlpar =</span> logED50),</span>
<span id="cb53-1248"><a href="#cb53-1248" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> peanut <span class="sc">|&gt;</span></span>
<span id="cb53-1249"><a href="#cb53-1249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TRT01P, dose) <span class="sc">|&gt;</span></span>
<span id="cb53-1250"><a href="#cb53-1250" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">sum</span>(CRIT1FL <span class="sc">==</span> <span class="st">"Y"</span>), <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb53-1251"><a href="#cb53-1251" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-1252"><a href="#cb53-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1253"><a href="#cb53-1253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1254"><a href="#cb53-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1255"><a href="#cb53-1255" aria-hidden="true" tabindex="-1"></a>Now use </span>
<span id="cb53-1256"><a href="#cb53-1256" aria-hidden="true" tabindex="-1"></a><span class="in">`tibble(dose = seq(0, 300, 1), n=1) |&gt; tidybayes::add_epred_rvars(object=fit_sigmoid)`</span> </span>
<span id="cb53-1257"><a href="#cb53-1257" aria-hidden="true" tabindex="-1"></a>to obtain predicted proportions for every dose from 0 to 300 mg.</span>
<span id="cb53-1258"><a href="#cb53-1258" aria-hidden="true" tabindex="-1"></a>Then, plot the curve of predicted proportions for each of these doses using </span>
<span id="cb53-1259"><a href="#cb53-1259" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span> and <span class="in">`ggdist`</span> (using <span class="in">`ydist=.epred`</span> in the aesthetics and the </span>
<span id="cb53-1260"><a href="#cb53-1260" aria-hidden="true" tabindex="-1"></a><span class="in">`ggdist::stat_lineribbon()`</span> geom).</span>
<span id="cb53-1261"><a href="#cb53-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1262"><a href="#cb53-1262" aria-hidden="true" tabindex="-1"></a>Next obtain the posterior distribution for the difference in proportions for</span>
<span id="cb53-1263"><a href="#cb53-1263" aria-hidden="true" tabindex="-1"></a>each of these dose levels compared with placebo.</span>
<span id="cb53-1264"><a href="#cb53-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1265"><a href="#cb53-1265" aria-hidden="true" tabindex="-1"></a>Try to perform a more efficient statistical analysis by either using an ordinal</span>
<span id="cb53-1266"><a href="#cb53-1266" aria-hidden="true" tabindex="-1"></a>outcome using <span class="in">`family = cumulative(link = "logit", threshold = "flexible")`</span></span>
<span id="cb53-1267"><a href="#cb53-1267" aria-hidden="true" tabindex="-1"></a>or by treating the data about the logarithm of the amount of protein </span>
<span id="cb53-1268"><a href="#cb53-1268" aria-hidden="true" tabindex="-1"></a>tolerated as interval censored </span>
<span id="cb53-1269"><a href="#cb53-1269" aria-hidden="true" tabindex="-1"></a>($-\infty$ to &lt;log(3), &gt;= log(3) to &lt;log(10) mg, ...) using</span>
<span id="cb53-1270"><a href="#cb53-1270" aria-hidden="true" tabindex="-1"></a><span class="in">`logAVAL | cens("interval", logAVALnext) ~`</span> with <span class="in">`family = gaussian()`</span>.</span>
<span id="cb53-1271"><a href="#cb53-1271" aria-hidden="true" tabindex="-1"></a>For the latter approach you might have to set <span class="in">`log(0)`</span> to a very low number</span>
<span id="cb53-1272"><a href="#cb53-1272" aria-hidden="true" tabindex="-1"></a>such as -28 (approximate log(weight) of one single peanut protein </span>
<span id="cb53-1273"><a href="#cb53-1273" aria-hidden="true" tabindex="-1"></a>molecule) and assume the upper interval end when a patient could tolerate</span>
<span id="cb53-1274"><a href="#cb53-1274" aria-hidden="true" tabindex="-1"></a>1000 mg to, say, <span class="in">`log(30000)`</span> (approximately 100 peanut kernels).</span>
<span id="cb53-1275"><a href="#cb53-1275" aria-hidden="true" tabindex="-1"></a>How would you change the prior distributions for these two models?</span>
<span id="cb53-1276"><a href="#cb53-1276" aria-hidden="true" tabindex="-1"></a>Note, if we had a baseline amount of protein tolerated, we could treat this</span>
<span id="cb53-1277"><a href="#cb53-1277" aria-hidden="true" tabindex="-1"></a>as a monotonic covariate e.g. using <span class="in">`mo(BASE)`</span> or assume a particular functional</span>
<span id="cb53-1278"><a href="#cb53-1278" aria-hidden="true" tabindex="-1"></a>form.</span>
<span id="cb53-1279"><a href="#cb53-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1280"><a href="#cb53-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1281"><a href="#cb53-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1282"><a href="#cb53-1282" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="dummy"}</span>
<span id="cb53-1283"><a href="#cb53-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Antipneumococcus serum in mice</span></span>
<span id="cb53-1284"><a href="#cb53-1284" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-1285"><a href="#cb53-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1286"><a href="#cb53-1286" aria-hidden="true" tabindex="-1"></a>The data below are from a non-clinical study published by Goodner and</span>
<span id="cb53-1287"><a href="#cb53-1287" aria-hidden="true" tabindex="-1"></a>Horsfall in 1935 (Goodner, K. and Horsfall Jr, F.L., 1935. The</span>
<span id="cb53-1288"><a href="#cb53-1288" aria-hidden="true" tabindex="-1"></a>protective action of type I antipneumococcus serum in mice: I. The</span>
<span id="cb53-1289"><a href="#cb53-1289" aria-hidden="true" tabindex="-1"></a>quantitative aspects of the mouse protection test. The Journal of</span>
<span id="cb53-1290"><a href="#cb53-1290" aria-hidden="true" tabindex="-1"></a>Experimental Medicine, 62(3), pp.359-374.).  Mice were given</span>
<span id="cb53-1291"><a href="#cb53-1291" aria-hidden="true" tabindex="-1"></a>injections of different amounts from a pneumococcus culture, which at</span>
<span id="cb53-1292"><a href="#cb53-1292" aria-hidden="true" tabindex="-1"></a>the doses given would in the absence of treatment be invariably fatal,</span>
<span id="cb53-1293"><a href="#cb53-1293" aria-hidden="true" tabindex="-1"></a>mixed together with different doses of type I antipenumococcus horse</span>
<span id="cb53-1294"><a href="#cb53-1294" aria-hidden="true" tabindex="-1"></a>and rabbit sera. Over several days it was recorded whether each mouse</span>
<span id="cb53-1295"><a href="#cb53-1295" aria-hidden="true" tabindex="-1"></a>survived or died. This is an example of a dose response curve that</span>
<span id="cb53-1296"><a href="#cb53-1296" aria-hidden="true" tabindex="-1"></a>appears to have been accepted to be truly non-monotonic in the</span>
<span id="cb53-1297"><a href="#cb53-1297" aria-hidden="true" tabindex="-1"></a>scientific literature.</span>
<span id="cb53-1298"><a href="#cb53-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1299"><a href="#cb53-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mice_data}</span></span>
<span id="cb53-1300"><a href="#cb53-1300" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb53-1301"><a href="#cb53-1301" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb53-1302"><a href="#cb53-1302" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb53-1303"><a href="#cb53-1303" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>( <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">29</span><span class="sc">*</span><span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">2</span>L, <span class="dv">32</span><span class="sc">*</span><span class="dv">3</span>)),</span>
<span id="cb53-1304"><a href="#cb53-1304" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">2</span>L), </span>
<span id="cb53-1305"><a href="#cb53-1305" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"rabbit"</span>, <span class="st">"horse"</span>)),</span>
<span id="cb53-1306"><a href="#cb53-1306" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fl">0.4</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">5</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">6</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">7</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">7</span>L,</span>
<span id="cb53-1307"><a href="#cb53-1307" aria-hidden="true" tabindex="-1"></a>                                          <span class="dv">1</span>L<span class="sc">:</span><span class="dv">5</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L, <span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L),</span>
<span id="cb53-1308"><a href="#cb53-1308" aria-hidden="true" tabindex="-1"></a>                                <span class="at">each=</span><span class="dv">3</span>),</span>
<span id="cb53-1309"><a href="#cb53-1309" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fl">0.4</span>, <span class="dv">18</span>), <span class="fu">rep</span>(<span class="fl">0.2</span>, <span class="dv">21</span>), <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="dv">24</span>), </span>
<span id="cb53-1310"><a href="#cb53-1310" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="fl">0.05</span>, <span class="dv">24</span>), <span class="fu">rep</span>(<span class="fl">0.4</span>, <span class="dv">15</span>), <span class="fu">rep</span>(<span class="fl">0.2</span>, <span class="dv">27</span>), </span>
<span id="cb53-1311"><a href="#cb53-1311" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="fl">0.1</span>, <span class="dv">27</span>), <span class="fu">rep</span>(<span class="fl">0.05</span>,<span class="dv">27</span>)),</span>
<span id="cb53-1312"><a href="#cb53-1312" aria-hidden="true" tabindex="-1"></a>  <span class="at">Died =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">18</span>),</span>
<span id="cb53-1313"><a href="#cb53-1313" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>L,<span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">5</span>), <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L,</span>
<span id="cb53-1314"><a href="#cb53-1314" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">0</span>L, <span class="dv">14</span>),<span class="dv">1</span>L, <span class="dv">0</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">1</span>L,<span class="dv">1</span>L,</span>
<span id="cb53-1315"><a href="#cb53-1315" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">24</span>), </span>
<span id="cb53-1316"><a href="#cb53-1316" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">15</span>),</span>
<span id="cb53-1317"><a href="#cb53-1317" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L, <span class="dv">8</span>),<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="dv">1</span>L,<span class="dv">0</span>L,<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>),<span class="dv">0</span>L, <span class="dv">0</span>L,<span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>),</span>
<span id="cb53-1318"><a href="#cb53-1318" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>), <span class="dv">0</span>L,<span class="dv">1</span>L,<span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">9</span>),<span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">4</span>),<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">6</span>),</span>
<span id="cb53-1319"><a href="#cb53-1319" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">0</span>L,<span class="dv">12</span>),<span class="dv">1</span>L, <span class="dv">0</span>L,<span class="dv">0</span>L, <span class="fu">rep</span>(<span class="dv">1</span>L,<span class="dv">7</span>))) <span class="sc">|&gt;</span></span>
<span id="cb53-1320"><a href="#cb53-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="dv">1</span>L<span class="sc">-</span>Died)</span>
<span id="cb53-1321"><a href="#cb53-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1322"><a href="#cb53-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1323"><a href="#cb53-1323" aria-hidden="true" tabindex="-1"></a>Displayed in a fashion similar to the original article, the data look</span>
<span id="cb53-1324"><a href="#cb53-1324" aria-hidden="true" tabindex="-1"></a>as in the figure below.</span>
<span id="cb53-1325"><a href="#cb53-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1326"><a href="#cb53-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_mice_data, echo=FALSE}</span></span>
<span id="cb53-1327"><a href="#cb53-1327" aria-hidden="true" tabindex="-1"></a>mice <span class="sc">|&gt;</span></span>
<span id="cb53-1328"><a href="#cb53-1328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>(<span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span>,</span>
<span id="cb53-1329"><a href="#cb53-1329" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"rabbit"</span>, <span class="st">"horse"</span>),</span>
<span id="cb53-1330"><a href="#cb53-1330" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Immune serum</span><span class="sc">\n</span><span class="st">from rabbits"</span>,</span>
<span id="cb53-1331"><a href="#cb53-1331" aria-hidden="true" tabindex="-1"></a>                                                    <span class="st">"Immune serum</span><span class="sc">\n</span><span class="st">from horses"</span>)),</span>
<span id="cb53-1332"><a href="#cb53-1332" aria-hidden="true" tabindex="-1"></a>         <span class="at">Survived =</span> <span class="fu">factor</span>(Survived, </span>
<span id="cb53-1333"><a href="#cb53-1333" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels=</span><span class="dv">0</span>L<span class="sc">:</span><span class="dv">1</span>L, </span>
<span id="cb53-1334"><a href="#cb53-1334" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Died"</span>, <span class="st">"Survived"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb53-1335"><a href="#cb53-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span>, <span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span>, </span>
<span id="cb53-1336"><a href="#cb53-1336" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-1337"><a href="#cb53-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Survived)) <span class="sc">|&gt;</span></span>
<span id="cb53-1338"><a href="#cb53-1338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mouse_number =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb53-1339"><a href="#cb53-1339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-1340"><a href="#cb53-1340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mouse_number, <span class="at">y=</span><span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span>, </span>
<span id="cb53-1341"><a href="#cb53-1341" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span>Survived)) <span class="sc">+</span></span>
<span id="cb53-1342"><a href="#cb53-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb53-1343"><a href="#cb53-1343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows=</span><span class="fu">vars</span>(<span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span>),</span>
<span id="cb53-1344"><a href="#cb53-1344" aria-hidden="true" tabindex="-1"></a>             <span class="at">cols=</span><span class="fu">vars</span>(<span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb53-1345"><a href="#cb53-1345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.3</span>), <span class="at">position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="cb53-1346"><a href="#cb53-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="fl">0.4</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L)),</span>
<span id="cb53-1347"><a href="#cb53-1347" aria-hidden="true" tabindex="-1"></a>                <span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.4</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L)),</span>
<span id="cb53-1348"><a href="#cb53-1348" aria-hidden="true" tabindex="-1"></a>                <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb53-1349"><a href="#cb53-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-1350"><a href="#cb53-1350" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-1351"><a href="#cb53-1351" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-1352"><a href="#cb53-1352" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb53-1353"><a href="#cb53-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Amount of culture (cc.)"</span>)</span>
<span id="cb53-1354"><a href="#cb53-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1355"><a href="#cb53-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1356"><a href="#cb53-1356" aria-hidden="true" tabindex="-1"></a>An alternative display showing the proportion of mice that survived</span>
<span id="cb53-1357"><a href="#cb53-1357" aria-hidden="true" tabindex="-1"></a>versus the amount of serum given as displayed in the figure below.</span>
<span id="cb53-1358"><a href="#cb53-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1359"><a href="#cb53-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb53-1360"><a href="#cb53-1360" aria-hidden="true" tabindex="-1"></a>mice_sum <span class="ot">&lt;-</span> mice <span class="sc">|&gt;</span></span>
<span id="cb53-1361"><a href="#cb53-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb53-1362"><a href="#cb53-1362" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span>,</span>
<span id="cb53-1363"><a href="#cb53-1363" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span>,</span>
<span id="cb53-1364"><a href="#cb53-1364" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span></span>
<span id="cb53-1365"><a href="#cb53-1365" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-1366"><a href="#cb53-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb53-1367"><a href="#cb53-1367" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Proportion of mice that survived</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(Survived),</span>
<span id="cb53-1368"><a href="#cb53-1368" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb53-1369"><a href="#cb53-1369" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-1370"><a href="#cb53-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1371"><a href="#cb53-1371" aria-hidden="true" tabindex="-1"></a>mice_sum <span class="sc">|&gt;</span></span>
<span id="cb53-1372"><a href="#cb53-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb53-1373"><a href="#cb53-1373" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span>,</span>
<span id="cb53-1374"><a href="#cb53-1374" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">`</span><span class="at">Proportion of mice that survived</span><span class="st">`</span>,</span>
<span id="cb53-1375"><a href="#cb53-1375" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">factor</span>(<span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span>),</span>
<span id="cb53-1376"><a href="#cb53-1376" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Amount of</span><span class="sc">\n</span><span class="st">culture</span><span class="sc">\n</span><span class="st">(cc.) ="</span>, <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span>)</span>
<span id="cb53-1377"><a href="#cb53-1377" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb53-1378"><a href="#cb53-1378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-1379"><a href="#cb53-1379" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-1380"><a href="#cb53-1380" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb53-1381"><a href="#cb53-1381" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1382"><a href="#cb53-1382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb53-1383"><a href="#cb53-1383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb53-1384"><a href="#cb53-1384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#fdbb84"</span>, <span class="st">"#fc8d59"</span>, <span class="st">"#e34a33"</span>, <span class="st">"#b30000"</span>)) <span class="sc">+</span></span>
<span id="cb53-1385"><a href="#cb53-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb53-1386"><a href="#cb53-1386" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.4</span> <span class="sc">*</span> <span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L)),</span>
<span id="cb53-1387"><a href="#cb53-1387" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fl">0.4</span> <span class="sc">*</span> <span class="fl">0.5</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">0</span>L<span class="sc">:</span><span class="dv">8</span>L)),</span>
<span id="cb53-1388"><a href="#cb53-1388" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>),</span>
<span id="cb53-1389"><a href="#cb53-1389" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb53-1390"><a href="#cb53-1390" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1391"><a href="#cb53-1391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb53-1392"><a href="#cb53-1392" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.15</span>),</span>
<span id="cb53-1393"><a href="#cb53-1393" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)</span>
<span id="cb53-1394"><a href="#cb53-1394" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-1395"><a href="#cb53-1395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb53-1396"><a href="#cb53-1396" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(</span>
<span id="cb53-1397"><a href="#cb53-1397" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(</span>
<span id="cb53-1398"><a href="#cb53-1398" aria-hidden="true" tabindex="-1"></a>      mice_sum,</span>
<span id="cb53-1399"><a href="#cb53-1399" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Source of immune serum</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"rabbit"</span> <span class="sc">&amp;</span></span>
<span id="cb53-1400"><a href="#cb53-1400" aria-hidden="true" tabindex="-1"></a>        ((<span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.003125</span> <span class="sc">&amp;</span></span>
<span id="cb53-1401"><a href="#cb53-1401" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.05</span>) <span class="sc">|</span></span>
<span id="cb53-1402"><a href="#cb53-1402" aria-hidden="true" tabindex="-1"></a>          (<span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.00625</span> <span class="sc">&amp;</span></span>
<span id="cb53-1403"><a href="#cb53-1403" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.1</span>) <span class="sc">|</span></span>
<span id="cb53-1404"><a href="#cb53-1404" aria-hidden="true" tabindex="-1"></a>          (<span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.1</span> <span class="sc">&amp;</span></span>
<span id="cb53-1405"><a href="#cb53-1405" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.2</span>) <span class="sc">|</span></span>
<span id="cb53-1406"><a href="#cb53-1406" aria-hidden="true" tabindex="-1"></a>          (<span class="st">`</span><span class="at">Amount of serum (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.1</span> <span class="sc">&amp;</span></span>
<span id="cb53-1407"><a href="#cb53-1407" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Amount of culture (cc.)</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.4</span>))</span>
<span id="cb53-1408"><a href="#cb53-1408" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb53-1409"><a href="#cb53-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb53-1410"><a href="#cb53-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">lineheight =</span> .<span class="dv">7</span>,</span>
<span id="cb53-1411"><a href="#cb53-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.1</span>),</span>
<span id="cb53-1412"><a href="#cb53-1412" aria-hidden="true" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="sc">-</span><span class="fl">0.03</span>)</span>
<span id="cb53-1413"><a href="#cb53-1413" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-1414"><a href="#cb53-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1415"><a href="#cb53-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-1416"><a href="#cb53-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1417"><a href="#cb53-1417" aria-hidden="true" tabindex="-1"></a>Excercises in increasing order of complexity:</span>
<span id="cb53-1418"><a href="#cb53-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1419"><a href="#cb53-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Fit a sigmoid Emax model to the horse serum data of each</span>
<span id="cb53-1420"><a href="#cb53-1420" aria-hidden="true" tabindex="-1"></a>    individual mouse assuming a Bernoulli distribution after choosing</span>
<span id="cb53-1421"><a href="#cb53-1421" aria-hidden="true" tabindex="-1"></a>    reasonable weakly informative priors, but remember that 0 cc. of</span>
<span id="cb53-1422"><a href="#cb53-1422" aria-hidden="true" tabindex="-1"></a>    serum was stated to result in a death rate of near 100%. Perform</span>
<span id="cb53-1423"><a href="#cb53-1423" aria-hidden="true" tabindex="-1"></a>    model checking.</span>
<span id="cb53-1424"><a href="#cb53-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-1425"><a href="#cb53-1425" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Fit a modified beta model to the horse serum data and also perform</span>
<span id="cb53-1426"><a href="#cb53-1426" aria-hidden="true" tabindex="-1"></a>    Bayesian model averaging. Does this result in a better fit?</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>