<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="BjÃ¶rn Holzhauer - bjoern.holzhauer@novartis.com">
<meta name="author" content="Andrew Bean - andrew.bean@novartis.com">

<title>(Bayesian) Applied Modelling in Drug Development (BAMDD) - 10&nbsp; Network meta-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/03a_stan_code.html" rel="next">
<link href="../src/02i_time_to_event.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/videojs/video.min.js"></script>
<link href="../site_libs/quarto-contrib/videojs/video-js.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02j_network_meta_analysis.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">(Bayesian) Applied Modelling in Drug Development (BAMDD)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Parallel computation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview-video" id="toc-overview-video" class="nav-link active" data-scroll-target="#overview-video"><span class="header-section-number">10.1</span> Overview Video</a>
  <ul class="collapse">
  <li><a href="#background-why-network-meta-analysis" id="toc-background-why-network-meta-analysis" class="nav-link" data-scroll-target="#background-why-network-meta-analysis"><span class="header-section-number">10.1.1</span> Background: Why network meta-analysis?</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">10.2</span> Data</a></li>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description"><span class="header-section-number">10.3</span> Model description</a>
  <ul class="collapse">
  <li><a href="#network-meta-analysis-with-summaries-for-each-arm" id="toc-network-meta-analysis-with-summaries-for-each-arm" class="nav-link" data-scroll-target="#network-meta-analysis-with-summaries-for-each-arm"><span class="header-section-number">10.3.1</span> Network meta-analysis with summaries for each arm</a></li>
  <li><a href="#patient--arm--or-trial-level-covariates" id="toc-patient--arm--or-trial-level-covariates" class="nav-link" data-scroll-target="#patient--arm--or-trial-level-covariates"><span class="header-section-number">10.3.2</span> Patient-, arm- or trial-level covariates</a></li>
  <li><a href="#borrowing-information-from-real-world-data-or-other-trials" id="toc-borrowing-information-from-real-world-data-or-other-trials" class="nav-link" data-scroll-target="#borrowing-information-from-real-world-data-or-other-trials"><span class="header-section-number">10.3.3</span> Borrowing information from real-world data or other trials</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">10.4</span> Implementation</a>
  <ul class="collapse">
  <li><a href="#reference-categories-matter-for-setting-priors" id="toc-reference-categories-matter-for-setting-priors" class="nav-link" data-scroll-target="#reference-categories-matter-for-setting-priors"><span class="header-section-number">10.4.1</span> Reference categories matter for setting priors</a></li>
  <li><a href="#setting-priors-is-easier-in-an-over-parameterized-model" id="toc-setting-priors-is-easier-in-an-over-parameterized-model" class="nav-link" data-scroll-target="#setting-priors-is-easier-in-an-over-parameterized-model"><span class="header-section-number">10.4.2</span> Setting priors is easier in an over-parameterized model</a></li>
  <li><a href="#ranking-treatments-and-the-probability-of-being-the-best-treatment" id="toc-ranking-treatments-and-the-probability-of-being-the-best-treatment" class="nav-link" data-scroll-target="#ranking-treatments-and-the-probability-of-being-the-best-treatment"><span class="header-section-number">10.4.3</span> Ranking treatments and the probability of being the best treatment</a></li>
  <li><a href="#detailed-look-at-a-pairwise-contrast" id="toc-detailed-look-at-a-pairwise-contrast" class="nav-link" data-scroll-target="#detailed-look-at-a-pairwise-contrast"><span class="header-section-number">10.4.4</span> Detailed look at a pairwise contrast</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">10.5</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">10.6</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#excercise-1" id="toc-excercise-1" class="nav-link" data-scroll-target="#excercise-1"><span class="header-section-number">10.6.1</span> Excercise 1</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02j_network_meta_analysis.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>BjÃ¶rn Holzhauer - <a href="mailto:bjoern.holzhauer@novartis.com" class="email">bjoern.holzhauer@novartis.com</a> </p>
             <p>Andrew Bean - <a href="mailto:andrew.bean@novartis.com" class="email">andrew.bean@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>This case study covers:</p>
<ul>
<li>Using <code>brms</code> to perform arm-based network meta-analysis using a âtwo-way mixed modelâ approach (as opposed to the also popular contrast-based or baseline-contrast model)</li>
<li>Visualizing networks of evidence using function from the <code>multinma</code> package</li>
<li>Setting up over-parameterized models to avoid specifying prior distributions for differences relative to a reference study or treatment (by collating two design matrices created using <code>model.matrix()</code>), and how to estimate desired contrasts in this context</li>
<li><code>r | trials(n) ~ ...</code> for binomial outcomes (<code>r</code> out of <code>n</code> patients)</li>
<li>Ranking treatments based on samples from the posterior distribution</li>
</ul>
<p>To run the R code of this section please ensure to load these libraries and options first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multinma) <span class="co"># for graphing the network &amp; other NMA utils</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5675798</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># allow for wider printouts without line-breaking</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">120</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>control_args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview-video" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="overview-video"><span class="header-section-number">10.1</span> Overview Video</h2>
<div class="quarto-video"><video id="video_shortcode_videojs_video1" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="videos/brms-20230426-4-network-meta.mp4"></video></div>
<section id="background-why-network-meta-analysis" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="background-why-network-meta-analysis"><span class="header-section-number">10.1.1</span> Background: Why network meta-analysis?</h3>
<p>Network (or multi-treatment) meta-analysis (NMA) is a term for analyses that combine the results of studies that compared several treatments and in which not all studies included all comparisons <span class="citation" data-cites="LuAdes2004">(<a href="02h_mmrm.html#ref-LuAdes2004" role="doc-biblioref">Lu and Ades 2004</a>)</span>. This is a frequent situation, because new drugs are often only compared to a placebo or to one commonly used current standard of care, but not to all existing current treatment options. As a result, physicians that want to choose between two treatment options often find that there are no or very few studies directly comparing them. NMA tries to address this issue by combining evidence from direct comparisons within each trial with indirect chains of comparisons across multiple trials.</p>
<p>Network meta-analyses have their limitations. One particular concern would be factors that modify the effects of treatments resulting in treatment by trial interactions, e.g.&nbsp;if pathogens developing resistance to some drugs over time, if the presence of some background therapies has a synergistic or antagonistic interaction with a drug, or if some drugs work better or worse depending on disease severity.</p>
</section>
</section>
<section id="data" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="data"><span class="header-section-number">10.2</span> Data</h2>
<p>We will use smoking cessation data <span class="citation" data-cites="Hasselblad1998">(<a href="02h_mmrm.html#ref-Hasselblad1998" role="doc-biblioref">Hasselblad 1998</a>)</span>, which consists of the number of patients <span class="math inline">\(r\)</span> amongst the total in an study arm <span class="math inline">\(n\)</span> that manage to stop smoking. There are 24 studies, in which different combinations of 4 interventions (no contact, self-help, individual counseling and group counseling) were tested. The aim of a network meta-analysis here would be to compare these different treatment in terms of the odds of patients managing to stop smoking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>trt_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No intervention"</span>, <span class="st">"Self-help"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Individual counselling"</span>, <span class="st">"Group counselling"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>smoking <span class="ot">&lt;-</span> multinma<span class="sc">::</span>smoking <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">study =</span> <span class="fu">factor</span>(studyn),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">trtc =</span> <span class="fu">factor</span>(trtc, trt_levels))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoking<span class="sc">$</span>trtc) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, trt_levels)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(smoking<span class="sc">$</span>trtc) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">levels</span>(smoking<span class="sc">$</span>trtc))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_preview</span>(smoking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="xgsciimqpf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xgsciimqpf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xgsciimqpf thead, #xgsciimqpf tbody, #xgsciimqpf tfoot, #xgsciimqpf tr, #xgsciimqpf td, #xgsciimqpf th {
  border-style: none;
}

#xgsciimqpf p {
  margin: 0;
  padding: 0;
}

#xgsciimqpf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xgsciimqpf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xgsciimqpf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xgsciimqpf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xgsciimqpf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xgsciimqpf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgsciimqpf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xgsciimqpf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xgsciimqpf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xgsciimqpf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xgsciimqpf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xgsciimqpf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xgsciimqpf .gt_spanner_row {
  border-bottom-style: hidden;
}

#xgsciimqpf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xgsciimqpf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xgsciimqpf .gt_from_md > :first-child {
  margin-top: 0;
}

#xgsciimqpf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xgsciimqpf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xgsciimqpf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xgsciimqpf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xgsciimqpf .gt_row_group_first td {
  border-top-width: 2px;
}

#xgsciimqpf .gt_row_group_first th {
  border-top-width: 2px;
}

#xgsciimqpf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgsciimqpf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xgsciimqpf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xgsciimqpf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgsciimqpf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgsciimqpf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xgsciimqpf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xgsciimqpf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xgsciimqpf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xgsciimqpf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xgsciimqpf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgsciimqpf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xgsciimqpf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xgsciimqpf .gt_left {
  text-align: left;
}

#xgsciimqpf .gt_center {
  text-align: center;
}

#xgsciimqpf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xgsciimqpf .gt_font_normal {
  font-weight: normal;
}

#xgsciimqpf .gt_font_bold {
  font-weight: bold;
}

#xgsciimqpf .gt_font_italic {
  font-style: italic;
}

#xgsciimqpf .gt_super {
  font-size: 65%;
}

#xgsciimqpf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xgsciimqpf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xgsciimqpf .gt_indent_1 {
  text-indent: 5px;
}

#xgsciimqpf .gt_indent_2 {
  text-indent: 10px;
}

#xgsciimqpf .gt_indent_3 {
  text-indent: 15px;
}

#xgsciimqpf .gt_indent_4 {
  text-indent: 20px;
}

#xgsciimqpf .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="studyn" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">studyn</th>
<th id="trtn" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trtn</th>
<th id="trtc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trtc</th>
<th id="r" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">r</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="study" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">study</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">1</td>
<td class="gt_row gt_right" headers="stub_1_1 studyn">1</td>
<td class="gt_row gt_right" headers="stub_1_1 trtn">1</td>
<td class="gt_row gt_left" headers="stub_1_1 trtc">No_intervention</td>
<td class="gt_row gt_right" headers="stub_1_1 r">9</td>
<td class="gt_row gt_right" headers="stub_1_1 n">140</td>
<td class="gt_row gt_right" headers="stub_1_1 study">1</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">2</td>
<td class="gt_row gt_right" headers="stub_1_2 studyn">1</td>
<td class="gt_row gt_right" headers="stub_1_2 trtn">3</td>
<td class="gt_row gt_left" headers="stub_1_2 trtc">Individual_counselling</td>
<td class="gt_row gt_right" headers="stub_1_2 r">23</td>
<td class="gt_row gt_right" headers="stub_1_2 n">140</td>
<td class="gt_row gt_right" headers="stub_1_2 study">1</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">3</td>
<td class="gt_row gt_right" headers="stub_1_3 studyn">1</td>
<td class="gt_row gt_right" headers="stub_1_3 trtn">4</td>
<td class="gt_row gt_left" headers="stub_1_3 trtc">Group_counselling</td>
<td class="gt_row gt_right" headers="stub_1_3 r">10</td>
<td class="gt_row gt_right" headers="stub_1_3 n">138</td>
<td class="gt_row gt_right" headers="stub_1_3 study">1</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">4</td>
<td class="gt_row gt_right" headers="stub_1_4 studyn">2</td>
<td class="gt_row gt_right" headers="stub_1_4 trtn">2</td>
<td class="gt_row gt_left" headers="stub_1_4 trtc">Self_help</td>
<td class="gt_row gt_right" headers="stub_1_4 r">11</td>
<td class="gt_row gt_right" headers="stub_1_4 n">78</td>
<td class="gt_row gt_right" headers="stub_1_4 study">2</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">5</td>
<td class="gt_row gt_right" headers="stub_1_5 studyn">2</td>
<td class="gt_row gt_right" headers="stub_1_5 trtn">3</td>
<td class="gt_row gt_left" headers="stub_1_5 trtc">Individual_counselling</td>
<td class="gt_row gt_right" headers="stub_1_5 r">12</td>
<td class="gt_row gt_right" headers="stub_1_5 n">85</td>
<td class="gt_row gt_right" headers="stub_1_5 study">2</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier; font-size: x-small; background-color: #E4E4E4">6..49</td>
<td class="gt_row gt_right" headers="stub_1_6 studyn" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 trtn" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_6 trtc" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 r" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 n" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 study" style="background-color: #E4E4E4"></td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">50</td>
<td class="gt_row gt_right" headers="stub_1_7 studyn">24</td>
<td class="gt_row gt_right" headers="stub_1_7 trtn">4</td>
<td class="gt_row gt_left" headers="stub_1_7 trtc">Group_counselling</td>
<td class="gt_row gt_right" headers="stub_1_7 r">3</td>
<td class="gt_row gt_right" headers="stub_1_7 n">26</td>
<td class="gt_row gt_right" headers="stub_1_7 study">24</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>smoking <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>study, <span class="at">y=</span>r<span class="sc">/</span>n, <span class="at">fill=</span>trtc, <span class="at">group=</span>trtc,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.025</span>, <span class="at">shape1=</span>r, <span class="at">shape2=</span><span class="dv">1</span><span class="sc">+</span>n<span class="sc">-</span>r),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.975</span>, <span class="at">shape1=</span>r<span class="sc">+</span><span class="dv">1</span>, <span class="at">shape2=</span>n<span class="sc">-</span>r))) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02j_network_meta_analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The totality of evidence about the treatments and their relative efficacy is commonly known as the <em>evidence network</em>. A common graphical representation, shown below, visualizes this network of treatments (the nodes) along with edges indicating the presence or absence of direct evidence comparing pairs of treatments from randomized trials. Below, the thickness of the edges is determined by the number of trials comparing each pair of treatments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>network <span class="ot">&lt;-</span> multinma<span class="sc">::</span><span class="fu">set_agd_arm</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> smoking,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> study,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> trtc,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> r,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> n,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt_ref =</span> <span class="st">"No_intervention"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(network)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02j_network_meta_analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-description" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="model-description"><span class="header-section-number">10.3</span> Model description</h2>
<p>We will first describe the arm-based (aka âtwo-way mixed modelâ) approach to NMA advocated by Piepho <span class="citation" data-cites="Piepho2012">(<a href="02h_mmrm.html#ref-Piepho2012" role="doc-biblioref">Piepho, Williams, and Madden 2012</a>)</span>. It has some advantages over more commonly used NMA approach that analyzes treatment contrasts <span class="citation" data-cites="LuAdes2004">(<a href="02h_mmrm.html#ref-LuAdes2004" role="doc-biblioref">Lu and Ades 2004</a>)</span>, in terms of ease of use and familiarity (the two-way linear mixed model is of course very familiar). The latter approach, however, is widely used in health technology assessments, for example by the UK NICE. The NICE decision support unit has published methodological guidance on how to use this method in practice <span class="citation" data-cites="dias2014">(<a href="02h_mmrm.html#ref-dias2014" role="doc-biblioref">Dias et al. 2014</a>)</span>.</p>
<p>Suppose we had individual patient data for patients <span class="math inline">\(k=1,\ldots,N_{ij}\)</span> randomly assigned to treatment <span class="math inline">\(j\)</span> in trial <span class="math inline">\(i\)</span>, for <span class="math inline">\(i = 1,\ldots, n\)</span> and <span class="math inline">\(j = 1,\ldots, m\)</span>. A two-way linear mixed model would model the outcome of interest <span class="math inline">\(Y_{ijk}\)</span> as <span class="math display">\[ g(E(Y_{ijk})) = \underbrace{\alpha_i}_{\text{fixed main effect of trial }i} + \underbrace{\beta_j}_{\text{fixed main effect of treatment }j} + \underbrace{u_{ij}}_{\text{random effect of trial on treatment}},\]</span> where <span class="math inline">\(g\)</span> is a link function such as the logit link in case of bernoulli data.</p>
<p>The random effects <span class="math inline">\(u_{ij}\)</span> have mean zero and describe that the effect of treatments is allowed to vary across trials. If we wanted to assume the same effect of all treatment across all trials, we could instead omit this term. When we include it, we will ideally want to allow for the possibility that if one treatment has better outcomes in a trial, then other treatments might also. To achieve that we assume that for the trials <span class="math inline">\(i=1,\ldots,n\)</span> there is a multivariate normal random effect <span class="math inline">\(\boldsymbol{U}_i \sim \text{MVN}(\boldsymbol{0}, \boldsymbol{\Sigma})\)</span>, where <span class="math inline">\(\Sigma\)</span> is some covariance matrix that is either unstructured or has some particular structure (e.g.&nbsp;compound symmetric). In other words, the components of the random vector <span class="math inline">\(\boldsymbol{U}_i\)</span> for a trial <span class="math inline">\(i\)</span> are correlated.</p>
<section id="network-meta-analysis-with-summaries-for-each-arm" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="network-meta-analysis-with-summaries-for-each-arm"><span class="header-section-number">10.3.1</span> Network meta-analysis with summaries for each arm</h3>
<p>In case we have summary information by treatment arm, we will (just as for traditional arm-based meta-analyses) often be able to assume a normal sampling distribution for least squares means for each arm from linear models, log-odds, log-rates or log-hazard rates. We will denote these estimates for each arm by <span class="math inline">\(\hat{\theta}_{ij}\)</span> and their standard error by <span class="math inline">\(\text{SE}(\hat{\theta}_{ij})\)</span>. We then assume <span class="math inline">\(\theta_{ij} = \alpha_i + \beta_j + u_{ij}\)</span> as above and that <span class="math inline">\(\hat{\theta}_{ij} \sim N(\theta_{ij}, \text{SE}(\hat{\theta}_{ij}))\)</span>.</p>
<p>Alternatively, for a binary outcome, we can use that the number of patients with a success follows a binomial distribution and we would use a regression equation like above for the logit-probability <span class="math inline">\(\theta_{ij} = \alpha_i + \beta_j + u_{ij}\)</span> for each arm.</p>
<p>TO BE DETERMINE WHAT TO DO FOR SURVIAL: Less clear, could one work with log-cumulative-hazard function (under a parametric model?)? Maybe one could get that from KM curves? Log-(or logit-?)survival probabilities at fixed points of time (e.g.&nbsp;1-year)? Discussed by some papers such as this one <span class="citation" data-cites="Combescure_2012">(<a href="02h_mmrm.html#ref-Combescure_2012" role="doc-biblioref">Combescure et al. 2012</a>)</span>. Perhaps models fitted to reconstructed patient-level data/KM curves via, standard parametric models, fractional polynomial models and/or spline-based models? What about non-proportional hazards?</p>
</section>
<section id="patient--arm--or-trial-level-covariates" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="patient--arm--or-trial-level-covariates"><span class="header-section-number">10.3.2</span> Patient-, arm- or trial-level covariates</h3>
<p>As needed, the regression equation <span class="math inline">\(\alpha_i + \beta_j + u_{ij}\)</span> can be extended by allowing for patient level covariates <span class="math inline">\(\boldsymbol{x}_{ijk}\)</span> (in case we work with individual patient data), arm-level covariates <span class="math inline">\(\boldsymbol{x}_{ij}\)</span> or study-level covariates <span class="math inline">\(\boldsymbol{x}_i\)</span>.</p>
</section>
<section id="borrowing-information-from-real-world-data-or-other-trials" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="borrowing-information-from-real-world-data-or-other-trials"><span class="header-section-number">10.3.3</span> Borrowing information from real-world data or other trials</h3>
<p>If we have a fixed effect for the <span class="math inline">\(\alpha_i\)</span>, then borrowing information between trials runs into the identifiability issues between the <span class="math inline">\(\alpha_i\)</span> and the <span class="math inline">\(u_{ij}\)</span>. In a frequentist approach we cannot resolve these issues. When we take a Bayesian approach, this identifiability issue will still severely limit how much information we can obtain about the distribution of the <span class="math inline">\(u_{ij}\)</span> (while we would by definition not borrow information about the <span class="math inline">\(\alpha_i\)</span>) and the results will be sensitive to the choice of prior distributions.</p>
<p>We could borrow information across trials, we replace the trial main effect by an intercept term and a random trial effect on the intercept. However, then we will be conducting a meta-analysis, in which the causal effects of treatments are no longer just judged based on randomized within-trial comparisons. We would then also to an extent do comparisons across treatment arms from different trials. Besides the limitations any NMA is subject to, such comparisons are additionally affected by any prognostic factors that change the expected outcomes for a treatment in different trials. Such prognostic factors are much more common than effect modifiers that would cause trial by treatment interactions, and we know that to some extent such differences across trials will exist. Examples include improving (or worsening) patient outcomes due to better treatments or access to healthcare, different inclusion/exclusion criteria of different trials, and differences in recruited patient populations in terms of e.g.&nbsp;background therapy, disease severity, country/region and comorbidities. While we may hope that a random trial effect on the intercept would capture random variation in these aspects across trials, we have to be concerned that there could be a systematic bias in favor of some treatments in a NMA - especially if studies for some treatments were conducted later in time than for other treatments.</p>
</section>
</section>
<section id="implementation" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="implementation"><span class="header-section-number">10.4</span> Implementation</h2>
<p>In this case, we have a binomial outcome. <code>brms</code> provides the <code>y | trials(n)</code> notation to indicate <code>y</code> successes out of <code>n</code> trials, while in <code>stats::glm</code> the way of specifying this is a little less intuitive: <code>glm( cbind(y, n-y)~... )</code>.</p>
<p>We will now try implement the network meta-analysis model we described above. In the process, we will discover some things that did not make a difference in a frequentist setting, but matter in the Bayesian setting with respect to how we can the most easily specify our prior knowledge (or lack thereof).</p>
<section id="reference-categories-matter-for-setting-priors" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="reference-categories-matter-for-setting-priors"><span class="header-section-number">10.4.1</span> Reference categories matter for setting priors</h3>
<p>Firstly, before we even think too much about any prior distributions, let see how <code>brms</code> parameterizes the model, if we specify it in the most obvious way by just writing <code>0 + study + trtc + (0 + trtc |study)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>brmfit <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> smoking,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> r <span class="sc">|</span> <span class="fu">trials</span>(n) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study <span class="sc">+</span> trtc <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> trtc <span class="sc">||</span> study),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> control_args,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class =</span> b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>)),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see from the summary of the fitted model, there are coefficients for all study main effects, but not for all treatments: treatment 1 is omitted, and the coefficients for remaining treatments now represent contrasts against treatment 1. (Conversely, if we had instead written <code>0 + trtc + study + (0+trtc|study)</code>, then there would have been a coefficient for all treatments, but the study effects would have been parametrized in terms of contrasts with study 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 12 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: r | trials(n) ~ 0 + study + trtc + (0 + trtc || study) 
   Data: smoking (Number of observations: 50) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~study (Number of levels: 24) 
                               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(trtcNo_intervention)            0.66      0.37     0.04     1.43 1.01      457      947
sd(trtcSelf_help)                  0.42      0.37     0.02     1.37 1.00     1302     2183
sd(trtcIndividual_counselling)     0.54      0.32     0.03     1.19 1.01      321     1326
sd(trtcGroup_counselling)          0.90      0.63     0.07     2.46 1.00     1049     1172

Regression Coefficients:
                           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
study1                        -2.59      0.47    -3.48    -1.65 1.01      879     1834
study2                        -2.26      0.44    -3.12    -1.40 1.00     1602     2164
study3                        -1.24      0.72    -2.42     0.00 1.01      371     1376
study4                        -3.73      0.56    -4.88    -2.63 1.00     2100     1622
study5                        -2.19      0.38    -2.95    -1.40 1.00     1861     1806
study6                        -2.66      0.74    -4.27    -1.34 1.01      834     1855
study7                        -2.09      0.75    -3.59    -0.80 1.01      442     1532
study8                        -2.03      0.66    -3.44    -0.90 1.01      726     1829
study9                        -1.78      0.47    -2.68    -0.81 1.00     2433     1999
study10                       -2.22      0.45    -3.09    -1.20 1.00     1670     1644
study11                       -3.48      0.49    -4.41    -2.40 1.00     1860     1467
study12                       -2.28      0.39    -3.06    -1.48 1.00     2019     1849
study13                       -2.71      0.53    -3.77    -1.66 1.00     3107     2770
study14                       -2.33      0.43    -3.16    -1.43 1.00     1895     1759
study15                       -2.15      1.03    -4.48    -0.41 1.00     1616     2280
study16                       -2.32      0.49    -3.29    -1.29 1.00     2196     1968
study17                       -2.35      0.39    -3.16    -1.55 1.00     1616     1466
study18                       -2.81      0.46    -3.66    -1.88 1.00     1120     1993
study19                       -2.29      0.46    -3.16    -1.42 1.00      880     2095
study20                       -3.03      0.42    -3.81    -2.19 1.00     1201     1832
study21                       -0.84      0.47    -1.77     0.07 1.00     1789     2588
study22                       -2.20      0.59    -3.36    -1.00 1.00     1798     2224
study23                       -2.04      0.58    -3.22    -0.87 1.00     2066     1813
study24                       -2.40      0.66    -3.73    -1.18 1.00     1893     2229
trtcSelf_help                  0.27      0.40    -0.55     1.09 1.00     1416     1766
trtcIndividual_counselling     0.61      0.28     0.01     1.14 1.01      973      896
trtcGroup_counselling          0.81      0.57    -0.33     1.98 1.00     1726     2167

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Is this a problem? In the frequentist context, this issue with the form of the design matrix for population-level effects is not important, because the pairwise treatment contrasts are uniquely estimable regardless of whether constraints such as <span class="math inline">\(\beta_1 = 0\)</span> are employed.</p>
<p>However, if we wanted to imply some prior information or lack thereof, it may impact our preference for the specification of the population-level terms. For example, if we had some prior information (external to the likelihood) on a particular contrast between a pair of treatments, we would favor the parametrization above, in which the treatment terms are parametrized in terms of contrasts.</p>
</section>
<section id="setting-priors-is-easier-in-an-over-parameterized-model" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="setting-priors-is-easier-in-an-over-parameterized-model"><span class="header-section-number">10.4.2</span> Setting priors is easier in an over-parameterized model</h3>
<p>Another possibility is to over-parametrize the model and have a main effect for each study (i.e.&nbsp;main effects for all studies <code>study1</code> to <code>study24</code> are present) and each treatment. The main rationale for this would be symmetry in how we set our prior distributions. I.e. we do not want to set our priors in a way that would somehow favor one treatment (or study - which will have studied some subset of treatments = might again favor somehow treatment) over any of the others. Unlike the specification above, the marginal variance of the each arm of each study will be constant in this approach.</p>
<p>This can be achieved by creating dummy variables for each treatment group and thereby enforcing the paramterization. We then specify our model as <code>0 + study + trtcA + trtcB + trtcC + trtcD + (0 + trtc | study)</code>. The code below constructs the dummy variables and corresponding formula in an automated way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> trtc, <span class="at">data =</span> smoking)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study, <span class="at">data =</span> smoking)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>smoking_with_dummies <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(smoking, r, n, study, trtc),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(B),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(S)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r | trials(n) ~ 0 + study +"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">colnames</span>(B), <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"+ (0 + trtc || study)"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># could also do:</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># f &lt;- as.formula(paste(</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     "r | trials(n) ~ 0 + trtc +",</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     paste(colnames(S), collapse = " + "),</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     "+ (0 + trtc || study)"</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ))</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>brmfit_with_dummies <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> smoking_with_dummies,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">formula =</span> f,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">control =</span> control_args,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span>b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>)),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we now summarize the model fit, we have regression coefficients for all treatment groups and studies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit_with_dummies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 1 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: r | trials(n) ~ 0 + study + trtcNo_intervention + trtcSelf_help + trtcIndividual_counselling + trtcGroup_counselling + (0 + trtc || study) 
   Data: smoking_with_dummies (Number of observations: 50) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~study (Number of levels: 24) 
                               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(trtcNo_intervention)            0.62      0.34     0.05     1.30 1.01      578     1538
sd(trtcSelf_help)                  0.43      0.39     0.02     1.44 1.00     2136     2856
sd(trtcIndividual_counselling)     0.56      0.31     0.03     1.16 1.00      634     1428
sd(trtcGroup_counselling)          1.02      0.72     0.09     2.77 1.00     1151     1536

Regression Coefficients:
                           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
study1                        -0.52      0.72    -1.97     0.86 1.01      545      904
study2                        -0.23      0.70    -1.62     1.14 1.01      550     1112
study3                         0.83      0.85    -0.82     2.48 1.01      482      802
study4                        -1.68      0.78    -3.22    -0.19 1.00      679      951
study5                        -0.08      0.69    -1.41     1.26 1.01      529     1090
study6                        -0.66      0.91    -2.59     1.04 1.00      708     1237
study7                        -0.05      0.89    -1.84     1.67 1.01      545      855
study8                        -0.01      0.85    -1.77     1.60 1.00      625     1052
study9                         0.31      0.73    -1.09     1.70 1.01      660     1494
study10                       -0.14      0.71    -1.56     1.22 1.01      622     1402
study11                       -1.39      0.72    -2.78     0.02 1.01      597     1198
study12                       -0.15      0.69    -1.50     1.18 1.01      550     1097
study13                       -0.61      0.76    -2.07     0.88 1.00      716     1448
study14                       -0.24      0.72    -1.66     1.13 1.01      619     1281
study15                       -0.34      1.24    -3.18     1.71 1.00     1134     1763
study16                       -0.25      0.73    -1.71     1.16 1.01      624     1176
study17                       -0.24      0.67    -1.56     1.03 1.01      535     1076
study18                       -0.70      0.73    -2.11     0.73 1.01      567     1389
study19                       -0.16      0.75    -1.62     1.29 1.01      551     1216
study20                       -0.90      0.72    -2.31     0.46 1.01      532      923
study21                        1.19      0.72    -0.22     2.56 1.00      609     1252
study22                       -0.25      0.80    -1.84     1.33 1.00      777     1552
study23                       -0.09      0.79    -1.69     1.41 1.00      762     1492
study24                       -0.44      0.84    -2.14     1.16 1.00      727     1437
trtcNo_intervention           -2.29      0.62    -3.48    -1.06 1.01      458      771
trtcSelf_help                 -1.76      0.67    -3.08    -0.45 1.01      543     1060
trtcIndividual_counselling    -1.45      0.61    -2.62    -0.23 1.01      451      821
trtcGroup_counselling         -1.10      0.81    -2.61     0.54 1.00      710     1402

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>While the coefficients for each treatment have changed compared to the previous section, we should not actually look at the coefficients for each treament main effect, but at their contrasts. When we look at those, we see that the models lead to very similar inference (despite us not even setting any priors for Model 0).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># utility function to estimate all pairwise contrasts between the main effects</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for the variable named "trtc"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>contrast_draws <span class="ot">&lt;-</span> <span class="cf">function</span>(brmfit, <span class="at">variable =</span> <span class="st">"trtc"</span>){</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  trts <span class="ot">&lt;-</span> <span class="fu">levels</span>(brmfit<span class="sc">$</span>data[[variable]])</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ntrt <span class="ot">&lt;-</span> <span class="fu">nlevels</span>(brmfit<span class="sc">$</span>data[[variable]])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  all_pairs <span class="ot">&lt;-</span> <span class="fu">combn</span>(<span class="dv">1</span><span class="sc">:</span>ntrt, <span class="dv">2</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  L_trt <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    all_pairs, <span class="dv">2</span>, <span class="cf">function</span>(x){</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ntrt)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      out[x[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      out[x[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      out</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(L_trt) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(variable, trts)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">standata</span>(brmfit)<span class="sc">$</span>X</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  L_study <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(L_trt), <span class="at">ncol =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">grepl</span>(variable, <span class="fu">colnames</span>(X))))</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if the treatment variable is not dummy coded for every level then</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need to drop the base category as this is masked by study</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">ncol</span>(L_trt) <span class="sc">==</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(variable, <span class="fu">colnames</span>(X)))){</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">cbind</span>(L_study, L_trt)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">cbind</span>(L_study, L_trt[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(L) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels for the contrasts</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  labs <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">combn</span>(trts, <span class="dv">2</span>), <span class="dv">2</span>, paste, <span class="at">collapse =</span> <span class="st">" vs "</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(L) <span class="ot">&lt;-</span> labs</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(brmfit, <span class="at">variable =</span> <span class="st">"^b_"</span>, <span class="at">regex =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  gamma_draws <span class="ot">&lt;-</span> B <span class="sc">%*%</span> <span class="fu">t</span>(L)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to posterior object</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(gamma_draws)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>summarize_contrasts <span class="ot">&lt;-</span> <span class="cf">function</span>(brmfit, <span class="at">model_name =</span> <span class="st">"model"</span>, <span class="at">variable =</span> <span class="st">"trtc"</span>, ...){</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(<span class="fu">contrast_draws</span>(brmfit, <span class="at">variable =</span> variable), ...), <span class="at">model =</span> model_name),</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    model</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_contrasts</span>(brmfit, <span class="st">"Full-rank model"</span>),</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_contrasts</span>(brmfit_with_dummies, <span class="st">"Overparametrized model"</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="fu">where</span>(is.numeric), <span class="at">decimals=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="kdchuwrlin" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kdchuwrlin table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kdchuwrlin thead, #kdchuwrlin tbody, #kdchuwrlin tfoot, #kdchuwrlin tr, #kdchuwrlin td, #kdchuwrlin th {
  border-style: none;
}

#kdchuwrlin p {
  margin: 0;
  padding: 0;
}

#kdchuwrlin .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kdchuwrlin .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kdchuwrlin .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kdchuwrlin .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kdchuwrlin .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kdchuwrlin .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kdchuwrlin .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kdchuwrlin .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kdchuwrlin .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kdchuwrlin .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kdchuwrlin .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kdchuwrlin .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kdchuwrlin .gt_spanner_row {
  border-bottom-style: hidden;
}

#kdchuwrlin .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kdchuwrlin .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kdchuwrlin .gt_from_md > :first-child {
  margin-top: 0;
}

#kdchuwrlin .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kdchuwrlin .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kdchuwrlin .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kdchuwrlin .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kdchuwrlin .gt_row_group_first td {
  border-top-width: 2px;
}

#kdchuwrlin .gt_row_group_first th {
  border-top-width: 2px;
}

#kdchuwrlin .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdchuwrlin .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kdchuwrlin .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kdchuwrlin .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kdchuwrlin .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdchuwrlin .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kdchuwrlin .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kdchuwrlin .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kdchuwrlin .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kdchuwrlin .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kdchuwrlin .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdchuwrlin .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kdchuwrlin .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdchuwrlin .gt_left {
  text-align: left;
}

#kdchuwrlin .gt_center {
  text-align: center;
}

#kdchuwrlin .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kdchuwrlin .gt_font_normal {
  font-weight: normal;
}

#kdchuwrlin .gt_font_bold {
  font-weight: bold;
}

#kdchuwrlin .gt_font_italic {
  font-style: italic;
}

#kdchuwrlin .gt_super {
  font-size: 65%;
}

#kdchuwrlin .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kdchuwrlin .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kdchuwrlin .gt_indent_1 {
  text-indent: 5px;
}

#kdchuwrlin .gt_indent_2 {
  text-indent: 10px;
}

#kdchuwrlin .gt_indent_3 {
  text-indent: 15px;
}

#kdchuwrlin .gt_indent_4 {
  text-indent: 20px;
}

#kdchuwrlin .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="model" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">model</th>
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">variable</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sd</th>
<th id="mad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mad</th>
<th id="q5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q5</th>
<th id="q95" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">q95</th>
<th id="rhat" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rhat</th>
<th id="ess_bulk" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_bulk</th>
<th id="ess_tail" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ess_tail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Self_help</td>
<td class="gt_row gt_right" headers="mean">â0.27</td>
<td class="gt_row gt_right" headers="median">â0.27</td>
<td class="gt_row gt_right" headers="sd">0.40</td>
<td class="gt_row gt_right" headers="mad">0.36</td>
<td class="gt_row gt_right" headers="q5">â0.92</td>
<td class="gt_row gt_right" headers="q95">0.37</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">1,398.93</td>
<td class="gt_row gt_right" headers="ess_tail">1,747.87</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Individual_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.61</td>
<td class="gt_row gt_right" headers="median">â0.62</td>
<td class="gt_row gt_right" headers="sd">0.28</td>
<td class="gt_row gt_right" headers="mad">0.25</td>
<td class="gt_row gt_right" headers="q5">â1.05</td>
<td class="gt_row gt_right" headers="q95">â0.13</td>
<td class="gt_row gt_right" headers="rhat">1.01</td>
<td class="gt_row gt_right" headers="ess_bulk">948.08</td>
<td class="gt_row gt_right" headers="ess_tail">890.87</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.81</td>
<td class="gt_row gt_right" headers="median">â0.80</td>
<td class="gt_row gt_right" headers="sd">0.57</td>
<td class="gt_row gt_right" headers="mad">0.50</td>
<td class="gt_row gt_right" headers="q5">â1.73</td>
<td class="gt_row gt_right" headers="q95">0.08</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">1,701.81</td>
<td class="gt_row gt_right" headers="ess_tail">2,147.63</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">Self_help vs Individual_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.34</td>
<td class="gt_row gt_right" headers="median">â0.33</td>
<td class="gt_row gt_right" headers="sd">0.41</td>
<td class="gt_row gt_right" headers="mad">0.38</td>
<td class="gt_row gt_right" headers="q5">â0.99</td>
<td class="gt_row gt_right" headers="q95">0.33</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">1,617.50</td>
<td class="gt_row gt_right" headers="ess_tail">2,473.83</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">Self_help vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.54</td>
<td class="gt_row gt_right" headers="median">â0.53</td>
<td class="gt_row gt_right" headers="sd">0.58</td>
<td class="gt_row gt_right" headers="mad">0.51</td>
<td class="gt_row gt_right" headers="q5">â1.47</td>
<td class="gt_row gt_right" headers="q95">0.41</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,485.66</td>
<td class="gt_row gt_right" headers="ess_tail">2,569.57</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Full-rank model</td>
<td class="gt_row gt_left" headers="variable">Individual_counselling vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.20</td>
<td class="gt_row gt_right" headers="median">â0.19</td>
<td class="gt_row gt_right" headers="sd">0.54</td>
<td class="gt_row gt_right" headers="mad">0.46</td>
<td class="gt_row gt_right" headers="q5">â1.08</td>
<td class="gt_row gt_right" headers="q95">0.63</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,808.62</td>
<td class="gt_row gt_right" headers="ess_tail">2,286.79</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Self_help</td>
<td class="gt_row gt_right" headers="mean">â0.52</td>
<td class="gt_row gt_right" headers="median">â0.50</td>
<td class="gt_row gt_right" headers="sd">0.41</td>
<td class="gt_row gt_right" headers="mad">0.37</td>
<td class="gt_row gt_right" headers="q5">â1.22</td>
<td class="gt_row gt_right" headers="q95">0.08</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,938.66</td>
<td class="gt_row gt_right" headers="ess_tail">2,981.21</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Individual_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.83</td>
<td class="gt_row gt_right" headers="median">â0.83</td>
<td class="gt_row gt_right" headers="sd">0.25</td>
<td class="gt_row gt_right" headers="mad">0.23</td>
<td class="gt_row gt_right" headers="q5">â1.27</td>
<td class="gt_row gt_right" headers="q95">â0.43</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">4,997.22</td>
<td class="gt_row gt_right" headers="ess_tail">3,208.11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">No_intervention vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â1.19</td>
<td class="gt_row gt_right" headers="median">â1.13</td>
<td class="gt_row gt_right" headers="sd">0.63</td>
<td class="gt_row gt_right" headers="mad">0.51</td>
<td class="gt_row gt_right" headers="q5">â2.24</td>
<td class="gt_row gt_right" headers="q95">â0.30</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">3,245.52</td>
<td class="gt_row gt_right" headers="ess_tail">2,575.15</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">Self_help vs Individual_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.31</td>
<td class="gt_row gt_right" headers="median">â0.32</td>
<td class="gt_row gt_right" headers="sd">0.41</td>
<td class="gt_row gt_right" headers="mad">0.38</td>
<td class="gt_row gt_right" headers="q5">â0.97</td>
<td class="gt_row gt_right" headers="q95">0.35</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">3,164.54</td>
<td class="gt_row gt_right" headers="ess_tail">3,204.82</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">Self_help vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.66</td>
<td class="gt_row gt_right" headers="median">â0.63</td>
<td class="gt_row gt_right" headers="sd">0.66</td>
<td class="gt_row gt_right" headers="mad">0.54</td>
<td class="gt_row gt_right" headers="q5">â1.73</td>
<td class="gt_row gt_right" headers="q95">0.33</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">2,887.11</td>
<td class="gt_row gt_right" headers="ess_tail">2,348.81</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="model">Overparametrized model</td>
<td class="gt_row gt_left" headers="variable">Individual_counselling vs Group_counselling</td>
<td class="gt_row gt_right" headers="mean">â0.35</td>
<td class="gt_row gt_right" headers="median">â0.29</td>
<td class="gt_row gt_right" headers="sd">0.61</td>
<td class="gt_row gt_right" headers="mad">0.50</td>
<td class="gt_row gt_right" headers="q5">â1.38</td>
<td class="gt_row gt_right" headers="q95">0.48</td>
<td class="gt_row gt_right" headers="rhat">1.00</td>
<td class="gt_row gt_right" headers="ess_bulk">3,338.67</td>
<td class="gt_row gt_right" headers="ess_tail">2,486.91</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Note also that it is hard to interpret the study main effects in these models. We could try to make them a little more interpretable by making them represent something like the average expected outcome across treatment groups (i.e.&nbsp;if we leave out the treatment main effects, we get a predicted outcome that is between the predicted outcomes for the treatment groups). For this purpose we encode the dummy for each treatment group as <span class="math inline">\(0.5\)</span> vs.&nbsp;<span class="math inline">\(-0.5\)</span> (if it is not that treatment group). However, treatment main effect coefficients should still be looked at in contrast to each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>smoking_with_centered_dummies <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(smoking, r, n, study, trtc),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(B <span class="sc">-</span> <span class="fl">0.5</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(S)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>brmfit_with_centered_dummies <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> smoking_with_centered_dummies,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> f,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> control_args,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span>b, <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">3.14</span>)),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">silent =</span> <span class="dv">2</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the relatively low-information priors weâve chosen here, all three of these models produce similar results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>all_contrasts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="fu">c</span>(<span class="st">"Full-rank model"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Overparametrized model"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Overparametrized model with centering"</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">brmfit =</span> <span class="fu">list</span>(brmfit, brmfit_with_dummies, brmfit_with_centered_dummies)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">contrasts =</span> <span class="fu">map2</span>(brmfit, model_name, summarize_contrasts)) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>brmfit) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(contrasts)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>all_contrasts <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model=</span><span class="fu">str_remove_all</span>(model, <span class="st">" model"</span>),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">model=</span><span class="fu">str_replace_all</span>(model, <span class="st">"with"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">with"</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"vs"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">vs</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"counselling"</span>, <span class="st">"couns."</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"Individual"</span>, <span class="st">"Indiv."</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>median, <span class="at">y=</span>model, <span class="at">xmin=</span>q5, <span class="at">xmax=</span>q95)) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">"darkred"</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>() <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"log-odds ratio"</span>) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02j_network_meta_analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ranking-treatments-and-the-probability-of-being-the-best-treatment" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="ranking-treatments-and-the-probability-of-being-the-best-treatment"><span class="header-section-number">10.4.3</span> Ranking treatments and the probability of being the best treatment</h3>
<p>Probability that each treatment is best is straightforward in any of these approaches. To illustrate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(brmfit_with_dummies, <span class="at">variable =</span> <span class="st">"b_trtc"</span>, <span class="at">regex =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>best_idx <span class="ot">&lt;-</span> <span class="fu">apply</span>(B, <span class="dv">1</span>, which.max)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>trts <span class="ot">&lt;-</span> <span class="fu">levels</span>(smoking<span class="sc">$</span>trtc)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>best_trt <span class="ot">&lt;-</span> <span class="fu">factor</span>(trts, <span class="at">levels=</span>trts)[best_idx]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>prob_best <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">table</span>(best_trt))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">arrange</span>(<span class="fu">as.data.frame</span>(prob_best), <span class="sc">-</span>Freq)) <span class="sc">%&gt;%</span> <span class="fu">fmt_percent</span>(Freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<div id="hhdkxyahez" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hhdkxyahez table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hhdkxyahez thead, #hhdkxyahez tbody, #hhdkxyahez tfoot, #hhdkxyahez tr, #hhdkxyahez td, #hhdkxyahez th {
  border-style: none;
}

#hhdkxyahez p {
  margin: 0;
  padding: 0;
}

#hhdkxyahez .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hhdkxyahez .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hhdkxyahez .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hhdkxyahez .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hhdkxyahez .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hhdkxyahez .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hhdkxyahez .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hhdkxyahez .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hhdkxyahez .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hhdkxyahez .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hhdkxyahez .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hhdkxyahez .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hhdkxyahez .gt_spanner_row {
  border-bottom-style: hidden;
}

#hhdkxyahez .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hhdkxyahez .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hhdkxyahez .gt_from_md > :first-child {
  margin-top: 0;
}

#hhdkxyahez .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hhdkxyahez .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hhdkxyahez .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hhdkxyahez .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hhdkxyahez .gt_row_group_first td {
  border-top-width: 2px;
}

#hhdkxyahez .gt_row_group_first th {
  border-top-width: 2px;
}

#hhdkxyahez .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hhdkxyahez .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hhdkxyahez .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hhdkxyahez .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hhdkxyahez .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hhdkxyahez .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hhdkxyahez .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hhdkxyahez .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hhdkxyahez .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hhdkxyahez .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hhdkxyahez .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hhdkxyahez .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hhdkxyahez .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hhdkxyahez .gt_left {
  text-align: left;
}

#hhdkxyahez .gt_center {
  text-align: center;
}

#hhdkxyahez .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hhdkxyahez .gt_font_normal {
  font-weight: normal;
}

#hhdkxyahez .gt_font_bold {
  font-weight: bold;
}

#hhdkxyahez .gt_font_italic {
  font-style: italic;
}

#hhdkxyahez .gt_super {
  font-size: 65%;
}

#hhdkxyahez .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hhdkxyahez .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hhdkxyahez .gt_indent_1 {
  text-indent: 5px;
}

#hhdkxyahez .gt_indent_2 {
  text-indent: 10px;
}

#hhdkxyahez .gt_indent_3 {
  text-indent: 15px;
}

#hhdkxyahez .gt_indent_4 {
  text-indent: 20px;
}

#hhdkxyahez .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="best_trt" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">best_trt</th>
<th id="Freq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Freq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="best_trt">Group_counselling</td>
<td class="gt_row gt_right" headers="Freq">70.25%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="best_trt">Individual_counselling</td>
<td class="gt_row gt_right" headers="Freq">22.50%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="best_trt">Self_help</td>
<td class="gt_row gt_right" headers="Freq">7.25%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="best_trt">No_intervention</td>
<td class="gt_row gt_right" headers="Freq">0.00%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="detailed-look-at-a-pairwise-contrast" class="level3" data-number="10.4.4">
<h3 data-number="10.4.4" class="anchored" data-anchor-id="detailed-look-at-a-pairwise-contrast"><span class="header-section-number">10.4.4</span> Detailed look at a pairwise contrast</h3>
<p>In some situations, there may be a particular treatment contrast that is of special interest. In some such scenarios, where we have several This is to illustrate that by including indirect evidence, we can enhance our inference for a pairwise contrast of interest, relative to a simple pairwise meta-analysis.</p>
<p>The following analyses are compared, in terms of their estimates of the relative effect (log odds ratio) of individual counselling versus no intervention:</p>
<ul>
<li>Network meta-analysis model (<code>brmfit1</code> above)</li>
<li>Pairwise meta-analysis model (currently <code>RBesT</code> is used here, but we could equally use <code>brms</code>)</li>
<li>âStratifiedâ analysis of the contrast separately in each study, using independent beta-binomial models</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify the A vs C studies</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ac_studies <span class="ot">&lt;-</span> smoking <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trtc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"No_intervention"</span>, <span class="st">"Individual_counselling"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(study, <span class="at">name =</span> <span class="st">"num_treatments"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_treatments <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(study, trtc)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the A vs C log odds ratio using Beta-Binomial models independently</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># across studies and arms</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>arm_level_beta_binom <span class="ot">&lt;-</span> ac_studies <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">map2</span>(r, n, <span class="sc">~</span> <span class="fu">rbeta</span>(<span class="dv">10000</span>, r <span class="sc">+</span> <span class="fl">0.5</span>, n <span class="sc">-</span> r <span class="sc">+</span> <span class="fl">0.5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(study, trtc, p) <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> trtc, <span class="at">values_from =</span> p)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>study_effects <span class="ot">&lt;-</span> arm_level_beta_binom <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_odds_ratio =</span> <span class="fu">map2</span>(No_intervention, Individual_counselling,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                               <span class="sc">~</span> <span class="fu">log</span>(.x) <span class="sc">+</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> .y) <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> .x) <span class="sc">-</span> <span class="fu">log</span>(.y)),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">out =</span> <span class="fu">map</span>(log_odds_ratio, <span class="sc">~</span> <span class="fu">summarize_draws</span>(<span class="fu">matrix</span>(.), mean, sd, <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">study =</span> <span class="fu">factor</span>(study), out) <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(out) <span class="sc">%&gt;%</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>variable)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># pairwise meta-analysis of the log odds ratios based on summary statistics</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>rbest_fit <span class="ot">&lt;-</span> RBesT<span class="sc">::</span><span class="fu">gMAP</span>(<span class="fu">cbind</span>(mean, sd) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> study,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> study_effects,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tau.dist =</span> <span class="st">"HalfNormal"</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tau.prior =</span> <span class="dv">1</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">beta.prior =</span> <span class="fu">cbind</span>(<span class="dv">0</span>,<span class="dv">2</span>))</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># study-level treatment-effect estimates from RBesT</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>fitted_rbest <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(study_effects, study), <span class="fu">fitted</span>(rbest_fit))</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># study-level treatment effect estimates from the NMA model</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(smoking_with_dummies,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                 dplyr<span class="sc">::</span><span class="fu">select</span>(ac_studies, study, trtc),</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(<span class="st">"study"</span>, <span class="st">"trtc"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>lp <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(brmfit, <span class="at">newdata =</span> nd)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>lpA <span class="ot">&lt;-</span> lp[,nd<span class="sc">$</span>trtc <span class="sc">==</span> <span class="st">"No_intervention"</span>]</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>lpC <span class="ot">&lt;-</span> lp[,nd<span class="sc">$</span>trtc <span class="sc">==</span> <span class="st">"Individual_counselling"</span>]</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>lor <span class="ot">&lt;-</span> <span class="fu">log</span>(lpA) <span class="sc">+</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> lpC) <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> lpA) <span class="sc">-</span> <span class="fu">log</span>(lpC)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>fitted_nma <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(study_effects, study),</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">summarize_draws</span>(lor, mean, sd, <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))), <span class="sc">-</span>variable)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and MAP treatment effect estimates from RBesT</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>mean_rbest <span class="ot">&lt;-</span> <span class="fu">summary</span>(rbest_fit, <span class="at">type=</span><span class="st">"response"</span>)[<span class="fu">c</span>(<span class="st">"theta.pred"</span>, <span class="st">"theta"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="at">what =</span> <span class="st">"rbind"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"study"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"pairwise meta"</span>,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">study =</span> <span class="fu">c</span>(<span class="st">"theta_resp_pred"</span> <span class="ot">=</span> <span class="st">"MAP"</span>, <span class="st">"theta_resp"</span> <span class="ot">=</span> <span class="st">"Mean"</span>)[study])</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="co"># mean treatment effect estimate from NMA model</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>mean_nma <span class="ot">&lt;-</span> <span class="fu">summarize_contrasts</span>(brmfit, <span class="at">variable =</span> <span class="st">"trtc"</span>, <span class="at">model_name =</span> <span class="st">"nma"</span>, mean, sd,</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>                                <span class="sc">~</span> <span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable <span class="sc">==</span> <span class="st">"No_intervention vs Individual_counselling"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">study =</span> <span class="st">"Mean"</span>, <span class="at">type =</span> <span class="st">"network meta"</span>)</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>all_ests <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(study_effects, <span class="at">type =</span> <span class="st">"stratified"</span>, <span class="at">estimate_type =</span> <span class="st">"Study-level"</span>),</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fitted_rbest, <span class="at">type =</span> <span class="st">"pairwise meta"</span>, <span class="at">estimate_type =</span> <span class="st">"Study-level"</span>),</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fitted_nma, <span class="at">type =</span> <span class="st">"network meta"</span>, <span class="at">estimate_type =</span> <span class="st">"Study-level"</span>),</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(mean_rbest, <span class="at">estimate_type =</span> <span class="st">"Mean"</span>),</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(mean_nma, <span class="at">estimate_type =</span> <span class="st">"Mean"</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_ests, <span class="fu">aes</span>(<span class="at">y =</span> study, <span class="at">x =</span> mean, <span class="at">xmin =</span> <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>,</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> type, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(estimate_type <span class="sc">~</span> ., <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Log odds ratio for individual counselling vs no intervention"</span>,</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Study"</span>, <span class="at">color =</span> <span class="st">"Analysis</span><span class="sc">\n</span><span class="st">method"</span>) <span class="sc">+</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02j_network_meta_analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">10.5</span> Conclusion</h2>
<p>Arm-based (network-)meta-analysis approaches compare favorably with contrast based approaches in many situations and fit very easily into the Bayesian regression modeling machinery provided by <code>brms</code>. The main challenge we face is how one should parametrize the model in order to be able to specify prior distributions easily, for which we showed several options.</p>
<p>For NMA, Bayesian approaches are very popular due to the ease with which one can obtain inference about various quantities of interest (e.g.&nbsp;ranking of treatments, probability that a treatment is the best one) via transformations of the MCMC samples from the posterior distribution.</p>
<p>TBD: Further topics might include including observational data (aka real-world Exploiting that some drugs are in the same class, that some arms are different doses of the same drug, or when we have subgroup results from the same study.</p>
</section>
<section id="exercises" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">10.6</span> Exercises</h2>
<section id="excercise-1" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="excercise-1"><span class="header-section-number">10.6.1</span> Excercise 1</h3>
<p>We will use the data on the occurrence of malignancy anti-tumour necrosis factor (anti-TNF) drugs used in the paper by <span class="citation" data-cites="Warren2014">Warren, Abrams, and Sutton (<a href="02h_mmrm.html#ref-Warren2014" role="doc-biblioref">2014</a>)</span>. We have information for each arm of 13 studies of three different anti-TNF drugs (etanercept, adalimumab and infliximab) on how many patients developed a malignancy <code>y</code> out of the total number of patients in an arm <code>n</code>. It is common in drug development to simplistically reduce what is in truth a time-to-event process of adverse event occurrence into a binomial problem. In practice, we should be cautious about this simplification, because differential drop-out could lead to biased conclusions and we will by necessaity get variation in effect measures for binomial outcomes across studies of different duration even if the time-to-event distributions are identical across studies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>antiTNF <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="fu">c</span>(<span class="st">"Ericson (1999)"</span>, <span class="st">"Ericson (1999)"</span>, <span class="st">"Ericson (1999)"</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Moreland (1999)"</span>, <span class="st">"Moreland (1999)"</span>, <span class="st">"Moreland (1999)"</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Genovese (2002)"</span>, <span class="st">"Genovese (2002)"</span>, <span class="st">"Genovese (2002)"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Combe (2006)"</span>, <span class="st">"Combe (2006)"</span>, <span class="st">"Van der Heijde (2006)"</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van der Heijde (2006)"</span>, <span class="st">"Weisman (2007)/Baumgartner (2004)"</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weisman (2007)/Baumgartner (2004)"</span>, <span class="st">"Furst (2003)"</span>, <span class="st">"Furst (2003)"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Weinblatt (2003)"</span>, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Keystone (2004)"</span>, <span class="st">"Keystone (2004)"</span>, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Van de Putte (2004)"</span>, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Breedveld (2006)"</span>, <span class="st">"Breedveld (2006)"</span>, </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Maini (2004)"</span>, <span class="st">"Maini (2004)"</span>, <span class="st">"Maini (2004)"</span>, <span class="st">"St Clair (2004)"</span>, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"St Clair (2004)"</span>, <span class="st">"St Clair (2004)"</span>), </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Adalimumab"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Control"</span>, <span class="st">"Infliximab"</span>, <span class="st">"Infliximab"</span>, <span class="st">"Control"</span>, <span class="st">"Infliximab"</span>, </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Infliximab"</span>), </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">regimen =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="st">"10 mg qw or 25 mg qw or 10 mg biw"</span>, <span class="cn">NA</span>, </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">"25 mg biw"</span>, <span class="st">"10 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="st">"10 mg biw"</span>, <span class="cn">NA</span>, </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, <span class="st">"20 mg eow"</span>, <span class="st">"80 mg eow"</span>, <span class="cn">NA</span>, </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">"20 mg qw or 40 mg eow"</span>, <span class="cn">NA</span>, <span class="st">"20 mg qw or 40 mg eow"</span>, </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">"20 mg eow"</span>, <span class="st">"40 mg qw"</span>, <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, <span class="cn">NA</span>, <span class="st">"3 mg/kg q8w"</span>, </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>              <span class="st">"3 mg/kg q4w or 10 mg/kg q8w or 10 mg/kg q4w"</span>, <span class="cn">NA</span>, <span class="st">"3 mg/kg q8w"</span>, </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>              <span class="st">"6 mg/q8w"</span>), </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>           <span class="st">"High"</span>), </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">105</span>L, <span class="dv">111</span>L, <span class="dv">343</span>L, <span class="dv">80</span>L, <span class="dv">78</span>L, <span class="dv">76</span>L, <span class="dv">217</span>L, <span class="dv">207</span>L, <span class="dv">208</span>L, <span class="dv">50</span>L, <span class="dv">204</span>L, <span class="dv">228</span>L, </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="dv">454</span>L, <span class="dv">269</span>L, <span class="dv">266</span>L, <span class="dv">318</span>L, <span class="dv">318</span>L, <span class="dv">62</span>L, <span class="dv">67</span>L, <span class="dv">69</span>L, <span class="dv">73</span>L, <span class="dv">200</span>L, <span class="dv">419</span>L, <span class="dv">110</span>L, </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        <span class="dv">225</span>L, <span class="dv">106</span>L, <span class="dv">103</span>L, <span class="dv">257</span>L, <span class="dv">542</span>L, <span class="dv">88</span>L, <span class="dv">86</span>L, <span class="dv">254</span>L, <span class="dv">291</span>L, <span class="dv">372</span>L, <span class="dv">377</span>L), </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">2</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">10</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L, <span class="dv">0</span>L, </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">8</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,  <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">6</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">8</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the data, we can see that the proportion of patients with an event is quite low (&lt;4%) across all studies and arms. I.e. we are in a rare event setting, where a Bayesian approach with sensibly chosen priors might be helpful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>antiTNF <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">study =</span> <span class="fu">factor</span>(study),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">arm =</span> <span class="fu">paste0</span>(treatment, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(dose),<span class="st">""</span>,<span class="fu">paste0</span>(<span class="st">" "</span>,dose)))) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>study, <span class="at">y=</span>y<span class="sc">/</span>n, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill=</span>arm, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">group=</span>arm,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.025</span>, <span class="at">shape1=</span>y, <span class="at">shape2=</span><span class="dv">1</span><span class="sc">+</span>n<span class="sc">-</span>y),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.975</span>, <span class="at">shape1=</span>y<span class="sc">+</span><span class="dv">1</span>, <span class="at">shape2=</span>n<span class="sc">-</span>y))) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="fu">guide_legend</span>(<span class="at">ncol=</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02j_network_meta_analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Try fitting models of increasing complexity (slightly different to those done in the <span class="citation" data-cites="Warren2014">Warren, Abrams, and Sutton (<a href="02h_mmrm.html#ref-Warren2014" role="doc-biblioref">2014</a>)</span> paper, which you could also choose to reproduce):</p>
<ol type="1">
<li>A simple meta-analysis of anti-TNF therapy vs.&nbsp;non-anti-TNF controls.</li>
<li>A network meta-analysis with each anti-TNF drug having a separate fixed treatment effects parameter, but ignoring informaiton on doses and regimens.</li>
<li>A network meta-analysis that treats all unique combinations of drug and dose/regimen as a separate treatment.</li>
<li>A network meta-analysis that assumes that each drug may have a different effect on malignancy with this effect being monotonic across doses. Note the <code>mo()</code> notation provided by <code>brms</code> to define monotonic effects. Look into borrowing information about the maximum effect across drugs.</li>
</ol>
<!---
### Excercise 2

**It would be good to have another example that does not involve binomial data.**

--->


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Combescure_2012" class="csl-entry" role="listitem">
Combescure, C, DS Courvoisier, G Haller, and TV Perneger. 2012. <span>âMeta-Analysis of Two-Arm Studies: Modeling the Intervention Effect from Survival Probabilities.â</span> <em>Statistical Methods in Medical Research</em> 25 (2): 857â71. <a href="https://doi.org/10.1177/0962280212469716">https://doi.org/10.1177/0962280212469716</a>.
</div>
<div id="ref-dias2014" class="csl-entry" role="listitem">
Dias, S., N. J. Welton, A. J. Sutton, and A. Ades. 2014. <span>â<span>NICE DSU</span> Technical Support Document 2: A Generalised Linear Modelling Framework for Pairwise and Network Meta-Analysis of Randomised Controlled Trials.â</span> Technical report. <span>NICE Decision Support Unit</span>.
</div>
<div id="ref-Hasselblad1998" class="csl-entry" role="listitem">
Hasselblad, Vic. 1998. <span>âMeta-Analysis of Multitreatment Studies.â</span> <em>Medical Decision Making</em> 18 (1): 37â43. <a href="https://doi.org/10.1177/0272989x9801800110">https://doi.org/10.1177/0272989x9801800110</a>.
</div>
<div id="ref-LuAdes2004" class="csl-entry" role="listitem">
Lu, G., and A. E. Ades. 2004. <span>âCombination of Direct and Indirect Evidence in Mixed Treatment Comparisons.â</span> <em>Statistics in Medicine</em> 23 (20): 3105â24. <a href="https://doi.org/10.1002/sim.1875">https://doi.org/10.1002/sim.1875</a>.
</div>
<div id="ref-Piepho2012" class="csl-entry" role="listitem">
Piepho, H. P., E. R. Williams, and L. V. Madden. 2012. <span>âThe Use of Two-Way Linear Mixed Models in Multitreatment Meta-Analysis.â</span> <em>Biometrics</em> 68 (4): 1269â77. <a href="https://doi.org/10.1111/j.1541-0420.2012.01786.x">https://doi.org/10.1111/j.1541-0420.2012.01786.x</a>.
</div>
<div id="ref-Warren2014" class="csl-entry" role="listitem">
Warren, Fiona C., Keith R. Abrams, and Alex J. Sutton. 2014. <span>âHierarchical Network Meta-Analysis Models to Address Sparsity of Events and Differing Treatment Classifications with Regard to Adverse Outcomes.â</span> <em>Statistics in Medicine</em> 33 (14): 2449â66. <a href="https://doi.org/10.1002/sim.6131">https://doi.org/10.1002/sim.6131</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/RBesT\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02i_time_to_event.html" class="pagination-link" aria-label="Time-to-event data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/03a_stan_code.html" class="pagination-link" aria-label="Exposing stan code">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - BjÃ¶rn Holzhauer - &lt;bjoern.holzhauer@novartis.com&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Andrew Bean - &lt;andrew.bean@novartis.com&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Network meta-analysis</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>This case study covers:</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Using <span class="in">`brms`</span> to perform arm-based network meta-analysis using a "two-way mixed model" approach (as opposed to the also popular contrast-based or baseline-contrast model)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Visualizing networks of evidence using function from the <span class="in">`multinma`</span> package</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Setting up over-parameterized models to avoid specifying prior distributions for differences relative to a reference study or treatment (by collating two design matrices created using <span class="in">`model.matrix()`</span>), and how to estimate desired contrasts in this context</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">` r | trials(n) ~ ...`</span> for binomial outcomes (<span class="in">`r`</span> out of <span class="in">`n`</span> patients)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Ranking treatments based on samples from the posterior distribution</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="in">source(here::here("src", "setup.R"))</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>libraries and options first:</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE}</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(brms)</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(posterior)</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(multinma) # for graphing the network &amp; other NMA utils</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="in"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="in">options(brms.backend="cmdstanr", cmdstanr_write_stan_file_dir=here("_brms-cache"))</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="in"># create cache directory if not yet available</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create(here("_brms-cache"), FALSE)</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(5675798)</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="in"># allow for wider printouts without line-breaking</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="in">options(width=120)</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="in">control_args &lt;- list(adapt_delta=0.95)</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="in"># invisible to the reader we move the cache directory</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="in">options(cmdstanr_write_stan_file_dir=brms_cache_dir)</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="in"># speedup things by lowering adapt_delta for now, which speeds up things a lot</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="in"># do this only if caching is on (which is when we want things go fast)</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="in">control_args &lt;- list(adapt_delta=0.8)</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview Video</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="public"}</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>{{&lt; video videos/brms-20230426-4-network-meta.mp4 &gt;}}</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Background: Why network meta-analysis?</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>Network (or multi-treatment) meta-analysis (NMA) is a term for analyses</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>that combine the results of studies that compared several treatments and</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>in which not all studies included all comparisons <span class="co">[</span><span class="ot">@LuAdes2004</span><span class="co">]</span>. This is a</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>frequent situation, because new drugs are often only compared to a placebo or to</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>one commonly used current standard of care, but not to all existing</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>current treatment options. As a result, physicians that want to choose</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>between two treatment options often find that there are no or very few</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>studies directly comparing them. NMA tries to address this issue by</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>combining evidence from direct comparisons within each trial with</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>indirect chains of comparisons across multiple trials.</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>Network meta-analyses have their limitations. One particular concern</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>would be factors that modify the effects of treatments resulting in</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>treatment by trial interactions, e.g. if pathogens developing resistance</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>to some drugs over time, if the presence of some background therapies</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>has a synergistic or antagonistic interaction with a drug, or if some</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>drugs work better or worse depending on disease severity.</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>We will use smoking cessation data <span class="co">[</span><span class="ot">@Hasselblad1998</span><span class="co">]</span>, which consists</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>of the number of patients $r$ amongst the total in an study arm $n$ that</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>manage to stop smoking. There are 24 studies, in which different</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>combinations of 4 interventions (no contact, self-help, individual</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>counseling and group counseling) were tested. The aim of a network</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>meta-analysis here would be to compare these different treatment in</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>terms of the odds of patients managing to stop smoking.</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r smoking_cessation_data}</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="in">trt_levels &lt;- c("No intervention", "Self-help",</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="in">                "Individual counselling", "Group counselling")</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="in">smoking &lt;- multinma::smoking %&gt;%</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(study = factor(studyn),</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a><span class="in">         trtc = factor(trtc, trt_levels))</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a><span class="in">levels(smoking$trtc) &lt;- gsub(" ", "_", trt_levels)</span></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="in">levels(smoking$trtc) &lt;- gsub("-", "_", levels(smoking$trtc))</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a><span class="in">gt_preview(smoking)</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>smoking <span class="sc">%&gt;%</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>study, <span class="at">y=</span>r<span class="sc">/</span>n, <span class="at">fill=</span>trtc, <span class="at">group=</span>trtc,</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.025</span>, <span class="at">shape1=</span>r, <span class="at">shape2=</span><span class="dv">1</span><span class="sc">+</span>n<span class="sc">-</span>r),</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.975</span>, <span class="at">shape1=</span>r<span class="sc">+</span><span class="dv">1</span>, <span class="at">shape2=</span>n<span class="sc">-</span>r))) <span class="sc">+</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>The totality of evidence about the treatments and their relative efficacy is </span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>commonly known as the *evidence network*. A common graphical representation, </span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>shown below, visualizes this network of treatments (the nodes) along with</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>edges indicating the presence or absence of direct evidence comparing pairs </span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>of treatments from randomized trials. Below, the thickness of the edges </span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>is determined by the number of trials comparing each pair of treatments.</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>network <span class="ot">&lt;-</span> multinma<span class="sc">::</span><span class="fu">set_agd_arm</span>(</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> smoking,</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> study,</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt =</span> trtc,</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> r,</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> n,</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">trt_ref =</span> <span class="st">"No_intervention"</span></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(network)</span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model description</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>We will first describe the arm-based (aka "two-way mixed model")</span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>approach to NMA advocated by</span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>Piepho <span class="co">[</span><span class="ot">@Piepho2012</span><span class="co">]</span>. It has some</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>advantages over more commonly used NMA approach that analyzes</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>treatment contrasts <span class="co">[</span><span class="ot">@LuAdes2004</span><span class="co">]</span>, in terms of ease of use and familiarity (the</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>two-way linear mixed model is of course very familiar). The latter approach,</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>however, is widely used in health technology assessments, for example by the UK </span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>NICE. The NICE decision support unit has published methodological guidance on </span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>how to use this method in practice <span class="co">[</span><span class="ot">@dias2014</span><span class="co">]</span>. </span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>Suppose we had individual patient data for patients $k=1,\ldots,N_{ij}$ </span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>randomly assigned to treatment $j$ in trial $i$, for $i = 1,\ldots, n$ and</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>$j = 1,\ldots, m$. A two-way linear mixed model would model the outcome of</span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>interest $Y_{ijk}$ as</span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>$$ g(E(Y_{ijk})) = \underbrace{\alpha_i}_{\text{fixed main effect of trial }i} + \underbrace{\beta_j}_{\text{fixed main effect of treatment }j} + \underbrace{u_{ij}}_{\text{random effect of trial on treatment}},$$</span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>where $g$ is a link function such as the logit link in case of bernoulli data.</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>The random effects $u_{ij}$ have mean zero and describe that the effect</span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a>of treatments is allowed to vary across trials. If we wanted to assume</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>the same effect of all treatment across all trials, we could instead</span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>omit this term. When we include it, we will ideally want to allow for</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>the possibility that if one treatment has better outcomes in a trial,</span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>then other treatments might also. To achieve that we assume that for the</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a>trials $i=1,\ldots,n$ there is a multivariate normal random effect</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a>$\boldsymbol{U}_i \sim \text{MVN}(\boldsymbol{0}, \boldsymbol{\Sigma})$,</span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a>where $\Sigma$ is some covariance matrix that is either unstructured or</span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a>has some particular structure (e.g. compound symmetric). In other words,</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a>the components of the random vector $\boldsymbol{U}_i$ for a trial $i$</span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>are correlated.</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a><span class="fu">### Network meta-analysis with summaries for each arm</span></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a>In case we have summary information by treatment arm, we will (just as</span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>for traditional arm-based meta-analyses) often be able to assume a</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>normal sampling distribution for least squares means for each arm from</span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a>linear models, log-odds, log-rates or log-hazard rates. We will denote</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>these estimates for each arm by $\hat{\theta}_{ij}$ and their standard</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>error by $\text{SE}(\hat{\theta}_{ij})$. We then assume</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a>$\theta_{ij} = \alpha_i + \beta_j + u_{ij}$ as above and that</span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>$\hat{\theta}_{ij} \sim N(\theta_{ij}, \text{SE}(\hat{\theta}_{ij}))$.</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>Alternatively, for a binary outcome, we can use that the number of</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a>patients with a success follows a binomial distribution and we would use</span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a>a regression equation like above for the logit-probability</span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a>$\theta_{ij} = \alpha_i + \beta_j + u_{ij}$ for each arm.</span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>TO BE DETERMINE WHAT TO DO FOR SURVIAL: Less clear, could one work with</span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a>log-cumulative-hazard function (under a parametric model?)? Maybe one</span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a>could get that from KM curves? Log-(or logit-?)survival probabilities at </span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a>fixed points of time (e.g. 1-year)? Discussed by some papers such as </span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>this one <span class="co">[</span><span class="ot">@Combescure_2012</span><span class="co">]</span>. Perhaps models fitted to </span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a>reconstructed patient-level data/KM curves via, standard parametric models,</span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a>fractional polynomial models and/or spline-based models? What about </span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a>non-proportional hazards?</span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Patient-, arm- or trial-level covariates</span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a>As needed, the regression equation $\alpha_i + \beta_j + u_{ij}$ can be</span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a>extended by allowing for patient level covariates $\boldsymbol{x}_{ijk}$</span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>(in case we work with individual patient data), arm-level covariates</span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a>$\boldsymbol{x}_{ij}$ or study-level covariates $\boldsymbol{x}_i$.</span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a><span class="fu">### Borrowing information from real-world data or other trials</span></span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a>If we have a fixed effect for the $\alpha_i$, then borrowing information</span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>between trials runs into the identifiability issues between the</span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a>$\alpha_i$ and the $u_{ij}$. In a frequentist approach we cannot resolve</span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a>these issues. When we take a Bayesian approach, this identifiability</span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a>issue will still severely limit how much information we can obtain about</span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a>the distribution of the $u_{ij}$ (while we would by definition not</span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a>borrow information about the $\alpha_i$) and the results will be</span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a>sensitive to the choice of prior distributions.</span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a>We could borrow information across trials, we replace the trial main</span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>effect by an intercept term and a random trial effect on the intercept.</span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>However, then we will be conducting a meta-analysis, in which the causal</span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>effects of treatments are no longer just judged based on randomized</span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>within-trial comparisons. We would then also to an extent do comparisons</span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>across treatment arms from different trials. Besides the limitations any</span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>NMA is subject to, such comparisons are additionally affected by any</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>prognostic factors that change the expected outcomes for a treatment in</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a>different trials. Such prognostic factors are much more common than effect</span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>modifiers that would cause trial by treatment interactions, and we know that</span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>to some extent such differences across trials will exist. Examples</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a>include improving (or worsening) patient outcomes due to better</span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a>treatments or access to healthcare, different inclusion/exclusion</span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a>criteria of different trials, and differences in recruited patient</span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a>populations in terms of e.g. background therapy, disease severity,</span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a>country/region and comorbidities. While we may hope that a random trial</span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a>effect on the intercept would capture random variation in these aspects</span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a>across trials, we have to be concerned that there could be a systematic</span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a>bias in favor of some treatments in a NMA - especially if studies for</span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a>some treatments were conducted later in time than for other treatments.</span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation</span></span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a>In this case, we have a binomial outcome. </span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> provides the <span class="in">`y | trials(n)`</span> notation to indicate <span class="in">`y`</span> successes out of </span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="in">`n`</span> trials, while in <span class="in">`stats::glm`</span> the way of specifying this is a little less </span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a>intuitive: <span class="in">`glm( cbind(y, n-y)~... )`</span>. </span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a>We will now try implement the network meta-analysis model we described</span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a>above. In the process, we will discover some things that did not make a</span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a>difference in a frequentist setting, but matter in the Bayesian setting</span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a>with respect to how we can the most easily specify our prior knowledge</span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a>(or lack thereof).</span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reference categories matter for setting priors</span></span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a>Firstly, before we even think too much about any prior distributions, let see how <span class="in">`brms`</span> </span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a>parameterizes the model, if we specify it in the most obvious way by just </span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a>writing <span class="in">`0 + study + trtc + (0 + trtc |study)`</span>:</span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', message=FALSE, warning=FALSE}</span></span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a><span class="in">brmfit &lt;- brm(</span></span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a><span class="in">  data = smoking,</span></span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a><span class="in">  formula = r | trials(n) ~ 0 + study + trtc + (0 + trtc || study),</span></span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(),</span></span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a><span class="in">  control = control_args,</span></span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = prior(class = b, normal(0, 3.14)),</span></span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a><span class="in">  silent = 2,</span></span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a>As we can see from the summary of the fitted model, there are coefficients for</span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a>all study main effects, but not for all treatments: treatment 1 is omitted, and</span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a>the coefficients for remaining treatments now represent contrasts against treatment</span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>(Conversely, if we had instead written </span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a><span class="in">`0 + trtc + study + (0+trtc|study)`</span>, then there would have been a </span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a>coefficient for all treatments, but the study effects would have been </span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a>parametrized in terms of contrasts with study 1.</span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit)</span>
<span id="cb20-283"><a href="#cb20-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-284"><a href="#cb20-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a>Is this a problem? In the frequentist context, this issue with the form of the</span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a>design matrix for population-level effects is not important, because the pairwise treatment contrasts are uniquely estimable regardless of whether constraints such as $\beta_1 = 0$ are employed.</span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a>However, if we wanted to imply some prior information or lack thereof, it may</span>
<span id="cb20-289"><a href="#cb20-289" aria-hidden="true" tabindex="-1"></a>impact our preference for the specification of the population-level terms. For</span>
<span id="cb20-290"><a href="#cb20-290" aria-hidden="true" tabindex="-1"></a>example, if we had some prior information (external to the likelihood) on a </span>
<span id="cb20-291"><a href="#cb20-291" aria-hidden="true" tabindex="-1"></a>particular contrast between a pair of treatments, we would favor the parametrization</span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a>above, in which the treatment terms are parametrized in terms of contrasts.</span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting priors is easier in an over-parameterized model</span></span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-296"><a href="#cb20-296" aria-hidden="true" tabindex="-1"></a>Another possibility is to over-parametrize the model and have a main effect for each study </span>
<span id="cb20-297"><a href="#cb20-297" aria-hidden="true" tabindex="-1"></a>(i.e. main effects for all studies <span class="in">`study1`</span> to <span class="in">`study24`</span> are present) and each </span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a>treatment. The main rationale for this would be symmetry in how we</span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a>set our prior distributions. I.e. we do not want to set our priors in a</span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a>way that would somehow favor one treatment (or study - which will have</span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a>studied some subset of treatments = might again favor somehow treatment)</span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a>over any of the others. Unlike the specification above, the marginal variance</span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a>of the each arm of each study will be constant in this approach.</span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a>This can be achieved by creating dummy variables for each treatment group and </span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a>thereby enforcing the paramterization. </span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a>We then specify our model as </span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a><span class="in">`0 + study + trtcA + trtcB + trtcC + trtcD + (0 + trtc | study)`</span>.</span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a>The code below constructs the dummy variables and corresponding formula in an </span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a>automated way. </span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r piepho_model2, results='hide', message=FALSE, warning=FALSE}</span></span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a><span class="in">B &lt;- model.matrix(~ 0 + trtc, data = smoking)</span></span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a><span class="in">S &lt;- model.matrix(~ 0 + study, data = smoking)</span></span>
<span id="cb20-315"><a href="#cb20-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-316"><a href="#cb20-316" aria-hidden="true" tabindex="-1"></a><span class="in">smoking_with_dummies &lt;- bind_cols(</span></span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(smoking, r, n, study, trtc),</span></span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble(B),</span></span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble(S)</span></span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-322"><a href="#cb20-322" aria-hidden="true" tabindex="-1"></a><span class="in">f &lt;- as.formula(paste(</span></span>
<span id="cb20-323"><a href="#cb20-323" aria-hidden="true" tabindex="-1"></a><span class="in">  "r | trials(n) ~ 0 + study +",</span></span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a><span class="in">  paste(colnames(B), collapse = " + "),</span></span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a><span class="in">  "+ (0 + trtc || study)"</span></span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a><span class="in">))</span></span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a><span class="in"># could also do:</span></span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a><span class="in"># f &lt;- as.formula(paste(</span></span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a><span class="in">#     "r | trials(n) ~ 0 + trtc +",</span></span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a><span class="in">#     paste(colnames(S), collapse = " + "),</span></span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a><span class="in">#     "+ (0 + trtc || study)"</span></span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a><span class="in"># ))</span></span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a><span class="in">brmfit_with_dummies &lt;- brm(data = smoking_with_dummies,</span></span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a><span class="in">                           formula = f,</span></span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a><span class="in">                           family = binomial(),</span></span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a><span class="in">                           control = control_args,</span></span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a><span class="in">                           prior = prior(class=b, normal(0, 3.14)),</span></span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a><span class="in">                           silent = 2,</span></span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a><span class="in">                           refresh = 0)</span></span>
<span id="cb20-342"><a href="#cb20-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-343"><a href="#cb20-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-344"><a href="#cb20-344" aria-hidden="true" tabindex="-1"></a>When we now summarize the model fit, we have regression coefficients for all </span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a>treatment groups and studies.</span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r piepho_results2}</span></span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a><span class="in">summary(brmfit_with_dummies)</span></span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a>While the coefficients for each treatment have changed compared to the previous</span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a>section, we should not actually look at the coefficients for each treament main</span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a>effect, but at their contrasts. When we look at those, we see that the models</span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a>lead to very similar inference (despite us not even setting any priors for </span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a>Model 0).</span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a><span class="co"># utility function to estimate all pairwise contrasts between the main effects</span></span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a><span class="co"># for the variable named "trtc"</span></span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a>contrast_draws <span class="ot">&lt;-</span> <span class="cf">function</span>(brmfit, <span class="at">variable =</span> <span class="st">"trtc"</span>){</span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a>  trts <span class="ot">&lt;-</span> <span class="fu">levels</span>(brmfit<span class="sc">$</span>data[[variable]])</span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a>  ntrt <span class="ot">&lt;-</span> <span class="fu">nlevels</span>(brmfit<span class="sc">$</span>data[[variable]])</span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a>  all_pairs <span class="ot">&lt;-</span> <span class="fu">combn</span>(<span class="dv">1</span><span class="sc">:</span>ntrt, <span class="dv">2</span>)</span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a>  L_trt <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(</span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a>    all_pairs, <span class="dv">2</span>, <span class="cf">function</span>(x){</span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">numeric</span>(ntrt)</span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a>      out[x[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a>      out[x[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a>      out</span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(L_trt) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(variable, trts)</span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">standata</span>(brmfit)<span class="sc">$</span>X</span>
<span id="cb20-379"><a href="#cb20-379" aria-hidden="true" tabindex="-1"></a>  L_study <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(L_trt), <span class="at">ncol =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">grepl</span>(variable, <span class="fu">colnames</span>(X))))</span>
<span id="cb20-380"><a href="#cb20-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if the treatment variable is not dummy coded for every level then</span></span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need to drop the base category as this is masked by study</span></span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">ncol</span>(L_trt) <span class="sc">==</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(variable, <span class="fu">colnames</span>(X)))){</span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">cbind</span>(L_study, L_trt)</span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">&lt;-</span> <span class="fu">cbind</span>(L_study, L_trt[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(L) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-391"><a href="#cb20-391" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels for the contrasts</span></span>
<span id="cb20-392"><a href="#cb20-392" aria-hidden="true" tabindex="-1"></a>  labs <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">combn</span>(trts, <span class="dv">2</span>), <span class="dv">2</span>, paste, <span class="at">collapse =</span> <span class="st">" vs "</span>)</span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(L) <span class="ot">&lt;-</span> labs</span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(brmfit, <span class="at">variable =</span> <span class="st">"^b_"</span>, <span class="at">regex =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a>  gamma_draws <span class="ot">&lt;-</span> B <span class="sc">%*%</span> <span class="fu">t</span>(L)</span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to posterior object</span></span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>(gamma_draws)</span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-403"><a href="#cb20-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-404"><a href="#cb20-404" aria-hidden="true" tabindex="-1"></a>summarize_contrasts <span class="ot">&lt;-</span> <span class="cf">function</span>(brmfit, <span class="at">model_name =</span> <span class="st">"model"</span>, <span class="at">variable =</span> <span class="st">"trtc"</span>, ...){</span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(</span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">summarize_draws</span>(<span class="fu">contrast_draws</span>(brmfit, <span class="at">variable =</span> variable), ...), <span class="at">model =</span> model_name),</span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a>    model</span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_contrasts</span>(brmfit, <span class="st">"Full-rank model"</span>),</span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_contrasts</span>(brmfit_with_dummies, <span class="st">"Overparametrized model"</span>)</span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="fu">where</span>(is.numeric), <span class="at">decimals=</span><span class="dv">2</span>)</span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a>Note also that it is hard to interpret the study main effects in these models.</span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a>We could try to make them a little more interpretable by making them represent</span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a>something like the average expected outcome across treatment groups </span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a>(i.e. if we leave out the treatment main effects, we get a predicted outcome</span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a>that is between the predicted outcomes for the treatment groups). For this </span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a>purpose we encode the dummy for each treatment group as $0.5$ vs. $-0.5$ </span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a>(if it is not that treatment group). However, treatment main effect</span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a>coefficients should still be looked at in contrast to each other.</span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r piepho_model3, results='hide', message=FALSE, warning=FALSE, eval = TRUE}</span></span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a><span class="in">smoking_with_centered_dummies &lt;- bind_cols(</span></span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(smoking, r, n, study, trtc),</span></span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble(B - 0.5),</span></span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble(S)</span></span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a><span class="in">brmfit_with_centered_dummies &lt;- brm(</span></span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a><span class="in">    data = smoking_with_centered_dummies,</span></span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a><span class="in">    formula = f,</span></span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a><span class="in">    family = binomial(),</span></span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a><span class="in">    control = control_args,</span></span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a><span class="in">    prior = prior(class=b, normal(0, 3.14)),</span></span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a><span class="in">    silent = 2,</span></span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a><span class="in">    refresh = 0</span></span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a>With the relatively low-information priors we've chosen here, all three of these models produce similar results</span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a>all_contrasts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="fu">c</span>(<span class="st">"Full-rank model"</span>,</span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Overparametrized model"</span>,</span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Overparametrized model with centering"</span>),</span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">brmfit =</span> <span class="fu">list</span>(brmfit, brmfit_with_dummies, brmfit_with_centered_dummies)</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">contrasts =</span> <span class="fu">map2</span>(brmfit, model_name, summarize_contrasts)) <span class="sc">%&gt;%</span></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>brmfit) <span class="sc">%&gt;%</span></span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(contrasts)</span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a>all_contrasts <span class="sc">%&gt;%</span></span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model=</span><span class="fu">str_remove_all</span>(model, <span class="st">" model"</span>),</span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a>           <span class="at">model=</span><span class="fu">str_replace_all</span>(model, <span class="st">"with"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">with"</span>),</span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"vs"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">vs</span><span class="sc">\n</span><span class="st">"</span>),</span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"counselling"</span>, <span class="st">"couns."</span>),</span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a>           <span class="at">variable=</span><span class="fu">str_replace_all</span>(variable, <span class="st">"Individual"</span>, <span class="st">"Indiv."</span>),</span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>median, <span class="at">y=</span>model, <span class="at">xmin=</span>q5, <span class="at">xmax=</span>q95)) <span class="sc">+</span></span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">color=</span><span class="st">"darkred"</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>() <span class="sc">+</span></span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"log-odds ratio"</span>) <span class="sc">+</span></span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable)</span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ranking treatments and the probability of being the best treatment</span></span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a>Probability that each treatment is best is straightforward in any of these approaches. To illustrate:</span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(brmfit_with_dummies, <span class="at">variable =</span> <span class="st">"b_trtc"</span>, <span class="at">regex =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a>best_idx <span class="ot">&lt;-</span> <span class="fu">apply</span>(B, <span class="dv">1</span>, which.max)</span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a>trts <span class="ot">&lt;-</span> <span class="fu">levels</span>(smoking<span class="sc">$</span>trtc)</span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a>best_trt <span class="ot">&lt;-</span> <span class="fu">factor</span>(trts, <span class="at">levels=</span>trts)[best_idx]</span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a>prob_best <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">table</span>(best_trt))</span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">arrange</span>(<span class="fu">as.data.frame</span>(prob_best), <span class="sc">-</span>Freq)) <span class="sc">%&gt;%</span> <span class="fu">fmt_percent</span>(Freq)</span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detailed look at a pairwise contrast</span></span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a>In some situations, there may be a particular treatment contrast that is of special interest. In some such scenarios, where we have several </span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a>This is to illustrate that by including indirect evidence, we can enhance our inference for a pairwise contrast of interest, relative to a simple pairwise meta-analysis.</span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a>The following analyses are compared, in terms of their estimates of the relative effect (log odds ratio) of individual counselling versus no intervention:</span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Network meta-analysis model (<span class="in">`brmfit1`</span> above)</span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Pairwise meta-analysis model (currently <span class="in">`RBesT`</span> is used here, but we could equally use <span class="in">`brms`</span>)</span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>"Stratified" analysis of the contrast separately in each study, using independent beta-binomial models</span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height=7}</span></span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-summary: "Show the code"</span></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a><span class="in"># identify the A vs C studies</span></span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a><span class="in">ac_studies &lt;- smoking %&gt;%</span></span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(trtc %in% c("No_intervention", "Individual_counselling")) %&gt;%</span></span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a><span class="in">  add_count(study, name = "num_treatments") %&gt;%</span></span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(num_treatments == 2) %&gt;%</span></span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(study, trtc)</span></span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a><span class="in"># summarize the A vs C log odds ratio using Beta-Binomial models independently</span></span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a><span class="in"># across studies and arms</span></span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a><span class="in">arm_level_beta_binom &lt;- ac_studies %&gt;%</span></span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a><span class="in">  rowwise() %&gt;%</span></span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(p = map2(r, n, ~ rbeta(10000, r + 0.5, n - r + 0.5))) %&gt;%</span></span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(study, trtc, p) %&gt;%</span></span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = trtc, values_from = p)</span></span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a><span class="in">study_effects &lt;- arm_level_beta_binom %&gt;%</span></span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(log_odds_ratio = map2(No_intervention, Individual_counselling,</span></span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a><span class="in">                               ~ log(.x) + log(1 - .y) - log(1 - .x) - log(.y)),</span></span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a><span class="in">         out = map(log_odds_ratio, ~ summarize_draws(matrix(.), mean, sd, ~ quantile(., probs = c(0.025, 0.5, 0.975))))) %&gt;%</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a><span class="in">  transmute(study = factor(study), out) %&gt;%</span></span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(out) %&gt;%</span></span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(-variable)</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a><span class="in"># pairwise meta-analysis of the log odds ratios based on summary statistics</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a><span class="in">rbest_fit &lt;- RBesT::gMAP(cbind(mean, sd) ~ 1 | study,</span></span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = study_effects,</span></span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a><span class="in">                         tau.dist = "HalfNormal",</span></span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a><span class="in">                         tau.prior = 1,</span></span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a><span class="in">                         beta.prior = cbind(0,2))</span></span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a><span class="in"># study-level treatment-effect estimates from RBesT</span></span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a><span class="in">fitted_rbest &lt;- bind_cols(dplyr::select(study_effects, study), fitted(rbest_fit))</span></span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a><span class="in"># study-level treatment effect estimates from the NMA model</span></span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a><span class="in">nd &lt;- inner_join(smoking_with_dummies,</span></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a><span class="in">                 dplyr::select(ac_studies, study, trtc),</span></span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a><span class="in">                 c("study", "trtc")) %&gt;%</span></span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(n = 1)</span></span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a><span class="in">lp &lt;- posterior_epred(brmfit, newdata = nd)</span></span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a><span class="in">lpA &lt;- lp[,nd$trtc == "No_intervention"]</span></span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a><span class="in">lpC &lt;- lp[,nd$trtc == "Individual_counselling"]</span></span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a><span class="in">lor &lt;- log(lpA) + log(1 - lpC) - log(1 - lpA) - log(lpC)</span></span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a><span class="in">fitted_nma &lt;- bind_cols(</span></span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(study_effects, study),</span></span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::select(summarize_draws(lor, mean, sd, ~ quantile(., probs = c(0.025, 0.5, 0.975))), -variable)</span></span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a><span class="in"># mean and MAP treatment effect estimates from RBesT</span></span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a><span class="in">mean_rbest &lt;- summary(rbest_fit, type="response")[c("theta.pred", "theta")] %&gt;% </span></span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a><span class="in">  do.call(what = "rbind") %&gt;%</span></span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble(rownames = "study") %&gt;% </span></span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(type = "pairwise meta",</span></span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a><span class="in">         study = c("theta_resp_pred" = "MAP", "theta_resp" = "Mean")[study])</span></span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a><span class="in"># mean treatment effect estimate from NMA model</span></span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a><span class="in">mean_nma &lt;- summarize_contrasts(brmfit, variable = "trtc", model_name = "nma", mean, sd,</span></span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a><span class="in">                                ~ quantile(., probs = c(0.025, 0.5, 0.975))) %&gt;%</span></span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(variable == "No_intervention vs Individual_counselling") %&gt;%</span></span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(study = "Mean", type = "network meta")</span></span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a><span class="in">all_ests &lt;- bind_rows(</span></span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(study_effects, type = "stratified", estimate_type = "Study-level"),</span></span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fitted_rbest, type = "pairwise meta", estimate_type = "Study-level"),</span></span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fitted_nma, type = "network meta", estimate_type = "Study-level"),</span></span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(mean_rbest, estimate_type = "Mean"),</span></span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(mean_nma, estimate_type = "Mean")</span></span>
<span id="cb20-576"><a href="#cb20-576" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-577"><a href="#cb20-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_ests, aes(y = study, x = mean, xmin = `2.5%`, xmax = `97.5%`,</span></span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a><span class="in">                     group = type, color = type)) +</span></span>
<span id="cb20-580"><a href="#cb20-580" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_pointrange(position = position_dodge(0.4)) +</span></span>
<span id="cb20-581"><a href="#cb20-581" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(estimate_type ~ ., space = "free", scales = "free") +</span></span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = 0, linetype = "dashed") +</span></span>
<span id="cb20-583"><a href="#cb20-583" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_continuous(breaks=seq(-5,1,by=1)) +</span></span>
<span id="cb20-584"><a href="#cb20-584" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_cartesian(xlim=c(-5,0.5)) +</span></span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Log odds ratio for individual counselling vs no intervention",</span></span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a><span class="in">         y = "Study", color = "Analysis\nmethod") +</span></span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "bottom")</span></span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a>Arm-based (network-)meta-analysis approaches compare favorably with contrast</span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a>based approaches in many situations and fit very easily into the Bayesian</span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a>regression modeling machinery provided by <span class="in">`brms`</span>. The main challenge we face</span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a>is how one should parametrize the model in order to be able to specify prior </span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a>distributions easily, for which we showed several options. </span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a>For NMA, Bayesian approaches are very popular due to the ease with which </span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a>one can obtain inference about various quantities of interest (e.g. ranking of</span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a>treatments, probability that a treatment is the best one) via transformations of</span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a>the MCMC samples from the posterior distribution.</span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a>TBD: Further topics might include including observational data (aka real-world </span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a>Exploiting that some drugs are in the same class, that some arms are different</span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a>doses of the same drug, or when we have subgroup results from the same study.</span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-611"><a href="#cb20-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Excercise 1</span></span>
<span id="cb20-612"><a href="#cb20-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a>We will use the data on the occurrence of malignancy anti-tumour necrosis </span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a>factor (anti-TNF) drugs used in the paper by @Warren2014. We have information </span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a>for each arm of 13 studies of three different anti-TNF drugs (etanercept, </span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a>adalimumab and infliximab) on how many patients developed a malignancy <span class="in">`y`</span> out</span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a>of the total number of patients in an arm <span class="in">`n`</span>. It is common in drug development</span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a>to simplistically reduce what is in truth a time-to-event process of adverse</span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a>event occurrence into a binomial problem. In practice, we should be cautious</span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a>about this simplification, because differential drop-out could lead to biased</span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>conclusions and we will by necessaity get variation in effect measures for</span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a>binomial outcomes across studies of different duration even if the time-to-event</span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a>distributions are identical across studies.</span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a>antiTNF <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-629"><a href="#cb20-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">study =</span> <span class="fu">c</span>(<span class="st">"Ericson (1999)"</span>, <span class="st">"Ericson (1999)"</span>, <span class="st">"Ericson (1999)"</span>, </span>
<span id="cb20-630"><a href="#cb20-630" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Moreland (1999)"</span>, <span class="st">"Moreland (1999)"</span>, <span class="st">"Moreland (1999)"</span>, </span>
<span id="cb20-631"><a href="#cb20-631" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Genovese (2002)"</span>, <span class="st">"Genovese (2002)"</span>, <span class="st">"Genovese (2002)"</span>, </span>
<span id="cb20-632"><a href="#cb20-632" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Combe (2006)"</span>, <span class="st">"Combe (2006)"</span>, <span class="st">"Van der Heijde (2006)"</span>, </span>
<span id="cb20-633"><a href="#cb20-633" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van der Heijde (2006)"</span>, <span class="st">"Weisman (2007)/Baumgartner (2004)"</span>, </span>
<span id="cb20-634"><a href="#cb20-634" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weisman (2007)/Baumgartner (2004)"</span>, <span class="st">"Furst (2003)"</span>, <span class="st">"Furst (2003)"</span>, </span>
<span id="cb20-635"><a href="#cb20-635" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Weinblatt (2003)"</span>, </span>
<span id="cb20-636"><a href="#cb20-636" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Weinblatt (2003)"</span>, <span class="st">"Keystone (2004)"</span>, <span class="st">"Keystone (2004)"</span>, </span>
<span id="cb20-637"><a href="#cb20-637" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Van de Putte (2004)"</span>, </span>
<span id="cb20-638"><a href="#cb20-638" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Van de Putte (2004)"</span>, <span class="st">"Breedveld (2006)"</span>, <span class="st">"Breedveld (2006)"</span>, </span>
<span id="cb20-639"><a href="#cb20-639" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Maini (2004)"</span>, <span class="st">"Maini (2004)"</span>, <span class="st">"Maini (2004)"</span>, <span class="st">"St Clair (2004)"</span>, </span>
<span id="cb20-640"><a href="#cb20-640" aria-hidden="true" tabindex="-1"></a>            <span class="st">"St Clair (2004)"</span>, <span class="st">"St Clair (2004)"</span>), </span>
<span id="cb20-641"><a href="#cb20-641" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, </span>
<span id="cb20-642"><a href="#cb20-642" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, </span>
<span id="cb20-643"><a href="#cb20-643" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, <span class="st">"Control"</span>, <span class="st">"Etanercept"</span>, </span>
<span id="cb20-644"><a href="#cb20-644" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb20-645"><a href="#cb20-645" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb20-646"><a href="#cb20-646" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Adalimumab"</span>, <span class="st">"Adalimumab"</span>, <span class="st">"Control"</span>, <span class="st">"Adalimumab"</span>, </span>
<span id="cb20-647"><a href="#cb20-647" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Control"</span>, <span class="st">"Infliximab"</span>, <span class="st">"Infliximab"</span>, <span class="st">"Control"</span>, <span class="st">"Infliximab"</span>, </span>
<span id="cb20-648"><a href="#cb20-648" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Infliximab"</span>), </span>
<span id="cb20-649"><a href="#cb20-649" aria-hidden="true" tabindex="-1"></a>  <span class="at">regimen =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="st">"10 mg qw or 25 mg qw or 10 mg biw"</span>, <span class="cn">NA</span>, </span>
<span id="cb20-650"><a href="#cb20-650" aria-hidden="true" tabindex="-1"></a>              <span class="st">"25 mg biw"</span>, <span class="st">"10 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="st">"10 mg biw"</span>, <span class="cn">NA</span>, </span>
<span id="cb20-651"><a href="#cb20-651" aria-hidden="true" tabindex="-1"></a>              <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"25 mg biw"</span>, <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, </span>
<span id="cb20-652"><a href="#cb20-652" aria-hidden="true" tabindex="-1"></a>              <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, <span class="st">"20 mg eow"</span>, <span class="st">"80 mg eow"</span>, <span class="cn">NA</span>, </span>
<span id="cb20-653"><a href="#cb20-653" aria-hidden="true" tabindex="-1"></a>              <span class="st">"20 mg qw or 40 mg eow"</span>, <span class="cn">NA</span>, <span class="st">"20 mg qw or 40 mg eow"</span>, </span>
<span id="cb20-654"><a href="#cb20-654" aria-hidden="true" tabindex="-1"></a>              <span class="st">"20 mg eow"</span>, <span class="st">"40 mg qw"</span>, <span class="cn">NA</span>, <span class="st">"40 mg eow"</span>, <span class="cn">NA</span>, <span class="st">"3 mg/kg q8w"</span>, </span>
<span id="cb20-655"><a href="#cb20-655" aria-hidden="true" tabindex="-1"></a>              <span class="st">"3 mg/kg q4w or 10 mg/kg q8w or 10 mg/kg q4w"</span>, <span class="cn">NA</span>, <span class="st">"3 mg/kg q8w"</span>, </span>
<span id="cb20-656"><a href="#cb20-656" aria-hidden="true" tabindex="-1"></a>              <span class="st">"6 mg/q8w"</span>), </span>
<span id="cb20-657"><a href="#cb20-657" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, </span>
<span id="cb20-658"><a href="#cb20-658" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, </span>
<span id="cb20-659"><a href="#cb20-659" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Rec"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, <span class="st">"High"</span>, <span class="cn">NA</span>, <span class="st">"Rec"</span>, </span>
<span id="cb20-660"><a href="#cb20-660" aria-hidden="true" tabindex="-1"></a>           <span class="st">"High"</span>), </span>
<span id="cb20-661"><a href="#cb20-661" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">105</span>L, <span class="dv">111</span>L, <span class="dv">343</span>L, <span class="dv">80</span>L, <span class="dv">78</span>L, <span class="dv">76</span>L, <span class="dv">217</span>L, <span class="dv">207</span>L, <span class="dv">208</span>L, <span class="dv">50</span>L, <span class="dv">204</span>L, <span class="dv">228</span>L, </span>
<span id="cb20-662"><a href="#cb20-662" aria-hidden="true" tabindex="-1"></a>        <span class="dv">454</span>L, <span class="dv">269</span>L, <span class="dv">266</span>L, <span class="dv">318</span>L, <span class="dv">318</span>L, <span class="dv">62</span>L, <span class="dv">67</span>L, <span class="dv">69</span>L, <span class="dv">73</span>L, <span class="dv">200</span>L, <span class="dv">419</span>L, <span class="dv">110</span>L, </span>
<span id="cb20-663"><a href="#cb20-663" aria-hidden="true" tabindex="-1"></a>        <span class="dv">225</span>L, <span class="dv">106</span>L, <span class="dv">103</span>L, <span class="dv">257</span>L, <span class="dv">542</span>L, <span class="dv">88</span>L, <span class="dv">86</span>L, <span class="dv">254</span>L, <span class="dv">291</span>L, <span class="dv">372</span>L, <span class="dv">377</span>L), </span>
<span id="cb20-664"><a href="#cb20-664" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">2</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L, <span class="dv">5</span>L, <span class="dv">5</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">10</span>L, <span class="dv">2</span>L, <span class="dv">2</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L, <span class="dv">0</span>L, </span>
<span id="cb20-665"><a href="#cb20-665" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">8</span>L, <span class="dv">1</span>L, <span class="dv">2</span>L,  <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">4</span>L, <span class="dv">6</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">8</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">4</span>L))</span>
<span id="cb20-666"><a href="#cb20-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-667"><a href="#cb20-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-668"><a href="#cb20-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-669"><a href="#cb20-669" aria-hidden="true" tabindex="-1"></a>If we look at the data, we can see that the proportion of patients with an </span>
<span id="cb20-670"><a href="#cb20-670" aria-hidden="true" tabindex="-1"></a>event is quite low (&lt;4\%) across all studies and arms. I.e. we are in a rare</span>
<span id="cb20-671"><a href="#cb20-671" aria-hidden="true" tabindex="-1"></a>event setting, where a Bayesian approach with sensibly chosen priors might be </span>
<span id="cb20-672"><a href="#cb20-672" aria-hidden="true" tabindex="-1"></a>helpful.</span>
<span id="cb20-673"><a href="#cb20-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-676"><a href="#cb20-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-677"><a href="#cb20-677" aria-hidden="true" tabindex="-1"></a>antiTNF <span class="sc">%&gt;%</span></span>
<span id="cb20-678"><a href="#cb20-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">study =</span> <span class="fu">factor</span>(study),</span>
<span id="cb20-679"><a href="#cb20-679" aria-hidden="true" tabindex="-1"></a>         <span class="at">arm =</span> <span class="fu">paste0</span>(treatment, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(dose),<span class="st">""</span>,<span class="fu">paste0</span>(<span class="st">" "</span>,dose)))) <span class="sc">%&gt;%</span></span>
<span id="cb20-680"><a href="#cb20-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>study, <span class="at">y=</span>y<span class="sc">/</span>n, </span>
<span id="cb20-681"><a href="#cb20-681" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill=</span>arm, </span>
<span id="cb20-682"><a href="#cb20-682" aria-hidden="true" tabindex="-1"></a>             <span class="at">group=</span>arm,</span>
<span id="cb20-683"><a href="#cb20-683" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.025</span>, <span class="at">shape1=</span>y, <span class="at">shape2=</span><span class="dv">1</span><span class="sc">+</span>n<span class="sc">-</span>y),</span>
<span id="cb20-684"><a href="#cb20-684" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax=</span><span class="fu">qbeta</span>(<span class="at">p=</span><span class="fl">0.975</span>, <span class="at">shape1=</span>y<span class="sc">+</span><span class="dv">1</span>, <span class="at">shape2=</span>n<span class="sc">-</span>y))) <span class="sc">+</span></span>
<span id="cb20-685"><a href="#cb20-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb20-686"><a href="#cb20-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb20-687"><a href="#cb20-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb20-688"><a href="#cb20-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="fu">guide_legend</span>(<span class="at">ncol=</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb20-689"><a href="#cb20-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb20-690"><a href="#cb20-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-691"><a href="#cb20-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-692"><a href="#cb20-692" aria-hidden="true" tabindex="-1"></a>Try fitting models of increasing complexity (slightly different to those done </span>
<span id="cb20-693"><a href="#cb20-693" aria-hidden="true" tabindex="-1"></a>in the @Warren2014 paper, which you could also choose to reproduce):</span>
<span id="cb20-694"><a href="#cb20-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-695"><a href="#cb20-695" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A simple meta-analysis of anti-TNF therapy vs. non-anti-TNF controls. </span>
<span id="cb20-696"><a href="#cb20-696" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A network meta-analysis with each anti-TNF drug having a separate fixed </span>
<span id="cb20-697"><a href="#cb20-697" aria-hidden="true" tabindex="-1"></a>treatment effects parameter, but ignoring informaiton on doses and regimens.</span>
<span id="cb20-698"><a href="#cb20-698" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>A network meta-analysis that treats all unique combinations of drug and</span>
<span id="cb20-699"><a href="#cb20-699" aria-hidden="true" tabindex="-1"></a>dose/regimen as a separate treatment.</span>
<span id="cb20-700"><a href="#cb20-700" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>A network meta-analysis that assumes that each drug may have a different </span>
<span id="cb20-701"><a href="#cb20-701" aria-hidden="true" tabindex="-1"></a>effect on malignancy with this effect being monotonic across doses. Note</span>
<span id="cb20-702"><a href="#cb20-702" aria-hidden="true" tabindex="-1"></a>the <span class="in">`mo()`</span> notation provided by <span class="in">`brms`</span> to define monotonic effects. Look</span>
<span id="cb20-703"><a href="#cb20-703" aria-hidden="true" tabindex="-1"></a>into borrowing information about the maximum effect across drugs.</span>
<span id="cb20-704"><a href="#cb20-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-705"><a href="#cb20-705" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!---</span></span>
<span id="cb20-706"><a href="#cb20-706" aria-hidden="true" tabindex="-1"></a><span class="al">###</span><span class="co"> Excercise 2</span></span>
<span id="cb20-707"><a href="#cb20-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-708"><a href="#cb20-708" aria-hidden="true" tabindex="-1"></a><span class="co">**It would be good to have another example that does not involve binomial data.**</span></span>
<span id="cb20-709"><a href="#cb20-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-710"><a href="#cb20-710" aria-hidden="true" tabindex="-1"></a><span class="co">---&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script>videojs(video_shortcode_videojs_video1);</script>




</body></html>