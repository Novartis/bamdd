<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Björn Holzhauer - bjoern.holzhauer@novartis.com">
<meta name="author" content="Sebastian Weber - sebastian.weber@novartis.com">

<title>5&nbsp; Meta-analysis to estimate treatment effects – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/02ac_meta_analysis_strata.html" rel="next">
<link href="../src/02a_meta_analysis.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b619e7580ba2a849d98fc8631a679bb4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="../resources/mathjax/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02ab_meta_analysis_trtdiff.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Parallel computation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">5.1</span> Background</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">5.2</span> Data</a></li>
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description"><span class="header-section-number">5.3</span> Model description</a>
  <ul class="collapse">
  <li><a href="#fixed--and-random-effects-meta-analysis" id="toc-fixed--and-random-effects-meta-analysis" class="nav-link" data-scroll-target="#fixed--and-random-effects-meta-analysis"><span class="header-section-number">5.3.1</span> Fixed- and random-effects meta-analysis</a></li>
  <li><a href="#with-data-from-each-arm-as-an-input" id="toc-with-data-from-each-arm-as-an-input" class="nav-link" data-scroll-target="#with-data-from-each-arm-as-an-input"><span class="header-section-number">5.3.2</span> With data from each arm as an input</a></li>
  <li><a href="#what-to-do-when-a-normal-approximation-is-not-appropriate" id="toc-what-to-do-when-a-normal-approximation-is-not-appropriate" class="nav-link" data-scroll-target="#what-to-do-when-a-normal-approximation-is-not-appropriate"><span class="header-section-number">5.3.3</span> What to do when a normal approximation is not appropriate?</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">5.4</span> Implementation</a>
  <ul class="collapse">
  <li><a href="#meta-analysis-with-treatment-effects-as-inputs" id="toc-meta-analysis-with-treatment-effects-as-inputs" class="nav-link" data-scroll-target="#meta-analysis-with-treatment-effects-as-inputs"><span class="header-section-number">5.4.1</span> Meta-analysis with treatment effects as inputs</a></li>
  <li><a href="#meta-analysis-with-data-from-each-arm-as-inputs" id="toc-meta-analysis-with-data-from-each-arm-as-inputs" class="nav-link" data-scroll-target="#meta-analysis-with-data-from-each-arm-as-inputs"><span class="header-section-number">5.4.2</span> Meta-analysis with data from each arm as inputs</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">5.5</span> Results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5.6</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02ab_meta_analysis_trtdiff.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-map-treat-effects" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Björn Holzhauer - <a href="mailto:bjoern.holzhauer@novartis.com" class="email">bjoern.holzhauer@novartis.com</a> </p>
             <p>Sebastian Weber - <a href="mailto:sebastian.weber@novartis.com" class="email">sebastian.weber@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>To run the R code of this section please ensure to load these libraries first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(meta)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">979356</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="background" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="background"><span class="header-section-number">5.1</span> Background</h2>
<p>Meta-analyses have become a key tool of evidence based medicine (<a href="https://training.cochrane.org/handbook/current/chapter-01#section-1-2">Higgins and Green, 2011, Section 1.2.2</a>) for when we have multiple studies that address the same (or closely related) question(s). Each study may not be able to conclusively answer these questions on its own or the results may vary across the studies. In this scenario, a meta-analysis can quantitatively combine the results of these multiple studies to provide an overall result. Literally, a meta-analysis is a statistical analysis of the analysis results from individual studies (for the purpose of combining the results) (<a href="https://doi.org/10.3102%2F0013189X005010003">Glass, 1976</a>).</p>
<p>One of most common types of meta-analysis in evidence based medicine is that of treatment effects estimated from randomized controlled trials. Meta-analyses of treatment effects from randomized controlled trials importantly respect within study randomization (“analyze as you randomize”). In contrast, simply pooling data from all trial arms ignoring from what study they come, is usually inappropriate and can lead to wildly inappropriate conclusions.</p>
<p>In this section we focus on meta-analyses for assessing treatment effects, but meta-analytic methods can be used for combining data across studies for many other purposes. For example, in the next section we willcover predicting control group outcomes for new trials from historical control groups of historical trials. Meta-analyses can be conducted using treatment differences, using outcomes from each trial arm or using individual patient data. We will illustrate all of these approaches.</p>
<p>In this section we focus on how to conduct meta-analysis in <code>brms</code>, but ignore a wide range of other important topics. These include the selection of trials for inclusion in meta-analyses, how to handle unavailabile study results, the potential for there to be studies that we are not aware of, and indirect treatment comparisons using network meta-analysis. These topics are covered in-depth in the <a href="https://training.cochrane.org/handbook/current/">Cochrane handbook for systematic reviews of interventions</a>, as well as in the <a href="https://dx.doi.org/10.1002/9780470743386">book by Borenstein et al.&nbsp;(2009)</a>.</p>
</section>
<section id="data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="data"><span class="header-section-number">5.2</span> Data</h2>
<p>Let us look at a meta-analysis for the effect of <a href="https://en.wikipedia.org/wiki/SGLT2_inhibitor">sodium-glucose transport protein 2 (SGLT-2) inhibitors</a> on major adverse cardiovascular events (MACE). MACE is a composite endpoint defined by the occurrence of either cardiovascular death, myocardial infarction or stroke. It is usually analyzed using time-to-first-event methods. We will use the data from all 7 SGLT-2 inhibitor trials in the <a href="https://doi.org/10.1007/s10741-021-10083-z">meta-analysis of Barbarawi et al.</a>, for which MACE results have been published. This example lets us try out different approaches and input data formats.</p>
<p>The first way of inputting data that we will look at is using estimated treatment differences from each study and their standard erorrs. Here, the treatment effect estimate from each study is a hazard ratio from a Cox regression model. The figure below shows the estimate hazard ratios with their 95% confidence intervals from each of the 7 studies with a log-scaled x-axis. For hazard ratios (and similarly for odds and rate ratios) it is preferable to work on the log-scale, because using a normal approximation to the sampling distribution of the estimator works a lot better for smaller sample sizes. Thus, we work with log-hazard ratios and their standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sglt2_hr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">trial =</span> <span class="fu">c</span>(<span class="st">"DECLARE–TIMI 58"</span>, <span class="st">"EMPA-REG OUTCOME"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"CANVAS"</span>, <span class="st">"CANVAS-R"</span>, <span class="st">"CREDENCE"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"SCORED"</span>, <span class="st">"VERTIS CV"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">drug =</span> <span class="fu">c</span>(<span class="st">"dapagliflozin"</span>, <span class="st">"empagliflozin"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"canagliflozin"</span>, <span class="st">"canagliflozin"</span>, <span class="st">"canagliflozin"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"sotagliflozin"</span>, <span class="st">"ertugliflozin"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">studyno =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.86</span>, <span class="fl">0.88</span>, <span class="fl">0.82</span>, <span class="fl">0.80</span>, <span class="fl">0.77</span>, <span class="fl">0.97</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr_lcl =</span> <span class="fu">c</span>(<span class="fl">0.84</span>, <span class="fl">0.74</span>, <span class="fl">0.75</span>, <span class="fl">0.66</span>, <span class="fl">0.67</span>, <span class="fl">0.65</span>, <span class="fl">0.85</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr_ucl =</span> <span class="fu">c</span>(<span class="fl">1.03</span>, <span class="fl">0.99</span>, <span class="fl">1.03</span>, <span class="fl">1.01</span>, <span class="fl">0.95</span>, <span class="fl">0.91</span>, <span class="fl">1.11</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(studyno)) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">studyno =</span> <span class="fu">factor</span>(studyno, <span class="at">levels=</span>studyno, <span class="at">labels=</span>trial),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_hr =</span> <span class="fu">log</span>(hr),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_hr_stderr =</span> (<span class="fu">log</span>(hr_ucl)<span class="sc">-</span><span class="fu">log</span>(hr_lcl))<span class="sc">/</span><span class="dv">2</span><span class="sc">/</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>sglt2_hr <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>hr, <span class="at">y=</span>studyno, <span class="at">xmin=</span>hr_lcl, <span class="at">xmax=</span>hr_ucl, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span>drug, <span class="at">label=</span>drug)) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>.<span class="sc">%&gt;%</span> <span class="fu">filter</span>(studyno <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CANVAS"</span>, <span class="st">"DECLARE–TIMI 58"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"EMPA-REG OUTCOME"</span>, <span class="st">"SCORED"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"VERTIS CV"</span>))) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hazard ratio for MACE (&lt;1 indicates</span><span class="sc">\n</span><span class="st">hazard rate reduction vs. placebo)"</span>) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Study"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ab_meta_analysis_trtdiff_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The second type of input to meta-analyses that we will use is outcomes for each treatment group. While meta-analyses more commonly use treatment differences as an input, we do not have to use that approach. Instead, we can use outcomes from each treatment group in each study as an input. Often, the two approaches are essentially equivalent, but especially when there is more than two treatment groups per study an approach using treatment differences does need modification in order to correctly capture the correlation of multiple treatment differences compared with the same control group. In contrast, an arm-based approach will automatically reflect this correlation.</p>
<p>In the SGLT-2 inhibitor case study, we will assume that event times approximately follow an exponential distribution, which allows us to conduct an arm-based meta-analysis with the number of cases per arm and the total follow-up time to firstevent or censoring per arm as inputs. These are the sufficient statistics for exponentially distributed event times with right-censoring.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="ot">&lt;-</span> <span class="st">"record, study, trialid, studyno, drugname, treatment, cases, patients, py_to_evt_or_cens, cases_per_py</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">1,CANVAS,NCT01032629, 1,canagliflozin, 1, 425, 2888, 15799.25651, 0.0269</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">2,CANVAS,NCT01032629, 1,canagliflozin, 0, 233, 1442, 7664.473684, 0.0304</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">3,CANVAS-R,NCT01989754, 2,canagliflozin, 1, 160, 2907, 5904.059041, 0.0271</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">4,CANVAS-R,NCT01989754, 2,canagliflozin, 0, 193, 2905, 5848.484848, 0.0330</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">5,CREDENCE,NCT02065791, 3,canagliflozin, 1, 217, 2202, 5607.235142, 0.0387</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">6,CREDENCE,NCT02065791, 3,canagliflozin, 0, 269, 2199, 5523.613963, 0.0487</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">7,EMPA-REG OUTCOME,NCT01131676, 4,empagliflozin, 1, 490, 4687, 13102, 0.0374</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">8,EMPA-REG OUTCOME,NCT01131676, 4,empagliflozin, 0, 282, 2333, 6424, 0.0439</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">9,DECLARE–TIMI 58,NCT01730534, 5,dapagliflozin, 1, 756, 8582, 33451.32743, 0.0226</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">10,DECLARE–TIMI 58,NCT01730534, 5,dapagliflozin, 0, 803, 8578, 33181.81818, 0.0242</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">11,SCORED,NCT03315143, 6,sotagliflozin, 1, 343, 5292, 7145.833333, 0.048</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">12,SCORED,NCT03315143, 6,sotagliflozin, 0, 442, 5292, 7015.873016, 0.063</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">13,VERTIS CV,NCT01986881, 7,ertugliflozin, 1, 653, 5493, 16743.58974, 0.039</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="st">14,VERTIS CV,NCT01986881, 7,ertugliflozin, 0, 327, 2745, 8175, 0.04"</span> <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="at">text=</span>.) <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment, <span class="at">levels=</span><span class="dv">0</span>L<span class="sc">:</span><span class="dv">1</span>L, </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"SGLT2 inhibitor"</span>)))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(studyno)) <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">studyno =</span> <span class="fu">factor</span>(studyno, <span class="at">levels=</span>studyno, <span class="at">labels=</span>study)) <span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cases_per_py, <span class="at">y=</span>studyno, <span class="at">col=</span>treatment, <span class="at">label=</span>treatment)) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>.<span class="sc">%&gt;%</span> <span class="fu">filter</span>(studyno<span class="sc">==</span><span class="st">"EMPA-REG OUTCOME"</span>)) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Exponential hazard rate for MACE"</span>) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Study"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ab_meta_analysis_trtdiff_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let us also briefly illustrate why naively pooling data instead of using meta-analytic approaches is inappropriate. Take e.g.&nbsp;the CANVAS and CANVAS-R studies, which both have hazard ratios &lt;1 favoring canagliflozin over placebo. A naive pooling of these two studies followed by calculating the proportion of patients with an event would seem to indicate that placebo performs better! This effect is called Simpson’s paradox.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(study, <span class="st">"CANVAS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Treatment=</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Proportion of cases</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(cases)<span class="sc">/</span><span class="fu">sum</span>(patients)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Treatment</th>
<th style="text-align: right;">Proportion of cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Placebo</td>
<td style="text-align: right;">0.098</td>
</tr>
<tr class="even">
<td style="text-align: left;">SGLT2 inhibitor</td>
<td style="text-align: right;">0.101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="model-description" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="model-description"><span class="header-section-number">5.3</span> Model description</h2>
<section id="fixed--and-random-effects-meta-analysis" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="fixed--and-random-effects-meta-analysis"><span class="header-section-number">5.3.1</span> Fixed- and random-effects meta-analysis</h3>
<p>Taking a Bayesian approach with at least weakly informative priors tends to be very useful to avoid various issues that arise with frequentist methods e.g.&nbsp;when there are very few studies, or no events in one or all arms of a study in a meta-analysis of event occurrence. Commonly, two types of meta-analysis model are distinguished: fixed- and random-effects meta-analysis models. Both can expressed as regression models. Fitting such regression models is straightforward in <code>brms</code>. While this is even arguably useful in simple situations due to the understanding and insights it provides, its true value lies in making it easier to deal with more complex situations. E.g. when we wish to adjust estimates or predictions for some study-level covariates (“meta-regression”), we simply add an additional term to our meta-analytic regression model.</p>
<p>A “fixed-effects meta analysis” assumes that there is a single fixed parameter that describes the treatment effect in all trials. For example, the very simple inverse-variance approach uses estimates <span class="math inline">\(\hat{\delta}_i\)</span> from each trial <span class="math inline">\(i=1,\ldots,I\)</span> and their standard errors <span class="math inline">\(\text{SE}(\hat{\delta}_i)\)</span> as its inputs, and results in an estimate that is the weighted mean of the estimates from each study with the weights of each study proportional to the inverse of the squared standard errors <span class="math display">\[\hat{\delta}_\text{inv.-var.} = \frac{1}{{\sum_{j=1}^I \frac{1}{\text{SE}(\hat{\delta}_j)^{2}}}} \times \sum_{i=1}^I \frac{\hat{\delta}_i}{\text{SE}(\hat{\delta}_i)^2}.\]</span></p>
<p>Expressed as a regression model, the inverse-variance approach corresponds to a regression model for the observed treatment effect estimates that only has an intercept term, i.e.: <span class="math display">\[\text{E} \hat{\delta}_i = \delta\]</span> with <span class="math inline">\(\hat{\delta}_i \sim N(\text{E} \hat{\delta}_i, \text{SE}(\hat{\delta}_i))\)</span> (conditioning on the observed value of the standard error). In this model, inference is about <span class="math inline">\(\delta\)</span>. In <code>brms</code> formula syntax, this model can be specified as <code>log_hr | se(log_hr_stderr) ~ 1</code>.</p>
<p>In contrast, a “random-effects meta analysis” assumes that there the parameter that describes the treatment effect varies across trials. It is commonly assumed that it varies according to a normal distribution with unknown mean and standard deviation. Such an approach will give greater weight to studies with larger standard errors than the inverse-variance approach does.</p>
<p>One common method for random-effects meta-analysis is the DerSimonian and Laird method (DerSimonian 1986). Expressed as a regression model, this method corresponds to a regression model for the observed treatment effect estimates that has an intercept term and a random study effect on the intercept, i.e.: <span class="math display">\[\text{E} \hat{\delta}_i = \mu + \nu_i\]</span> with <span class="math inline">\(\nu_i \sim N(0, \tau)\)</span> for some <span class="math inline">\(\tau&gt;0\)</span> and <span class="math inline">\(\hat{\delta}_i \sim N(\text{E} \hat{\delta}_i, \text{SE}(\hat{\delta}_i))\)</span> for <span class="math inline">\(i=1, \ldots, I\)</span> (again, conditioning on the observed value of the standard error). In <code>brms</code>formula syntax, this model can be expressed as <code>log_hr | se(log_hr_stderr) ~ 1 + (1|study)</code>.</p>
<p>In this model, inference is usually made for <span class="math inline">\(\mu\)</span>, although arguably the effect <span class="math inline">\(\delta^* \sim N(\mu, \tau)\)</span> in a new population drawn from the distribution of study populations may also be of interest.</p>
</section>
<section id="with-data-from-each-arm-as-an-input" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="with-data-from-each-arm-as-an-input"><span class="header-section-number">5.3.2</span> With data from each arm as an input</h3>
<p>When we have data from each arm as an input, we can use a fixed-effects approach with a regression model for the observed outcomes in each arm that has fixed study and treatment effects: <span class="math display">\[\text{E} \hat{\theta}_j = \sum_{i=1}^I \alpha_i \times 1\{\text{study}_j=i\} + \delta \times 1\{\text{treatment}_j = 1\}\]</span> with <span class="math inline">\(\hat{\theta}_i \sim N(\text{E} \hat{\theta}_i, \text{SE}(\hat{\theta}_i))\)</span>. The expected control group outcome <span class="math inline">\(\alpha_i\)</span> for each study is a nuissance parameter and we aim to make inference about <span class="math inline">\(\delta\)</span>. In <code>brms</code> formula syntax this model can be expressed as <code>theta | se(se_theta) ~ 0 + study + treatment</code>.</p>
<p>In a frequentist setting, there is only value in using this input data format, if we have more than two treatments, because different comparisons versus the same control group from the same study are correlated and this approach can automatically reflects this. The generalization of the regression equation above is straightforward.</p>
<p>When we have data from each arm as an input, we can implement a random-effects approach via a regression model for the observed outcomes in each arm that has fixed study effects and random treatment effects: <span class="math display">\[\text{E} \hat{\theta}_j = \sum_{i=1}^I \alpha_i \times 1\{\text{study}_j=i\} + \left( \mu + \sum_{i=1}^I \nu_i \times 1\{\text{study}_j=i\} \right) \times 1\{\text{treatment}_j = 1\}\]</span> with <span class="math inline">\(\hat{\theta}_i \sim N(\text{E} \hat{\theta}_i, \text{SE}(\hat{\theta}_i))\)</span>. In theory, the <code>brms</code> formula syntax for such a model should be something like <code>theta | se(se_theta) ~ 0 + study + (treatment|study)</code>, but this does not seem to do quite what we want, so we implement something else below.</p>
</section>
<section id="what-to-do-when-a-normal-approximation-is-not-appropriate" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="what-to-do-when-a-normal-approximation-is-not-appropriate"><span class="header-section-number">5.3.3</span> What to do when a normal approximation is not appropriate?</h3>
<p>In the previous subsection, we assumed that it is a good approximation to assume that least-squares-means for each treatment group or treatment differences have a normal sampling distribution. That is often the case, especially after suitable transformations such as the log-transformation for odds ratios, rate ratios, hazard ratios, event rates, odds, and hazard rates. However, making this assumption is not always appropriate. Examples when different approaches are preferable include:</p>
<ul>
<li><p>sparse binomial, time-to-event or count outcomes (e.g.&nbsp;arms in some studies have a low number of events or no events - this is one of the most common scenarios),</p></li>
<li><p>the published information does not lend itself easily towards being represented as an estimate with a standard error (e.g.&nbsp;data consisting of Kaplan-Meier curves for each treatment arm),</p></li>
<li><p>correlations in the data need to be reflected appropriately (e.g. meta-analysis of multivariate data such as data from multiple timepoints, or joint meta-analysis of diagnostic sensitivity and specificity), or</p></li>
<li><p>meta-analysis of individual-patient data accounting for covariates.</p></li>
</ul>
<p>In these situations, there are a number of ideas we can conveniently use in a regression setting.</p>
<ul>
<li><p>Using a likelihood corresponding to the individual patient data likelihood when sufficient statistics are available. Examples include:</p>
<ul>
<li><p>When number of patients with an event <span class="math inline">\(Y_{ij}\)</span> and the total number of patients <span class="math inline">\(N_{ij}\)</span> are available for each arm <span class="math inline">\(j\)</span> of study <span class="math inline">\(i\)</span>, we could assume that <span class="math inline">\(Y_{ij} \sim \text{Bin}(\pi_{ij}, N_{ij})\)</span> and work with a regression equation for <span class="math inline">\(\text{logit}(\pi_{ij})\)</span>. For this, <code>brms</code> offers the <code>formula = cases | trials(patients) = regression terms</code> syntax in combination with specifying <code>family = binomial(link="logit")</code>.</p></li>
<li><p>When the number of patients with at least an event <span class="math inline">\(Y_{ij}\)</span> and the total time until first event or censoring <span class="math inline">\(t_{ij}\)</span> are available for exponentially distributed time-to-event data, we can use the the log-likelihood is - up to a constant - the same as when we assume <span class="math inline">\(Y_{ij} \sim \text{Poisson}(\lambda_{ij} t_{ij})\)</span> and work with Poisson regression with a <span class="math inline">\(\log t_{ij}\)</span> offset. For this, <code>brms</code> offers the <code>formula = cases | rate(followuptime) ~ regression terms</code> syntax in combination with specifying <code>family = poisson(link="log")</code>.</p></li>
<li><p>When the number of total events experienced by all patients <span class="math inline">\(Y_{ij}\)</span> and the total time at risk of events for all patients <span class="math inline">\(t_{ij}\)</span> are available for Poisson distributed count data, we can use <span class="math inline">\(Y_{ij} \sim \text{Poisson}(\lambda_{ij} t_{ij})\)</span> and work with Poisson regression with a <span class="math inline">\(\log t_{ij}\)</span> offset. For this, <code>brms</code> offers the <code>formula = cases | rate(followuptime) ~ regression terms</code> syntax in combination with specifying <code>family = poisson(link="log")</code>. However, note that this is rarely appropriate, because in practice count data are nearly always over-dispersed compared to the Poisson distribution. In contrast, assuming an exponential distribution for the time-to-first-event seems to occasionally describe data from real trials reasonably well.</p></li>
</ul></li>
<li><p>For individual patient data, we would use a regression model that we would use to analyze each trial, but let all model terms other than the treatment effect differ between trials. Most typically, we would simply assume that there are completely different parameters for each trial. For regression coefficients, this is equivalent to having an interaction between them and the trial effect. For distributional parameters such as the residual standard deviation, we can use the specific syntax offered by <code>brms</code> to specify that they should differ by trial, e.g.&nbsp;for the residual standard deviation in a linear regression we can write <code>formula = bf(outcome ~ regression terms, sigma ~ 0 + trial), family = gaussian()</code> to specify this. For more details see the <a href="https://paul-buerkner.github.io/brms/articles/brms_distreg.html"><code>brms</code> vignette on distributional models</a>.</p></li>
<li><p>Using custom likelihood functions can also be an option.</p></li>
</ul>
</section>
</section>
<section id="implementation" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="implementation"><span class="header-section-number">5.4</span> Implementation</h2>
<section id="meta-analysis-with-treatment-effects-as-inputs" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="meta-analysis-with-treatment-effects-as-inputs"><span class="header-section-number">5.4.1</span> Meta-analysis with treatment effects as inputs</h3>
<p>We will first implement a Bayesian version of the “traditional” meta-analysis approach, where we use the estimates of a treatment effect and their standard errors as inputs. The <code>brms</code> code below performs a fixed-effects meta-analysis with log-hazard ratios and their standard errors as inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>brmfit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2_hr,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> log_hr <span class="sc">|</span> <span class="fu">se</span>(log_hr_stderr) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"Intercept"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.0 seconds.
Chain 2 finished in 0.0 seconds.
Chain 3 finished in 0.0 seconds.
Chain 4 finished in 0.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.0 seconds.
Total execution time: 0.8 seconds.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: log_hr | se(log_hr_stderr) ~ 1 
   Data: sglt2_hr (Number of observations: 7) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -0.13      0.03    -0.19    -0.08 1.00      959      832

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>This <code>brms</code> code performs a random-effects meta-analysis with log-hazard ratios and their standard errors as inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>brmfit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2_hr,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> log_hr <span class="sc">|</span> <span class="fu">se</span>(log_hr_stderr) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>studyno),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"Intercept"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"sd"</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.5 seconds.
Chain 2 finished in 0.4 seconds.
Chain 3 finished in 0.3 seconds.
Chain 4 finished in 0.3 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.4 seconds.
Total execution time: 1.9 seconds.</code></pre>
</div>
</div>
<p>As we noted before, there’s at least two ways of performing posterior inference after fitting the model above: 1. inference about the mean effect of the SGLT-2 inhibitors across studies, or 2. inference about the predicted effect in a new study drawn from the same distribution of studies as the studies under analysis. This difference becomes very clear when working in a Bayesian regression setting using <code>brms</code>, but is somewhat obscured when we use standard meta-analysis software.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: log_hr | se(log_hr_stderr) ~ 1 + (1 | studyno) 
   Data: sglt2_hr (Number of observations: 7) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~studyno (Number of levels: 7) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.07      0.05     0.00     0.19 1.00     1196     1647

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -0.14      0.05    -0.24    -0.05 1.00     1651      993

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.00      0.00     0.00     0.00   NA       NA       NA

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(<span class="at">object=</span>brmfit2, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata=</span><span class="fu">tibble</span>(<span class="at">studyno=</span><span class="st">"New study"</span>, <span class="at">log_hr_stderr=</span><span class="fl">10e-19</span>), </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">allow_new_levels=</span><span class="cn">TRUE</span>, <span class="at">sample_new_levels =</span> <span class="st">"gaussian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate Est.Error       Q2.5      Q97.5
[1,] -0.1373729 0.0957787 -0.3472731 0.05168975</code></pre>
</div>
</div>
</section>
<section id="meta-analysis-with-data-from-each-arm-as-inputs" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="meta-analysis-with-data-from-each-arm-as-inputs"><span class="header-section-number">5.4.2</span> Meta-analysis with data from each arm as inputs</h3>
<p>This <code>brms</code> code performs a fixed-effects meta-analysis with arm-based data as inputs. We now need to assume prior distributions for the placebo group log-hazard rate in each trial, for this we use an extremely wide Student-t prior with 3 degrees of freedom centered on <span class="math inline">\(-3\)</span>, because when exponentiated <span class="math inline">\(e^-3 \approx 0.05\)</span> corresponds to a plausible yearly event rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>brmfit3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> cases <span class="sc">|</span> <span class="fu">rate</span>(py_to_evt_or_cens) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study <span class="sc">+</span> treatment,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>, <span class="at">coef=</span><span class="st">"treatmentSGLT2inhibitor"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVAS"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVASMR"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCREDENCE"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyDECLARE–TIMI58"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyEMPAMREGOUTCOME"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studySCORED"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyVERTISCV"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>make[2]: warning: jobserver unavailable: using -j1.  Add '+' to parent make rule.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Start sampling</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.2 seconds.
Chain 2 finished in 0.2 seconds.
Chain 3 finished in 0.2 seconds.
Chain 4 finished in 0.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.2 seconds.
Total execution time: 1.1 seconds.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson 
  Links: mu = log 
Formula: cases | rate(py_to_evt_or_cens) ~ 0 + study + treatment 
   Data: sglt2 (Number of observations: 14) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
studyCANVAS                -3.49      0.04    -3.58    -3.40 1.00     3169
studyCANVASMR              -3.44      0.06    -3.55    -3.33 1.00     4175
studyCREDENCE              -3.07      0.05    -3.16    -2.98 1.00     3550
studyDECLARE–TIMI58        -3.69      0.03    -3.75    -3.64 1.00     3266
studyEMPAMREGOUTCOME       -3.15      0.04    -3.23    -3.07 1.00     2938
studySCORED                -2.83      0.04    -2.90    -2.75 1.00     3228
studyVERTISCV              -3.15      0.04    -3.22    -3.08 1.00     2555
treatmentSGLT2inhibitor    -0.13      0.03    -0.18    -0.08 1.00     1946
                        Tail_ESS
studyCANVAS                 2901
studyCANVASMR               3052
studyCREDENCE               2567
studyDECLARE–TIMI58         3104
studyEMPAMREGOUTCOME        2439
studySCORED                 2881
studyVERTISCV               3040
treatmentSGLT2inhibitor     2765

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>brmfit3 <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
  variable      mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 hazard ratio 0.877  0.877 0.0237 0.0242 0.839 0.916 1.000    1946.    2765.</code></pre>
</div>
</div>
<p>This <code>brms</code> code performs a random-effects meta-analysis with arm-based data as inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="ot">=</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">trtno =</span> <span class="dv">1</span>L<span class="sc">*</span>(treatment<span class="sc">==</span><span class="st">"SGLT2 inhibitor"</span>)),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> cases <span class="sc">|</span> <span class="fu">rate</span>(py_to_evt_or_cens) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study <span class="sc">+</span> treatment <span class="sc">+</span> (<span class="dv">0</span><span class="sc">+</span>trtno<span class="sc">|</span>study),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>, <span class="at">coef=</span><span class="st">"treatmentSGLT2inhibitor"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVAS"</span>,   <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVASMR"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCREDENCE"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyDECLARE–TIMI58"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyEMPAMREGOUTCOME"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studySCORED"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyVERTISCV"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"sd"</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">refresh =</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.9 seconds.
Chain 2 finished in 0.8 seconds.
Chain 3 finished in 1.0 seconds.
Chain 4 finished in 1.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.9 seconds.
Total execution time: 4.0 seconds.</code></pre>
</div>
</div>
<p>As before, we can easily obtain inference about the mean effect of the SGLT-2 inhibitors across studies or the predicted effect in a new study drawn from the same distribution of studies as the studies under analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hazard ratio</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: right;">0.934</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor <span class="sc">+</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_treatmentSGLT2inhibitor), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sd_study__trtno))) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hazard ratio</td>
<td style="text-align: right;">0.871</td>
<td style="text-align: right;">0.728</td>
<td style="text-align: right;">1.024</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="results" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="results"><span class="header-section-number">5.5</span> Results</h2>
<p>Let us combine all the results including also a standard frequentist analysis. As we can see, particularly when using log-hazard-ratios as our analysis inputs, the results of the different models are extremely similar. There seems to be substantial evidence that on average there is a benefit on MACE from SGLT-2 inhibitors in type 2 diabetes patients.</p>
<p>The uncertainty from random effects models is greater - especially when predicting for a new trial. When using arm-based inputs, the prior we put on the results for each arm appears to influence there results - perhaps we should make those rates exchangeable between trials to make a more data-informed decision on those rates?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(meta)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>frequentist_ma <span class="ot">=</span> <span class="fu">metagen</span>(<span class="at">data =</span> sglt2_hr,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sm =</span> <span class="st">"HR"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">TE=</span>log_hr,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seTE=</span>log_hr_stderr, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">studlab=</span>trial)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  brmfit1 <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Fixed effects - log-hazard ratios"</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>   brmfit2 <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - log-hazard ratios;inference on mean"</span>),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  brmfit2 <span class="sc">%&gt;%</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_Intercept), </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">mean=</span><span class="dv">0</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sd=</span>sd_studyno__Intercept))) <span class="sc">%&gt;%</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - log-hazard ratios;inference for new trial"</span>),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  brmfit3 <span class="sc">%&gt;%</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Fixed effects - rates by arm"</span>),</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - rates by arm; inference on mean"</span>),</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor <span class="sc">+</span> </span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_treatmentSGLT2inhibitor), </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sd_study__trtno))) <span class="sc">%&gt;%</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - rates by arm; inference for new trial"</span>),</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"Fixed effects - frequentist"</span>, <span class="st">"Random effects - frequentist"</span>),</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable=</span><span class="st">"hazard ratio"</span>,</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">median=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>TE.fixed, frequentist_ma<span class="sc">$</span>TE.random)), </span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">q5=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>lower.fixed, frequentist_ma<span class="sc">$</span>lower.random)), </span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">q95=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>upper.fixed, frequentist_ma<span class="sc">$</span>upper.random)))) <span class="sc">%&gt;%</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Method, variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - frequentist"</span><span class="sc">~</span><span class="dv">1</span>L,</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - log-hazard ratios"</span> <span class="sc">~</span> <span class="dv">2</span>L,</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - rates by arm"</span><span class="sc">~</span><span class="dv">3</span>L,</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - frequentist"</span><span class="sc">~</span><span class="dv">4</span>L,</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - log-hazard ratios;inference on mean"</span><span class="sc">~</span><span class="dv">5</span>L,</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - rates by arm; inference on mean"</span><span class="sc">~</span><span class="dv">6</span>L,</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - log-hazard ratios;inference for new trial"</span><span class="sc">~</span><span class="dv">7</span>L,</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - rates by arm; inference for new trial"</span><span class="sc">~</span><span class="dv">8</span>L,</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span><span class="sc">~</span><span class="dv">9</span>L)) <span class="sc">%&gt;%</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(method_class)) <span class="sc">%&gt;%</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method_class =</span> <span class="fu">factor</span>(method_class, <span class="at">levels=</span><span class="dv">8</span>L<span class="sc">:</span><span class="dv">1</span>L, <span class="at">labels=</span><span class="fu">gsub</span>(<span class="st">" - "</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, Method))) <span class="sc">%&gt;%</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>median, <span class="at">y=</span>method_class, <span class="at">xmin=</span>q5, <span class="at">xmax=</span>q95)) <span class="sc">+</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hazard ratio for MACE (&lt;1 indicates</span><span class="sc">\n</span><span class="st">hazard rate reduction vs. placebo)"</span>) <span class="sc">+</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02ab_meta_analysis_trtdiff_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.6</span> Conclusion</h2>
<p>As we saw, <code>brms</code> makes it extremely easy to fit various meta-analysis models. Looking at these from a regression perspective makes it easier to see their connections and makes the extension of meta-analysis to meta-regression seem like just one little logical step.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02a_meta_analysis.html" class="pagination-link" aria-label="Use of historical control data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/02ac_meta_analysis_strata.html" class="pagination-link" aria-label="Use of historical control data with stratification">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb32" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Björn Holzhauer - &lt;bjoern.holzhauer@novartis.com&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Sebastian Weber - &lt;sebastian.weber@novartis.com&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Meta-analysis to estimate treatment effects {#sec-map-treat-effects}</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these libraries first:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE}</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(meta)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">979356</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE, eval=TRUE}</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible to the reader additional setup steps, which are optional</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># {{&lt; include setup.R &gt;}}</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"setup.R"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>Meta-analyses have become a key tool of evidence based medicine ([Higgins</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>and Green, 2011, Section 1.2.2](https://training.cochrane.org/handbook/current/chapter-01#section-1-2)) for when we have multiple studies that</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>address the same (or closely related) question(s). Each study may not be</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>able to conclusively answer these questions on its own or the results</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>may vary across the studies. In this scenario, a meta-analysis can</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>quantitatively combine the results of these multiple studies to provide</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>an overall result. Literally, a meta-analysis is a statistical analysis</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>of the analysis results from individual studies (for the purpose of</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>combining the results) (<span class="co">[</span><span class="ot">Glass, 1976</span><span class="co">](https://doi.org/10.3102%2F0013189X005010003)</span>).</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>One of most common types of meta-analysis in evidence based medicine is</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>that of treatment effects estimated from randomized controlled trials.</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>Meta-analyses of treatment effects from randomized controlled trials</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>importantly respect within study randomization ("analyze as you</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>randomize"). In contrast, simply pooling data from all trial arms</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>ignoring from what study they come, is usually inappropriate and can</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>lead to wildly inappropriate conclusions.</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>In this section we focus on meta-analyses for assessing treatment</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>effects, but meta-analytic methods can be used for combining data across</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>studies for many other purposes. For example, in the next section we</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>willcover predicting control group outcomes for new trials from</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>historical control groups of historical trials. Meta-analyses can be</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>conducted using treatment differences, using outcomes from each trial</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>arm or using individual patient data. We will illustrate all of these</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>approaches.</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>In this section we focus on how to conduct meta-analysis in <span class="in">`brms`</span>, but</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>ignore a wide range of other important topics. These include the</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>selection of trials for inclusion in meta-analyses, how to handle</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>unavailabile study results, the potential for there to be studies that</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>we are not aware of, and indirect treatment comparisons using network</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>meta-analysis. These topics are covered in-depth in the [Cochrane</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>handbook for systematic reviews of interventions](https://training.cochrane.org/handbook/current/), as well as in the <span class="co">[</span><span class="ot">book by Borenstein et al. (2009)</span><span class="co">](https://dx.doi.org/10.1002/9780470743386)</span>.</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>Let us look at a meta-analysis for the effect of [sodium-glucose</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>transport protein 2 (SGLT-2)</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>inhibitors](https://en.wikipedia.org/wiki/SGLT2_inhibitor) on major</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>adverse cardiovascular events (MACE). MACE is a composite endpoint</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>defined by the occurrence of either cardiovascular death, myocardial</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>infarction or stroke. It is usually analyzed using time-to-first-event</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>methods. We will use the data from all 7 SGLT-2 inhibitor trials in the</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>[meta-analysis of Barbarawi et</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>al.](https://doi.org/10.1007/s10741-021-10083-z), for which MACE results</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>have been published. This example lets us try out different approaches</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>and input data formats.</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>The first way of inputting data that we will look at is using estimated</span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>treatment differences from each study and their standard erorrs. Here,</span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>the treatment effect estimate from each study is a hazard ratio from a</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>Cox regression model. The figure below shows the estimate hazard ratios</span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>with their 95% confidence intervals from each of the 7 studies with a</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>log-scaled x-axis. For hazard ratios (and similarly for odds and rate</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>ratios) it is preferable to work on the log-scale, because using a</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>normal approximation to the sampling distribution of the estimator works</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>a lot better for smaller sample sizes. Thus, we work with log-hazard</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>ratios and their standard errors.</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>sglt2_hr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">trial =</span> <span class="fu">c</span>(<span class="st">"DECLARE–TIMI 58"</span>, <span class="st">"EMPA-REG OUTCOME"</span>,</span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"CANVAS"</span>, <span class="st">"CANVAS-R"</span>, <span class="st">"CREDENCE"</span>, </span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"SCORED"</span>, <span class="st">"VERTIS CV"</span>),</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>                   <span class="at">drug =</span> <span class="fu">c</span>(<span class="st">"dapagliflozin"</span>, <span class="st">"empagliflozin"</span>,</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"canagliflozin"</span>, <span class="st">"canagliflozin"</span>, <span class="st">"canagliflozin"</span>,</span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"sotagliflozin"</span>, <span class="st">"ertugliflozin"</span>),</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>                   <span class="at">studyno =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr =</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.86</span>, <span class="fl">0.88</span>, <span class="fl">0.82</span>, <span class="fl">0.80</span>, <span class="fl">0.77</span>, <span class="fl">0.97</span>),</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr_lcl =</span> <span class="fu">c</span>(<span class="fl">0.84</span>, <span class="fl">0.74</span>, <span class="fl">0.75</span>, <span class="fl">0.66</span>, <span class="fl">0.67</span>, <span class="fl">0.65</span>, <span class="fl">0.85</span>),</span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>                   <span class="at">hr_ucl =</span> <span class="fu">c</span>(<span class="fl">1.03</span>, <span class="fl">0.99</span>, <span class="fl">1.03</span>, <span class="fl">1.01</span>, <span class="fl">0.95</span>, <span class="fl">0.91</span>, <span class="fl">1.11</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(studyno)) <span class="sc">%&gt;%</span></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">studyno =</span> <span class="fu">factor</span>(studyno, <span class="at">levels=</span>studyno, <span class="at">labels=</span>trial),</span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_hr =</span> <span class="fu">log</span>(hr),</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_hr_stderr =</span> (<span class="fu">log</span>(hr_ucl)<span class="sc">-</span><span class="fu">log</span>(hr_lcl))<span class="sc">/</span><span class="dv">2</span><span class="sc">/</span><span class="fu">qnorm</span>(<span class="fl">0.975</span>))</span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>sglt2_hr <span class="sc">%&gt;%</span></span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>hr, <span class="at">y=</span>studyno, <span class="at">xmin=</span>hr_lcl, <span class="at">xmax=</span>hr_ucl, </span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span>drug, <span class="at">label=</span>drug)) <span class="sc">+</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>.<span class="sc">%&gt;%</span> <span class="fu">filter</span>(studyno <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"CANVAS"</span>, <span class="st">"DECLARE–TIMI 58"</span>,</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"EMPA-REG OUTCOME"</span>, <span class="st">"SCORED"</span>,</span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"VERTIS CV"</span>))) <span class="sc">+</span></span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hazard ratio for MACE (&lt;1 indicates</span><span class="sc">\n</span><span class="st">hazard rate reduction vs. placebo)"</span>) <span class="sc">+</span></span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Study"</span>)</span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>The second type of input to meta-analyses that we will use is outcomes</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a>for each treatment group. While meta-analyses more commonly use</span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>treatment differences as an input, we do not have to use that approach.</span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>Instead, we can use outcomes from each treatment group in each study as</span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>an input. Often, the two approaches are essentially equivalent, but</span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>especially when there is more than two treatment groups per study an</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>approach using treatment differences does need modification in order to</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>correctly capture the correlation of multiple treatment differences</span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>compared with the same control group. In contrast, an arm-based approach</span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a>will automatically reflect this correlation.</span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a>In the SGLT-2 inhibitor case study, we will assume that event times</span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>approximately follow an exponential distribution, which allows us to</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>conduct an arm-based meta-analysis with the number of cases per arm and</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a>the total follow-up time to firstevent or censoring per arm as inputs.</span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a>These are the sufficient statistics for exponentially distributed event</span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a>times with right-censoring.</span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="ot">&lt;-</span> <span class="st">"record, study, trialid, studyno, drugname, treatment, cases, patients, py_to_evt_or_cens, cases_per_py</span></span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a><span class="st">1,CANVAS,NCT01032629, 1,canagliflozin, 1, 425, 2888, 15799.25651, 0.0269</span></span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a><span class="st">2,CANVAS,NCT01032629, 1,canagliflozin, 0, 233, 1442, 7664.473684, 0.0304</span></span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a><span class="st">3,CANVAS-R,NCT01989754, 2,canagliflozin, 1, 160, 2907, 5904.059041, 0.0271</span></span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a><span class="st">4,CANVAS-R,NCT01989754, 2,canagliflozin, 0, 193, 2905, 5848.484848, 0.0330</span></span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a><span class="st">5,CREDENCE,NCT02065791, 3,canagliflozin, 1, 217, 2202, 5607.235142, 0.0387</span></span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a><span class="st">6,CREDENCE,NCT02065791, 3,canagliflozin, 0, 269, 2199, 5523.613963, 0.0487</span></span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a><span class="st">7,EMPA-REG OUTCOME,NCT01131676, 4,empagliflozin, 1, 490, 4687, 13102, 0.0374</span></span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a><span class="st">8,EMPA-REG OUTCOME,NCT01131676, 4,empagliflozin, 0, 282, 2333, 6424, 0.0439</span></span>
<span id="cb32-155"><a href="#cb32-155" aria-hidden="true" tabindex="-1"></a><span class="st">9,DECLARE–TIMI 58,NCT01730534, 5,dapagliflozin, 1, 756, 8582, 33451.32743, 0.0226</span></span>
<span id="cb32-156"><a href="#cb32-156" aria-hidden="true" tabindex="-1"></a><span class="st">10,DECLARE–TIMI 58,NCT01730534, 5,dapagliflozin, 0, 803, 8578, 33181.81818, 0.0242</span></span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a><span class="st">11,SCORED,NCT03315143, 6,sotagliflozin, 1, 343, 5292, 7145.833333, 0.048</span></span>
<span id="cb32-158"><a href="#cb32-158" aria-hidden="true" tabindex="-1"></a><span class="st">12,SCORED,NCT03315143, 6,sotagliflozin, 0, 442, 5292, 7015.873016, 0.063</span></span>
<span id="cb32-159"><a href="#cb32-159" aria-hidden="true" tabindex="-1"></a><span class="st">13,VERTIS CV,NCT01986881, 7,ertugliflozin, 1, 653, 5493, 16743.58974, 0.039</span></span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a><span class="st">14,VERTIS CV,NCT01986881, 7,ertugliflozin, 0, 327, 2745, 8175, 0.04"</span> <span class="sc">%&gt;%</span></span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="at">text=</span>.) <span class="sc">%&gt;%</span></span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment, <span class="at">levels=</span><span class="dv">0</span>L<span class="sc">:</span><span class="dv">1</span>L, </span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Placebo"</span>, <span class="st">"SGLT2 inhibitor"</span>)))</span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="sc">%&gt;%</span></span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(studyno)) <span class="sc">%&gt;%</span></span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">studyno =</span> <span class="fu">factor</span>(studyno, <span class="at">levels=</span>studyno, <span class="at">labels=</span>study)) <span class="sc">%&gt;%</span></span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cases_per_py, <span class="at">y=</span>studyno, <span class="at">col=</span>treatment, <span class="at">label=</span>treatment)) <span class="sc">+</span></span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linewidth=</span><span class="fl">0.25</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>.<span class="sc">%&gt;%</span> <span class="fu">filter</span>(studyno<span class="sc">==</span><span class="st">"EMPA-REG OUTCOME"</span>)) <span class="sc">+</span></span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Exponential hazard rate for MACE"</span>) <span class="sc">+</span></span>
<span id="cb32-174"><a href="#cb32-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Study"</span>)</span>
<span id="cb32-175"><a href="#cb32-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a>Let us also briefly illustrate why naively pooling data instead of using</span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a>meta-analytic approaches is inappropriate. Take e.g. the CANVAS and</span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a>CANVAS-R studies, which both have hazard ratios <span class="sc">\&lt;</span>1 favoring</span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a>canagliflozin over placebo. A naive pooling of these two studies</span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a>followed by calculating the proportion of patients with an event would</span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a>seem to indicate that placebo performs better! This effect is called</span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a>Simpson's paradox.</span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-188"><a href="#cb32-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a>sglt2 <span class="sc">%&gt;%</span> </span>
<span id="cb32-190"><a href="#cb32-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(study, <span class="st">"CANVAS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-191"><a href="#cb32-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Treatment=</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb32-192"><a href="#cb32-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb32-193"><a href="#cb32-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Proportion of cases</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(cases)<span class="sc">/</span><span class="fu">sum</span>(patients)) <span class="sc">%&gt;%</span></span>
<span id="cb32-194"><a href="#cb32-194" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb32-195"><a href="#cb32-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-196"><a href="#cb32-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-197"><a href="#cb32-197" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model description</span></span>
<span id="cb32-198"><a href="#cb32-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-199"><a href="#cb32-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fixed- and random-effects meta-analysis</span></span>
<span id="cb32-200"><a href="#cb32-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-201"><a href="#cb32-201" aria-hidden="true" tabindex="-1"></a>Taking a Bayesian approach with at least weakly informative priors tends</span>
<span id="cb32-202"><a href="#cb32-202" aria-hidden="true" tabindex="-1"></a>to be very useful to avoid various issues that arise with frequentist</span>
<span id="cb32-203"><a href="#cb32-203" aria-hidden="true" tabindex="-1"></a>methods e.g. when there are very few studies, or no events in one or all</span>
<span id="cb32-204"><a href="#cb32-204" aria-hidden="true" tabindex="-1"></a>arms of a study in a meta-analysis of event occurrence. Commonly, two</span>
<span id="cb32-205"><a href="#cb32-205" aria-hidden="true" tabindex="-1"></a>types of meta-analysis model are distinguished: fixed- and</span>
<span id="cb32-206"><a href="#cb32-206" aria-hidden="true" tabindex="-1"></a>random-effects meta-analysis models. Both can expressed as regression</span>
<span id="cb32-207"><a href="#cb32-207" aria-hidden="true" tabindex="-1"></a>models. Fitting such regression models is straightforward in <span class="in">`brms`</span>.</span>
<span id="cb32-208"><a href="#cb32-208" aria-hidden="true" tabindex="-1"></a>While this is even arguably useful in simple situations due to the</span>
<span id="cb32-209"><a href="#cb32-209" aria-hidden="true" tabindex="-1"></a>understanding and insights it provides, its true value lies in making it</span>
<span id="cb32-210"><a href="#cb32-210" aria-hidden="true" tabindex="-1"></a>easier to deal with more complex situations. E.g. when we wish to adjust</span>
<span id="cb32-211"><a href="#cb32-211" aria-hidden="true" tabindex="-1"></a>estimates or predictions for some study-level covariates</span>
<span id="cb32-212"><a href="#cb32-212" aria-hidden="true" tabindex="-1"></a>("meta-regression"), we simply add an additional term to our</span>
<span id="cb32-213"><a href="#cb32-213" aria-hidden="true" tabindex="-1"></a>meta-analytic regression model.</span>
<span id="cb32-214"><a href="#cb32-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-215"><a href="#cb32-215" aria-hidden="true" tabindex="-1"></a>A "fixed-effects meta analysis" assumes that there is a single fixed</span>
<span id="cb32-216"><a href="#cb32-216" aria-hidden="true" tabindex="-1"></a>parameter that describes the treatment effect in all trials. For</span>
<span id="cb32-217"><a href="#cb32-217" aria-hidden="true" tabindex="-1"></a>example, the very simple inverse-variance approach uses estimates</span>
<span id="cb32-218"><a href="#cb32-218" aria-hidden="true" tabindex="-1"></a>$\hat{\delta}_i$ from each trial $i=1,\ldots,I$ and their standard</span>
<span id="cb32-219"><a href="#cb32-219" aria-hidden="true" tabindex="-1"></a>errors $\text{SE}(\hat{\delta}_i)$ as its inputs, and results in an</span>
<span id="cb32-220"><a href="#cb32-220" aria-hidden="true" tabindex="-1"></a>estimate that is the weighted mean of the estimates from each study with</span>
<span id="cb32-221"><a href="#cb32-221" aria-hidden="true" tabindex="-1"></a>the weights of each study proportional to the inverse of the squared</span>
<span id="cb32-222"><a href="#cb32-222" aria-hidden="true" tabindex="-1"></a>standard errors</span>
<span id="cb32-223"><a href="#cb32-223" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_\text{inv.-var.} = \frac{1}{{\sum_{j=1}^I \frac{1}{\text{SE}(\hat{\delta}_j)^{2}}}} \times \sum_{i=1}^I \frac{\hat{\delta}_i}{\text{SE}(\hat{\delta}_i)^2}.$$</span>
<span id="cb32-224"><a href="#cb32-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-225"><a href="#cb32-225" aria-hidden="true" tabindex="-1"></a>Expressed as a regression model, the inverse-variance approach</span>
<span id="cb32-226"><a href="#cb32-226" aria-hidden="true" tabindex="-1"></a>corresponds to a regression model for the observed treatment effect</span>
<span id="cb32-227"><a href="#cb32-227" aria-hidden="true" tabindex="-1"></a>estimates that only has an intercept term, i.e.:</span>
<span id="cb32-228"><a href="#cb32-228" aria-hidden="true" tabindex="-1"></a>$$\text{E} \hat{\delta}_i = \delta$$ with</span>
<span id="cb32-229"><a href="#cb32-229" aria-hidden="true" tabindex="-1"></a>$\hat{\delta}_i \sim N(\text{E} \hat{\delta}_i, \text{SE}(\hat{\delta}_i))$</span>
<span id="cb32-230"><a href="#cb32-230" aria-hidden="true" tabindex="-1"></a>(conditioning on the observed value of the standard error). In this</span>
<span id="cb32-231"><a href="#cb32-231" aria-hidden="true" tabindex="-1"></a>model, inference is about $\delta$. In <span class="in">`brms`</span> formula syntax, this model</span>
<span id="cb32-232"><a href="#cb32-232" aria-hidden="true" tabindex="-1"></a>can be specified as <span class="in">`log_hr | se(log_hr_stderr) ~ 1`</span>.</span>
<span id="cb32-233"><a href="#cb32-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-234"><a href="#cb32-234" aria-hidden="true" tabindex="-1"></a>In contrast, a "random-effects meta analysis" assumes that there the</span>
<span id="cb32-235"><a href="#cb32-235" aria-hidden="true" tabindex="-1"></a>parameter that describes the treatment effect varies across trials. It</span>
<span id="cb32-236"><a href="#cb32-236" aria-hidden="true" tabindex="-1"></a>is commonly assumed that it varies according to a normal distribution</span>
<span id="cb32-237"><a href="#cb32-237" aria-hidden="true" tabindex="-1"></a>with unknown mean and standard deviation. Such an approach will give</span>
<span id="cb32-238"><a href="#cb32-238" aria-hidden="true" tabindex="-1"></a>greater weight to studies with larger standard errors than the</span>
<span id="cb32-239"><a href="#cb32-239" aria-hidden="true" tabindex="-1"></a>inverse-variance approach does.</span>
<span id="cb32-240"><a href="#cb32-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-241"><a href="#cb32-241" aria-hidden="true" tabindex="-1"></a>One common method for random-effects meta-analysis is the DerSimonian</span>
<span id="cb32-242"><a href="#cb32-242" aria-hidden="true" tabindex="-1"></a>and Laird method (DerSimonian 1986). Expressed as a regression model,</span>
<span id="cb32-243"><a href="#cb32-243" aria-hidden="true" tabindex="-1"></a>this method corresponds to a regression model for the observed treatment</span>
<span id="cb32-244"><a href="#cb32-244" aria-hidden="true" tabindex="-1"></a>effect estimates that has an intercept term and a random study effect on</span>
<span id="cb32-245"><a href="#cb32-245" aria-hidden="true" tabindex="-1"></a>the intercept, i.e.: $$\text{E} \hat{\delta}_i = \mu + \nu_i$$ with</span>
<span id="cb32-246"><a href="#cb32-246" aria-hidden="true" tabindex="-1"></a>$\nu_i \sim N(0, \tau)$ for some $\tau&gt;0$ and</span>
<span id="cb32-247"><a href="#cb32-247" aria-hidden="true" tabindex="-1"></a>$\hat{\delta}_i \sim N(\text{E} \hat{\delta}_i, \text{SE}(\hat{\delta}_i))$</span>
<span id="cb32-248"><a href="#cb32-248" aria-hidden="true" tabindex="-1"></a>for $i=1, \ldots, I$ (again, conditioning on the observed value of the</span>
<span id="cb32-249"><a href="#cb32-249" aria-hidden="true" tabindex="-1"></a>standard error). In <span class="in">`brms`</span>formula syntax, this model can be expressed as</span>
<span id="cb32-250"><a href="#cb32-250" aria-hidden="true" tabindex="-1"></a><span class="in">`log_hr | se(log_hr_stderr) ~ 1 + (1|study)`</span>.</span>
<span id="cb32-251"><a href="#cb32-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-252"><a href="#cb32-252" aria-hidden="true" tabindex="-1"></a>In this model, inference is usually made for $\mu$, although arguably</span>
<span id="cb32-253"><a href="#cb32-253" aria-hidden="true" tabindex="-1"></a>the effect $\delta^* \sim N(\mu, \tau)$ in a new population drawn from</span>
<span id="cb32-254"><a href="#cb32-254" aria-hidden="true" tabindex="-1"></a>the distribution of study populations may also be of interest.</span>
<span id="cb32-255"><a href="#cb32-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-256"><a href="#cb32-256" aria-hidden="true" tabindex="-1"></a><span class="fu">### With data from each arm as an input</span></span>
<span id="cb32-257"><a href="#cb32-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-258"><a href="#cb32-258" aria-hidden="true" tabindex="-1"></a>When we have data from each arm as an input, we can use a fixed-effects</span>
<span id="cb32-259"><a href="#cb32-259" aria-hidden="true" tabindex="-1"></a>approach with a regression model for the observed outcomes in each arm</span>
<span id="cb32-260"><a href="#cb32-260" aria-hidden="true" tabindex="-1"></a>that has fixed study and treatment effects:</span>
<span id="cb32-261"><a href="#cb32-261" aria-hidden="true" tabindex="-1"></a>$$\text{E} \hat{\theta}_j = \sum_{i=1}^I \alpha_i \times 1<span class="sc">\{</span>\text{study}_j=i<span class="sc">\}</span> + \delta \times 1<span class="sc">\{</span>\text{treatment}_j = 1<span class="sc">\}</span>$$</span>
<span id="cb32-262"><a href="#cb32-262" aria-hidden="true" tabindex="-1"></a>with</span>
<span id="cb32-263"><a href="#cb32-263" aria-hidden="true" tabindex="-1"></a>$\hat{\theta}_i \sim N(\text{E} \hat{\theta}_i, \text{SE}(\hat{\theta}_i))$.</span>
<span id="cb32-264"><a href="#cb32-264" aria-hidden="true" tabindex="-1"></a>The expected control group outcome $\alpha_i$ for each study is a</span>
<span id="cb32-265"><a href="#cb32-265" aria-hidden="true" tabindex="-1"></a>nuissance parameter and we aim to make inference about $\delta$. In</span>
<span id="cb32-266"><a href="#cb32-266" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> formula syntax this model can be expressed as</span>
<span id="cb32-267"><a href="#cb32-267" aria-hidden="true" tabindex="-1"></a><span class="in">`theta | se(se_theta) ~ 0 + study + treatment`</span>.</span>
<span id="cb32-268"><a href="#cb32-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-269"><a href="#cb32-269" aria-hidden="true" tabindex="-1"></a>In a frequentist setting, there is only value in using this input data</span>
<span id="cb32-270"><a href="#cb32-270" aria-hidden="true" tabindex="-1"></a>format, if we have more than two treatments, because different</span>
<span id="cb32-271"><a href="#cb32-271" aria-hidden="true" tabindex="-1"></a>comparisons versus the same control group from the same study are</span>
<span id="cb32-272"><a href="#cb32-272" aria-hidden="true" tabindex="-1"></a>correlated and this approach can automatically reflects this. The</span>
<span id="cb32-273"><a href="#cb32-273" aria-hidden="true" tabindex="-1"></a>generalization of the regression equation above is straightforward.</span>
<span id="cb32-274"><a href="#cb32-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-275"><a href="#cb32-275" aria-hidden="true" tabindex="-1"></a>When we have data from each arm as an input, we can implement a</span>
<span id="cb32-276"><a href="#cb32-276" aria-hidden="true" tabindex="-1"></a>random-effects approach via a regression model for the observed outcomes</span>
<span id="cb32-277"><a href="#cb32-277" aria-hidden="true" tabindex="-1"></a>in each arm that has fixed study effects and random treatment effects:</span>
<span id="cb32-278"><a href="#cb32-278" aria-hidden="true" tabindex="-1"></a>$$\text{E} \hat{\theta}_j = \sum_{i=1}^I \alpha_i \times 1\{\text{study}_j=i\} + \left( \mu + \sum_{i=1}^I \nu_i \times 1<span class="sc">\{</span>\text{study}_j=i<span class="sc">\}</span> \right) \times 1<span class="sc">\{</span>\text{treatment}_j = 1<span class="sc">\}</span>$$</span>
<span id="cb32-279"><a href="#cb32-279" aria-hidden="true" tabindex="-1"></a>with</span>
<span id="cb32-280"><a href="#cb32-280" aria-hidden="true" tabindex="-1"></a>$\hat{\theta}_i \sim N(\text{E} \hat{\theta}_i, \text{SE}(\hat{\theta}_i))$.</span>
<span id="cb32-281"><a href="#cb32-281" aria-hidden="true" tabindex="-1"></a>In theory, the <span class="in">`brms`</span> formula syntax for such a model should be</span>
<span id="cb32-282"><a href="#cb32-282" aria-hidden="true" tabindex="-1"></a>something like <span class="in">`theta | se(se_theta) ~ 0 + study + (treatment|study)`</span>,</span>
<span id="cb32-283"><a href="#cb32-283" aria-hidden="true" tabindex="-1"></a>but this does not seem to do quite what we want, so we implement</span>
<span id="cb32-284"><a href="#cb32-284" aria-hidden="true" tabindex="-1"></a>something else below.</span>
<span id="cb32-285"><a href="#cb32-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-286"><a href="#cb32-286" aria-hidden="true" tabindex="-1"></a><span class="fu">### What to do when a normal approximation is not appropriate?</span></span>
<span id="cb32-287"><a href="#cb32-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-288"><a href="#cb32-288" aria-hidden="true" tabindex="-1"></a>In the previous subsection, we assumed that it is a good approximation</span>
<span id="cb32-289"><a href="#cb32-289" aria-hidden="true" tabindex="-1"></a>to assume that least-squares-means for each treatment group or treatment</span>
<span id="cb32-290"><a href="#cb32-290" aria-hidden="true" tabindex="-1"></a>differences have a normal sampling distribution. That is often the case,</span>
<span id="cb32-291"><a href="#cb32-291" aria-hidden="true" tabindex="-1"></a>especially after suitable transformations such as the log-transformation</span>
<span id="cb32-292"><a href="#cb32-292" aria-hidden="true" tabindex="-1"></a>for odds ratios, rate ratios, hazard ratios, event rates, odds, and</span>
<span id="cb32-293"><a href="#cb32-293" aria-hidden="true" tabindex="-1"></a>hazard rates. However, making this assumption is not always appropriate.</span>
<span id="cb32-294"><a href="#cb32-294" aria-hidden="true" tabindex="-1"></a>Examples when different approaches are preferable include:</span>
<span id="cb32-295"><a href="#cb32-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-296"><a href="#cb32-296" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>sparse binomial, time-to-event or count outcomes (e.g. arms in some</span>
<span id="cb32-297"><a href="#cb32-297" aria-hidden="true" tabindex="-1"></a>    studies have a low number of events or no events - this is one of</span>
<span id="cb32-298"><a href="#cb32-298" aria-hidden="true" tabindex="-1"></a>    the most common scenarios),</span>
<span id="cb32-299"><a href="#cb32-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-300"><a href="#cb32-300" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the published information does not lend itself easily towards being</span>
<span id="cb32-301"><a href="#cb32-301" aria-hidden="true" tabindex="-1"></a>    represented as an estimate with a standard error (e.g. data</span>
<span id="cb32-302"><a href="#cb32-302" aria-hidden="true" tabindex="-1"></a>    consisting of Kaplan-Meier curves for each treatment arm),</span>
<span id="cb32-303"><a href="#cb32-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-304"><a href="#cb32-304" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>correlations in the data need to be reflected appropriately (e.g.</span>
<span id="cb32-305"><a href="#cb32-305" aria-hidden="true" tabindex="-1"></a>    meta-analysis of multivariate data such as data from multiple</span>
<span id="cb32-306"><a href="#cb32-306" aria-hidden="true" tabindex="-1"></a>    timepoints, or joint meta-analysis of diagnostic sensitivity and</span>
<span id="cb32-307"><a href="#cb32-307" aria-hidden="true" tabindex="-1"></a>    specificity), or</span>
<span id="cb32-308"><a href="#cb32-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-309"><a href="#cb32-309" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>meta-analysis of individual-patient data accounting for covariates.</span>
<span id="cb32-310"><a href="#cb32-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-311"><a href="#cb32-311" aria-hidden="true" tabindex="-1"></a>In these situations, there are a number of ideas we can conveniently use</span>
<span id="cb32-312"><a href="#cb32-312" aria-hidden="true" tabindex="-1"></a>in a regression setting.</span>
<span id="cb32-313"><a href="#cb32-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-314"><a href="#cb32-314" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using a likelihood corresponding to the individual patient data</span>
<span id="cb32-315"><a href="#cb32-315" aria-hidden="true" tabindex="-1"></a>    likelihood when sufficient statistics are available. Examples</span>
<span id="cb32-316"><a href="#cb32-316" aria-hidden="true" tabindex="-1"></a>    include:</span>
<span id="cb32-317"><a href="#cb32-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-318"><a href="#cb32-318" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When number of patients with an event $Y_{ij}$ and the total</span>
<span id="cb32-319"><a href="#cb32-319" aria-hidden="true" tabindex="-1"></a>        number of patients $N_{ij}$ are available for each arm $j$ of</span>
<span id="cb32-320"><a href="#cb32-320" aria-hidden="true" tabindex="-1"></a>        study $i$, we could assume that</span>
<span id="cb32-321"><a href="#cb32-321" aria-hidden="true" tabindex="-1"></a>        $Y_{ij} \sim \text{Bin}(\pi_{ij}, N_{ij})$ and work with a</span>
<span id="cb32-322"><a href="#cb32-322" aria-hidden="true" tabindex="-1"></a>        regression equation for $\text{logit}(\pi_{ij})$. For this,</span>
<span id="cb32-323"><a href="#cb32-323" aria-hidden="true" tabindex="-1"></a>        <span class="in">`brms`</span> offers the</span>
<span id="cb32-324"><a href="#cb32-324" aria-hidden="true" tabindex="-1"></a>        <span class="in">`formula = cases | trials(patients) = regression terms`</span> syntax</span>
<span id="cb32-325"><a href="#cb32-325" aria-hidden="true" tabindex="-1"></a>        in combination with specifying</span>
<span id="cb32-326"><a href="#cb32-326" aria-hidden="true" tabindex="-1"></a>        <span class="in">`family = binomial(link="logit")`</span>.</span>
<span id="cb32-327"><a href="#cb32-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-328"><a href="#cb32-328" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When the number of patients with at least an event $Y_{ij}$ and</span>
<span id="cb32-329"><a href="#cb32-329" aria-hidden="true" tabindex="-1"></a>        the total time until first event or censoring $t_{ij}$ are</span>
<span id="cb32-330"><a href="#cb32-330" aria-hidden="true" tabindex="-1"></a>        available for exponentially distributed time-to-event data, we</span>
<span id="cb32-331"><a href="#cb32-331" aria-hidden="true" tabindex="-1"></a>        can use the the log-likelihood is - up to a constant - the same</span>
<span id="cb32-332"><a href="#cb32-332" aria-hidden="true" tabindex="-1"></a>        as when we assume</span>
<span id="cb32-333"><a href="#cb32-333" aria-hidden="true" tabindex="-1"></a>        $Y_{ij} \sim \text{Poisson}(\lambda_{ij} t_{ij})$ and work with</span>
<span id="cb32-334"><a href="#cb32-334" aria-hidden="true" tabindex="-1"></a>        Poisson regression with a $\log t_{ij}$ offset. For this, <span class="in">`brms`</span></span>
<span id="cb32-335"><a href="#cb32-335" aria-hidden="true" tabindex="-1"></a>        offers the</span>
<span id="cb32-336"><a href="#cb32-336" aria-hidden="true" tabindex="-1"></a>        <span class="in">`formula = cases | rate(followuptime) ~ regression terms`</span> syntax</span>
<span id="cb32-337"><a href="#cb32-337" aria-hidden="true" tabindex="-1"></a>        in combination with specifying <span class="in">`family = poisson(link="log")`</span>.</span>
<span id="cb32-338"><a href="#cb32-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-339"><a href="#cb32-339" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When the number of total events experienced by all patients</span>
<span id="cb32-340"><a href="#cb32-340" aria-hidden="true" tabindex="-1"></a>        $Y_{ij}$ and the total time at risk of events for all patients</span>
<span id="cb32-341"><a href="#cb32-341" aria-hidden="true" tabindex="-1"></a>        $t_{ij}$ are available for Poisson distributed count data, we</span>
<span id="cb32-342"><a href="#cb32-342" aria-hidden="true" tabindex="-1"></a>        can use $Y_{ij} \sim \text{Poisson}(\lambda_{ij} t_{ij})$ and</span>
<span id="cb32-343"><a href="#cb32-343" aria-hidden="true" tabindex="-1"></a>        work with Poisson regression with a $\log t_{ij}$ offset. For</span>
<span id="cb32-344"><a href="#cb32-344" aria-hidden="true" tabindex="-1"></a>        this, <span class="in">`brms`</span> offers the</span>
<span id="cb32-345"><a href="#cb32-345" aria-hidden="true" tabindex="-1"></a>        <span class="in">`formula = cases | rate(followuptime) ~ regression terms`</span> syntax</span>
<span id="cb32-346"><a href="#cb32-346" aria-hidden="true" tabindex="-1"></a>        in combination with specifying <span class="in">`family = poisson(link="log")`</span>.</span>
<span id="cb32-347"><a href="#cb32-347" aria-hidden="true" tabindex="-1"></a>        However, note that this is rarely appropriate, because in</span>
<span id="cb32-348"><a href="#cb32-348" aria-hidden="true" tabindex="-1"></a>        practice count data are nearly always over-dispersed compared to</span>
<span id="cb32-349"><a href="#cb32-349" aria-hidden="true" tabindex="-1"></a>        the Poisson distribution. In contrast, assuming an exponential</span>
<span id="cb32-350"><a href="#cb32-350" aria-hidden="true" tabindex="-1"></a>        distribution for the time-to-first-event seems to occasionally</span>
<span id="cb32-351"><a href="#cb32-351" aria-hidden="true" tabindex="-1"></a>        describe data from real trials reasonably well.</span>
<span id="cb32-352"><a href="#cb32-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-353"><a href="#cb32-353" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For individual patient data, we would use a regression model that we</span>
<span id="cb32-354"><a href="#cb32-354" aria-hidden="true" tabindex="-1"></a>    would use to analyze each trial, but let all model terms other than</span>
<span id="cb32-355"><a href="#cb32-355" aria-hidden="true" tabindex="-1"></a>    the treatment effect differ between trials. Most typically, we would</span>
<span id="cb32-356"><a href="#cb32-356" aria-hidden="true" tabindex="-1"></a>    simply assume that there are completely different parameters for</span>
<span id="cb32-357"><a href="#cb32-357" aria-hidden="true" tabindex="-1"></a>    each trial. For regression coefficients, this is equivalent to</span>
<span id="cb32-358"><a href="#cb32-358" aria-hidden="true" tabindex="-1"></a>    having an interaction between them and the trial effect. For</span>
<span id="cb32-359"><a href="#cb32-359" aria-hidden="true" tabindex="-1"></a>    distributional parameters such as the residual standard deviation,</span>
<span id="cb32-360"><a href="#cb32-360" aria-hidden="true" tabindex="-1"></a>    we can use the specific syntax offered by <span class="in">`brms`</span> to specify that they should differ by trial, e.g. for the residual standard deviation in a linear regression we can write <span class="in">`formula = bf(outcome ~ regression terms, sigma ~ 0 + trial), family = gaussian()`</span> to specify this. For more details see the <span class="co">[</span><span class="ot">`brms` vignette on distributional models</span><span class="co">](https://paul-buerkner.github.io/brms/articles/brms_distreg.html)</span>. </span>
<span id="cb32-361"><a href="#cb32-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-362"><a href="#cb32-362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using custom likelihood functions can also be an option.</span>
<span id="cb32-363"><a href="#cb32-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-364"><a href="#cb32-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation</span></span>
<span id="cb32-365"><a href="#cb32-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-366"><a href="#cb32-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Meta-analysis with treatment effects as inputs</span></span>
<span id="cb32-367"><a href="#cb32-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-368"><a href="#cb32-368" aria-hidden="true" tabindex="-1"></a>We will first implement a Bayesian version of the "traditional"</span>
<span id="cb32-369"><a href="#cb32-369" aria-hidden="true" tabindex="-1"></a>meta-analysis approach, where we use the estimates of a treatment effect</span>
<span id="cb32-370"><a href="#cb32-370" aria-hidden="true" tabindex="-1"></a>and their standard errors as inputs. The <span class="in">`brms`</span> code below performs a</span>
<span id="cb32-371"><a href="#cb32-371" aria-hidden="true" tabindex="-1"></a>fixed-effects meta-analysis with log-hazard ratios and their standard</span>
<span id="cb32-372"><a href="#cb32-372" aria-hidden="true" tabindex="-1"></a>errors as inputs.</span>
<span id="cb32-373"><a href="#cb32-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-376"><a href="#cb32-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-377"><a href="#cb32-377" aria-hidden="true" tabindex="-1"></a>brmfit1 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2_hr,</span>
<span id="cb32-378"><a href="#cb32-378" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> log_hr <span class="sc">|</span> <span class="fu">se</span>(log_hr_stderr) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb32-379"><a href="#cb32-379" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"Intercept"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)),</span>
<span id="cb32-380"><a href="#cb32-380" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb32-381"><a href="#cb32-381" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb32-382"><a href="#cb32-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-383"><a href="#cb32-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-386"><a href="#cb32-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-387"><a href="#cb32-387" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit1)</span>
<span id="cb32-388"><a href="#cb32-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-389"><a href="#cb32-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-390"><a href="#cb32-390" aria-hidden="true" tabindex="-1"></a>This <span class="in">`brms`</span> code performs a random-effects meta-analysis with log-hazard</span>
<span id="cb32-391"><a href="#cb32-391" aria-hidden="true" tabindex="-1"></a>ratios and their standard errors as inputs.</span>
<span id="cb32-392"><a href="#cb32-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-395"><a href="#cb32-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-396"><a href="#cb32-396" aria-hidden="true" tabindex="-1"></a>brmfit2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2_hr,</span>
<span id="cb32-397"><a href="#cb32-397" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> log_hr <span class="sc">|</span> <span class="fu">se</span>(log_hr_stderr) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>studyno),</span>
<span id="cb32-398"><a href="#cb32-398" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"Intercept"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb32-399"><a href="#cb32-399" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"sd"</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb32-400"><a href="#cb32-400" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb32-401"><a href="#cb32-401" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb32-402"><a href="#cb32-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-403"><a href="#cb32-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-404"><a href="#cb32-404" aria-hidden="true" tabindex="-1"></a>As we noted before, there's at least two ways of performing posterior</span>
<span id="cb32-405"><a href="#cb32-405" aria-hidden="true" tabindex="-1"></a>inference after fitting the model above: 1. inference about the mean</span>
<span id="cb32-406"><a href="#cb32-406" aria-hidden="true" tabindex="-1"></a>effect of the SGLT-2 inhibitors across studies, or 2. inference about</span>
<span id="cb32-407"><a href="#cb32-407" aria-hidden="true" tabindex="-1"></a>the predicted effect in a new study drawn from the same distribution of</span>
<span id="cb32-408"><a href="#cb32-408" aria-hidden="true" tabindex="-1"></a>studies as the studies under analysis. This difference becomes very</span>
<span id="cb32-409"><a href="#cb32-409" aria-hidden="true" tabindex="-1"></a>clear when working in a Bayesian regression setting using <span class="in">`brms`</span>, but is</span>
<span id="cb32-410"><a href="#cb32-410" aria-hidden="true" tabindex="-1"></a>somewhat obscured when we use standard meta-analysis software.</span>
<span id="cb32-411"><a href="#cb32-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-414"><a href="#cb32-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-415"><a href="#cb32-415" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit2)</span>
<span id="cb32-416"><a href="#cb32-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-417"><a href="#cb32-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-420"><a href="#cb32-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-421"><a href="#cb32-421" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(<span class="at">object=</span>brmfit2, </span>
<span id="cb32-422"><a href="#cb32-422" aria-hidden="true" tabindex="-1"></a>        <span class="at">newdata=</span><span class="fu">tibble</span>(<span class="at">studyno=</span><span class="st">"New study"</span>, <span class="at">log_hr_stderr=</span><span class="fl">10e-19</span>), </span>
<span id="cb32-423"><a href="#cb32-423" aria-hidden="true" tabindex="-1"></a>        <span class="at">allow_new_levels=</span><span class="cn">TRUE</span>, <span class="at">sample_new_levels =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb32-424"><a href="#cb32-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-425"><a href="#cb32-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-426"><a href="#cb32-426" aria-hidden="true" tabindex="-1"></a><span class="fu">### Meta-analysis with data from each arm as inputs</span></span>
<span id="cb32-427"><a href="#cb32-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-428"><a href="#cb32-428" aria-hidden="true" tabindex="-1"></a>This <span class="in">`brms`</span> code performs a fixed-effects meta-analysis with arm-based</span>
<span id="cb32-429"><a href="#cb32-429" aria-hidden="true" tabindex="-1"></a>data as inputs. We now need to assume prior distributions for the placebo group </span>
<span id="cb32-430"><a href="#cb32-430" aria-hidden="true" tabindex="-1"></a>log-hazard  rate in each trial, for this we use an extremely wide Student-t prior with </span>
<span id="cb32-431"><a href="#cb32-431" aria-hidden="true" tabindex="-1"></a>3 degrees of freedom centered on $-3$, because when exponentiated $e^-3 \approx 0.05$ corresponds to a plausible yearly event rate.</span>
<span id="cb32-432"><a href="#cb32-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-435"><a href="#cb32-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-436"><a href="#cb32-436" aria-hidden="true" tabindex="-1"></a>brmfit3 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2,</span>
<span id="cb32-437"><a href="#cb32-437" aria-hidden="true" tabindex="-1"></a>               <span class="at">formula =</span> cases <span class="sc">|</span> <span class="fu">rate</span>(py_to_evt_or_cens) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study <span class="sc">+</span> treatment,</span>
<span id="cb32-438"><a href="#cb32-438" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb32-439"><a href="#cb32-439" aria-hidden="true" tabindex="-1"></a>               <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>, <span class="at">coef=</span><span class="st">"treatmentSGLT2inhibitor"</span>,</span>
<span id="cb32-440"><a href="#cb32-440" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb32-441"><a href="#cb32-441" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVAS"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-442"><a href="#cb32-442" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVASMR"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-443"><a href="#cb32-443" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCREDENCE"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-444"><a href="#cb32-444" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyDECLARE–TIMI58"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-445"><a href="#cb32-445" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyEMPAMREGOUTCOME"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-446"><a href="#cb32-446" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studySCORED"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-447"><a href="#cb32-447" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyVERTISCV"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)),</span>
<span id="cb32-448"><a href="#cb32-448" aria-hidden="true" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb32-449"><a href="#cb32-449" aria-hidden="true" tabindex="-1"></a>               <span class="at">refresh =</span> <span class="dv">0</span>) </span>
<span id="cb32-450"><a href="#cb32-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-451"><a href="#cb32-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-454"><a href="#cb32-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-455"><a href="#cb32-455" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brmfit3)</span>
<span id="cb32-456"><a href="#cb32-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-457"><a href="#cb32-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-458"><a href="#cb32-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-461"><a href="#cb32-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-462"><a href="#cb32-462" aria-hidden="true" tabindex="-1"></a>brmfit3 <span class="sc">%&gt;%</span></span>
<span id="cb32-463"><a href="#cb32-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-464"><a href="#cb32-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb32-465"><a href="#cb32-465" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-466"><a href="#cb32-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>()</span>
<span id="cb32-467"><a href="#cb32-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-468"><a href="#cb32-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-469"><a href="#cb32-469" aria-hidden="true" tabindex="-1"></a>This <span class="in">`brms`</span> code performs a random-effects meta-analysis with arm-based</span>
<span id="cb32-470"><a href="#cb32-470" aria-hidden="true" tabindex="-1"></a>data as inputs.</span>
<span id="cb32-471"><a href="#cb32-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-472"><a href="#cb32-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb32-473"><a href="#cb32-473" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="ot">=</span> <span class="fu">brm</span>(<span class="at">data=</span>sglt2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">trtno =</span> <span class="dv">1</span>L<span class="sc">*</span>(treatment<span class="sc">==</span><span class="st">"SGLT2 inhibitor"</span>)),</span>
<span id="cb32-474"><a href="#cb32-474" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> cases <span class="sc">|</span> <span class="fu">rate</span>(py_to_evt_or_cens) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> study <span class="sc">+</span> treatment <span class="sc">+</span> (<span class="dv">0</span><span class="sc">+</span>trtno<span class="sc">|</span>study),</span>
<span id="cb32-475"><a href="#cb32-475" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb32-476"><a href="#cb32-476" aria-hidden="true" tabindex="-1"></a>              <span class="at">prior =</span> <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>, <span class="at">coef=</span><span class="st">"treatmentSGLT2inhibitor"</span>, <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb32-477"><a href="#cb32-477" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVAS"</span>,   <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-478"><a href="#cb32-478" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCANVASMR"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-479"><a href="#cb32-479" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyCREDENCE"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-480"><a href="#cb32-480" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyDECLARE–TIMI58"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-481"><a href="#cb32-481" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyEMPAMREGOUTCOME"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-482"><a href="#cb32-482" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studySCORED"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-483"><a href="#cb32-483" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"b"</span>,  <span class="at">coef=</span><span class="st">"studyVERTISCV"</span>,  <span class="fu">student_t</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb32-484"><a href="#cb32-484" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="at">class=</span><span class="st">"sd"</span>, <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb32-485"><a href="#cb32-485" aria-hidden="true" tabindex="-1"></a>              <span class="at">control=</span><span class="fu">list</span>(<span class="at">adapt_delta=</span><span class="fl">0.99</span>),</span>
<span id="cb32-486"><a href="#cb32-486" aria-hidden="true" tabindex="-1"></a>              <span class="at">refresh =</span> <span class="dv">0</span>) </span>
<span id="cb32-487"><a href="#cb32-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-488"><a href="#cb32-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-489"><a href="#cb32-489" aria-hidden="true" tabindex="-1"></a>As before, we can easily obtain inference about the mean effect of the</span>
<span id="cb32-490"><a href="#cb32-490" aria-hidden="true" tabindex="-1"></a>SGLT-2 inhibitors across studies or the predicted effect in a new study</span>
<span id="cb32-491"><a href="#cb32-491" aria-hidden="true" tabindex="-1"></a>drawn from the same distribution of studies as the studies under</span>
<span id="cb32-492"><a href="#cb32-492" aria-hidden="true" tabindex="-1"></a>analysis.</span>
<span id="cb32-493"><a href="#cb32-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-496"><a href="#cb32-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-497"><a href="#cb32-497" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb32-498"><a href="#cb32-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-499"><a href="#cb32-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb32-500"><a href="#cb32-500" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-501"><a href="#cb32-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-502"><a href="#cb32-502" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb32-503"><a href="#cb32-503" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb32-504"><a href="#cb32-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-505"><a href="#cb32-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-508"><a href="#cb32-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-509"><a href="#cb32-509" aria-hidden="true" tabindex="-1"></a>brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb32-510"><a href="#cb32-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-511"><a href="#cb32-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor <span class="sc">+</span> </span>
<span id="cb32-512"><a href="#cb32-512" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_treatmentSGLT2inhibitor), </span>
<span id="cb32-513"><a href="#cb32-513" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sd_study__trtno))) <span class="sc">%&gt;%</span></span>
<span id="cb32-514"><a href="#cb32-514" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-515"><a href="#cb32-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-516"><a href="#cb32-516" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb32-517"><a href="#cb32-517" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb32-518"><a href="#cb32-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-519"><a href="#cb32-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-520"><a href="#cb32-520" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb32-521"><a href="#cb32-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-522"><a href="#cb32-522" aria-hidden="true" tabindex="-1"></a>Let us combine all the results including also a standard frequentist analysis. As we can see, particularly when using log-hazard-ratios as our analysis inputs, the results of the different models are extremely similar. There seems to be substantial evidence that on average there is a benefit on MACE from SGLT-2 inhibitors in type 2 diabetes patients. </span>
<span id="cb32-523"><a href="#cb32-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-524"><a href="#cb32-524" aria-hidden="true" tabindex="-1"></a>The uncertainty from random effects models is greater - especially when predicting for a new trial. When using arm-based inputs, the prior we put on the results for each arm appears to influence there results - perhaps we should make those rates exchangeable between trials to make a more data-informed decision on those rates?</span>
<span id="cb32-525"><a href="#cb32-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-528"><a href="#cb32-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb32-529"><a href="#cb32-529" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(meta)</span>
<span id="cb32-530"><a href="#cb32-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-531"><a href="#cb32-531" aria-hidden="true" tabindex="-1"></a>frequentist_ma <span class="ot">=</span> <span class="fu">metagen</span>(<span class="at">data =</span> sglt2_hr,</span>
<span id="cb32-532"><a href="#cb32-532" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sm =</span> <span class="st">"HR"</span>,</span>
<span id="cb32-533"><a href="#cb32-533" aria-hidden="true" tabindex="-1"></a>                         <span class="at">TE=</span>log_hr,</span>
<span id="cb32-534"><a href="#cb32-534" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seTE=</span>log_hr_stderr, </span>
<span id="cb32-535"><a href="#cb32-535" aria-hidden="true" tabindex="-1"></a>                         <span class="at">studlab=</span>trial)</span>
<span id="cb32-536"><a href="#cb32-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-537"><a href="#cb32-537" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb32-538"><a href="#cb32-538" aria-hidden="true" tabindex="-1"></a>  brmfit1 <span class="sc">%&gt;%</span></span>
<span id="cb32-539"><a href="#cb32-539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-540"><a href="#cb32-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb32-541"><a href="#cb32-541" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-542"><a href="#cb32-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-543"><a href="#cb32-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Fixed effects - log-hazard ratios"</span>),</span>
<span id="cb32-544"><a href="#cb32-544" aria-hidden="true" tabindex="-1"></a>   brmfit2 <span class="sc">%&gt;%</span></span>
<span id="cb32-545"><a href="#cb32-545" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-546"><a href="#cb32-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb32-547"><a href="#cb32-547" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-548"><a href="#cb32-548" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-549"><a href="#cb32-549" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - log-hazard ratios;inference on mean"</span>),</span>
<span id="cb32-550"><a href="#cb32-550" aria-hidden="true" tabindex="-1"></a>  brmfit2 <span class="sc">%&gt;%</span></span>
<span id="cb32-551"><a href="#cb32-551" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-552"><a href="#cb32-552" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_Intercept <span class="sc">+</span></span>
<span id="cb32-553"><a href="#cb32-553" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_Intercept), </span>
<span id="cb32-554"><a href="#cb32-554" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">mean=</span><span class="dv">0</span>, </span>
<span id="cb32-555"><a href="#cb32-555" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sd=</span>sd_studyno__Intercept))) <span class="sc">%&gt;%</span></span>
<span id="cb32-556"><a href="#cb32-556" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-557"><a href="#cb32-557" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-558"><a href="#cb32-558" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - log-hazard ratios;inference for new trial"</span>),</span>
<span id="cb32-559"><a href="#cb32-559" aria-hidden="true" tabindex="-1"></a>  brmfit3 <span class="sc">%&gt;%</span></span>
<span id="cb32-560"><a href="#cb32-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-561"><a href="#cb32-561" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb32-562"><a href="#cb32-562" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-563"><a href="#cb32-563" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb32-564"><a href="#cb32-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Fixed effects - rates by arm"</span>),</span>
<span id="cb32-565"><a href="#cb32-565" aria-hidden="true" tabindex="-1"></a>  brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb32-566"><a href="#cb32-566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-567"><a href="#cb32-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor)) <span class="sc">%&gt;%</span></span>
<span id="cb32-568"><a href="#cb32-568" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-569"><a href="#cb32-569" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-570"><a href="#cb32-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - rates by arm; inference on mean"</span>),</span>
<span id="cb32-571"><a href="#cb32-571" aria-hidden="true" tabindex="-1"></a>  brmfit4 <span class="sc">%&gt;%</span></span>
<span id="cb32-572"><a href="#cb32-572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_draws_df</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-573"><a href="#cb32-573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_variables</span>(<span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_treatmentSGLT2inhibitor <span class="sc">+</span> </span>
<span id="cb32-574"><a href="#cb32-574" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fu">length</span>(b_treatmentSGLT2inhibitor), </span>
<span id="cb32-575"><a href="#cb32-575" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sd_study__trtno))) <span class="sc">%&gt;%</span></span>
<span id="cb32-576"><a href="#cb32-576" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(.chain, .iteration, .draw, <span class="st">`</span><span class="at">hazard ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-577"><a href="#cb32-577" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-578"><a href="#cb32-578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Method =</span> <span class="st">"Random effects - rates by arm; inference for new trial"</span>),</span>
<span id="cb32-579"><a href="#cb32-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"Fixed effects - frequentist"</span>, <span class="st">"Random effects - frequentist"</span>),</span>
<span id="cb32-580"><a href="#cb32-580" aria-hidden="true" tabindex="-1"></a>         <span class="at">variable=</span><span class="st">"hazard ratio"</span>,</span>
<span id="cb32-581"><a href="#cb32-581" aria-hidden="true" tabindex="-1"></a>         <span class="at">median=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>TE.fixed, frequentist_ma<span class="sc">$</span>TE.random)), </span>
<span id="cb32-582"><a href="#cb32-582" aria-hidden="true" tabindex="-1"></a>         <span class="at">q5=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>lower.fixed, frequentist_ma<span class="sc">$</span>lower.random)), </span>
<span id="cb32-583"><a href="#cb32-583" aria-hidden="true" tabindex="-1"></a>         <span class="at">q95=</span><span class="fu">exp</span>(<span class="fu">c</span>(frequentist_ma<span class="sc">$</span>upper.fixed, frequentist_ma<span class="sc">$</span>upper.random)))) <span class="sc">%&gt;%</span></span>
<span id="cb32-584"><a href="#cb32-584" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Method, variable, median, q5, q95) <span class="sc">%&gt;%</span></span>
<span id="cb32-585"><a href="#cb32-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-586"><a href="#cb32-586" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - frequentist"</span><span class="sc">~</span><span class="dv">1</span>L,</span>
<span id="cb32-587"><a href="#cb32-587" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - log-hazard ratios"</span> <span class="sc">~</span> <span class="dv">2</span>L,</span>
<span id="cb32-588"><a href="#cb32-588" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Fixed effects - rates by arm"</span><span class="sc">~</span><span class="dv">3</span>L,</span>
<span id="cb32-589"><a href="#cb32-589" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - frequentist"</span><span class="sc">~</span><span class="dv">4</span>L,</span>
<span id="cb32-590"><a href="#cb32-590" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - log-hazard ratios;inference on mean"</span><span class="sc">~</span><span class="dv">5</span>L,</span>
<span id="cb32-591"><a href="#cb32-591" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - rates by arm; inference on mean"</span><span class="sc">~</span><span class="dv">6</span>L,</span>
<span id="cb32-592"><a href="#cb32-592" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - log-hazard ratios;inference for new trial"</span><span class="sc">~</span><span class="dv">7</span>L,</span>
<span id="cb32-593"><a href="#cb32-593" aria-hidden="true" tabindex="-1"></a>    Method<span class="sc">==</span><span class="st">"Random effects - rates by arm; inference for new trial"</span><span class="sc">~</span><span class="dv">8</span>L,</span>
<span id="cb32-594"><a href="#cb32-594" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span><span class="sc">~</span><span class="dv">9</span>L)) <span class="sc">%&gt;%</span></span>
<span id="cb32-595"><a href="#cb32-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(method_class)) <span class="sc">%&gt;%</span></span>
<span id="cb32-596"><a href="#cb32-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method_class =</span> <span class="fu">factor</span>(method_class, <span class="at">levels=</span><span class="dv">8</span>L<span class="sc">:</span><span class="dv">1</span>L, <span class="at">labels=</span><span class="fu">gsub</span>(<span class="st">" - "</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, Method))) <span class="sc">%&gt;%</span></span>
<span id="cb32-597"><a href="#cb32-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>median, <span class="at">y=</span>method_class, <span class="at">xmin=</span>q5, <span class="at">xmax=</span>q95)) <span class="sc">+</span></span>
<span id="cb32-598"><a href="#cb32-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-599"><a href="#cb32-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb32-600"><a href="#cb32-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">height=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb32-601"><a href="#cb32-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb32-602"><a href="#cb32-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Hazard ratio for MACE (&lt;1 indicates</span><span class="sc">\n</span><span class="st">hazard rate reduction vs. placebo)"</span>) <span class="sc">+</span></span>
<span id="cb32-603"><a href="#cb32-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb32-604"><a href="#cb32-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-605"><a href="#cb32-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb32-606"><a href="#cb32-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-607"><a href="#cb32-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb32-608"><a href="#cb32-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-609"><a href="#cb32-609" aria-hidden="true" tabindex="-1"></a>As we saw, <span class="in">`brms`</span> makes it extremely easy to fit various meta-analysis models. Looking at these from a regression perspective makes it easier to see their connections and makes the extension of meta-analysis to meta-regression seem like just one little logical step.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>