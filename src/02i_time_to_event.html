<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cong Zhang - cong.zhang@novartis.com">
<meta name="author" content="Sebastian Weber - sebastian.weber@novartis.com">

<title>16&nbsp; Time-to-event data – Applied Modelling in Drug Development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/02j_network_meta_analysis.html" rel="next">
<link href="../src/02h_mmrm.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-989f635e0436309011e17b1a0ac5a5c1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="../resources/mathjax/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../bamdd.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02i_time_to_event.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../bamdd_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Applied Modelling in Drug Development</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Novartis/bamdd/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01a_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01b_basic_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/01c_priors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model setup &amp; priors</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../src/02_case_studies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Case studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02a_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Use of historical control data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ab_meta_analysis_trtdiff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Meta-analysis to estimate treatment effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02ac_meta_analysis_strata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Use of historical control data with stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02l_single_arm_pos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability of success from a single arm trial</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02k_nuisance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nuisance parameters, expected power and the “significance threshold”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02b_dose_finding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dose finding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02c_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02cb_tte_dose_escalation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Time-to-event modelling in Oncology dose escalation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02e_multiple_imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multiple imputation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02g_longitudinal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Longitudinal data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02h_mmrm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02i_time_to_event.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02j_network_meta_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/02m_proportion_difference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Difference in proportions from a fitted logistic regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03a_stan_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exposing stan code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/03b_parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Parallel computation</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">16.1</span> Background</a></li>
  <li><a href="#sec:tte-model-brms" id="toc-sec:tte-model-brms" class="nav-link" data-scroll-target="#sec\:tte-model-brms"><span class="header-section-number">16.2</span> Modeling time-to-event data with <code>brms</code></a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">16.3</span> Data</a>
  <ul class="collapse">
  <li><a href="#historical-data" id="toc-historical-data" class="nav-link" data-scroll-target="#historical-data"><span class="header-section-number">16.3.1</span> Historical data</a></li>
  <li><a href="#trial-simulation" id="toc-trial-simulation" class="nav-link" data-scroll-target="#trial-simulation"><span class="header-section-number">16.3.2</span> Trial simulation</a></li>
  </ul></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models"><span class="header-section-number">16.4</span> Models</a>
  <ul class="collapse">
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification"><span class="header-section-number">16.4.1</span> Model specification</a></li>
  <li><a href="#tte-model-prior" id="toc-tte-model-prior" class="nav-link" data-scroll-target="#tte-model-prior"><span class="header-section-number">16.4.2</span> Priors</a></li>
  </ul></li>
  <li><a href="#implementationresults" id="toc-implementationresults" class="nav-link" data-scroll-target="#implementationresults"><span class="header-section-number">16.5</span> Implementation/Results</a>
  <ul class="collapse">
  <li><a href="#construct-customized-coded-contrasts" id="toc-construct-customized-coded-contrasts" class="nav-link" data-scroll-target="#construct-customized-coded-contrasts"><span class="header-section-number">16.5.1</span> Construct customized coded contrasts</a></li>
  <li><a href="#model-fit-with-brms" id="toc-model-fit-with-brms" class="nav-link" data-scroll-target="#model-fit-with-brms"><span class="header-section-number">16.5.2</span> Model fit with <code>brms</code></a></li>
  <li><a href="#incoporate-simulated-historical-data" id="toc-incoporate-simulated-historical-data" class="nav-link" data-scroll-target="#incoporate-simulated-historical-data"><span class="header-section-number">16.5.3</span> Incoporate simulated historical data</a></li>
  <li><a href="#including-historical-data-of-average-soc" id="toc-including-historical-data-of-average-soc" class="nav-link" data-scroll-target="#including-historical-data-of-average-soc"><span class="header-section-number">16.5.4</span> Including historical data of average SoC</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">16.6</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">16.7</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/02_case_studies.html">Case studies</a></li><li class="breadcrumb-item"><a href="../src/02i_time_to_event.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-tte-data" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Time-to-event data</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Cong Zhang - <a href="mailto:cong.zhang@novartis.com" class="email">cong.zhang@novartis.com</a> </p>
             <p>Sebastian Weber - <a href="mailto:sebastian.weber@novartis.com" class="email">sebastian.weber@novartis.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>In this case study the design of a time-to-event trial is presented. The trial evaluates a combination treatment of an active drug given in addition to standard of care (SoC) therapy. Two SoC therapies are in clinical use, which varies geographically. The SoC therapies alone are used as control and compared to the combination of the active drug given in addition to the respective SoC. This results in four arms of the trial and special emphasis is put on the parametrization of the problem. That is, the treatment effect (and each standard of care) is anticipated to be similar to one another such that the mean treatment effect is of particular interest. In addition, a historical data set is incorporated in the analysis of the trial.</p>
<p>This case study demonstrates:</p>
<ul>
<li>modeling censored time-to-event data in <code>brms</code> (use of <code>cens</code> formula modifier) with borrowing from historical control data,</li>
<li>the use of custom contrasts allowing for custom definition of the model parametrization, which in turn allows to specify priors on relevant bits of the problem (a priori we expect the treatment effect not to differ substantially between standard of cares),</li>
<li>an additional alternative approaches of using custom coded contrasts to include with greater flexibility historical data.</li>
</ul>
<p>To run the R code of this section please ensure to load these libraries and options first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simsurv)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RBesT)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># allow for wider printouts without line-breaking</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="background" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="background"><span class="header-section-number">16.1</span> Background</h2>
<p>The outcome of interest in clinical trials is often the occurence of an event. Such events might be negative for patients such as a worsening of a disease, hospitalization or death. They might also be a positive such as clearing the blood of malaria parasites, or being released from hospital.</p>
<p>We use time-to-event (or survival) analysis when it is important to patients whether the event of interest occurs earlier or later. Additionally, time-to-event methods let us deal with the fact that not all patients will have the event of interest during a trial, which leads to censored observations.</p>
<p>In this case study we focus on an Oncology late phase trial evaluating a test treatment in combination with standard of care (SoC) using progression free survival as endpoint in the indication of gastric cancer. Due to geographic differences in the SoC, two different SoC treatments are considered as control treatments. One active treatment is tested in combination with each SoC and compared to the control treatment using only the SoC, which leads to four trial arms in total. From clinical experience with the two SoCs on expects a similar PFS for both therapies. In addition, it is expected that the treatment effect of the active drug is similar when combined with each SoC respectivley. It is therefore desirable to express this prior knowledge when setting up the model.</p>
<p>By way of aligning the parametrization of the model we can encode the prior knowledge on expected similarities (no difference between the two SoCs and consistent treatment effect). For example, defining the average treatment effect and the difference between the two treatment effects as parameters, one can place a prior with limited width on the difference parameter. This expresses the a-priori expectation that differences in the treatment effect per SoC are not too large. This results in efficency gains for the estimation of the average treatment effect while only partially pooling the data.</p>
<p>As furthermore historical data is available on each SoC treatment, its use may allow for un-equal randomization between active and control arms. However, the available literature data only reports outcomes for a treatment arm which lumps together data from the two SoC treatments. Since about 50% of these patients were treated with either SoC, the reported data can be considered to report the average effect of both SoCs. How this historical data can be included in the analysis is outlined below.</p>
<!--- This information is given in the next section first
paragraph already.

The Cox proportional hazards model is a very popular choice for
time-to-event data, since it avoids the need to model a baseline
hazard function. Avoiding the need to model a baseline hazard function
reduces assumptions and is acceptable, since the main inferential goal
is to quantify differences due to active treatment between
arms. However, the Cox proportional hazards relies on a partial
likelihood approach which drops the baseline hazard function by
marginalizing out the respective terms. This approach is not possible
in a Bayesian framework which must work with the full likelihood of
the model. Nonetheless, `brms` does support a `cox` family for
time-to-event data which relies on estimating the baseline hazard
function in a non-parametric manner using parametric splines. This
approach gives under most circumstances very similar results to a
frequentist Cox regression. As the historical data available in this
case study can be approximated with a Weibull distribution this
baseline hazard function has been selected. In `brms` this is enabled
by the `weibull` family while many other options exist including
`exponential`, `gamma`, `lognormal`, `frechet` and `inverse.gaussian`.
--->
<!---
For example, we all die at some point, but most of us consider a longer life (ideally at a good quality of life) desirable. During a clinical trial of even a very severe condition, it would be unusual if all patients died. However, we know that those that did not will die at some point in the future. Thus, we consider the time of their death to be "censored", i.e. we did not observe it, we just know it must be beyond the end of the observation period. 

Censored observations can be right-censored, left-censored, or interval-censored. Right censoring occurs when a subject leaves the study before an event occurs, or the study ends before the event has occurred. An observation is left-censored if we know that the event happened before the observed time. It is interval-censored if we know only that the event happened within some observed time interval. A common example is a clinical trial where patients are tested or measured periodically to evaluate if the event of interest has happened. We may not observe the exact time of the event, but we know that it happened before an evaluation, after an evaluation, or between two evaluations. Interval censoring also contains right censoring and left censoring as special cases.

The `brms` package provides distributions and link functions for fitting survival or time-to-event models. Families including `gamma`, `weibull`, `exponential`, `lognormal`, `frechet`, `inverse.gaussian`, and `cox` (Cox proportional hazards model) can be used (among others) for time-to-event regression
also known as survival regression. By specifying corresponding model options in `formula` when fitting `brms` models, `cens` makes up the internal function that handles censored data.

Here we will demonstrate the exploration of suitable parametric forms for time-to-event modeling with a gastic cancer study and how to use custom coded contrasts as a way to approximate a hierarchical model where we only have to levels by using a `delta` parameter approach and borrowing from historical control data. 

--->
</section>
<section id="sec:tte-model-brms" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="sec:tte-model-brms"><span class="header-section-number">16.2</span> Modeling time-to-event data with <code>brms</code></h2>
<p>Modeling time to event data of clinical trials is oftentimes run with the semi-parametric Cox proportional hazards model. This model avoids the need to specify a hazard function <span class="math inline">\(h(t)\)</span>, which is the rate of events provided no event as happened yet and it crucially defines the probability density of the survival times. Using the assumption of proportional hazards allows to quantify effects of explanatory variables on the hazard and thereby one can quantify the difference between two treatment groups in a trial, for example. The hazard for a patient <span class="math inline">\(i\)</span> with covariates <span class="math inline">\(x_i\)</span> is often modelled as <span class="math inline">\(h_i(t) =
\exp\{x_i \, \beta\} \, h_0(t)\)</span>. The baseline hazard function <span class="math inline">\(h_0(t)\)</span> is not required in the estimation of the effects <span class="math inline">\(\beta\)</span> and the Cox model parameters are estimated using a <em>partial</em> likelihood approach. However, as the Bayesian framework is based on the (full) likelihood principle, the semi-parametric Cox proportional hazards model is not applicale. Nonetheless, <code>brms</code> does offer a variant of the Cox proportional hazards model, which is designed to result in numerically very similar results if used with non-informative priors when compared to the respective Cox proportional hazards model. Instead of marginalizing out the baseline hazard function <span class="math inline">\(h_0(t)\)</span>, the baseline hazard function is modelled using an almost non-parametric approach based on a parametric spline approximation to <span class="math inline">\(h_0(t)\)</span>. The estimated regression coefficients <span class="math inline">\(\beta\)</span> for the Cox <code>brms</code> family correspond to logarithmic hazard ratios.</p>
<p>In contrast to the semi-parametric Cox model, parametric modeling of time to event data assumes a functional form for the hazard function <span class="math inline">\(h(t)\)</span> or equivalently for the probability density function <span class="math inline">\(f(t)\)</span> of the event times at <span class="math inline">\(t=T\)</span>. Both functions are related to one another by the basic relationship <span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span>, where <span class="math inline">\(S(t) = P(T&gt;t) =
\int_t^\infty f(u)\, du\)</span> is the survivor function (probability that an event occurs past time <span class="math inline">\(t\)</span>). In <code>brms</code> the convention is to define via the <code>family</code> argument to <code>brm</code> the probability density of the event times. A description of the parametrization for these densities are found in the vignette “Parametrization of Response Distributions in <code>brms</code>”.</p>
<p>In this case study the Weibull distribution is used as literature data suggested its appropiateness and a parametric modeling approach may lead to greater statistical efficiency. The Weibull probability density is parametrized in <code>brms</code> in terms of shape <span class="math inline">\(\alpha\)</span> and scale parameter <span class="math inline">\(s\)</span>. Instead of directly modeling the scale <span class="math inline">\(s\)</span> (as done in many other time to event programs), <code>brms</code> models the mean of the Weibull distribution <span class="math inline">\(\mu\)</span>. Therefore, the scale <span class="math inline">\(s\)</span> is set equal to <span class="math inline">\(s=\frac{\mu}{\Gamma(1 + \frac{1}{\alpha})}\)</span> in the Weibull probability density</p>
<p><span class="math display">\[ f_{\mbox{Weibull}}(t) = \frac{\alpha}{s} \left( \frac{t}{s}
\right)^{\alpha-1} \, \exp\left(-\left(\frac{t}{s}\right)^\alpha\right).\]</span></p>
<p>In this form, the model fulfills the property of an <em>accelerated failure time</em> (AFT) model whenever explanatory variables are introduced. This follows from considering the survivor function</p>
<p><span class="math display">\[S_{\mbox{Weibull}}(t) =
\exp\left(-\left(\frac{t}{s}\right)^\alpha\right)\]</span></p>
<p>and modeling the mean <span class="math inline">\(\mu_i\)</span> linearly on the <span class="math inline">\(\log\)</span> scale as a function of covariates <span class="math inline">\(x_i\)</span> for subject <span class="math inline">\(i\)</span>, <span class="math inline">\(\log(\mu_i) = \beta_0 + x_i' \,
\beta\)</span>. Defining as the reference covariate level <span class="math inline">\(x_i = 0\)</span> motivates the definition of a reference survivor function <span class="math inline">\(S_{\mbox{Weibull},0}(t)\)</span> for which the linear predictor <span class="math inline">\(\log(\mu_0)\)</span> is equal to the intercept <span class="math inline">\(\beta_0\)</span>. As a consequence, the survivor function of any patient <span class="math inline">\(i\)</span> is related to the reference survivor function by</p>
<p><span class="math display">\[ S_{i}(t) = S_{\mbox{Weibull},0}\left(\frac{t}{\exp(x_i' \, \beta)} \right),\]</span></p>
<p>which is the defining property of AFT models. The regression coefficients <span class="math inline">\(\beta\)</span> are then interpretable as relative speedup/slowdown of the process progression. That is, an increased time scale (slowdown) leads to a delay of an event. Given that modeling the scale of the Weibull distribution is a common convention (instead of the mean <span class="math inline">\(\mu\)</span> as in <code>brms</code>), it is useful to recall that this merely means that we need to offset the intercept as estimated by <code>brms</code> with <span class="math inline">\(-\log\Gamma\left(1 + \frac{1}{\alpha} \right)\)</span> in order to obtain the scale on the log scale, <span class="math inline">\(\log(s)\)</span> (which is the what the <code>survival</code> R package would report with its <code>survreg</code> routine). The <code>survival</code> R package does futhermore use a log-linear representation of the statistical problem leading to an estimation of the inverse shape parameter <span class="math inline">\(\sigma=\frac{1}{\alpha}\)</span>.</p>
<p>The Weibull AFT model as estimated by <code>brms</code> can be converted into the respective proportional hazard model by transforming the scale <span class="math inline">\(s\)</span> with the relation <span class="math inline">\(s = \lambda^{-\frac{1}{\alpha}}\)</span> to an alternative scale parameter <span class="math inline">\(\lambda\)</span>. Doing so casts the hazard function into</p>
<p><span class="math display">\[h_{\mbox{Weibull}}(t) = \lambda \, \alpha \, t^{\alpha-1}.\]</span></p>
<p>When we now model <span class="math inline">\(\lambda\)</span> as a function of covariates <span class="math inline">\(x_i\)</span> linearly on the <span class="math inline">\(\log\)</span> scale one arrives at</p>
<p><span class="math display">\[ h_i(t) = \exp(x_i' \, \xi) \, h_{\mbox{Weibull},0}(t),\]</span></p>
<p>where <span class="math inline">\(h_{\mbox{Weibull},0}(t)\)</span> is defined by the reference covariate level <span class="math inline">\(x_i=0\)</span> such that <span class="math inline">\(\lambda = \exp(\xi_0)\)</span> for <span class="math inline">\(h_{\mbox{Weibull},0}(t)\)</span>. To now convert the AFT regression coefficients <span class="math inline">\(\beta\)</span> as estimated by <code>brms</code> to their respective proportional hazard coefficients <span class="math inline">\(\xi\)</span> one may just apply the transformation resulting in the relationship</p>
<p><span class="math display">\[\xi = -\alpha \, \beta,\]</span></p>
<p>which converts from logarithmic speedup/slowdown <span class="math inline">\(\beta\)</span> (AFT model) into logarithmic hazard ratios <span class="math inline">\(\xi\)</span> (proportional hazard model).</p>
<!---
We assume that the event times $T_i$ for patients $i=1,\ldots,N$ follow a
distribution with probability density function
$f(t| \boldsymbol{\theta})$ defined on the positive reals
(i.e. the time-to-event can only ever be positive by convention). The distribution has
parameters $\boldsymbol{\theta}$ and its cumulative distribution function
$F(t|\boldsymbol{\theta})$ is the probability for an event prior to
$t$. Moreover, the survivor function $S(t|\boldsymbol{\theta}) =
1-F(t|\boldsymbol{\theta})$ is the probability for an event to occur
later than $t$. When we observe an event time $Y_i=y_i$, the
likelihood contribution of this observation is
$f(y_i|\boldsymbol{\theta})$. If we observe that by time $Y_i=y_i$ no
event has occured and there is no further follow-up for events beyond
this point, the likelihood contribution is
$S(y_i|\boldsymbol{\theta})$ (right censoring).

A common approach to model the survival times is by considering the
hazard rate, which is the rate of events at time $t$ provided no event
has happened so far

$$h(t|\boldsymbol{\theta}) = \frac{f(t|\boldsymbol{\theta})}{S(t|\boldsymbol{\theta})}.$$

By basic time to event relationships, the hazard function
$h(t|\boldsymbol{\theta})$ defines directly the probability density
function ($f(t|\boldsymbol{\theta}) = h(t|\boldsymbol{\theta}) \,
\exp[-\int_0^t h(s|\boldsymbol{\theta})\, ds]$).

For regression modeling, we wish to compare the survival times of
different groups of patients, for example patients on a control
treatment in comparison to patients on an active treatment. We assume
that the survival times of the different groups, as defined by their
covariates $X$, are related to the model's distributional parameters
$\boldsymbol{\theta}$. In `brms` the distributional parameters
$\boldsymbol{\theta}$ are by default modelled using a linear
relationship on a transformed scale defined by a link function.


suitably to the model parameters
$\boldsymbol{\theta}$. Typically a

will typically want to assume that some
suitable function of the model parameters $\boldsymbol{\theta}$ can be
explained by a linear regression equation. 

One common approach is to
consider the hazard rate (event rate at time $t$ provided no event
happend so far) defined as $$h(t) :=
\frac{f(t;\boldsymbol{\theta})}{1-F(t;\boldsymbol{\theta})}$$ and to
model $$\log h(t) = \log h_0(t) + \boldsymbol{X_i}
\boldsymbol{\beta}.$$ Here, we call $h_0(t)$ the baseline hazard
function. The baseline hazard function describes how the hazard for an
event changes over time when all covariates are 0.

In the simple case of an exponential time-to-event regression model
$h_0(t) = h_0$ is constant. I.e. the risk of an event falling into a
time interval conditional on a patient still being at risk at the start
of the interval is the same for all time intervals of equal length.

In contrast, the baseline hazard rate is not constant for Weibull
regression. The parametrization used in `brms` for the Weibull
distribution is
$$f(t;\alpha, s) = \frac{\alpha}{s} \left(\frac{t}{s}\right)^{\alpha-1} \exp\left[-\left(\frac{t}{s}\right)^\alpha\right]$$
so that the log-hazard function is
$$\log h(t; \alpha, s) = \log \alpha - \log s + (\alpha - 1) * (\log t - \log s).$$
Thus, we can see that the baseline hazard rate increases with time, if
$\alpha > 1$, decreases, if $\alpha < 1$, and is constant when
$\alpha=1$, in which case the Weibull distribution reduces to the
exponential distribution. In this parameterization `s` and `alpha`
together define the mean of the distribution, which is given by
$E(T) = s \times \Gamma(1+1/\alpha)$.

Cox regression can be fitted in a frequentist manner using (partial)
maximum likelihood estimation without explicitly modeling $\log h_0(t)$.
However, the implicit estimate for the baseline hazard function implied
by Cox regression is a piecewise constant function that has steps at
each observed uncensored event time. `brms` implements Cox regression
using M-splines, which is a very close approximarion to cox, since the
hazard ratio is modeled in non-parametric fashion, and we can request it
with `cox(link = "log", bhaz = NULL)`.


--->
</section>
<section id="data" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="data"><span class="header-section-number">16.3</span> Data</h2>
<p>We demonstrate here the trial analysis using a fake data simulation of the trial design. As key modeling choices for the parametric modeling approach are motivated from the historical data we start with the presentation of the historical data set and then describe the details of the trial simulation.</p>
<section id="historical-data" class="level3" data-number="16.3.1">
<h3 data-number="16.3.1" class="anchored" data-anchor-id="historical-data"><span class="header-section-number">16.3.1</span> Historical data</h3>
<p>The CheckMate 649 trial <span class="citation" data-cites="Janjigian2021">(<a href="02l_single_arm_pos.html#ref-Janjigian2021" role="doc-biblioref">Janjigian et al. 2021</a>)</span> included 789 gastric cancer patients which were treated with either <code>chemoA</code> or <code>chemoB</code> and their progression free survival (PFS) was reported. Both chemotherapies were used in a roughly 1:1 ratio such that we will consider the reported data as “average” between both chemo therapies (despite lack of randomization occured wrt to chemotherapy assignment).</p>
<p>The data of trial has here been reconstructed from the published survival curves:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02i_time_to_event_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To now evaluate if the Weibull probability density function is an appropiate choice for this data we consider if the non-parametric estimate of the survivor function is compatible with properties of Weibull distributed event times. Specifically, if we transform the survivor function <span class="math inline">\(S_{\mbox{Weibull}}(t)\)</span> of the Weibull probability density function with the complementary log-log transformation, we obtain that</p>
<p><span class="math display">\[ \mbox{cloglog}(S_{\mbox{Weibull}}(t)) = \log( - \log(S_{\mbox{Weibull}}(t))) =
-\alpha \, \log(s)  + \alpha \, \log(t)\]</span></p>
<p>holds. Therefore, we can visualize an estimate of the survivor function on a transformed scale as a function of <span class="math inline">\(\log(t)\)</span> and we should observe a straight line with slope <span class="math inline">\(\alpha\)</span> and intercept <span class="math inline">\(-\alpha \, \log(s)\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>hdata2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(km, <span class="at">data=</span>hdata2, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02i_time_to_event_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While the line is not perfectly straight over the entire follow-up, the assumption of a straight line within the time period including the bulk of all events falls in the range of a good approximation with a line (as can be seen from the numbers at risk of the plot above).</p>
<p>As an additional evaluation of the Weibull distributional form we model the CheckMate 649 data via <code>brms</code> and perform a posterior predictive check. The priors are specified as illustrated in the later section on the <a href="#tte-model-prior">used priors</a>. The result looks reasonable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model_weibull_hist <span class="ot">&lt;-</span> <span class="fu">bf</span>(time <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>prior_weibull_hist <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fu">log</span>(<span class="dv">6</span>), <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>), <span class="at">class=</span>Intercept) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">3</span>, <span class="fl">2.7</span>), <span class="at">class=</span>shape)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>fit_hist_checkmate <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_weibull_hist,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>hdata2,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prior=</span>prior_weibull_hist,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed=</span><span class="dv">234235</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 1.1 seconds.
Chain 2 finished in 1.4 seconds.
Chain 3 finished in 1.6 seconds.
Chain 4 finished in 1.6 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.4 seconds.
Total execution time: 6.5 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fit_hist_checkmate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: time | cens(1 - status) ~ 1 
   Data: hdata2 (Number of observations: 789) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     2.44      0.04     2.37     2.51 1.00     2911     2563

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     1.22      0.04     1.15     1.30 1.00     2787     2417

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>With the posterior we can now perform a posterior predictive check. We do so by drawing 100 samples of the model parameters from the posterior and draw for each sample a realization of the event times for all patients. Hence, for each sample one obtains a fake data set simulated according to the Weibull distribution. Finally, each fake data set is summarized by a Kaplan-Meier estimate and drawn in light color while the actually observed data is summarized in the same way and drawn using a thick line. If the fitted model is appropiate, then the observed Kaplan Meier estimate should look just like a random realization among the many fake data generated ones. However, we observe that over the entire follow-up time the observed data is leaving for late follow-up times the bulk of the fake data generated Kaplan Meier curves. This may suggest a deviation from the Weibull distribution or the possibility that time-varying covariates are helpful. Nonetheless, if one focusses on the follow-up time frame, which includes the majoritiy of events (up to 15 month), then the posterior predictive check does look reasonable. This is why we use the Weibull distribution without a time-varying covariate for simplicity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p_full_fup <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(fit_hist_checkmate, <span class="at">status_y=</span>hdata2<span class="sc">$</span>status,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">type=</span><span class="st">"km_overlay"</span>, <span class="at">ndraws=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time [month]"</span>) <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>p_sub_fup <span class="ot">&lt;-</span> p_full_fup <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p_full_fup, p_sub_fup, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02i_time_to_event_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Note that the above predictive check does not simulate the censoring process. Thus, the censoring process is ignored and non-informative censoring is thereby assumed.</p>
</section>
<section id="trial-simulation" class="level3" data-number="16.3.2">
<h3 data-number="16.3.2" class="anchored" data-anchor-id="trial-simulation"><span class="header-section-number">16.3.2</span> Trial simulation</h3>
<p>Here we consider a fake data simulation of the trial of interest evaluating a novel treatment of gastric cancer for which an established treatment is available already. The trial is a randomized trial to study the efficacy and safety of adding a drug <code>CompoundX</code> in combination with a monoclonal antibody <code>mAb</code> + standard of care (SoC). Two chemotherapy backbones, <code>ChemoA</code> and <code>ChemoB</code> were used as SoC. There are in total four treatment arms including two control groups, which are <code>mAb</code>+<code>ChemoA</code> (<code>controlChemoA</code>) and <code>mAb</code>+<code>ChemoB</code> (<code>controlChemoB</code>), and two corresponding active arms with the test treatment administrated in addition, that is <code>CompoundX</code>+<code>mAb</code>+<code>ChemoA</code> (<code>activeChemoA</code>), <code>CompoundX</code>+<code>mAb</code>+<code>ChemoB</code> (<code>activeChemoB</code>).</p>
<p>Synthetic data were generated for the randomised study. We let the sample size of both active and control group be 100, respectively. The sample size has been chosen to ensure adequate trial power of 80%. Efficacy was assessed using progression-free survival (PFS) measured in units of months. For patients not experiencing a progression event at the time of the analysis, their event time will be right censored at the time of their last valid tumor assessment. For patients experiencing an event, their event time will be interval censored, with the upper limit of the interval being the study day on which the progression event is observed, and the lower limit being the day of the last preceding valid tumor assessment at which the patient’s progression-free status was confirmed. While interval censoring is a supported feature of <code>brms</code>, this case study will for simplicity use the actual event times and leave it to the reader to explore interval censoring with <code>brms</code>.</p>
<p>There are two historical datasets available. The first one with 400 patients on a control arm, <code>mAb</code>+<code>ChemoA</code> (<code>controlChemoA</code>), is simulated together with the randomised study. And the PFS data of 789 patients receiving first-line programmed cell death (PD-1) inhibitor+chemotherapy are available from a randomised, open-label, phase 3 trial, CheckMate 649 <span class="citation" data-cites="Janjigian2021">(<a href="02l_single_arm_pos.html#ref-Janjigian2021" role="doc-biblioref">Janjigian et al. 2021</a>)</span>, and it will be introduced later. These data are highly relevant and we would like to integrate the historical information into our analysis.</p>
<p>Simulated data will be generated using <code>simsurv</code> function via simulating survival times from the Weibull model using the proportional hazard form of the model. We assumed a 20% hazard rate (HR) reduction due to active treatment administration (<code>CompoundX</code>) to the active group in comparison to the control group and a 5% difference in HR for the two chemotherapy SoCs (<code>ChemoB</code> is 5% worse than <code>ChemoA</code> on the hazard scale). We also assumed that both of the historical data have a 2% worse outcome on the hazards scale and we represent the two studies with <code>hist1</code> and <code>hist2</code> respectively (<code>hist1</code> for simulated historidal data and <code>hist2</code> for CheckMate 649).</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">46767</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># n per group</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>n_grp <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>n_hist <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use month as time-unit</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>rate_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">6</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>rate_cens <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">trt=</span><span class="sc">-</span><span class="fl">0.2</span>,        <span class="do">## roughly 20% HR reduction</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">soc_alt=</span><span class="fl">0.05</span>,    <span class="do">## alternative chemotherapy is 5% worse</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">hist1=</span><span class="fl">0.02</span>)      <span class="do">## simulated historical data has a 2% worse outcome</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates of simulated trial data</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">2</span><span class="sc">*</span>n_grp), <span class="at">trt =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">1</span>L),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">soc_alt=</span><span class="fu">rbinom</span>(<span class="dv">2</span><span class="sc">*</span>n_grp, <span class="dv">1</span>L, <span class="fl">0.3</span>), <span class="at">hist1=</span><span class="dv">0</span>L, <span class="at">hist2=</span><span class="dv">0</span>L)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates of historical data</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>hcovs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">seq</span>(<span class="dv">2</span><span class="sc">*</span>n_grp<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">*</span>n_grp<span class="sc">+</span><span class="dv">1</span> <span class="sc">+</span>n_hist <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trt =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">soc_alt=</span><span class="dv">0</span>, <span class="at">hist1=</span><span class="dv">1</span>L, <span class="at">hist2=</span><span class="dv">0</span>L)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>simulate_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, gamma, lambda_cens, x, betas) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate censoring times, note that we do not simulate end of</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">## trial with maxt for now. Also note the different parametrization of</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simsurv which models log(shape) with a linear predictor.</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    cens <span class="ot">&lt;-</span> <span class="fu">simsurv</span>(<span class="at">lambdas =</span> lambda_cens, <span class="at">gammas =</span> <span class="dv">1</span>, <span class="at">x=</span>x)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    events <span class="ot">&lt;-</span> <span class="fu">simsurv</span>(<span class="at">lambdas =</span> lambda, <span class="at">gammas =</span> gamma, <span class="at">x=</span>x, <span class="at">betas=</span>betas)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(cens) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(cens), <span class="st">"_cens"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(events, <span class="fu">select</span>(cens, <span class="sc">-</span>id_cens), <span class="fu">select</span>(x, <span class="sc">-</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">censtime=</span>eventtime_cens) <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">event=</span><span class="dv">1</span>L<span class="sc">*</span>(eventtime <span class="sc">&lt;=</span> censtime),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="fu">if_else</span>(event<span class="sc">==</span><span class="dv">1</span>, eventtime, censtime),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">status=</span><span class="cn">NULL</span>, <span class="at">status_cens=</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(id, y, event) <span class="sc">%&gt;%</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">soc=</span><span class="fu">factor</span>(soc_alt, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">"ChemoA"</span>, <span class="st">"ChemoB"</span>)),</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">trt_ind=</span>trt,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">trt=</span><span class="fu">factor</span>(trt_ind, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"active"</span>)),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">arm=</span><span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"active"</span>)[trt_ind <span class="sc">+</span> <span class="dv">1</span>], soc),</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"activeChemoA"</span>, <span class="st">"controlChemoA"</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"activeChemoB"</span>, <span class="st">"controlChemoB"</span>)))</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co"># using shape=1 for simulation (corresponding to exponential survival times)</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">simulate_trial</span>(rate_1, <span class="dv">1</span>, rate_cens, covs, beta)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>hdata1 <span class="ot">&lt;-</span> <span class="fu">simulate_trial</span>(rate_1, <span class="dv">1</span>, rate_cens, hcovs, beta) <span class="sc">%&gt;%</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id=</span>id<span class="sc">+</span><span class="fu">max</span>(sim<span class="sc">$</span>id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can check how the simulated data looks like and its sample size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_preview</span>(sim) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">where</span>(is.double), <span class="at">decimals=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="blwcllhyqr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#blwcllhyqr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#blwcllhyqr thead, #blwcllhyqr tbody, #blwcllhyqr tfoot, #blwcllhyqr tr, #blwcllhyqr td, #blwcllhyqr th {
  border-style: none;
}

#blwcllhyqr p {
  margin: 0;
  padding: 0;
}

#blwcllhyqr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#blwcllhyqr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#blwcllhyqr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#blwcllhyqr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#blwcllhyqr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#blwcllhyqr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#blwcllhyqr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#blwcllhyqr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#blwcllhyqr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#blwcllhyqr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#blwcllhyqr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#blwcllhyqr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#blwcllhyqr .gt_spanner_row {
  border-bottom-style: hidden;
}

#blwcllhyqr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#blwcllhyqr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#blwcllhyqr .gt_from_md > :first-child {
  margin-top: 0;
}

#blwcllhyqr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#blwcllhyqr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#blwcllhyqr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#blwcllhyqr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#blwcllhyqr .gt_row_group_first td {
  border-top-width: 2px;
}

#blwcllhyqr .gt_row_group_first th {
  border-top-width: 2px;
}

#blwcllhyqr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#blwcllhyqr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#blwcllhyqr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#blwcllhyqr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#blwcllhyqr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#blwcllhyqr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#blwcllhyqr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#blwcllhyqr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#blwcllhyqr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#blwcllhyqr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#blwcllhyqr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#blwcllhyqr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#blwcllhyqr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#blwcllhyqr .gt_left {
  text-align: left;
}

#blwcllhyqr .gt_center {
  text-align: center;
}

#blwcllhyqr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#blwcllhyqr .gt_font_normal {
  font-weight: normal;
}

#blwcllhyqr .gt_font_bold {
  font-weight: bold;
}

#blwcllhyqr .gt_font_italic {
  font-style: italic;
}

#blwcllhyqr .gt_super {
  font-size: 65%;
}

#blwcllhyqr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#blwcllhyqr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#blwcllhyqr .gt_indent_1 {
  text-indent: 5px;
}

#blwcllhyqr .gt_indent_2 {
  text-indent: 10px;
}

#blwcllhyqr .gt_indent_3 {
  text-indent: 15px;
}

#blwcllhyqr .gt_indent_4 {
  text-indent: 20px;
}

#blwcllhyqr .gt_indent_5 {
  text-indent: 25px;
}

#blwcllhyqr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#blwcllhyqr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">id</th>
<th id="y" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">y</th>
<th id="event" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">event</th>
<th id="eventtime" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">eventtime</th>
<th id="censtime" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">censtime</th>
<th id="trt" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">trt</th>
<th id="soc_alt" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">soc_alt</th>
<th id="hist1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hist1</th>
<th id="hist2" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hist2</th>
<th id="soc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">soc</th>
<th id="trt_ind" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trt_ind</th>
<th id="arm" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">arm</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">1</td>
<td class="gt_row gt_right" headers="stub_1_1 id">1</td>
<td class="gt_row gt_right" headers="stub_1_1 y">7.7</td>
<td class="gt_row gt_right" headers="stub_1_1 event">0</td>
<td class="gt_row gt_right" headers="stub_1_1 eventtime">12.3</td>
<td class="gt_row gt_right" headers="stub_1_1 censtime">7.7</td>
<td class="gt_row gt_left" headers="stub_1_1 trt">control</td>
<td class="gt_row gt_right" headers="stub_1_1 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_1 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_1 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_1 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_1 trt_ind">0</td>
<td class="gt_row gt_left" headers="stub_1_1 arm">controlChemoA</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">2</td>
<td class="gt_row gt_right" headers="stub_1_2 id">2</td>
<td class="gt_row gt_right" headers="stub_1_2 y">0.1</td>
<td class="gt_row gt_right" headers="stub_1_2 event">0</td>
<td class="gt_row gt_right" headers="stub_1_2 eventtime">20.4</td>
<td class="gt_row gt_right" headers="stub_1_2 censtime">0.1</td>
<td class="gt_row gt_left" headers="stub_1_2 trt">active</td>
<td class="gt_row gt_right" headers="stub_1_2 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_2 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_2 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_2 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_2 trt_ind">1</td>
<td class="gt_row gt_left" headers="stub_1_2 arm">activeChemoA</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">3</td>
<td class="gt_row gt_right" headers="stub_1_3 id">3</td>
<td class="gt_row gt_right" headers="stub_1_3 y">4.7</td>
<td class="gt_row gt_right" headers="stub_1_3 event">0</td>
<td class="gt_row gt_right" headers="stub_1_3 eventtime">10.3</td>
<td class="gt_row gt_right" headers="stub_1_3 censtime">4.7</td>
<td class="gt_row gt_left" headers="stub_1_3 trt">control</td>
<td class="gt_row gt_right" headers="stub_1_3 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_3 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_3 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_3 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_3 trt_ind">0</td>
<td class="gt_row gt_left" headers="stub_1_3 arm">controlChemoA</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">4</td>
<td class="gt_row gt_right" headers="stub_1_4 id">4</td>
<td class="gt_row gt_right" headers="stub_1_4 y">2.7</td>
<td class="gt_row gt_right" headers="stub_1_4 event">0</td>
<td class="gt_row gt_right" headers="stub_1_4 eventtime">19.0</td>
<td class="gt_row gt_right" headers="stub_1_4 censtime">2.7</td>
<td class="gt_row gt_left" headers="stub_1_4 trt">active</td>
<td class="gt_row gt_right" headers="stub_1_4 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_4 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_4 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_4 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_4 trt_ind">1</td>
<td class="gt_row gt_left" headers="stub_1_4 arm">activeChemoA</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">5</td>
<td class="gt_row gt_right" headers="stub_1_5 id">5</td>
<td class="gt_row gt_right" headers="stub_1_5 y">3.6</td>
<td class="gt_row gt_right" headers="stub_1_5 event">1</td>
<td class="gt_row gt_right" headers="stub_1_5 eventtime">3.6</td>
<td class="gt_row gt_right" headers="stub_1_5 censtime">7.5</td>
<td class="gt_row gt_left" headers="stub_1_5 trt">control</td>
<td class="gt_row gt_right" headers="stub_1_5 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_5 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_5 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_5 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_5 trt_ind">0</td>
<td class="gt_row gt_left" headers="stub_1_5 arm">controlChemoA</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier; font-size: x-small; background-color: #E4E4E4">6..199</td>
<td class="gt_row gt_right" headers="stub_1_6 id" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 y" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 event" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 eventtime" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 censtime" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_6 trt" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 soc_alt" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 hist1" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 hist2" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_6 soc" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 trt_ind" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_left" headers="stub_1_6 arm" style="background-color: #E4E4E4"></td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">200</td>
<td class="gt_row gt_right" headers="stub_1_7 id">200</td>
<td class="gt_row gt_right" headers="stub_1_7 y">11.8</td>
<td class="gt_row gt_right" headers="stub_1_7 event">0</td>
<td class="gt_row gt_right" headers="stub_1_7 eventtime">17.1</td>
<td class="gt_row gt_right" headers="stub_1_7 censtime">11.8</td>
<td class="gt_row gt_left" headers="stub_1_7 trt">active</td>
<td class="gt_row gt_right" headers="stub_1_7 soc_alt">0</td>
<td class="gt_row gt_right" headers="stub_1_7 hist1">0</td>
<td class="gt_row gt_right" headers="stub_1_7 hist2">0</td>
<td class="gt_row gt_left" headers="stub_1_7 soc">ChemoA</td>
<td class="gt_row gt_right" headers="stub_1_7 trt_ind">1</td>
<td class="gt_row gt_left" headers="stub_1_7 arm">activeChemoA</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sim<span class="sc">$</span>arm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 activeChemoA controlChemoA  activeChemoB controlChemoB 
           72            73            28            27 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(hdata1<span class="sc">$</span>arm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 activeChemoA controlChemoA  activeChemoB controlChemoB 
            0           400             0             0 </code></pre>
</div>
</div>
</section>
</section>
<section id="models" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="models"><span class="header-section-number">16.4</span> Models</h2>
<section id="model-specification" class="level3" data-number="16.4.1">
<h3 data-number="16.4.1" class="anchored" data-anchor-id="model-specification"><span class="header-section-number">16.4.1</span> Model specification</h3>
<p>Survival data will be fitted by a Bayesian generalized linear model.</p>
<p>The survival function follows a Weibull distribution with shape parameter <span class="math inline">\(\alpha\)</span> and scale parameter <span class="math inline">\(s\)</span>,</p>
<p><span class="math display">\[T|\alpha,s \sim f_{\mbox{Weibull}}(T).\]</span></p>
<p>A common shape parameter <span class="math inline">\(\alpha\)</span> is assumed for all treatment arms, with the scale parameter allowed to vary by treatment arm. In place of directly modeling the scale parameter <span class="math inline">\(s\)</span>, the mean of the Weibull distribution is modelled on the logarithmic scale such that the scale is set to <span class="math inline">\(s = \frac{\mu}{\Gamma(1 + \frac{1}{\alpha})}\)</span> and <span class="math inline">\(\log(\mu)\)</span> is modelled as a linear function of the covariates. We use <span class="math inline">\(\lambda_{\mbox{activeChemoA}}\)</span> to represent the logarithm of the mean survival time for patients receiving <code>CompoundX</code>+<code>mAb</code>+<code>ChemoA</code> (<span class="math inline">\(\lambda_{\mbox{activeChemoA}} = \log(\mu_{\mbox{activeChemoA}})\)</span>), and <span class="math inline">\(\lambda_{\mbox{controlChemoA}}\)</span> for patients receiving <code>mAb</code>+<code>ChemoA</code>. We define <span class="math inline">\(\lambda_{\mbox{activeChemoB}}\)</span> and <span class="math inline">\(\lambda_{\mbox{controlChemoB}}\)</span> similarly for patients receiving the <code>ChemoB</code> chemotherapy backbone.</p>
<p>With 4 different patient groups we may define 4 parameters in total. The default parametrization in <code>R</code> for categorical variables is the treatment contrast representation. This representation delcares a reference category to form the overall intercept and defines differences to the overall intercept for each categorical level. As this does automatically define the parametrization of the model, we here define the contrasts in a customized manner. Doing so ensures that we control directly the exact parametrization of the model. This is important in this problem as we can then setup priors in a tailored manner. More details in defining custom contrasts are explained by Ben Bolker <a href="https://bbolker.github.io/mixedmodels-misc/notes/contrasts.pdf">here</a>.</p>
<p>In addition to the overall mean (global intercept)</p>
<p><span class="math display">\[\gamma = \frac{1}{4}( \lambda_{\mbox{activeChemoA}} +
\lambda_{\mbox{controlChemoA}} + \lambda_{\mbox{activeChemoB}} +
\lambda_{\mbox{controlChemoB}} ), \]</span></p>
<p>we define for the four groups the following contrasts of interest:</p>
<ul>
<li>Average difference between the active and control arms in each chemotherapy backbone:</li>
</ul>
<p><span class="math display">\[\delta_{\mbox{EffectAvg}} = \frac{1}{2} {
(\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) + (
\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}} ) } \]</span></p>
<ul>
<li>Half of the difference in treatment effect between the two chemotherapy backbones:</li>
</ul>
<p><span class="math display">\[\delta_{\mbox{effect}} = \frac{1}{2} { (\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) - ( \lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}}) }\]</span></p>
<ul>
<li>Difference between the two control arms:</li>
</ul>
<p><span class="math display">\[\delta_{\mbox{control}} = - \lambda_{\mbox{controlChemoA}}  +
\lambda_{\mbox{controlChemoB}} \]</span></p>
<p>To formalize these contrast definitions, we summarize the arms to parameter mapping as matrix:</p>
<div class="cell">
<div class="cell-output-display">
<div id="vmvoqvdktj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vmvoqvdktj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vmvoqvdktj thead, #vmvoqvdktj tbody, #vmvoqvdktj tfoot, #vmvoqvdktj tr, #vmvoqvdktj td, #vmvoqvdktj th {
  border-style: none;
}

#vmvoqvdktj p {
  margin: 0;
  padding: 0;
}

#vmvoqvdktj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vmvoqvdktj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vmvoqvdktj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vmvoqvdktj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vmvoqvdktj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vmvoqvdktj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmvoqvdktj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vmvoqvdktj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vmvoqvdktj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vmvoqvdktj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vmvoqvdktj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vmvoqvdktj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vmvoqvdktj .gt_spanner_row {
  border-bottom-style: hidden;
}

#vmvoqvdktj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vmvoqvdktj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vmvoqvdktj .gt_from_md > :first-child {
  margin-top: 0;
}

#vmvoqvdktj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vmvoqvdktj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vmvoqvdktj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vmvoqvdktj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vmvoqvdktj .gt_row_group_first td {
  border-top-width: 2px;
}

#vmvoqvdktj .gt_row_group_first th {
  border-top-width: 2px;
}

#vmvoqvdktj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmvoqvdktj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vmvoqvdktj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vmvoqvdktj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmvoqvdktj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmvoqvdktj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vmvoqvdktj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vmvoqvdktj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vmvoqvdktj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmvoqvdktj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vmvoqvdktj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmvoqvdktj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vmvoqvdktj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmvoqvdktj .gt_left {
  text-align: left;
}

#vmvoqvdktj .gt_center {
  text-align: center;
}

#vmvoqvdktj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vmvoqvdktj .gt_font_normal {
  font-weight: normal;
}

#vmvoqvdktj .gt_font_bold {
  font-weight: bold;
}

#vmvoqvdktj .gt_font_italic {
  font-style: italic;
}

#vmvoqvdktj .gt_super {
  font-size: 65%;
}

#vmvoqvdktj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vmvoqvdktj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vmvoqvdktj .gt_indent_1 {
  text-indent: 5px;
}

#vmvoqvdktj .gt_indent_2 {
  text-indent: 10px;
}

#vmvoqvdktj .gt_indent_3 {
  text-indent: 15px;
}

#vmvoqvdktj .gt_indent_4 {
  text-indent: 20px;
}

#vmvoqvdktj .gt_indent_5 {
  text-indent: 25px;
}

#vmvoqvdktj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vmvoqvdktj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Parameter" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Parameter</th>
<th id="a$\lambda_{\mbox{activeChemoA}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\lambda_{\mbox{activeChemoA}}$</th>
<th id="a$\lambda_{\mbox{controlChemoA}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\lambda_{\mbox{controlChemoA}}$</th>
<th id="a$\lambda_{\mbox{activeChemoB}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\lambda_{\mbox{activeChemoB}}$</th>
<th id="a$\lambda_{\mbox{controlChemoB}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\lambda_{\mbox{controlChemoB}}$</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\gamma\)</span></td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoA}}$">1/4</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoA}}$">1/4</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoB}}$">1/4</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoB}}$">1/4</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{EffectAvg}}\)</span></td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoA}}$">1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoA}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoB}}$">1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoB}}$">-1/2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{effect}}\)</span>$</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoA}}$">1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoA}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoB}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoB}}$">1/2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{control}}\)</span></td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoA}}$">0</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoA}}$">-1</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{activeChemoB}}$">0</td>
<td class="gt_row gt_right" headers="$\lambda_{\mbox{controlChemoB}}$">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this form it is straightforward to derive the definition of a parameter and how it relates to the strata of the data based on the parameter definitions. However, in order to define the design matrix, which maps parameters to data strata, we will need the inverse of the above matrix. By convention <code>R</code> requires for the specification of custom contrats, the matrix mapping parameters to the data means such that the above matrix is referred to as <span class="math inline">\(C^{-1}\)</span> in the following.</p>
<p>The linear model for <span class="math inline">\(\log(\mu)\)</span> is parameterised in terms of the defined contrasts with additional parameters allowing for heterogeneity between data from the two separate historical data strata. For the 4 different treatment arms the linear predictor is then given by:</p>
<p><span class="math display">\[\begin{align}
\begin{bmatrix}
\lambda_{\mbox{activeChemoA}} \\
\lambda_{\mbox{controlChemoA}} \\
\lambda_{\mbox{activeChemoB}} \\
\lambda_{\mbox{controlChemoB}}
\end{bmatrix}
&amp;= C \,
\begin{bmatrix}
    \gamma \\
    \delta_{\mbox{EffectAvg}} \\
    \delta_{\mbox{effect}} \\
    \delta_{\mbox{control}}
        \end{bmatrix}
+ I_{\mbox{hist1}} \,
\beta_{\mbox{hist1}} + I_{\mbox{hist2}} \, \beta_{\mbox{hist2}}
\end{align}\]</span></p>
<p>The indicators <span class="math inline">\(I_{\mbox{hist1}}\)</span> and <span class="math inline">\(I_{\mbox{hist2}}\)</span> represent that a patient was in the simulated historical stratum, or in the historical CheckMate 649 stratum, respectively. The corresponding parameters <span class="math inline">\(\beta_{\mbox{hist1}}\)</span> and <span class="math inline">\(\beta_{\mbox{hist2}}\)</span> capture differences in outcome between these two historical strata, and patients in our randomised comparison. In order to borrow strength from the historical data, the prior on these two regression coefficients are set reasonably narrow which in effect emulates a random effects meta-analysis.</p>
<p>As the historical data set reported in CheckMate 649 reported the outcome for the control treatment with a mixed population of 50% being on either SoC, we consider this data to report an average SoC effect. Basic algebra shows that <span class="math display">\[\frac{1}{2} \,
(\lambda_{\mbox{activeChemoA}} + \lambda_{\mbox{activeChemoB}}) = \gamma -
\frac{1}{2} \, \delta_{\mbox{effect}}. \]</span> Thus, we may simply add an additional row to the matrix <span class="math inline">\(C\)</span> such that the full matrix <span class="math inline">\(C\)</span> is:</p>
<div class="cell">
<div class="cell-output-display">
<div id="rddjzxyvan" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rddjzxyvan table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rddjzxyvan thead, #rddjzxyvan tbody, #rddjzxyvan tfoot, #rddjzxyvan tr, #rddjzxyvan td, #rddjzxyvan th {
  border-style: none;
}

#rddjzxyvan p {
  margin: 0;
  padding: 0;
}

#rddjzxyvan .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rddjzxyvan .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rddjzxyvan .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rddjzxyvan .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rddjzxyvan .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rddjzxyvan .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rddjzxyvan .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rddjzxyvan .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rddjzxyvan .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rddjzxyvan .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rddjzxyvan .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rddjzxyvan .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rddjzxyvan .gt_spanner_row {
  border-bottom-style: hidden;
}

#rddjzxyvan .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rddjzxyvan .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rddjzxyvan .gt_from_md > :first-child {
  margin-top: 0;
}

#rddjzxyvan .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rddjzxyvan .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rddjzxyvan .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rddjzxyvan .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rddjzxyvan .gt_row_group_first td {
  border-top-width: 2px;
}

#rddjzxyvan .gt_row_group_first th {
  border-top-width: 2px;
}

#rddjzxyvan .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rddjzxyvan .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rddjzxyvan .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rddjzxyvan .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rddjzxyvan .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rddjzxyvan .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rddjzxyvan .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rddjzxyvan .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rddjzxyvan .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rddjzxyvan .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rddjzxyvan .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rddjzxyvan .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rddjzxyvan .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rddjzxyvan .gt_left {
  text-align: left;
}

#rddjzxyvan .gt_center {
  text-align: center;
}

#rddjzxyvan .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rddjzxyvan .gt_font_normal {
  font-weight: normal;
}

#rddjzxyvan .gt_font_bold {
  font-weight: bold;
}

#rddjzxyvan .gt_font_italic {
  font-style: italic;
}

#rddjzxyvan .gt_super {
  font-size: 65%;
}

#rddjzxyvan .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rddjzxyvan .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rddjzxyvan .gt_indent_1 {
  text-indent: 5px;
}

#rddjzxyvan .gt_indent_2 {
  text-indent: 10px;
}

#rddjzxyvan .gt_indent_3 {
  text-indent: 15px;
}

#rddjzxyvan .gt_indent_4 {
  text-indent: 20px;
}

#rddjzxyvan .gt_indent_5 {
  text-indent: 25px;
}

#rddjzxyvan .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rddjzxyvan div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Treatment-arm" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Treatment arm</th>
<th id="a$\gamma$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\gamma$</th>
<th id="a$\delta_{\mbox{EffectAvg}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\delta_{\mbox{EffectAvg}}$</th>
<th id="a$\delta_{\mbox{effect}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\delta_{\mbox{effect}}$</th>
<th id="a$\delta_{\mbox{control}}$" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">$\delta_{\mbox{control}}$</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Treatment arm">activeChemoA</td>
<td class="gt_row gt_right" headers="$\gamma$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{EffectAvg}}$">1/2</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{effect}}$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{control}}$">-1/2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Treatment arm">controlChemoA</td>
<td class="gt_row gt_right" headers="$\gamma$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{EffectAvg}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{effect}}$">0</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{control}}$">-1/2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Treatment arm">activeChemoB</td>
<td class="gt_row gt_right" headers="$\gamma$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{EffectAvg}}$">1/2</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{effect}}$">-1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{control}}$">1/2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Treatment arm">controlChemoB</td>
<td class="gt_row gt_right" headers="$\gamma$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{EffectAvg}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{effect}}$">0</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{control}}$">1/2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Treatment arm">controlAverage</td>
<td class="gt_row gt_right" headers="$\gamma$">1</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{EffectAvg}}$">-1/2</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{effect}}$">0</td>
<td class="gt_row gt_right" headers="$\delta_{\mbox{control}}$">0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="tte-model-prior" class="level3" data-number="16.4.2">
<h3 data-number="16.4.2" class="anchored" data-anchor-id="tte-model-prior"><span class="header-section-number">16.4.2</span> Priors</h3>
<p>Priors for each random variable are described in the following table.</p>
<div class="cell">
<div class="cell-output-display">
<div id="qjypentcxf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qjypentcxf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qjypentcxf thead, #qjypentcxf tbody, #qjypentcxf tfoot, #qjypentcxf tr, #qjypentcxf td, #qjypentcxf th {
  border-style: none;
}

#qjypentcxf p {
  margin: 0;
  padding: 0;
}

#qjypentcxf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qjypentcxf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qjypentcxf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qjypentcxf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qjypentcxf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qjypentcxf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qjypentcxf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qjypentcxf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qjypentcxf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qjypentcxf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qjypentcxf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qjypentcxf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qjypentcxf .gt_spanner_row {
  border-bottom-style: hidden;
}

#qjypentcxf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qjypentcxf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qjypentcxf .gt_from_md > :first-child {
  margin-top: 0;
}

#qjypentcxf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qjypentcxf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qjypentcxf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qjypentcxf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qjypentcxf .gt_row_group_first td {
  border-top-width: 2px;
}

#qjypentcxf .gt_row_group_first th {
  border-top-width: 2px;
}

#qjypentcxf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qjypentcxf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qjypentcxf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qjypentcxf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qjypentcxf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qjypentcxf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qjypentcxf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qjypentcxf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qjypentcxf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qjypentcxf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qjypentcxf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qjypentcxf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qjypentcxf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qjypentcxf .gt_left {
  text-align: left;
}

#qjypentcxf .gt_center {
  text-align: center;
}

#qjypentcxf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qjypentcxf .gt_font_normal {
  font-weight: normal;
}

#qjypentcxf .gt_font_bold {
  font-weight: bold;
}

#qjypentcxf .gt_font_italic {
  font-style: italic;
}

#qjypentcxf .gt_super {
  font-size: 65%;
}

#qjypentcxf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qjypentcxf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qjypentcxf .gt_indent_1 {
  text-indent: 5px;
}

#qjypentcxf .gt_indent_2 {
  text-indent: 10px;
}

#qjypentcxf .gt_indent_3 {
  text-indent: 15px;
}

#qjypentcxf .gt_indent_4 {
  text-indent: 20px;
}

#qjypentcxf .gt_indent_5 {
  text-indent: 25px;
}

#qjypentcxf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qjypentcxf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Parameter" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Parameter</th>
<th id="Prior" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Prior</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\alpha\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\Gamma(3, 2.7)\)</span></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\gamma\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}( \log(\frac{8}{\log(2)}), \frac{\log(4)}{1.64})\)</span></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{effectAvg}}\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}(0, \frac{\log(2)}{1.64})\)</span></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{effect}}\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}(0, \frac{\log(1.25)}{1.64})\)</span></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\delta_{\mbox{control}}\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}(0, \frac{\log(1.25)}{1.64})\)</span></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\beta_{\mbox{hist1}}\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}(0, \frac{\log(1.8)}{1.64})\)</span></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Parameter"><span class="math inline">\(\beta_{\mbox{hist2}}\)</span></td>
<td class="gt_row gt_left" headers="Prior"><span class="math inline">\(\mbox{Normal}(0, \frac{\log(1.8)}{1.64})\)</span></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These priors parametrize the central 90% credible interval for the respective normal priors used. As the parameters are additive on the <span class="math inline">\(\log\)</span> scale, the standard deviation of <span class="math inline">\(\log(2)/\Phi^{-1}(95\%)
\approx \log(2)/1.64\)</span> defines a 90% credible interval of <span class="math inline">\([-\log(2), \log(2)]\)</span> and implies on the back-transformed scale a respective interval of <span class="math inline">\([1/2, 2]\)</span>, i.e.&nbsp;a doubling or a halving of the progression speed.</p>
<p>The common shape parameter, <span class="math inline">\(\alpha\)</span>, is set to have median value of unity and it’s 90% credible interval is <span class="math inline">\([0.3, 2.33]\)</span>, which admits substantial deviation from unity, which is the case of exponential survival time distribution.</p>
<p>The prior for <span class="math inline">\(\gamma\)</span>, the intercept, is set with a mean approximately corresponding to expected median PFS on anti-PD-1 with SoC, as estimated from CheckMate 649 (approx. 8 months). The width of the central 90% credible interval for the intercept prior <span class="math inline">\(\gamma\)</span> is set to admit for a 4 fold increase or decrease. A priori it is expected that the outcome for <code>controlChemoA</code>and <code>controlChemoB</code> will be similar (Janjijian et al, mPFS by chemotherapy not provided, but mOS was 14 months for both anti-PD1+Chemotherapy backbones (considered as similar to <code>mAb</code>+<code>ChemoA</code> and<code>mAb</code>+<code>ChemoB</code> in our simulated data), hence a prior for <span class="math inline">\(\delta_{\mbox{control}}\)</span> is centered on 0 with a standard deviation corresponding to a 25% increase or decrease is chosen for the 90% credible interval. Similarly, the treatment benefit from adding <code>CompoundX</code> is expected to be similar for both arms, so the prior for <span class="math inline">\(\delta_{\mbox{effect}}\)</span> is again centered on 0 with the prior admitting a 25% increase or decrease a priori in terms of the 90% central credible interval. Priors for <span class="math inline">\(\beta_{\mbox{hist1}}\)</span> and <span class="math inline">\(\beta_{\mbox{hist2}}\)</span> are centered at a mean of 0, corresponding to no difference in outcome for the two historical studies as compared to this trial’s randomised part, but with the same variance allowing substantial differences between the randomised study and historical data. The use of Student-t priors for these parameters also robustifies against possible data discordance between the randomised comparison and historical data.</p>
<p>These prior definitions provide an uninformative prior, that allows for a broad range of shapes for the survival curve.</p>
</section>
</section>
<section id="implementationresults" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="implementationresults"><span class="header-section-number">16.5</span> Implementation/Results</h2>
<section id="construct-customized-coded-contrasts" class="level3" data-number="16.5.1">
<h3 data-number="16.5.1" class="anchored" data-anchor-id="construct-customized-coded-contrasts"><span class="header-section-number">16.5.1</span> Construct customized coded contrasts</h3>
<p>First we define customized contrasts which define the parametrization of the model as defined in the <em>Model sepcification</em> section.</p>
<p>The mapping of data strata to parameters is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cc_inv <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">0</span>,   <span class="sc">-</span><span class="dv">1</span>,    <span class="dv">0</span>,    <span class="dv">1</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">nrow=</span><span class="dv">4</span>, <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">dimnames=</span><span class="fu">list</span>(<span class="at">contrast=</span><span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"deltaEffectAvg"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"deltaEffect"</span>, <span class="st">"deltaControl"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">arm=</span><span class="fu">c</span>(<span class="st">"activeChemoA"</span>, <span class="st">"controlChemoA"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"activeChemoB"</span>, <span class="st">"controlChemoB"</span>)))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(cc_inv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                arm
contrast         activeChemoA controlChemoA activeChemoB controlChemoB
  intercept       1/4          1/4           1/4          1/4         
  deltaEffectAvg  1/2         -1/2           1/2         -1/2         
  deltaEffect     1/2         -1/2          -1/2          1/2         
  deltaControl      0           -1             0            1         </code></pre>
</div>
</div>
<p><code>intercept</code> (<span class="math inline">\(\gamma\)</span>) is the overall mean while <code>deltaControl</code> (<span class="math inline">\(\delta_{\mbox{control}}\)</span>) is the difference between the two control arms.</p>
<p>By way of defining <code>deltaEffectAvg</code> (<span class="math inline">\(\delta_{\mbox{EffectAvg}}\)</span>) we obtain the average treatment effect. Setting <code>deltaEffect</code> (<span class="math inline">\(\delta_{\mbox{effect}}\)</span>) to half of the difference between the two treatment effects one arrives at the following symmetric relations to obtain the chemo therapy specific treatment effect:</p>
<p><span class="math display">\[\delta_{\mbox{EffectAvg}} = \frac{1}{2} \, [
(\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) +
(\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}})]\]</span></p>
<p><span class="math display">\[\delta_{\mbox{effect}} = \frac{1}{2} \, [ (\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) - (\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}})]\]</span></p>
<p><span class="math display">\[ \Leftrightarrow \delta_{\mbox{effectChemoA}}  =
\delta_{\mbox{effectAvg}} + \delta_{\mbox{effect}}\]</span></p>
<p><span class="math display">\[ \Leftrightarrow \delta_{\mbox{effectChemoB}}  = \delta_{\mbox{effectAvg}} - \delta_{\mbox{effect}}\]</span></p>
<p><code>R</code> requires to define the inverse relationship, i.e.&nbsp;the mapping from parameters to data strata (as needed to define the design matrix). Therefore, the contrast matrix <span class="math inline">\(C\)</span> is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">solve</span>(cc_inv)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(cc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              intercept deltaEffectAvg deltaEffect deltaControl
activeChemoA     1       1/2              1        -1/2        
controlChemoA    1      -1/2              0        -1/2        
activeChemoB     1       1/2             -1         1/2        
controlChemoB    1      -1/2              0         1/2        </code></pre>
</div>
</div>
<p>In order to setup custom contrasts of discrete explanatory variables like treatment arms, <code>R</code> requires to define the explanatory variable as <code>factor</code>, which has been defined accordingly in the simulation routine of this case study:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sim<span class="sc">$</span>arm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "activeChemoA"  "controlChemoA" "activeChemoB"  "controlChemoB"</code></pre>
</div>
</div>
<p>As <code>R</code> sets up the overall intercept separatley, we need to drop the overall intercept definition from <span class="math inline">\(C\)</span> and define the contrast of the <code>factor</code> variable to be equal to the matrix <span class="math inline">\(C\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(sim<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then to check if the contrasts work as expected, we can use a dummy fit to see if things get used correctly and the results here are consistent with our definitions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lfit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, sim)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lfit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ 1 + arm, data = sim)

Residuals:
   Min     1Q Median     3Q    Max 
-5.506 -2.909 -1.461  1.261 17.064 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         4.5023     0.3349  13.444   &lt;2e-16 ***
armdeltaEffectAvg   0.9641     0.6698   1.439    0.152    
armdeltaEffect     -0.4516     0.6698  -0.674    0.501    
armdeltaControl     0.6574     0.9526   0.690    0.491    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.229 on 196 degrees of freedom
Multiple R-squared:  0.02433,   Adjusted R-squared:  0.009398 
F-statistic: 1.629 on 3 and 196 DF,  p-value: 0.1839</code></pre>
</div>
</div>
<p>We can see that above model specification for <code>lm</code> estimates the parameter coefficient for the three contrasts <code>armdeltaEffectAvg</code> (<span class="math inline">\(\delta_{\mbox{EffectAvg}}\)</span>), <code>armdeltaEffect</code> (<span class="math inline">\(\delta_{\mbox{effect}}\)</span>) and <code>armdeltaControl</code> (<span class="math inline">\(\delta_{\mbox{control}}\)</span>).</p>
</section>
<section id="model-fit-with-brms" class="level3" data-number="16.5.2">
<h3 data-number="16.5.2" class="anchored" data-anchor-id="model-fit-with-brms"><span class="header-section-number">16.5.2</span> Model fit with <code>brms</code></h3>
<p>Now we start with analyzing the simulated randomized study and specify the <code>brms</code> model using a Weibull distribution. In a first version, we do not include the literature historical data which requires the definition of a custom design matrix as will be explained below.</p>
<p>First we define with a call to <code>bf</code> the model formula and model family. This defines the model’s likelihood and the parametrization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model_weibull <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, <span class="at">family=</span><span class="fu">weibull</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The left hand side of the formula, <code>y | cens(1-event) ~ ...</code>, denotes with <span class="math inline">\(y\)</span> the data being modeled - the time variable -, while <code>cens</code> is a response modifier added with a vertical bar<code>|</code> to the left hand side. Here, <code>cens</code> defines which data rows correspond to (right) censored observations. The censoring information is passed into <code>cens</code> by the variable <code>1-event</code>. The right hand side defines the linear regressor formula used for the mean parameter of the model, which is in this case modeled by default with a <span class="math inline">\(\log\)</span> link function. The formula <code>1 + arm</code> defines an overall intercept and the covariate <code>arm</code> (coded as <code>factor</code> in the data) is used with it’s custom constrasts as explanatory variable. Finally, the <code>family</code> argument specifies that the event and censoring times stored in <span class="math inline">\(y\)</span> are distributed according to a <code>weibull</code> probability density distribution.</p>
<p>With the model (and data) being defined, we are left to specify the priors for the model. With the help of the <code>get_prior</code> function we can report which default priors and parameters were instantiated by <code>brms</code> and hence need an assignment of a prior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_weibull, sim))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="siluayrtza" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#siluayrtza table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#siluayrtza thead, #siluayrtza tbody, #siluayrtza tfoot, #siluayrtza tr, #siluayrtza td, #siluayrtza th {
  border-style: none;
}

#siluayrtza p {
  margin: 0;
  padding: 0;
}

#siluayrtza .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#siluayrtza .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#siluayrtza .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#siluayrtza .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#siluayrtza .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#siluayrtza .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#siluayrtza .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#siluayrtza .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#siluayrtza .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#siluayrtza .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#siluayrtza .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#siluayrtza .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#siluayrtza .gt_spanner_row {
  border-bottom-style: hidden;
}

#siluayrtza .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#siluayrtza .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#siluayrtza .gt_from_md > :first-child {
  margin-top: 0;
}

#siluayrtza .gt_from_md > :last-child {
  margin-bottom: 0;
}

#siluayrtza .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#siluayrtza .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#siluayrtza .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#siluayrtza .gt_row_group_first td {
  border-top-width: 2px;
}

#siluayrtza .gt_row_group_first th {
  border-top-width: 2px;
}

#siluayrtza .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#siluayrtza .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#siluayrtza .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#siluayrtza .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#siluayrtza .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#siluayrtza .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#siluayrtza .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#siluayrtza .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#siluayrtza .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#siluayrtza .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#siluayrtza .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#siluayrtza .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#siluayrtza .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#siluayrtza .gt_left {
  text-align: left;
}

#siluayrtza .gt_center {
  text-align: center;
}

#siluayrtza .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#siluayrtza .gt_font_normal {
  font-weight: normal;
}

#siluayrtza .gt_font_bold {
  font-weight: bold;
}

#siluayrtza .gt_font_italic {
  font-style: italic;
}

#siluayrtza .gt_super {
  font-size: 65%;
}

#siluayrtza .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#siluayrtza .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#siluayrtza .gt_indent_1 {
  text-indent: 5px;
}

#siluayrtza .gt_indent_2 {
  text-indent: 10px;
}

#siluayrtza .gt_indent_3 {
  text-indent: 15px;
}

#siluayrtza .gt_indent_4 {
  text-indent: 20px;
}

#siluayrtza .gt_indent_5 {
  text-indent: 25px;
}

#siluayrtza .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#siluayrtza div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="prior" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">prior</th>
<th id="class" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">class</th>
<th id="coef" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">coef</th>
<th id="group" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">group</th>
<th id="resp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">resp</th>
<th id="dpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">dpar</th>
<th id="nlpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">nlpar</th>
<th id="lb" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lb</th>
<th id="ub" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ub</th>
<th id="source" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">source</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaControl</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffect</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffectAvg</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior">student_t(3, 1, 2.5)</td>
<td class="gt_row gt_left" headers="class">Intercept</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior">gamma(0.01, 0.01)</td>
<td class="gt_row gt_left" headers="class">shape</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb">0</td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we define the priors with standard deviations stored in variables, which are passed as <code>stanvars</code> to the <code>brms</code> model. Doing so allows to change the prior quickly, since the Stan model as generated by <code>brms</code> remains unchanged whenever the standard deviation of a prior is changed. A priori it is expected that the outcome for the two control groups will be similar, so the prior on <code>deltaControl</code> (<span class="math inline">\(\delta_{\mbox{control}}\)</span>) is centered on <span class="math inline">\(0\)</span>. The same is a priori assumed for the <code>deltaEffect</code> (<span class="math inline">\(\delta_{\mbox{effect}}\)</span>) parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model_weibull_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(meanInter, <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">class=</span><span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdEffectAvg), <span class="at">coef=</span>armdeltaEffectAvg) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaEffect), <span class="at">coef=</span>armdeltaEffect) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaControl), <span class="at">coef=</span>armdeltaControl) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">3</span>, <span class="fl">2.7</span>), <span class="at">class=</span>shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The prior for the intercept, <span class="math inline">\(\gamma\)</span>, is set to a mean approximately corresponding to an expected median PFS on anti-PD-1 + SoC, as estimated from CheckMate 649 (here 8 month)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="dv">8</span><span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)), <span class="st">"meanInter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The standard deviations are setup with reference to a <span class="math inline">\(90 \%\)</span> credible interval. Hence, <span class="math inline">\(log(2)/1.64\)</span> for the standard deviation of the prior for <code>deltaEffectAvg</code> (<span class="math inline">\(\delta_{\mbox{effectAvg}}\)</span>) means that the event process can increase/decrease in progression speed by a factor of <span class="math inline">\(2\)</span> at most.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>prior_sd <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="dv">2</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdEffectAvg"</span>) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.25</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdDeltaEffect"</span>)<span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.25</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdDeltaControl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the model and prior specifications are complete and we are ready to run the model in <code>brms</code>. First fit the model using the randomized study data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fit_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_weibull, <span class="at">data=</span>sim, <span class="at">prior=</span>model_weibull_prior,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.4 seconds.
Chain 2 finished in 0.5 seconds.
Chain 3 finished in 0.4 seconds.
Chain 4 finished in 0.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.4 seconds.
Total execution time: 2.4 seconds.</code></pre>
</div>
</div>
<p>When looking at the model summary, it is preferable to use <code>robust=TRUE</code> to get the median estimate of the posterior rather than the mean (which would change due to transforms)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + arm 
   Data: sim (Number of observations: 200) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.16      0.12     1.98     2.36 1.00     3986     3061
armdeltaEffectAvg     0.26      0.19    -0.05     0.58 1.00     4044     2592
armdeltaEffect        0.00      0.11    -0.17     0.18 1.00     4081     2772
armdeltaControl       0.06      0.12    -0.13     0.26 1.00     4307     3010

Further Distributional Parameters:
      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
shape     0.97      0.08     0.86     1.10 1.00     4028     2871

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Summarize posterior draws based on point estimates, estimation errors and quantiles. And we transform the estimates to the original scale</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>post_sum <span class="ot">&lt;-</span> <span class="fu">posterior_summary</span>(fit_weibull, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">exp</span>(post_sum[,<span class="st">"Estimate"</span>]), <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        b_Intercept b_armdeltaEffectAvg    b_armdeltaEffect   b_armdeltaControl               shape           Intercept 
            8.6e+00             1.3e+00             1.0e+00             1.1e+00             2.6e+00             8.5e+00 
             lprior                lp__ 
            1.0e+00            5.7e-140 </code></pre>
</div>
</div>
<p>These estimates are the AFT regression coefficients such that the effect of treatment is to <em>slowdown</em> the time to an event and thus the treatment effect estimate <span class="math inline">\(\delta_{\mbox{effectAvg}}\)</span> is positive. To convert to hazard ratios, one needs to multiply with the negative of the estimated shape parameter. Doing so for all 3 regression coefficients by using the <code>rvar</code> facility (provided from the <code>posterior</code> R package) yields:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>post_rv <span class="ot">&lt;-</span> <span class="fu">as_draws_rvars</span>(fit_weibull)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>post_rv_HR <span class="ot">&lt;-</span> <span class="fu">with</span>(post_rv, <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> shape <span class="sc">*</span> <span class="fu">c</span>(b_armdeltaEffectAvg, b_armdeltaEffect, b_armdeltaControl)))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(post_rv_HR) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"deltaEffectAvg"</span>, <span class="st">"deltaEffect"</span>, <span class="st">"deltaControl"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_draws</span>(post_rv_HR), <span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 10
  variable                    mean median    sd   mad    q5   q95  rhat ess_bulk ess_tail
  &lt;chr&gt;                      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 post_rv_HR[deltaEffectAvg] 0.786  0.775 0.148 0.143 0.568  1.05  1.00    4248.    2594.
2 post_rv_HR[deltaEffect]    1.00   0.998 0.105 0.105 0.838  1.18  1.00    4081.    2907.
3 post_rv_HR[deltaControl]   0.948  0.942 0.109 0.106 0.774  1.13  1.00    4302.    3109.</code></pre>
</div>
</div>
<p>Obtain posterior mean estimates (mean rate). Median of the posterior estimates indicated a roughly 20% increase in survival in <code>activeChemoA</code> compared to <code>controlChemoA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span><span class="dv">0</span>, <span class="at">event=</span><span class="dv">0</span>, <span class="at">arm=</span><span class="fu">levels</span>(sim<span class="sc">$</span>arm))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>post_mean <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_weibull, <span class="at">newdata=</span>nd)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(post_mean) <span class="ot">&lt;-</span> nd<span class="sc">$</span>arm</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(post_mean[,<span class="st">"activeChemoA"</span>] <span class="sc">/</span> post_mean[,<span class="st">"controlChemoA"</span>],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      5%      50%      95% 
0.939546 1.306990 1.824785 </code></pre>
</div>
</div>
<p>Now extract posterior coefficients with a 90% credible interval</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>post_est <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit_weibull, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">as.data.frame</span>(post_est)) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">everything</span>(), <span class="at">decimals=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="avrqllsarg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#avrqllsarg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#avrqllsarg thead, #avrqllsarg tbody, #avrqllsarg tfoot, #avrqllsarg tr, #avrqllsarg td, #avrqllsarg th {
  border-style: none;
}

#avrqllsarg p {
  margin: 0;
  padding: 0;
}

#avrqllsarg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#avrqllsarg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#avrqllsarg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#avrqllsarg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#avrqllsarg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#avrqllsarg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#avrqllsarg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#avrqllsarg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#avrqllsarg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#avrqllsarg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#avrqllsarg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#avrqllsarg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#avrqllsarg .gt_spanner_row {
  border-bottom-style: hidden;
}

#avrqllsarg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#avrqllsarg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#avrqllsarg .gt_from_md > :first-child {
  margin-top: 0;
}

#avrqllsarg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#avrqllsarg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#avrqllsarg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#avrqllsarg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#avrqllsarg .gt_row_group_first td {
  border-top-width: 2px;
}

#avrqllsarg .gt_row_group_first th {
  border-top-width: 2px;
}

#avrqllsarg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#avrqllsarg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#avrqllsarg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#avrqllsarg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#avrqllsarg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#avrqllsarg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#avrqllsarg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#avrqllsarg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#avrqllsarg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#avrqllsarg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#avrqllsarg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#avrqllsarg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#avrqllsarg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#avrqllsarg .gt_left {
  text-align: left;
}

#avrqllsarg .gt_center {
  text-align: center;
}

#avrqllsarg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#avrqllsarg .gt_font_normal {
  font-weight: normal;
}

#avrqllsarg .gt_font_bold {
  font-weight: bold;
}

#avrqllsarg .gt_font_italic {
  font-style: italic;
}

#avrqllsarg .gt_super {
  font-size: 65%;
}

#avrqllsarg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#avrqllsarg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#avrqllsarg .gt_indent_1 {
  text-indent: 5px;
}

#avrqllsarg .gt_indent_2 {
  text-indent: 10px;
}

#avrqllsarg .gt_indent_3 {
  text-indent: 15px;
}

#avrqllsarg .gt_indent_4 {
  text-indent: 20px;
}

#avrqllsarg .gt_indent_5 {
  text-indent: 25px;
}

#avrqllsarg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#avrqllsarg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Est.Error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Est.Error</th>
<th id="Q5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q5</th>
<th id="Q95" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q95</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Estimate">2.16</td>
<td class="gt_row gt_right" headers="Est.Error">0.12</td>
<td class="gt_row gt_right" headers="Q5">1.98</td>
<td class="gt_row gt_right" headers="Q95">2.36</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Estimate">0.26</td>
<td class="gt_row gt_right" headers="Est.Error">0.19</td>
<td class="gt_row gt_right" headers="Q5">−0.05</td>
<td class="gt_row gt_right" headers="Q95">0.58</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Estimate">0.00</td>
<td class="gt_row gt_right" headers="Est.Error">0.11</td>
<td class="gt_row gt_right" headers="Q5">−0.17</td>
<td class="gt_row gt_right" headers="Q95">0.18</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Estimate">0.06</td>
<td class="gt_row gt_right" headers="Est.Error">0.12</td>
<td class="gt_row gt_right" headers="Q5">−0.13</td>
<td class="gt_row gt_right" headers="Q95">0.26</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Define trial successfull if the <code>deltaEffectAvg</code> exceed 0 (which means the survival time is increased) and the result is not significant here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>post_est[<span class="st">"armdeltaEffectAvg"</span>,<span class="st">"Q5"</span>] <span class="sc">&gt;</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
<section id="incoporate-simulated-historical-data" class="level3" data-number="16.5.3">
<h3 data-number="16.5.3" class="anchored" data-anchor-id="incoporate-simulated-historical-data"><span class="header-section-number">16.5.3</span> Incoporate simulated historical data</h3>
<p>Since we have the simulated historical data <code>hist1</code> on one control arm, we can incorporate the information by adding the corresponding covariate <code>hist1</code> (indicator variable being <span class="math inline">\(1\)</span> for the historical study and <span class="math inline">\(0\)</span> otherwise) when specifying the formula for meta-analytic-combined (MAC) analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model_mac_weibull <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm <span class="sc">+</span> hist1, <span class="at">family=</span><span class="fu">weibull</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And <code>get_prior</code> function shows that in addition to the priors for the weibull model on randomised data, the co-data model needs one more prior on the historical data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_mac_weibull, sim))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tmjvcfltkk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tmjvcfltkk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tmjvcfltkk thead, #tmjvcfltkk tbody, #tmjvcfltkk tfoot, #tmjvcfltkk tr, #tmjvcfltkk td, #tmjvcfltkk th {
  border-style: none;
}

#tmjvcfltkk p {
  margin: 0;
  padding: 0;
}

#tmjvcfltkk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tmjvcfltkk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tmjvcfltkk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tmjvcfltkk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tmjvcfltkk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tmjvcfltkk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmjvcfltkk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tmjvcfltkk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tmjvcfltkk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tmjvcfltkk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tmjvcfltkk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tmjvcfltkk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tmjvcfltkk .gt_spanner_row {
  border-bottom-style: hidden;
}

#tmjvcfltkk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tmjvcfltkk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tmjvcfltkk .gt_from_md > :first-child {
  margin-top: 0;
}

#tmjvcfltkk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tmjvcfltkk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tmjvcfltkk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tmjvcfltkk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tmjvcfltkk .gt_row_group_first td {
  border-top-width: 2px;
}

#tmjvcfltkk .gt_row_group_first th {
  border-top-width: 2px;
}

#tmjvcfltkk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmjvcfltkk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tmjvcfltkk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tmjvcfltkk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmjvcfltkk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmjvcfltkk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tmjvcfltkk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tmjvcfltkk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tmjvcfltkk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmjvcfltkk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tmjvcfltkk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmjvcfltkk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tmjvcfltkk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmjvcfltkk .gt_left {
  text-align: left;
}

#tmjvcfltkk .gt_center {
  text-align: center;
}

#tmjvcfltkk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tmjvcfltkk .gt_font_normal {
  font-weight: normal;
}

#tmjvcfltkk .gt_font_bold {
  font-weight: bold;
}

#tmjvcfltkk .gt_font_italic {
  font-style: italic;
}

#tmjvcfltkk .gt_super {
  font-size: 65%;
}

#tmjvcfltkk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tmjvcfltkk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tmjvcfltkk .gt_indent_1 {
  text-indent: 5px;
}

#tmjvcfltkk .gt_indent_2 {
  text-indent: 10px;
}

#tmjvcfltkk .gt_indent_3 {
  text-indent: 15px;
}

#tmjvcfltkk .gt_indent_4 {
  text-indent: 20px;
}

#tmjvcfltkk .gt_indent_5 {
  text-indent: 25px;
}

#tmjvcfltkk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tmjvcfltkk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="prior" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">prior</th>
<th id="class" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">class</th>
<th id="coef" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">coef</th>
<th id="group" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">group</th>
<th id="resp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">resp</th>
<th id="dpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">dpar</th>
<th id="nlpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">nlpar</th>
<th id="lb" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lb</th>
<th id="ub" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ub</th>
<th id="source" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">source</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaControl</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffect</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffectAvg</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">hist1</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior">student_t(3, 1, 2.5)</td>
<td class="gt_row gt_left" headers="class">Intercept</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior">gamma(0.01, 0.01)</td>
<td class="gt_row gt_left" headers="class">shape</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb">0</td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We use a student with 6 degrees of freedom for the regression coefficient for the historical data prior. Using a Student-t distribution robustifies against possible data discordance between the randomised study and the historical data, since very large deviations between the two data sets are admitted by the heavy tails of the prior. The prior is centered at a mean of <span class="math inline">\(0\)</span>, corresponding to no expected difference in the outcome for historical and current study.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior <span class="ot">&lt;-</span> model_weibull_prior <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">6</span>, <span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A variance allowing substantial differences, a <span class="math inline">\(1.8\)</span> fold of increase/decrease, between the randomised study and historical data is set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>prior_sdHist <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.8</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdHist"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we combine the simulated trial data and historical data to fit the co-data MAC model. Don’t forget to set contrasts of arm in the combined data to the contrast matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>comb_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sim, hdata1)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(comb_data<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull, <span class="at">data=</span>comb_data,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prior=</span>model_weibull_mac_prior,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 1.2 seconds.
Chain 2 finished in 1.1 seconds.
Chain 3 finished in 1.2 seconds.
Chain 4 finished in 1.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.2 seconds.
Total execution time: 5.2 seconds.</code></pre>
</div>
</div>
<p>And we can compare the results from two models. Inclusion of historical data on <code>controlChemoA</code> affect the estimates of coefficients for overall mean and <code>EffectAverage</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + arm 
   Data: sim (Number of observations: 200) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.16      0.12     1.98     2.36 1.00     3986     3061
armdeltaEffectAvg     0.26      0.19    -0.05     0.58 1.00     4044     2592
armdeltaEffect        0.00      0.11    -0.17     0.18 1.00     4081     2772
armdeltaControl       0.06      0.12    -0.13     0.26 1.00     4307     3010

Further Distributional Parameters:
      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
shape     0.97      0.08     0.86     1.10 1.00     4028     2871

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + arm + hist1 
   Data: comb_data (Number of observations: 600) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.12      0.11     1.96     2.30 1.00     4584     2824
armdeltaEffectAvg     0.29      0.17    -0.01     0.59 1.00     4328     3004
armdeltaEffect        0.01      0.10    -0.16     0.17 1.00     5560     3017
armdeltaControl       0.07      0.12    -0.13     0.26 1.00     4951     3306
hist1                -0.20      0.13    -0.43     0.03 1.00     3927     2959

Further Distributional Parameters:
      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
shape     1.00      0.04     0.93     1.07 1.00     4576     3212

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Next, we check the informativeness of the historical data by only including the historical data. Note that we have to request that factor levels for which no realization is present in the data set must be kept, since only the <code>controlChemoA</code> arm is present in the historical data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(hdata1<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fit_mac_prior_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull, <span class="at">data=</span>hdata1,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior=</span>model_weibull_mac_prior,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">drop_unused_levels=</span><span class="cn">FALSE</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 0.8 seconds.
Chain 2 finished in 0.8 seconds.
Chain 3 finished in 0.8 seconds.
Chain 4 finished in 0.8 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.8 seconds.
Total execution time: 3.7 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">as.data.frame</span>(<span class="fu">fixef</span>(fit_mac_prior_weibull, <span class="at">robust=</span><span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">everything</span>(), <span class="at">decimals=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="qbsogosing" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qbsogosing table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qbsogosing thead, #qbsogosing tbody, #qbsogosing tfoot, #qbsogosing tr, #qbsogosing td, #qbsogosing th {
  border-style: none;
}

#qbsogosing p {
  margin: 0;
  padding: 0;
}

#qbsogosing .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qbsogosing .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qbsogosing .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qbsogosing .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qbsogosing .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbsogosing .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbsogosing .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qbsogosing .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qbsogosing .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qbsogosing .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qbsogosing .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qbsogosing .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qbsogosing .gt_spanner_row {
  border-bottom-style: hidden;
}

#qbsogosing .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qbsogosing .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qbsogosing .gt_from_md > :first-child {
  margin-top: 0;
}

#qbsogosing .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qbsogosing .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qbsogosing .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qbsogosing .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qbsogosing .gt_row_group_first td {
  border-top-width: 2px;
}

#qbsogosing .gt_row_group_first th {
  border-top-width: 2px;
}

#qbsogosing .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbsogosing .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qbsogosing .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qbsogosing .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbsogosing .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbsogosing .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qbsogosing .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qbsogosing .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qbsogosing .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qbsogosing .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbsogosing .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbsogosing .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qbsogosing .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qbsogosing .gt_left {
  text-align: left;
}

#qbsogosing .gt_center {
  text-align: center;
}

#qbsogosing .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qbsogosing .gt_font_normal {
  font-weight: normal;
}

#qbsogosing .gt_font_bold {
  font-weight: bold;
}

#qbsogosing .gt_font_italic {
  font-style: italic;
}

#qbsogosing .gt_super {
  font-size: 65%;
}

#qbsogosing .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qbsogosing .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qbsogosing .gt_indent_1 {
  text-indent: 5px;
}

#qbsogosing .gt_indent_2 {
  text-indent: 10px;
}

#qbsogosing .gt_indent_3 {
  text-indent: 15px;
}

#qbsogosing .gt_indent_4 {
  text-indent: 20px;
}

#qbsogosing .gt_indent_5 {
  text-indent: 25px;
}

#qbsogosing .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qbsogosing div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Est.Error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Est.Error</th>
<th id="Q2.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q2.5</th>
<th id="Q97.5" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Q97.5</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Estimate">1.73</td>
<td class="gt_row gt_right" headers="Est.Error">0.45</td>
<td class="gt_row gt_right" headers="Q2.5">0.82</td>
<td class="gt_row gt_right" headers="Q97.5">2.67</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Estimate">0.00</td>
<td class="gt_row gt_right" headers="Est.Error">0.42</td>
<td class="gt_row gt_right" headers="Q2.5">−0.83</td>
<td class="gt_row gt_right" headers="Q97.5">0.85</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Estimate">0.00</td>
<td class="gt_row gt_right" headers="Est.Error">0.13</td>
<td class="gt_row gt_right" headers="Q2.5">−0.28</td>
<td class="gt_row gt_right" headers="Q97.5">0.26</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Estimate">0.00</td>
<td class="gt_row gt_right" headers="Est.Error">0.14</td>
<td class="gt_row gt_right" headers="Q2.5">−0.27</td>
<td class="gt_row gt_right" headers="Q97.5">0.27</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Estimate">0.00</td>
<td class="gt_row gt_right" headers="Est.Error">0.37</td>
<td class="gt_row gt_right" headers="Q2.5">−0.82</td>
<td class="gt_row gt_right" headers="Q97.5">0.82</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We see that we essentially sample the prior for most regression coefficients, but we do substantially reduce the standard error of the intercept estimate which is almost halved in comparison to the prior standard deviation of 0.85.</p>
</section>
<section id="including-historical-data-of-average-soc" class="level3" data-number="16.5.4">
<h3 data-number="16.5.4" class="anchored" data-anchor-id="including-historical-data-of-average-soc"><span class="header-section-number">16.5.4</span> Including historical data of average SoC</h3>
<p>So far we have setup a custom parametrization allowing to define priors aligned with prior expectations (small difference of the treatment effect and small difference between SoC). However, the CheckMate 649 historical data reports the effect of an average SoC treatment. Thus, the data of CheckMate 649 is incompatible with the 4 defined categorical factor levels so far as it does not correspond to any of the 4 treatment arms in the current data set. However, as the custom factor contrasts and <code>factor</code> level definitions are translated by <code>R</code> into a design matrix, we can customize the created design matrix directly. This requires to setup the design matrix manually giving us the freedom to define the design matrix appropiatley for the CheckMate 649 data set.</p>
<p>There is an alternative way to use the customized contrast and setup analysis by using respective indicator flags, which is created using <code>model.matrix</code>. The <code>model.matrix</code> function is used internally by <code>brms</code> to create the design matrix for the regression problem</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>Xind <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, comb_data)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_preview</span>(Xind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="qihrptfcyw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qihrptfcyw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qihrptfcyw thead, #qihrptfcyw tbody, #qihrptfcyw tfoot, #qihrptfcyw tr, #qihrptfcyw td, #qihrptfcyw th {
  border-style: none;
}

#qihrptfcyw p {
  margin: 0;
  padding: 0;
}

#qihrptfcyw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qihrptfcyw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qihrptfcyw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qihrptfcyw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qihrptfcyw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qihrptfcyw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qihrptfcyw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qihrptfcyw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qihrptfcyw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qihrptfcyw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qihrptfcyw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qihrptfcyw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qihrptfcyw .gt_spanner_row {
  border-bottom-style: hidden;
}

#qihrptfcyw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qihrptfcyw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qihrptfcyw .gt_from_md > :first-child {
  margin-top: 0;
}

#qihrptfcyw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qihrptfcyw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qihrptfcyw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qihrptfcyw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qihrptfcyw .gt_row_group_first td {
  border-top-width: 2px;
}

#qihrptfcyw .gt_row_group_first th {
  border-top-width: 2px;
}

#qihrptfcyw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qihrptfcyw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qihrptfcyw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qihrptfcyw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qihrptfcyw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qihrptfcyw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qihrptfcyw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qihrptfcyw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qihrptfcyw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qihrptfcyw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qihrptfcyw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qihrptfcyw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qihrptfcyw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qihrptfcyw .gt_left {
  text-align: left;
}

#qihrptfcyw .gt_center {
  text-align: center;
}

#qihrptfcyw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qihrptfcyw .gt_font_normal {
  font-weight: normal;
}

#qihrptfcyw .gt_font_bold {
  font-weight: bold;
}

#qihrptfcyw .gt_font_italic {
  font-style: italic;
}

#qihrptfcyw .gt_super {
  font-size: 65%;
}

#qihrptfcyw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qihrptfcyw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qihrptfcyw .gt_indent_1 {
  text-indent: 5px;
}

#qihrptfcyw .gt_indent_2 {
  text-indent: 10px;
}

#qihrptfcyw .gt_indent_3 {
  text-indent: 15px;
}

#qihrptfcyw .gt_indent_4 {
  text-indent: 20px;
}

#qihrptfcyw .gt_indent_5 {
  text-indent: 25px;
}

#qihrptfcyw .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qihrptfcyw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="a(Intercept)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">(Intercept)</th>
<th id="armdeltaEffectAvg" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armdeltaEffectAvg</th>
<th id="armdeltaEffect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armdeltaEffect</th>
<th id="armdeltaControl" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">armdeltaControl</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">1</td>
<td class="gt_row gt_right" headers="stub_1_1 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_1 armdeltaEffectAvg">-0.5</td>
<td class="gt_row gt_right" headers="stub_1_1 armdeltaEffect">0</td>
<td class="gt_row gt_right" headers="stub_1_1 armdeltaControl">-0.5</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">2</td>
<td class="gt_row gt_right" headers="stub_1_2 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_2 armdeltaEffectAvg">0.5</td>
<td class="gt_row gt_right" headers="stub_1_2 armdeltaEffect">1</td>
<td class="gt_row gt_right" headers="stub_1_2 armdeltaControl">-0.5</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">3</td>
<td class="gt_row gt_right" headers="stub_1_3 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_3 armdeltaEffectAvg">-0.5</td>
<td class="gt_row gt_right" headers="stub_1_3 armdeltaEffect">0</td>
<td class="gt_row gt_right" headers="stub_1_3 armdeltaControl">-0.5</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">4</td>
<td class="gt_row gt_right" headers="stub_1_4 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_4 armdeltaEffectAvg">0.5</td>
<td class="gt_row gt_right" headers="stub_1_4 armdeltaEffect">1</td>
<td class="gt_row gt_right" headers="stub_1_4 armdeltaControl">-0.5</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">5</td>
<td class="gt_row gt_right" headers="stub_1_5 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_5 armdeltaEffectAvg">-0.5</td>
<td class="gt_row gt_right" headers="stub_1_5 armdeltaEffect">0</td>
<td class="gt_row gt_right" headers="stub_1_5 armdeltaControl">-0.5</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier; font-size: x-small; background-color: #E4E4E4">6..599</td>
<td class="gt_row gt_right" headers="stub_1_6 (Intercept)" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 armdeltaEffectAvg" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 armdeltaEffect" style="background-color: #E4E4E4"></td>
<td class="gt_row gt_right" headers="stub_1_6 armdeltaControl" style="background-color: #E4E4E4"></td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row" style="font-family: Courier">600</td>
<td class="gt_row gt_right" headers="stub_1_7 (Intercept)">1</td>
<td class="gt_row gt_right" headers="stub_1_7 armdeltaEffectAvg">-0.5</td>
<td class="gt_row gt_right" headers="stub_1_7 armdeltaEffect">0</td>
<td class="gt_row gt_right" headers="stub_1_7 armdeltaControl">-0.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By adding the generated design matrix to the original data set, we can then simply delcare the model formula using these created indicator variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>comb_data_ind <span class="ot">&lt;-</span> <span class="fu">cbind</span>(comb_data, Xind[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Thus we use those indicator variables in the fit as if these were continuous covariates which replaces the use of the categorical <code>factor</code> variable <code>arm</code> used in the first approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>model_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> armdeltaEffectAvg <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                            armdeltaEffect <span class="sc">+</span> armdeltaControl <span class="sc">+</span> hist1,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">weibull</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And query what prior parameters need to be set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_mac_weibull_ind, comb_data_ind))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="sarhimdjpe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sarhimdjpe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sarhimdjpe thead, #sarhimdjpe tbody, #sarhimdjpe tfoot, #sarhimdjpe tr, #sarhimdjpe td, #sarhimdjpe th {
  border-style: none;
}

#sarhimdjpe p {
  margin: 0;
  padding: 0;
}

#sarhimdjpe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sarhimdjpe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sarhimdjpe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sarhimdjpe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sarhimdjpe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sarhimdjpe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sarhimdjpe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sarhimdjpe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sarhimdjpe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sarhimdjpe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sarhimdjpe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sarhimdjpe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sarhimdjpe .gt_spanner_row {
  border-bottom-style: hidden;
}

#sarhimdjpe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sarhimdjpe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sarhimdjpe .gt_from_md > :first-child {
  margin-top: 0;
}

#sarhimdjpe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sarhimdjpe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sarhimdjpe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sarhimdjpe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sarhimdjpe .gt_row_group_first td {
  border-top-width: 2px;
}

#sarhimdjpe .gt_row_group_first th {
  border-top-width: 2px;
}

#sarhimdjpe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sarhimdjpe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sarhimdjpe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sarhimdjpe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sarhimdjpe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sarhimdjpe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sarhimdjpe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sarhimdjpe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sarhimdjpe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sarhimdjpe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sarhimdjpe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sarhimdjpe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sarhimdjpe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sarhimdjpe .gt_left {
  text-align: left;
}

#sarhimdjpe .gt_center {
  text-align: center;
}

#sarhimdjpe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sarhimdjpe .gt_font_normal {
  font-weight: normal;
}

#sarhimdjpe .gt_font_bold {
  font-weight: bold;
}

#sarhimdjpe .gt_font_italic {
  font-style: italic;
}

#sarhimdjpe .gt_super {
  font-size: 65%;
}

#sarhimdjpe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sarhimdjpe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sarhimdjpe .gt_indent_1 {
  text-indent: 5px;
}

#sarhimdjpe .gt_indent_2 {
  text-indent: 10px;
}

#sarhimdjpe .gt_indent_3 {
  text-indent: 15px;
}

#sarhimdjpe .gt_indent_4 {
  text-indent: 20px;
}

#sarhimdjpe .gt_indent_5 {
  text-indent: 25px;
}

#sarhimdjpe .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sarhimdjpe div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="prior" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">prior</th>
<th id="class" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">class</th>
<th id="coef" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">coef</th>
<th id="group" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">group</th>
<th id="resp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">resp</th>
<th id="dpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">dpar</th>
<th id="nlpar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">nlpar</th>
<th id="lb" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lb</th>
<th id="ub" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ub</th>
<th id="source" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">source</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaControl</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffect</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">armdeltaEffectAvg</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior"></td>
<td class="gt_row gt_left" headers="class">b</td>
<td class="gt_row gt_left" headers="coef">hist1</td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="prior">student_t(3, 1, 2.5)</td>
<td class="gt_row gt_left" headers="class">Intercept</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb"></td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="prior">gamma(0.01, 0.01)</td>
<td class="gt_row gt_left" headers="class">shape</td>
<td class="gt_row gt_left" headers="coef"></td>
<td class="gt_row gt_right" headers="group"></td>
<td class="gt_row gt_right" headers="resp"></td>
<td class="gt_row gt_right" headers="dpar"></td>
<td class="gt_row gt_right" headers="nlpar"></td>
<td class="gt_row gt_right" headers="lb">0</td>
<td class="gt_row gt_right" headers="ub"></td>
<td class="gt_row gt_left" headers="source">default</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Fit the model using indicator flags with the same priors as before and compare with the previous one fitted with <code>arm</code> variable, the results are the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior_ind <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(meanInter, <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>),</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">class=</span><span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdEffectAvg), <span class="at">coef=</span>armdeltaEffectAvg) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaEffect), <span class="at">coef=</span>armdeltaEffect) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaControl), <span class="at">coef=</span>armdeltaControl) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist1)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull_ind, <span class="at">data=</span>comb_data_ind,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior=</span>model_weibull_mac_prior_ind,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 1.7 seconds.
Chain 2 finished in 1.7 seconds.
Chain 3 finished in 1.9 seconds.
Chain 4 finished in 2.3 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.9 seconds.
Total execution time: 8.3 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + arm + hist1 
   Data: comb_data (Number of observations: 600) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.12      0.11     1.96     2.30 1.00     4584     2824
armdeltaEffectAvg     0.29      0.17    -0.01     0.59 1.00     4328     3004
armdeltaEffect        0.01      0.10    -0.16     0.17 1.00     5560     3017
armdeltaControl       0.07      0.12    -0.13     0.26 1.00     4951     3306
hist1                -0.20      0.13    -0.43     0.03 1.00     3927     2959

Further Distributional Parameters:
      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
shape     1.00      0.04     0.93     1.07 1.00     4576     3212

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull_ind, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + armdeltaEffectAvg + armdeltaEffect + armdeltaControl + hist1 
   Data: comb_data_ind (Number of observations: 600) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.12      0.10     1.95     2.29 1.00     4875     3332
armdeltaEffectAvg     0.29      0.18    -0.00     0.57 1.00     4457     3025
armdeltaEffect        0.01      0.10    -0.17     0.18 1.00     5379     3068
armdeltaControl       0.07      0.12    -0.13     0.26 1.00     4623     3081
hist1                -0.20      0.14    -0.43     0.02 1.00     4406     3061

Further Distributional Parameters:
      Estimate Est.Error l-90% CI u-90% CI Rhat Bulk_ESS Tail_ESS
shape     1.00      0.04     0.93     1.07 1.00     4457     2806

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Note that the equality holds exactly for the entire posterior, since the very same problem (using the same random seed) has been fitted by <code>brms</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>post_mac <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(fit_mac_weibull)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>post_mac_ind <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(fit_mac_weibull_ind)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(post_mac <span class="sc">==</span> post_mac_ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>The benefit of this approach is that we can then include external data corresponding to the <code>controlAverage</code> from the second historical study CheckMate 649, which is not one of the treatment groups but the average effect of control groups, <span class="math inline">\(\frac{1}{2} \, (\lambda_{\mbox{controlChemoA}}+\lambda_{\mbox{controlChemoB}})\)</span>.</p>
<p>To now find the indicators needed for the effect of <code>controlAverage</code> in the given parametrization so far, we can obtain this via simple algebra as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">solve</span>(cc_inv))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>cc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              intercept deltaEffectAvg deltaEffect deltaControl
activeChemoA     1       1/2              1        -1/2        
controlChemoA    1      -1/2              0        -1/2        
activeChemoB     1       1/2             -1         1/2        
controlChemoB    1      -1/2              0         1/2        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.5</span><span class="sc">*</span>(cc[<span class="st">"controlChemoA"</span>,] <span class="sc">+</span> cc[<span class="st">"controlChemoB"</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     intercept deltaEffectAvg    deltaEffect   deltaControl 
             1           -1/2              0              0 </code></pre>
</div>
</div>
<p>Hence we must set the <code>deltaEffectAvg</code> column to <span class="math inline">\(-\frac{1}{2}\)</span> and the others to <span class="math inline">\(0\)</span> to get the indicator for <code>controlAverage</code> (the overall intercept is always added to the linear predictor as we define <code>1</code> as the first term of the model formula) in order to include the new historical data from CheckMate649.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>hdata2_ind <span class="ot">&lt;-</span> <span class="fu">rename</span>(hdata2, <span class="at">y=</span>time, <span class="at">event=</span>status) <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hist1=</span><span class="dv">0</span>, <span class="at">hist2=</span><span class="dv">1</span>, <span class="at">armdeltaEffectAvg=</span><span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">armdeltaEffect=</span><span class="dv">0</span>, <span class="at">armdeltaControl=</span><span class="dv">0</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>all_comb_data_ind <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(comb_data_ind, hdata2_ind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To include the second historical data, we specify the formula and the priors as we did for one historical study.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>model_mac_weibull_ind_all <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> armdeltaEffectAvg <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                              armdeltaEffect <span class="sc">+</span> armdeltaControl <span class="sc">+</span> hist1<span class="sc">+</span> hist2,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior_all <span class="ot">&lt;-</span> model_weibull_mac_prior <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fit the model and compare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>fit_all_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull_ind_all, <span class="at">data=</span>all_comb_data_ind,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">prior=</span>model_weibull_mac_prior_all,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 sequential chains...

Chain 1 finished in 6.5 seconds.
Chain 2 finished in 7.4 seconds.
Chain 3 finished in 6.8 seconds.
Chain 4 finished in 8.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 7.2 seconds.
Total execution time: 29.8 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + armdeltaEffectAvg + armdeltaEffect + armdeltaControl + hist1 
   Data: comb_data_ind (Number of observations: 600) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.12      0.10     1.92     2.33 1.00     4875     3332
armdeltaEffectAvg     0.29      0.18    -0.07     0.63 1.00     4457     3025
armdeltaEffect        0.01      0.10    -0.20     0.21 1.00     5379     3068
armdeltaControl       0.07      0.12    -0.17     0.30 1.00     4623     3081
hist1                -0.20      0.14    -0.48     0.07 1.00     4406     3061

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     1.00      0.04     0.92     1.09 1.00     4457     2806

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>fit_all_mac_weibull_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: weibull 
  Links: mu = log; shape = identity 
Formula: y | cens(1 - event) ~ 1 + armdeltaEffectAvg + armdeltaEffect + armdeltaControl + hist1 + hist2 
   Data: all_comb_data_ind (Number of observations: 1389) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept             2.09      0.09     1.91     2.26 1.00     3828     3318
armdeltaEffectAvg     0.23      0.16    -0.09     0.55 1.00     2859     2637
armdeltaEffect        0.01      0.10    -0.18     0.20 1.00     3804     3196
armdeltaControl       0.09      0.11    -0.14     0.31 1.00     3856     3152
hist1                -0.23      0.13    -0.49     0.01 1.00     2401     2813
hist2                 0.48      0.12     0.25     0.71 1.00     2378     2619

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
shape     1.12      0.03     1.07     1.18 1.00     4360     3393

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">16.6</span> Conclusion</h2>
<p>Here we showed how <code>brms</code> enabled us to model time-to-event data with censoring and incorporate historical data into the analysis. By use of custom contrasts we controlled the parametrization of the problem allowing for the specification of priors aligned with the prior knowledge. This is possible in <code>R</code> using the <code>contrasts</code> function to setup custom contrast matrices used to setup the design matrix of the model. Going beyond that we also discussed that in some situations the facilities in <code>R</code> are too limiting and a customized setup of the model design matrix allows for even greater flexibility. This allowed in this case study the inclusion of historical data which corresponds to the average effect of standard of care.</p>
</section>
<section id="exercises" class="level2" data-number="16.7">
<h2 data-number="16.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">16.7</span> Exercises</h2>
<ol type="1">
<li><p>In <code>brms</code> various families can be used to model time-to-event data. Re-fit the model using <code>exponential</code> distribution and compare with the <code>weibull</code> results.</p></li>
<li><p>Cox regression is implemented in <code>brms</code> using M-splines, which is a very close approximation to the semi-parametric Cox model. Show that the estimates for the covariate effect we get from <code>brms</code> are quite similar to what we get from <code>survival</code> package. Also compare the estimate of the overall intercept which needs to account for an offset as detailled in section @ref(sec:tte-model-brms).</p></li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Janjigian2021" class="csl-entry" role="listitem">
Janjigian, Yelena Y., Kohei Shitara, Markus Moehler, Marcelo Garrido, Pamela Salman, Lin Shen, Lucjan Wyrwicz, et al. 2021. <span>“First-Line Nivolumab Plus Chemotherapy Versus Chemotherapy Alone for Advanced Gastric, Gastro-Oesophageal Junction, and Oesophageal Adenocarcinoma (CheckMate 649): A Randomised, Open-Label, Phase 3 Trial.”</span> <em>The Lancet</em> 398 (July): 27–40. <a href="https://doi.org/10.1016/S0140-6736(21)00797-2">https://doi.org/10.1016/S0140-6736(21)00797-2</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/opensource\.nibr\.com\/bamdd\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/02h_mmrm.html" class="pagination-link" aria-label="Bayesian Mixed effects Model for Repeated Measures">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Bayesian Mixed effects Model for Repeated Measures</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/02j_network_meta_analysis.html" class="pagination-link" aria-label="Network meta-analysis">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Network meta-analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb78" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co">   </span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - Cong Zhang - &lt;cong.zhang@novartis.com&gt;</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - Sebastian Weber - &lt;sebastian.weber@novartis.com&gt;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Time-to-event data {#sec-tte-data}</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>In this case study the design of a time-to-event trial is</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>presented. The trial evaluates a combination treatment of an active</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>drug given in addition to standard of care (SoC) therapy. Two SoC</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>therapies are in clinical use, which varies geographically. The SoC</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>therapies alone are used as control and compared to the combination of</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>the active drug given in addition to the respective SoC. This results in four arms of the</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>trial and special emphasis is put on the parametrization of the</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>problem. That is, the treatment effect (and each standard of care) is</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>anticipated to be similar to one another such that the mean treatment</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>effect is of particular interest. In addition, a historical data set</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>is incorporated in the analysis of the trial.</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>This case study demonstrates:</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>modeling censored time-to-event data in <span class="in">`brms`</span> (use of <span class="in">`cens`</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>  formula modifier) with borrowing from historical control data,</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the use of custom contrasts allowing for custom</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>  definition of the model parametrization, which in turn allows to</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>  specify priors on relevant bits of the problem (a priori we expect</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  the treatment effect not to differ substantially between standard of</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>  cares),</span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>an additional alternative approaches of using custom coded contrasts to</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>  include with greater flexibility historical data.</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>To run the R code of this section please ensure to load these</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>libraries and options first:</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE}</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simsurv)</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RBesT)</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a><span class="co"># instruct brms to use cmdstanr as backend and cache all Stan binaries</span></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">brms.backend=</span><span class="st">"cmdstanr"</span>, <span class="at">cmdstanr_write_stan_file_dir=</span><span class="fu">here</span>(<span class="st">"_brms-cache"</span>))</span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a><span class="co"># create cache directory if not yet available</span></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">"_brms-cache"</span>), <span class="cn">FALSE</span>)</span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a><span class="co"># allow for wider printouts without line-breaking</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width=</span><span class="dv">120</span>)</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE, echo=FALSE, eval=TRUE}</span></span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible to the reader additional setup steps, which are optional</span></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a><span class="co"># {{&lt; include setup.R &gt;}}</span></span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"setup.R"</span>)</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-profile="dummy"}</span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview Video</span></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>{{&lt; video videos/brms-20230426-2-tte.mp4 &gt;}}</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>The outcome of interest in clinical trials is often the occurence of an</span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a>event. Such events might be negative for patients such as a worsening of</span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>a disease, hospitalization or death. They might also be a positive such</span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>as clearing the blood of malaria parasites, or being released from</span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a>hospital.</span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a>We use time-to-event (or survival) analysis when it is important to</span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a>patients whether the event of interest occurs earlier or later.</span>
<span id="cb78-85"><a href="#cb78-85" aria-hidden="true" tabindex="-1"></a>Additionally, time-to-event methods let us deal with the fact that not</span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a>all patients will have the event of interest during a trial, which</span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a>leads to censored observations.</span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a>In this case study we focus on an Oncology late phase trial evaluating</span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>a test treatment in combination with standard of care (SoC) using</span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a>progression free survival as endpoint in the indication of gastric</span>
<span id="cb78-92"><a href="#cb78-92" aria-hidden="true" tabindex="-1"></a>cancer. Due to geographic differences in the SoC, two different SoC</span>
<span id="cb78-93"><a href="#cb78-93" aria-hidden="true" tabindex="-1"></a>treatments are considered as control treatments. One active treatment</span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a>is tested in combination with each SoC and compared to the control</span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a>treatment using only the SoC, which leads to four trial arms in</span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a>total. From clinical experience with the two SoCs on expects a similar</span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a>PFS for both therapies. In addition, it is expected that the treatment</span>
<span id="cb78-98"><a href="#cb78-98" aria-hidden="true" tabindex="-1"></a>effect of the active drug is similar when combined with each SoC</span>
<span id="cb78-99"><a href="#cb78-99" aria-hidden="true" tabindex="-1"></a>respectivley. It is therefore desirable to express this prior knowledge</span>
<span id="cb78-100"><a href="#cb78-100" aria-hidden="true" tabindex="-1"></a>when setting up the model.</span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>By way of aligning the parametrization of the model we can encode the</span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a>prior knowledge on expected similarities (no difference between the</span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a>two SoCs and consistent treatment effect). For example, defining the</span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a>average treatment effect and the difference between the two treatment</span>
<span id="cb78-106"><a href="#cb78-106" aria-hidden="true" tabindex="-1"></a>effects as parameters, one can place a prior with limited width on</span>
<span id="cb78-107"><a href="#cb78-107" aria-hidden="true" tabindex="-1"></a>the difference parameter. This expresses the a-priori expectation that</span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a>differences in the treatment effect per SoC are not too large. This</span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a>results in efficency gains for the estimation of the average treatment</span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a>effect while only partially pooling the data.</span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-112"><a href="#cb78-112" aria-hidden="true" tabindex="-1"></a>As furthermore historical data is available on each SoC treatment, its</span>
<span id="cb78-113"><a href="#cb78-113" aria-hidden="true" tabindex="-1"></a>use may allow for un-equal randomization between active and control</span>
<span id="cb78-114"><a href="#cb78-114" aria-hidden="true" tabindex="-1"></a>arms. However, the available literature data only reports outcomes for</span>
<span id="cb78-115"><a href="#cb78-115" aria-hidden="true" tabindex="-1"></a>a treatment arm which lumps together data from the two SoC</span>
<span id="cb78-116"><a href="#cb78-116" aria-hidden="true" tabindex="-1"></a>treatments. Since about 50% of these patients were treated with either</span>
<span id="cb78-117"><a href="#cb78-117" aria-hidden="true" tabindex="-1"></a>SoC, the reported data can be considered to report the average effect</span>
<span id="cb78-118"><a href="#cb78-118" aria-hidden="true" tabindex="-1"></a>of both SoCs. How this historical data can be included in the analysis</span>
<span id="cb78-119"><a href="#cb78-119" aria-hidden="true" tabindex="-1"></a>is outlined below.</span>
<span id="cb78-120"><a href="#cb78-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-121"><a href="#cb78-121" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- This information is given in the next section first</span></span>
<span id="cb78-122"><a href="#cb78-122" aria-hidden="true" tabindex="-1"></a><span class="co">paragraph already.</span></span>
<span id="cb78-123"><a href="#cb78-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-124"><a href="#cb78-124" aria-hidden="true" tabindex="-1"></a><span class="co">The Cox proportional hazards model is a very popular choice for</span></span>
<span id="cb78-125"><a href="#cb78-125" aria-hidden="true" tabindex="-1"></a><span class="co">time-to-event data, since it avoids the need to model a baseline</span></span>
<span id="cb78-126"><a href="#cb78-126" aria-hidden="true" tabindex="-1"></a><span class="co">hazard function. Avoiding the need to model a baseline hazard function</span></span>
<span id="cb78-127"><a href="#cb78-127" aria-hidden="true" tabindex="-1"></a><span class="co">reduces assumptions and is acceptable, since the main inferential goal</span></span>
<span id="cb78-128"><a href="#cb78-128" aria-hidden="true" tabindex="-1"></a><span class="co">is to quantify differences due to active treatment between</span></span>
<span id="cb78-129"><a href="#cb78-129" aria-hidden="true" tabindex="-1"></a><span class="co">arms. However, the Cox proportional hazards relies on a partial</span></span>
<span id="cb78-130"><a href="#cb78-130" aria-hidden="true" tabindex="-1"></a><span class="co">likelihood approach which drops the baseline hazard function by</span></span>
<span id="cb78-131"><a href="#cb78-131" aria-hidden="true" tabindex="-1"></a><span class="co">marginalizing out the respective terms. This approach is not possible</span></span>
<span id="cb78-132"><a href="#cb78-132" aria-hidden="true" tabindex="-1"></a><span class="co">in a Bayesian framework which must work with the full likelihood of</span></span>
<span id="cb78-133"><a href="#cb78-133" aria-hidden="true" tabindex="-1"></a><span class="co">the model. Nonetheless, `brms` does support a `cox` family for</span></span>
<span id="cb78-134"><a href="#cb78-134" aria-hidden="true" tabindex="-1"></a><span class="co">time-to-event data which relies on estimating the baseline hazard</span></span>
<span id="cb78-135"><a href="#cb78-135" aria-hidden="true" tabindex="-1"></a><span class="co">function in a non-parametric manner using parametric splines. This</span></span>
<span id="cb78-136"><a href="#cb78-136" aria-hidden="true" tabindex="-1"></a><span class="co">approach gives under most circumstances very similar results to a</span></span>
<span id="cb78-137"><a href="#cb78-137" aria-hidden="true" tabindex="-1"></a><span class="co">frequentist Cox regression. As the historical data available in this</span></span>
<span id="cb78-138"><a href="#cb78-138" aria-hidden="true" tabindex="-1"></a><span class="co">case study can be approximated with a Weibull distribution this</span></span>
<span id="cb78-139"><a href="#cb78-139" aria-hidden="true" tabindex="-1"></a><span class="co">baseline hazard function has been selected. In `brms` this is enabled</span></span>
<span id="cb78-140"><a href="#cb78-140" aria-hidden="true" tabindex="-1"></a><span class="co">by the `weibull` family while many other options exist including</span></span>
<span id="cb78-141"><a href="#cb78-141" aria-hidden="true" tabindex="-1"></a><span class="co">`exponential`, `gamma`, `lognormal`, `frechet` and `inverse.gaussian`.</span></span>
<span id="cb78-142"><a href="#cb78-142" aria-hidden="true" tabindex="-1"></a><span class="co">---&gt;</span></span>
<span id="cb78-143"><a href="#cb78-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-144"><a href="#cb78-144" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!---</span></span>
<span id="cb78-145"><a href="#cb78-145" aria-hidden="true" tabindex="-1"></a><span class="co">For example, we all die at some point, but most of us consider a longer life (ideally at a good quality of life) desirable. During a clinical trial of even a very severe condition, it would be unusual if all patients died. However, we know that those that did not will die at some point in the future. Thus, we consider the time of their death to be "censored", i.e. we did not observe it, we just know it must be beyond the end of the observation period. </span></span>
<span id="cb78-146"><a href="#cb78-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-147"><a href="#cb78-147" aria-hidden="true" tabindex="-1"></a><span class="co">Censored observations can be right-censored, left-censored, or interval-censored. Right censoring occurs when a subject leaves the study before an event occurs, or the study ends before the event has occurred. An observation is left-censored if we know that the event happened before the observed time. It is interval-censored if we know only that the event happened within some observed time interval. A common example is a clinical trial where patients are tested or measured periodically to evaluate if the event of interest has happened. We may not observe the exact time of the event, but we know that it happened before an evaluation, after an evaluation, or between two evaluations. Interval censoring also contains right censoring and left censoring as special cases.</span></span>
<span id="cb78-148"><a href="#cb78-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-149"><a href="#cb78-149" aria-hidden="true" tabindex="-1"></a><span class="co">The `brms` package provides distributions and link functions for fitting survival or time-to-event models. Families including `gamma`, `weibull`, `exponential`, `lognormal`, `frechet`, `inverse.gaussian`, and `cox` (Cox proportional hazards model) can be used (among others) for time-to-event regression</span></span>
<span id="cb78-150"><a href="#cb78-150" aria-hidden="true" tabindex="-1"></a><span class="co">also known as survival regression. By specifying corresponding model options in `formula` when fitting `brms` models, `cens` makes up the internal function that handles censored data.</span></span>
<span id="cb78-151"><a href="#cb78-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-152"><a href="#cb78-152" aria-hidden="true" tabindex="-1"></a><span class="co">Here we will demonstrate the exploration of suitable parametric forms for time-to-event modeling with a gastic cancer study and how to use custom coded contrasts as a way to approximate a hierarchical model where we only have to levels by using a `delta` parameter approach and borrowing from historical control data. </span></span>
<span id="cb78-153"><a href="#cb78-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-154"><a href="#cb78-154" aria-hidden="true" tabindex="-1"></a><span class="co">---&gt;</span></span>
<span id="cb78-155"><a href="#cb78-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-156"><a href="#cb78-156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modeling time-to-event data with `brms` {#sec:tte-model-brms}</span></span>
<span id="cb78-157"><a href="#cb78-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-158"><a href="#cb78-158" aria-hidden="true" tabindex="-1"></a>Modeling time to event data of clinical trials is oftentimes run with</span>
<span id="cb78-159"><a href="#cb78-159" aria-hidden="true" tabindex="-1"></a>the semi-parametric Cox proportional hazards model. This model avoids</span>
<span id="cb78-160"><a href="#cb78-160" aria-hidden="true" tabindex="-1"></a>the need to specify a hazard function $h(t)$, which is the rate of</span>
<span id="cb78-161"><a href="#cb78-161" aria-hidden="true" tabindex="-1"></a>events provided no event as happened yet and it crucially defines the</span>
<span id="cb78-162"><a href="#cb78-162" aria-hidden="true" tabindex="-1"></a>probability density of the survival times. Using the assumption of</span>
<span id="cb78-163"><a href="#cb78-163" aria-hidden="true" tabindex="-1"></a>proportional hazards allows to quantify effects of explanatory</span>
<span id="cb78-164"><a href="#cb78-164" aria-hidden="true" tabindex="-1"></a>variables on the hazard and thereby one can quantify the difference</span>
<span id="cb78-165"><a href="#cb78-165" aria-hidden="true" tabindex="-1"></a>between two treatment groups in a trial, for example. The hazard for a</span>
<span id="cb78-166"><a href="#cb78-166" aria-hidden="true" tabindex="-1"></a>patient $i$ with covariates $x_i$ is often modelled as $h_i(t) =</span>
<span id="cb78-167"><a href="#cb78-167" aria-hidden="true" tabindex="-1"></a>\exp<span class="sc">\{</span>x_i \, \beta<span class="sc">\}</span> \, h_0(t)$. The baseline hazard function $h_0(t)$</span>
<span id="cb78-168"><a href="#cb78-168" aria-hidden="true" tabindex="-1"></a>is not required in the estimation of the effects $\beta$ and the Cox</span>
<span id="cb78-169"><a href="#cb78-169" aria-hidden="true" tabindex="-1"></a>model parameters are estimated using a *partial* likelihood</span>
<span id="cb78-170"><a href="#cb78-170" aria-hidden="true" tabindex="-1"></a>approach. However, as the Bayesian framework is based on the (full)</span>
<span id="cb78-171"><a href="#cb78-171" aria-hidden="true" tabindex="-1"></a>likelihood principle, the semi-parametric Cox proportional hazards</span>
<span id="cb78-172"><a href="#cb78-172" aria-hidden="true" tabindex="-1"></a>model is not applicale. Nonetheless, <span class="in">`brms`</span> does offer a variant of</span>
<span id="cb78-173"><a href="#cb78-173" aria-hidden="true" tabindex="-1"></a>the Cox proportional hazards model, which is designed to result in</span>
<span id="cb78-174"><a href="#cb78-174" aria-hidden="true" tabindex="-1"></a>numerically very similar results if used with non-informative priors</span>
<span id="cb78-175"><a href="#cb78-175" aria-hidden="true" tabindex="-1"></a>when compared to the respective Cox proportional hazards</span>
<span id="cb78-176"><a href="#cb78-176" aria-hidden="true" tabindex="-1"></a>model. Instead of marginalizing out the baseline hazard function</span>
<span id="cb78-177"><a href="#cb78-177" aria-hidden="true" tabindex="-1"></a>$h_0(t)$, the baseline hazard function is modelled using an almost</span>
<span id="cb78-178"><a href="#cb78-178" aria-hidden="true" tabindex="-1"></a>non-parametric approach based on a parametric spline approximation to</span>
<span id="cb78-179"><a href="#cb78-179" aria-hidden="true" tabindex="-1"></a>$h_0(t)$. The estimated regression coefficients $\beta$ for the Cox</span>
<span id="cb78-180"><a href="#cb78-180" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> family correspond to logarithmic hazard ratios.</span>
<span id="cb78-181"><a href="#cb78-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-182"><a href="#cb78-182" aria-hidden="true" tabindex="-1"></a>In contrast to the semi-parametric Cox model, parametric modeling of</span>
<span id="cb78-183"><a href="#cb78-183" aria-hidden="true" tabindex="-1"></a>time to event data assumes a functional form for the hazard function</span>
<span id="cb78-184"><a href="#cb78-184" aria-hidden="true" tabindex="-1"></a>$h(t)$ or equivalently for the probability density function $f(t)$ of</span>
<span id="cb78-185"><a href="#cb78-185" aria-hidden="true" tabindex="-1"></a>the event times at $t=T$. Both functions are related to one another by the</span>
<span id="cb78-186"><a href="#cb78-186" aria-hidden="true" tabindex="-1"></a>basic relationship $h(t) = \frac{f(t)}{S(t)}$, where $S(t) = P(T&gt;t) =</span>
<span id="cb78-187"><a href="#cb78-187" aria-hidden="true" tabindex="-1"></a>\int_t^\infty f(u)\, du$ is the survivor function (probability that an</span>
<span id="cb78-188"><a href="#cb78-188" aria-hidden="true" tabindex="-1"></a>event occurs past time $t$). In <span class="in">`brms`</span> the convention is to define via</span>
<span id="cb78-189"><a href="#cb78-189" aria-hidden="true" tabindex="-1"></a>the <span class="in">`family`</span> argument to <span class="in">`brm`</span> the probability density of the event</span>
<span id="cb78-190"><a href="#cb78-190" aria-hidden="true" tabindex="-1"></a>times. A description of the parametrization for these densities are</span>
<span id="cb78-191"><a href="#cb78-191" aria-hidden="true" tabindex="-1"></a>found in the vignette "Parametrization of Response Distributions in</span>
<span id="cb78-192"><a href="#cb78-192" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span>".</span>
<span id="cb78-193"><a href="#cb78-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-194"><a href="#cb78-194" aria-hidden="true" tabindex="-1"></a>In this case study the Weibull distribution is used as literature data</span>
<span id="cb78-195"><a href="#cb78-195" aria-hidden="true" tabindex="-1"></a>suggested its appropiateness and a parametric modeling approach may</span>
<span id="cb78-196"><a href="#cb78-196" aria-hidden="true" tabindex="-1"></a>lead to greater statistical efficiency. The Weibull probability</span>
<span id="cb78-197"><a href="#cb78-197" aria-hidden="true" tabindex="-1"></a>density is parametrized in <span class="in">`brms`</span> in terms of shape $\alpha$ and scale</span>
<span id="cb78-198"><a href="#cb78-198" aria-hidden="true" tabindex="-1"></a>parameter $s$. Instead of directly modeling the scale $s$ (as done in many</span>
<span id="cb78-199"><a href="#cb78-199" aria-hidden="true" tabindex="-1"></a>other time to event programs), <span class="in">`brms`</span> models the mean of the Weibull</span>
<span id="cb78-200"><a href="#cb78-200" aria-hidden="true" tabindex="-1"></a>distribution $\mu$. Therefore, the scale $s$ is set equal to</span>
<span id="cb78-201"><a href="#cb78-201" aria-hidden="true" tabindex="-1"></a>$s=\frac{\mu}{\Gamma(1 + \frac{1}{\alpha})}$ in the Weibull</span>
<span id="cb78-202"><a href="#cb78-202" aria-hidden="true" tabindex="-1"></a>probability density</span>
<span id="cb78-203"><a href="#cb78-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-204"><a href="#cb78-204" aria-hidden="true" tabindex="-1"></a>$$ f_{\mbox{Weibull}}(t) = \frac{\alpha}{s} \left( \frac{t}{s}</span>
<span id="cb78-205"><a href="#cb78-205" aria-hidden="true" tabindex="-1"></a>\right)^{\alpha-1} \, \exp\left(-\left(\frac{t}{s}\right)^\alpha\right).$$</span>
<span id="cb78-206"><a href="#cb78-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-207"><a href="#cb78-207" aria-hidden="true" tabindex="-1"></a>In this form, the model fulfills the property of an *accelerated</span>
<span id="cb78-208"><a href="#cb78-208" aria-hidden="true" tabindex="-1"></a>failure time* (AFT) model whenever explanatory variables are</span>
<span id="cb78-209"><a href="#cb78-209" aria-hidden="true" tabindex="-1"></a>introduced. This follows from considering the survivor function</span>
<span id="cb78-210"><a href="#cb78-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-211"><a href="#cb78-211" aria-hidden="true" tabindex="-1"></a>$$S_{\mbox{Weibull}}(t) =</span>
<span id="cb78-212"><a href="#cb78-212" aria-hidden="true" tabindex="-1"></a>\exp\left(-\left(\frac{t}{s}\right)^\alpha\right)$$</span>
<span id="cb78-213"><a href="#cb78-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-214"><a href="#cb78-214" aria-hidden="true" tabindex="-1"></a>and modeling the mean $\mu_i$ linearly on the $\log$ scale as a function</span>
<span id="cb78-215"><a href="#cb78-215" aria-hidden="true" tabindex="-1"></a>of covariates $x_i$ for subject $i$, $\log(\mu_i) = \beta_0 + x_i' \,</span>
<span id="cb78-216"><a href="#cb78-216" aria-hidden="true" tabindex="-1"></a>\beta$. Defining as the reference covariate level $x_i = 0$ motivates</span>
<span id="cb78-217"><a href="#cb78-217" aria-hidden="true" tabindex="-1"></a>the definition of a reference survivor function</span>
<span id="cb78-218"><a href="#cb78-218" aria-hidden="true" tabindex="-1"></a>$S_{\mbox{Weibull},0}(t)$ for which the linear predictor $\log(\mu_0)$</span>
<span id="cb78-219"><a href="#cb78-219" aria-hidden="true" tabindex="-1"></a>is equal to the intercept $\beta_0$. As a consequence, the survivor</span>
<span id="cb78-220"><a href="#cb78-220" aria-hidden="true" tabindex="-1"></a>function of any patient $i$ is related to the reference survivor</span>
<span id="cb78-221"><a href="#cb78-221" aria-hidden="true" tabindex="-1"></a>function by</span>
<span id="cb78-222"><a href="#cb78-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-223"><a href="#cb78-223" aria-hidden="true" tabindex="-1"></a>$$ S_{i}(t) = S_{\mbox{Weibull},0}\left(\frac{t}{\exp(x_i' \, \beta)} \right),$$</span>
<span id="cb78-224"><a href="#cb78-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-225"><a href="#cb78-225" aria-hidden="true" tabindex="-1"></a>which is the defining property of AFT models.  The regression</span>
<span id="cb78-226"><a href="#cb78-226" aria-hidden="true" tabindex="-1"></a>coefficients $\beta$ are then interpretable as relative</span>
<span id="cb78-227"><a href="#cb78-227" aria-hidden="true" tabindex="-1"></a>speedup/slowdown of the process progression. That is, an increased</span>
<span id="cb78-228"><a href="#cb78-228" aria-hidden="true" tabindex="-1"></a>time scale (slowdown) leads to a delay of an event. Given that</span>
<span id="cb78-229"><a href="#cb78-229" aria-hidden="true" tabindex="-1"></a>modeling the scale of the Weibull distribution is a common convention</span>
<span id="cb78-230"><a href="#cb78-230" aria-hidden="true" tabindex="-1"></a>(instead of the mean $\mu$ as in <span class="in">`brms`</span>), it is useful to recall that</span>
<span id="cb78-231"><a href="#cb78-231" aria-hidden="true" tabindex="-1"></a>this merely means that we need to offset the intercept as estimated by</span>
<span id="cb78-232"><a href="#cb78-232" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> with $-\log\Gamma\left(1 + \frac{1}{\alpha} \right)$ in order</span>
<span id="cb78-233"><a href="#cb78-233" aria-hidden="true" tabindex="-1"></a>to obtain the scale on the log scale, $\log(s)$ (which is the what the</span>
<span id="cb78-234"><a href="#cb78-234" aria-hidden="true" tabindex="-1"></a><span class="in">`survival`</span> R package would report with its <span class="in">`survreg`</span> routine). The</span>
<span id="cb78-235"><a href="#cb78-235" aria-hidden="true" tabindex="-1"></a><span class="in">`survival`</span> R package does futhermore use a log-linear representation</span>
<span id="cb78-236"><a href="#cb78-236" aria-hidden="true" tabindex="-1"></a>of the statistical problem leading to an estimation of the inverse</span>
<span id="cb78-237"><a href="#cb78-237" aria-hidden="true" tabindex="-1"></a>shape parameter $\sigma=\frac{1}{\alpha}$.</span>
<span id="cb78-238"><a href="#cb78-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-239"><a href="#cb78-239" aria-hidden="true" tabindex="-1"></a>The Weibull AFT model as estimated by <span class="in">`brms`</span> can be converted into the</span>
<span id="cb78-240"><a href="#cb78-240" aria-hidden="true" tabindex="-1"></a>respective proportional hazard model by transforming the scale $s$</span>
<span id="cb78-241"><a href="#cb78-241" aria-hidden="true" tabindex="-1"></a>with the relation $s = \lambda^{-\frac{1}{\alpha}}$ to an alternative</span>
<span id="cb78-242"><a href="#cb78-242" aria-hidden="true" tabindex="-1"></a>scale parameter $\lambda$. Doing so casts the hazard function into</span>
<span id="cb78-243"><a href="#cb78-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-244"><a href="#cb78-244" aria-hidden="true" tabindex="-1"></a>$$h_{\mbox{Weibull}}(t) = \lambda \, \alpha \, t^{\alpha-1}.$$</span>
<span id="cb78-245"><a href="#cb78-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-246"><a href="#cb78-246" aria-hidden="true" tabindex="-1"></a>When we now model $\lambda$ as a function of covariates $x_i$</span>
<span id="cb78-247"><a href="#cb78-247" aria-hidden="true" tabindex="-1"></a>linearly on the $\log$ scale one arrives at</span>
<span id="cb78-248"><a href="#cb78-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-249"><a href="#cb78-249" aria-hidden="true" tabindex="-1"></a>$$ h_i(t) = \exp(x_i' \, \xi) \, h_{\mbox{Weibull},0}(t),$$</span>
<span id="cb78-250"><a href="#cb78-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-251"><a href="#cb78-251" aria-hidden="true" tabindex="-1"></a>where $h_{\mbox{Weibull},0}(t)$ is defined by the reference covariate</span>
<span id="cb78-252"><a href="#cb78-252" aria-hidden="true" tabindex="-1"></a>level $x_i=0$ such that $\lambda = \exp(\xi_0)$ for</span>
<span id="cb78-253"><a href="#cb78-253" aria-hidden="true" tabindex="-1"></a>$h_{\mbox{Weibull},0}(t)$. To now convert the AFT regression</span>
<span id="cb78-254"><a href="#cb78-254" aria-hidden="true" tabindex="-1"></a>coefficients $\beta$ as estimated by <span class="in">`brms`</span> to their respective</span>
<span id="cb78-255"><a href="#cb78-255" aria-hidden="true" tabindex="-1"></a>proportional hazard coefficients $\xi$ one may just apply the</span>
<span id="cb78-256"><a href="#cb78-256" aria-hidden="true" tabindex="-1"></a>transformation resulting in the relationship</span>
<span id="cb78-257"><a href="#cb78-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-258"><a href="#cb78-258" aria-hidden="true" tabindex="-1"></a>$$\xi = -\alpha \, \beta,$$</span>
<span id="cb78-259"><a href="#cb78-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-260"><a href="#cb78-260" aria-hidden="true" tabindex="-1"></a>which converts from logarithmic speedup/slowdown $\beta$ (AFT model) into</span>
<span id="cb78-261"><a href="#cb78-261" aria-hidden="true" tabindex="-1"></a>logarithmic hazard ratios $\xi$ (proportional hazard model).</span>
<span id="cb78-262"><a href="#cb78-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-263"><a href="#cb78-263" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!---</span></span>
<span id="cb78-264"><a href="#cb78-264" aria-hidden="true" tabindex="-1"></a><span class="co">We assume that the event times $T_i$ for patients $i=1,\ldots,N$ follow a</span></span>
<span id="cb78-265"><a href="#cb78-265" aria-hidden="true" tabindex="-1"></a><span class="co">distribution with probability density function</span></span>
<span id="cb78-266"><a href="#cb78-266" aria-hidden="true" tabindex="-1"></a><span class="co">$f(t| \boldsymbol{\theta})$ defined on the positive reals</span></span>
<span id="cb78-267"><a href="#cb78-267" aria-hidden="true" tabindex="-1"></a><span class="co">(i.e. the time-to-event can only ever be positive by convention). The distribution has</span></span>
<span id="cb78-268"><a href="#cb78-268" aria-hidden="true" tabindex="-1"></a><span class="co">parameters $\boldsymbol{\theta}$ and its cumulative distribution function</span></span>
<span id="cb78-269"><a href="#cb78-269" aria-hidden="true" tabindex="-1"></a><span class="co">$F(t|\boldsymbol{\theta})$ is the probability for an event prior to</span></span>
<span id="cb78-270"><a href="#cb78-270" aria-hidden="true" tabindex="-1"></a><span class="co">$t$. Moreover, the survivor function $S(t|\boldsymbol{\theta}) =</span></span>
<span id="cb78-271"><a href="#cb78-271" aria-hidden="true" tabindex="-1"></a><span class="co">1-F(t|\boldsymbol{\theta})$ is the probability for an event to occur</span></span>
<span id="cb78-272"><a href="#cb78-272" aria-hidden="true" tabindex="-1"></a><span class="co">later than $t$. When we observe an event time $Y_i=y_i$, the</span></span>
<span id="cb78-273"><a href="#cb78-273" aria-hidden="true" tabindex="-1"></a><span class="co">likelihood contribution of this observation is</span></span>
<span id="cb78-274"><a href="#cb78-274" aria-hidden="true" tabindex="-1"></a><span class="co">$f(y_i|\boldsymbol{\theta})$. If we observe that by time $Y_i=y_i$ no</span></span>
<span id="cb78-275"><a href="#cb78-275" aria-hidden="true" tabindex="-1"></a><span class="co">event has occured and there is no further follow-up for events beyond</span></span>
<span id="cb78-276"><a href="#cb78-276" aria-hidden="true" tabindex="-1"></a><span class="co">this point, the likelihood contribution is</span></span>
<span id="cb78-277"><a href="#cb78-277" aria-hidden="true" tabindex="-1"></a><span class="co">$S(y_i|\boldsymbol{\theta})$ (right censoring).</span></span>
<span id="cb78-278"><a href="#cb78-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-279"><a href="#cb78-279" aria-hidden="true" tabindex="-1"></a><span class="co">A common approach to model the survival times is by considering the</span></span>
<span id="cb78-280"><a href="#cb78-280" aria-hidden="true" tabindex="-1"></a><span class="co">hazard rate, which is the rate of events at time $t$ provided no event</span></span>
<span id="cb78-281"><a href="#cb78-281" aria-hidden="true" tabindex="-1"></a><span class="co">has happened so far</span></span>
<span id="cb78-282"><a href="#cb78-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-283"><a href="#cb78-283" aria-hidden="true" tabindex="-1"></a><span class="co">$$h(t|\boldsymbol{\theta}) = \frac{f(t|\boldsymbol{\theta})}{S(t|\boldsymbol{\theta})}.$$</span></span>
<span id="cb78-284"><a href="#cb78-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-285"><a href="#cb78-285" aria-hidden="true" tabindex="-1"></a><span class="co">By basic time to event relationships, the hazard function</span></span>
<span id="cb78-286"><a href="#cb78-286" aria-hidden="true" tabindex="-1"></a><span class="co">$h(t|\boldsymbol{\theta})$ defines directly the probability density</span></span>
<span id="cb78-287"><a href="#cb78-287" aria-hidden="true" tabindex="-1"></a><span class="co">function ($f(t|\boldsymbol{\theta}) = h(t|\boldsymbol{\theta}) \,</span></span>
<span id="cb78-288"><a href="#cb78-288" aria-hidden="true" tabindex="-1"></a><span class="co">\exp[-\int_0^t h(s|\boldsymbol{\theta})\, ds]$).</span></span>
<span id="cb78-289"><a href="#cb78-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-290"><a href="#cb78-290" aria-hidden="true" tabindex="-1"></a><span class="co">For regression modeling, we wish to compare the survival times of</span></span>
<span id="cb78-291"><a href="#cb78-291" aria-hidden="true" tabindex="-1"></a><span class="co">different groups of patients, for example patients on a control</span></span>
<span id="cb78-292"><a href="#cb78-292" aria-hidden="true" tabindex="-1"></a><span class="co">treatment in comparison to patients on an active treatment. We assume</span></span>
<span id="cb78-293"><a href="#cb78-293" aria-hidden="true" tabindex="-1"></a><span class="co">that the survival times of the different groups, as defined by their</span></span>
<span id="cb78-294"><a href="#cb78-294" aria-hidden="true" tabindex="-1"></a><span class="co">covariates $X$, are related to the model's distributional parameters</span></span>
<span id="cb78-295"><a href="#cb78-295" aria-hidden="true" tabindex="-1"></a><span class="co">$\boldsymbol{\theta}$. In `brms` the distributional parameters</span></span>
<span id="cb78-296"><a href="#cb78-296" aria-hidden="true" tabindex="-1"></a><span class="co">$\boldsymbol{\theta}$ are by default modelled using a linear</span></span>
<span id="cb78-297"><a href="#cb78-297" aria-hidden="true" tabindex="-1"></a><span class="co">relationship on a transformed scale defined by a link function.</span></span>
<span id="cb78-298"><a href="#cb78-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-299"><a href="#cb78-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-300"><a href="#cb78-300" aria-hidden="true" tabindex="-1"></a><span class="co">suitably to the model parameters</span></span>
<span id="cb78-301"><a href="#cb78-301" aria-hidden="true" tabindex="-1"></a><span class="co">$\boldsymbol{\theta}$. Typically a</span></span>
<span id="cb78-302"><a href="#cb78-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-303"><a href="#cb78-303" aria-hidden="true" tabindex="-1"></a><span class="co">will typically want to assume that some</span></span>
<span id="cb78-304"><a href="#cb78-304" aria-hidden="true" tabindex="-1"></a><span class="co">suitable function of the model parameters $\boldsymbol{\theta}$ can be</span></span>
<span id="cb78-305"><a href="#cb78-305" aria-hidden="true" tabindex="-1"></a><span class="co">explained by a linear regression equation. </span></span>
<span id="cb78-306"><a href="#cb78-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-307"><a href="#cb78-307" aria-hidden="true" tabindex="-1"></a><span class="co">One common approach is to</span></span>
<span id="cb78-308"><a href="#cb78-308" aria-hidden="true" tabindex="-1"></a><span class="co">consider the hazard rate (event rate at time $t$ provided no event</span></span>
<span id="cb78-309"><a href="#cb78-309" aria-hidden="true" tabindex="-1"></a><span class="co">happend so far) defined as $$h(t) :=</span></span>
<span id="cb78-310"><a href="#cb78-310" aria-hidden="true" tabindex="-1"></a><span class="co">\frac{f(t;\boldsymbol{\theta})}{1-F(t;\boldsymbol{\theta})}$$ and to</span></span>
<span id="cb78-311"><a href="#cb78-311" aria-hidden="true" tabindex="-1"></a><span class="co">model $$\log h(t) = \log h_0(t) + \boldsymbol{X_i}</span></span>
<span id="cb78-312"><a href="#cb78-312" aria-hidden="true" tabindex="-1"></a><span class="co">\boldsymbol{\beta}.$$ Here, we call $h_0(t)$ the baseline hazard</span></span>
<span id="cb78-313"><a href="#cb78-313" aria-hidden="true" tabindex="-1"></a><span class="co">function. The baseline hazard function describes how the hazard for an</span></span>
<span id="cb78-314"><a href="#cb78-314" aria-hidden="true" tabindex="-1"></a><span class="co">event changes over time when all covariates are 0.</span></span>
<span id="cb78-315"><a href="#cb78-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-316"><a href="#cb78-316" aria-hidden="true" tabindex="-1"></a><span class="co">In the simple case of an exponential time-to-event regression model</span></span>
<span id="cb78-317"><a href="#cb78-317" aria-hidden="true" tabindex="-1"></a><span class="co">$h_0(t) = h_0$ is constant. I.e. the risk of an event falling into a</span></span>
<span id="cb78-318"><a href="#cb78-318" aria-hidden="true" tabindex="-1"></a><span class="co">time interval conditional on a patient still being at risk at the start</span></span>
<span id="cb78-319"><a href="#cb78-319" aria-hidden="true" tabindex="-1"></a><span class="co">of the interval is the same for all time intervals of equal length.</span></span>
<span id="cb78-320"><a href="#cb78-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-321"><a href="#cb78-321" aria-hidden="true" tabindex="-1"></a><span class="co">In contrast, the baseline hazard rate is not constant for Weibull</span></span>
<span id="cb78-322"><a href="#cb78-322" aria-hidden="true" tabindex="-1"></a><span class="co">regression. The parametrization used in `brms` for the Weibull</span></span>
<span id="cb78-323"><a href="#cb78-323" aria-hidden="true" tabindex="-1"></a><span class="co">distribution is</span></span>
<span id="cb78-324"><a href="#cb78-324" aria-hidden="true" tabindex="-1"></a><span class="co">$$f(t;\alpha, s) = \frac{\alpha}{s} \left(\frac{t}{s}\right)^{\alpha-1} \exp\left[-\left(\frac{t}{s}\right)^\alpha\right]$$</span></span>
<span id="cb78-325"><a href="#cb78-325" aria-hidden="true" tabindex="-1"></a><span class="co">so that the log-hazard function is</span></span>
<span id="cb78-326"><a href="#cb78-326" aria-hidden="true" tabindex="-1"></a><span class="co">$$\log h(t; \alpha, s) = \log \alpha - \log s + (\alpha - 1) * (\log t - \log s).$$</span></span>
<span id="cb78-327"><a href="#cb78-327" aria-hidden="true" tabindex="-1"></a><span class="co">Thus, we can see that the baseline hazard rate increases with time, if</span></span>
<span id="cb78-328"><a href="#cb78-328" aria-hidden="true" tabindex="-1"></a><span class="co">$\alpha &gt; 1$, decreases, if $\alpha &lt; 1$, and is constant when</span></span>
<span id="cb78-329"><a href="#cb78-329" aria-hidden="true" tabindex="-1"></a><span class="co">$\alpha=1$, in which case the Weibull distribution reduces to the</span></span>
<span id="cb78-330"><a href="#cb78-330" aria-hidden="true" tabindex="-1"></a><span class="co">exponential distribution. In this parameterization `s` and `alpha`</span></span>
<span id="cb78-331"><a href="#cb78-331" aria-hidden="true" tabindex="-1"></a><span class="co">together define the mean of the distribution, which is given by</span></span>
<span id="cb78-332"><a href="#cb78-332" aria-hidden="true" tabindex="-1"></a><span class="co">$E(T) = s \times \Gamma(1+1/\alpha)$.</span></span>
<span id="cb78-333"><a href="#cb78-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-334"><a href="#cb78-334" aria-hidden="true" tabindex="-1"></a><span class="co">Cox regression can be fitted in a frequentist manner using (partial)</span></span>
<span id="cb78-335"><a href="#cb78-335" aria-hidden="true" tabindex="-1"></a><span class="co">maximum likelihood estimation without explicitly modeling $\log h_0(t)$.</span></span>
<span id="cb78-336"><a href="#cb78-336" aria-hidden="true" tabindex="-1"></a><span class="co">However, the implicit estimate for the baseline hazard function implied</span></span>
<span id="cb78-337"><a href="#cb78-337" aria-hidden="true" tabindex="-1"></a><span class="co">by Cox regression is a piecewise constant function that has steps at</span></span>
<span id="cb78-338"><a href="#cb78-338" aria-hidden="true" tabindex="-1"></a><span class="co">each observed uncensored event time. `brms` implements Cox regression</span></span>
<span id="cb78-339"><a href="#cb78-339" aria-hidden="true" tabindex="-1"></a><span class="co">using M-splines, which is a very close approximarion to cox, since the</span></span>
<span id="cb78-340"><a href="#cb78-340" aria-hidden="true" tabindex="-1"></a><span class="co">hazard ratio is modeled in non-parametric fashion, and we can request it</span></span>
<span id="cb78-341"><a href="#cb78-341" aria-hidden="true" tabindex="-1"></a><span class="co">with `cox(link = "log", bhaz = NULL)`.</span></span>
<span id="cb78-342"><a href="#cb78-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-343"><a href="#cb78-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-344"><a href="#cb78-344" aria-hidden="true" tabindex="-1"></a><span class="co">---&gt;</span></span>
<span id="cb78-345"><a href="#cb78-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-346"><a href="#cb78-346" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb78-347"><a href="#cb78-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-348"><a href="#cb78-348" aria-hidden="true" tabindex="-1"></a>We demonstrate here the trial analysis using a fake data simulation of</span>
<span id="cb78-349"><a href="#cb78-349" aria-hidden="true" tabindex="-1"></a>the trial design. As key modeling choices for the parametric modeling</span>
<span id="cb78-350"><a href="#cb78-350" aria-hidden="true" tabindex="-1"></a>approach are motivated from the historical data we start with the</span>
<span id="cb78-351"><a href="#cb78-351" aria-hidden="true" tabindex="-1"></a>presentation of the historical data set and then describe the details</span>
<span id="cb78-352"><a href="#cb78-352" aria-hidden="true" tabindex="-1"></a>of the trial simulation.</span>
<span id="cb78-353"><a href="#cb78-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-354"><a href="#cb78-354" aria-hidden="true" tabindex="-1"></a><span class="fu">### Historical data</span></span>
<span id="cb78-355"><a href="#cb78-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-356"><a href="#cb78-356" aria-hidden="true" tabindex="-1"></a>The CheckMate 649 trial <span class="co">[</span><span class="ot">@Janjigian2021</span><span class="co">]</span> included 789 gastric cancer</span>
<span id="cb78-357"><a href="#cb78-357" aria-hidden="true" tabindex="-1"></a>patients which were treated with either <span class="in">`chemoA`</span> or <span class="in">`chemoB`</span> and their</span>
<span id="cb78-358"><a href="#cb78-358" aria-hidden="true" tabindex="-1"></a>progression free survival (PFS) was reported. Both chemotherapies were</span>
<span id="cb78-359"><a href="#cb78-359" aria-hidden="true" tabindex="-1"></a>used in a roughly 1:1 ratio such that we will consider the</span>
<span id="cb78-360"><a href="#cb78-360" aria-hidden="true" tabindex="-1"></a>reported data as "average" between both chemo therapies (despite lack</span>
<span id="cb78-361"><a href="#cb78-361" aria-hidden="true" tabindex="-1"></a>of randomization occured wrt to chemotherapy assignment).</span>
<span id="cb78-362"><a href="#cb78-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-363"><a href="#cb78-363" aria-hidden="true" tabindex="-1"></a>The data of trial has here been reconstructed from the published</span>
<span id="cb78-364"><a href="#cb78-364" aria-hidden="true" tabindex="-1"></a>survival curves:</span>
<span id="cb78-365"><a href="#cb78-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-366"><a href="#cb78-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, echo=FALSE}</span></span>
<span id="cb78-367"><a href="#cb78-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: FALSE</span></span>
<span id="cb78-368"><a href="#cb78-368" aria-hidden="true" tabindex="-1"></a>hdata2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/pfs_nivo_all.csv"</span>))</span>
<span id="cb78-369"><a href="#cb78-369" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hdata2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"status"</span>)</span>
<span id="cb78-370"><a href="#cb78-370" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>hdata2)</span>
<span id="cb78-371"><a href="#cb78-371" aria-hidden="true" tabindex="-1"></a>ggpl <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(km, <span class="at">data=</span>hdata2, <span class="at">risk.table=</span><span class="cn">TRUE</span>, <span class="at">surv.median.line =</span> <span class="st">"hv"</span>, <span class="at">break.time.by=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb78-372"><a href="#cb78-372" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Time [month]"</span>)</span>
<span id="cb78-373"><a href="#cb78-373" aria-hidden="true" tabindex="-1"></a>ggpl<span class="sc">$</span>plot <span class="ot">&lt;-</span> ggpl<span class="sc">$</span>plot <span class="sc">+</span></span>
<span id="cb78-374"><a href="#cb78-374" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Historical data CheckMate 649"</span>,</span>
<span id="cb78-375"><a href="#cb78-375" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Treatment with either SoC-A or SoC-B in 1:1 ratio"</span>) <span class="sc">+</span></span>
<span id="cb78-376"><a href="#cb78-376" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb78-377"><a href="#cb78-377" aria-hidden="true" tabindex="-1"></a>ggpl</span>
<span id="cb78-378"><a href="#cb78-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-379"><a href="#cb78-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-380"><a href="#cb78-380" aria-hidden="true" tabindex="-1"></a>To now evaluate if the Weibull probability density function is an</span>
<span id="cb78-381"><a href="#cb78-381" aria-hidden="true" tabindex="-1"></a>appropiate choice for this data we consider if the non-parametric</span>
<span id="cb78-382"><a href="#cb78-382" aria-hidden="true" tabindex="-1"></a>estimate of the survivor function is compatible with properties of</span>
<span id="cb78-383"><a href="#cb78-383" aria-hidden="true" tabindex="-1"></a>Weibull distributed event times. Specifically, if we transform the</span>
<span id="cb78-384"><a href="#cb78-384" aria-hidden="true" tabindex="-1"></a>survivor function $S_{\mbox{Weibull}}(t)$ of the Weibull probability</span>
<span id="cb78-385"><a href="#cb78-385" aria-hidden="true" tabindex="-1"></a>density function with the complementary log-log transformation, we</span>
<span id="cb78-386"><a href="#cb78-386" aria-hidden="true" tabindex="-1"></a>obtain that</span>
<span id="cb78-387"><a href="#cb78-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-388"><a href="#cb78-388" aria-hidden="true" tabindex="-1"></a>$$ \mbox{cloglog}(S_{\mbox{Weibull}}(t)) = \log( - \log(S_{\mbox{Weibull}}(t))) =</span>
<span id="cb78-389"><a href="#cb78-389" aria-hidden="true" tabindex="-1"></a>-\alpha \, \log(s)  + \alpha \, \log(t)$$</span>
<span id="cb78-390"><a href="#cb78-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-391"><a href="#cb78-391" aria-hidden="true" tabindex="-1"></a>holds. Therefore, we can visualize an estimate of the survivor</span>
<span id="cb78-392"><a href="#cb78-392" aria-hidden="true" tabindex="-1"></a>function on a transformed scale as a function of $\log(t)$ and we</span>
<span id="cb78-393"><a href="#cb78-393" aria-hidden="true" tabindex="-1"></a>should observe a straight line with slope $\alpha$ and intercept</span>
<span id="cb78-394"><a href="#cb78-394" aria-hidden="true" tabindex="-1"></a>$-\alpha \, \log(s)$:</span>
<span id="cb78-395"><a href="#cb78-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-398"><a href="#cb78-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-399"><a href="#cb78-399" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>hdata2)</span>
<span id="cb78-400"><a href="#cb78-400" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(km, <span class="at">data=</span>hdata2, <span class="at">fun =</span> <span class="st">"cloglog"</span>)</span>
<span id="cb78-401"><a href="#cb78-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-402"><a href="#cb78-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-403"><a href="#cb78-403" aria-hidden="true" tabindex="-1"></a>While the line is not perfectly straight over the entire follow-up,</span>
<span id="cb78-404"><a href="#cb78-404" aria-hidden="true" tabindex="-1"></a>the assumption of a straight line within the time period including the</span>
<span id="cb78-405"><a href="#cb78-405" aria-hidden="true" tabindex="-1"></a>bulk of all events falls in the range of a good approximation with a</span>
<span id="cb78-406"><a href="#cb78-406" aria-hidden="true" tabindex="-1"></a>line (as can be seen from the numbers at risk of the plot above).</span>
<span id="cb78-407"><a href="#cb78-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-408"><a href="#cb78-408" aria-hidden="true" tabindex="-1"></a>As an additional evaluation of the Weibull distributional form we</span>
<span id="cb78-409"><a href="#cb78-409" aria-hidden="true" tabindex="-1"></a>model the CheckMate 649 data via <span class="in">`brms`</span> and perform a posterior</span>
<span id="cb78-410"><a href="#cb78-410" aria-hidden="true" tabindex="-1"></a>predictive check.  The priors are specified as illustrated in the</span>
<span id="cb78-411"><a href="#cb78-411" aria-hidden="true" tabindex="-1"></a>later section on the <span class="co">[</span><span class="ot">used priors</span><span class="co">](#tte-model-prior)</span>. The result</span>
<span id="cb78-412"><a href="#cb78-412" aria-hidden="true" tabindex="-1"></a>looks reasonable.</span>
<span id="cb78-413"><a href="#cb78-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-414"><a href="#cb78-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb78-415"><a href="#cb78-415" aria-hidden="true" tabindex="-1"></a>model_weibull_hist <span class="ot">&lt;-</span> <span class="fu">bf</span>(time <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>status) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb78-416"><a href="#cb78-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-417"><a href="#cb78-417" aria-hidden="true" tabindex="-1"></a>prior_weibull_hist <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fu">log</span>(<span class="dv">6</span>), <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>), <span class="at">class=</span>Intercept) <span class="sc">+</span></span>
<span id="cb78-418"><a href="#cb78-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">3</span>, <span class="fl">2.7</span>), <span class="at">class=</span>shape)</span>
<span id="cb78-419"><a href="#cb78-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-420"><a href="#cb78-420" aria-hidden="true" tabindex="-1"></a>fit_hist_checkmate <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_weibull_hist,</span>
<span id="cb78-421"><a href="#cb78-421" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>hdata2,</span>
<span id="cb78-422"><a href="#cb78-422" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prior=</span>prior_weibull_hist,</span>
<span id="cb78-423"><a href="#cb78-423" aria-hidden="true" tabindex="-1"></a>                          <span class="at">seed=</span><span class="dv">234235</span>,</span>
<span id="cb78-424"><a href="#cb78-424" aria-hidden="true" tabindex="-1"></a>                          <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-425"><a href="#cb78-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-426"><a href="#cb78-426" aria-hidden="true" tabindex="-1"></a>fit_hist_checkmate</span>
<span id="cb78-427"><a href="#cb78-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-428"><a href="#cb78-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-429"><a href="#cb78-429" aria-hidden="true" tabindex="-1"></a>With the posterior we can now perform a posterior predictive check. We</span>
<span id="cb78-430"><a href="#cb78-430" aria-hidden="true" tabindex="-1"></a>do so by drawing 100 samples of the model parameters from the</span>
<span id="cb78-431"><a href="#cb78-431" aria-hidden="true" tabindex="-1"></a>posterior and draw for each sample a realization of the event times</span>
<span id="cb78-432"><a href="#cb78-432" aria-hidden="true" tabindex="-1"></a>for all patients. Hence, for each sample one obtains a fake data set</span>
<span id="cb78-433"><a href="#cb78-433" aria-hidden="true" tabindex="-1"></a>simulated according to the Weibull distribution. Finally, each fake</span>
<span id="cb78-434"><a href="#cb78-434" aria-hidden="true" tabindex="-1"></a>data set is summarized by a Kaplan-Meier estimate and drawn in light</span>
<span id="cb78-435"><a href="#cb78-435" aria-hidden="true" tabindex="-1"></a>color while the actually observed data is summarized in the same way</span>
<span id="cb78-436"><a href="#cb78-436" aria-hidden="true" tabindex="-1"></a>and drawn using a thick line. If the fitted model is appropiate, then</span>
<span id="cb78-437"><a href="#cb78-437" aria-hidden="true" tabindex="-1"></a>the observed Kaplan Meier estimate should look just like a random</span>
<span id="cb78-438"><a href="#cb78-438" aria-hidden="true" tabindex="-1"></a>realization among the many fake data generated ones. However, we</span>
<span id="cb78-439"><a href="#cb78-439" aria-hidden="true" tabindex="-1"></a>observe that over the entire follow-up time the observed data is</span>
<span id="cb78-440"><a href="#cb78-440" aria-hidden="true" tabindex="-1"></a>leaving for late follow-up times the bulk of the fake data generated</span>
<span id="cb78-441"><a href="#cb78-441" aria-hidden="true" tabindex="-1"></a>Kaplan Meier curves. This may suggest a deviation from the Weibull</span>
<span id="cb78-442"><a href="#cb78-442" aria-hidden="true" tabindex="-1"></a>distribution or the possibility that time-varying covariates are</span>
<span id="cb78-443"><a href="#cb78-443" aria-hidden="true" tabindex="-1"></a>helpful. Nonetheless, if one focusses on the follow-up time frame,</span>
<span id="cb78-444"><a href="#cb78-444" aria-hidden="true" tabindex="-1"></a>which includes the majoritiy of events (up to 15 month), then the</span>
<span id="cb78-445"><a href="#cb78-445" aria-hidden="true" tabindex="-1"></a>posterior predictive check does look reasonable. This is why we use</span>
<span id="cb78-446"><a href="#cb78-446" aria-hidden="true" tabindex="-1"></a>the Weibull distribution without a time-varying covariate for</span>
<span id="cb78-447"><a href="#cb78-447" aria-hidden="true" tabindex="-1"></a>simplicity.</span>
<span id="cb78-448"><a href="#cb78-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-449"><a href="#cb78-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, echo=TRUE, fig.width=10}</span></span>
<span id="cb78-450"><a href="#cb78-450" aria-hidden="true" tabindex="-1"></a>p_full_fup <span class="ot">&lt;-</span> <span class="fu">pp_check</span>(fit_hist_checkmate, <span class="at">status_y=</span>hdata2<span class="sc">$</span>status,</span>
<span id="cb78-451"><a href="#cb78-451" aria-hidden="true" tabindex="-1"></a>             <span class="at">type=</span><span class="st">"km_overlay"</span>, <span class="at">ndraws=</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb78-452"><a href="#cb78-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb78-453"><a href="#cb78-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time [month]"</span>) <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>))</span>
<span id="cb78-454"><a href="#cb78-454" aria-hidden="true" tabindex="-1"></a>p_sub_fup <span class="ot">&lt;-</span> p_full_fup <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>))</span>
<span id="cb78-455"><a href="#cb78-455" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p_full_fup, p_sub_fup, <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-456"><a href="#cb78-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-457"><a href="#cb78-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-458"><a href="#cb78-458" aria-hidden="true" tabindex="-1"></a>Note that the above predictive check does not simulate the censoring</span>
<span id="cb78-459"><a href="#cb78-459" aria-hidden="true" tabindex="-1"></a>process. Thus, the censoring process is ignored and non-informative</span>
<span id="cb78-460"><a href="#cb78-460" aria-hidden="true" tabindex="-1"></a>censoring is thereby assumed.</span>
<span id="cb78-461"><a href="#cb78-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-462"><a href="#cb78-462" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trial simulation</span></span>
<span id="cb78-463"><a href="#cb78-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-464"><a href="#cb78-464" aria-hidden="true" tabindex="-1"></a>Here we consider a fake data simulation of the trial of interest</span>
<span id="cb78-465"><a href="#cb78-465" aria-hidden="true" tabindex="-1"></a>evaluating a novel treatment of gastric cancer for which an</span>
<span id="cb78-466"><a href="#cb78-466" aria-hidden="true" tabindex="-1"></a>established treatment is available already. The trial is a</span>
<span id="cb78-467"><a href="#cb78-467" aria-hidden="true" tabindex="-1"></a>randomized trial to study the efficacy and safety of adding a drug</span>
<span id="cb78-468"><a href="#cb78-468" aria-hidden="true" tabindex="-1"></a><span class="in">`CompoundX`</span> in combination with a monoclonal antibody <span class="in">`mAb`</span> + standard</span>
<span id="cb78-469"><a href="#cb78-469" aria-hidden="true" tabindex="-1"></a>of care (SoC). Two chemotherapy backbones, <span class="in">`ChemoA`</span> and <span class="in">`ChemoB`</span> were</span>
<span id="cb78-470"><a href="#cb78-470" aria-hidden="true" tabindex="-1"></a>used as SoC. There are in total four treatment arms including two</span>
<span id="cb78-471"><a href="#cb78-471" aria-hidden="true" tabindex="-1"></a>control groups, which are <span class="in">`mAb`</span>+<span class="in">`ChemoA`</span> (<span class="in">`controlChemoA`</span>) and</span>
<span id="cb78-472"><a href="#cb78-472" aria-hidden="true" tabindex="-1"></a><span class="in">`mAb`</span>+<span class="in">`ChemoB`</span> (<span class="in">`controlChemoB`</span>), and two corresponding active arms</span>
<span id="cb78-473"><a href="#cb78-473" aria-hidden="true" tabindex="-1"></a>with the test treatment administrated in addition, that is</span>
<span id="cb78-474"><a href="#cb78-474" aria-hidden="true" tabindex="-1"></a><span class="in">`CompoundX`</span>+<span class="in">`mAb`</span>+<span class="in">`ChemoA`</span> (<span class="in">`activeChemoA`</span>),</span>
<span id="cb78-475"><a href="#cb78-475" aria-hidden="true" tabindex="-1"></a><span class="in">`CompoundX`</span>+<span class="in">`mAb`</span>+<span class="in">`ChemoB`</span> (<span class="in">`activeChemoB`</span>).</span>
<span id="cb78-476"><a href="#cb78-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-477"><a href="#cb78-477" aria-hidden="true" tabindex="-1"></a>Synthetic data were generated for the randomised study. We let the</span>
<span id="cb78-478"><a href="#cb78-478" aria-hidden="true" tabindex="-1"></a>sample size of both active and control group be 100, respectively. The</span>
<span id="cb78-479"><a href="#cb78-479" aria-hidden="true" tabindex="-1"></a>sample size has been chosen to ensure adequate trial power of</span>
<span id="cb78-480"><a href="#cb78-480" aria-hidden="true" tabindex="-1"></a>80%. Efficacy was assessed using progression-free survival (PFS)</span>
<span id="cb78-481"><a href="#cb78-481" aria-hidden="true" tabindex="-1"></a>measured in units of months. For patients not experiencing a</span>
<span id="cb78-482"><a href="#cb78-482" aria-hidden="true" tabindex="-1"></a>progression event at the time of the analysis, their event time will</span>
<span id="cb78-483"><a href="#cb78-483" aria-hidden="true" tabindex="-1"></a>be right censored at the time of their last valid tumor</span>
<span id="cb78-484"><a href="#cb78-484" aria-hidden="true" tabindex="-1"></a>assessment. For patients experiencing an event, their event time will</span>
<span id="cb78-485"><a href="#cb78-485" aria-hidden="true" tabindex="-1"></a>be interval censored, with the upper limit of the interval being the</span>
<span id="cb78-486"><a href="#cb78-486" aria-hidden="true" tabindex="-1"></a>study day on which the progression event is observed, and the lower</span>
<span id="cb78-487"><a href="#cb78-487" aria-hidden="true" tabindex="-1"></a>limit being the day of the last preceding valid tumor assessment at</span>
<span id="cb78-488"><a href="#cb78-488" aria-hidden="true" tabindex="-1"></a>which the patient’s progression-free status was confirmed. While</span>
<span id="cb78-489"><a href="#cb78-489" aria-hidden="true" tabindex="-1"></a>interval censoring is a supported feature of <span class="in">`brms`</span>, this case study</span>
<span id="cb78-490"><a href="#cb78-490" aria-hidden="true" tabindex="-1"></a>will for simplicity use the actual event times and leave it to the</span>
<span id="cb78-491"><a href="#cb78-491" aria-hidden="true" tabindex="-1"></a>reader to explore interval censoring with <span class="in">`brms`</span>.</span>
<span id="cb78-492"><a href="#cb78-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-493"><a href="#cb78-493" aria-hidden="true" tabindex="-1"></a>There are two historical datasets available. The first one with 400</span>
<span id="cb78-494"><a href="#cb78-494" aria-hidden="true" tabindex="-1"></a>patients on a control arm, <span class="in">`mAb`</span>+<span class="in">`ChemoA`</span> (<span class="in">`controlChemoA`</span>), is</span>
<span id="cb78-495"><a href="#cb78-495" aria-hidden="true" tabindex="-1"></a>simulated together with the randomised study. And the PFS data of 789</span>
<span id="cb78-496"><a href="#cb78-496" aria-hidden="true" tabindex="-1"></a>patients receiving first-line programmed cell death (PD-1)</span>
<span id="cb78-497"><a href="#cb78-497" aria-hidden="true" tabindex="-1"></a>inhibitor+chemotherapy are available from a randomised, open-label,</span>
<span id="cb78-498"><a href="#cb78-498" aria-hidden="true" tabindex="-1"></a>phase 3 trial, CheckMate 649 <span class="co">[</span><span class="ot">@Janjigian2021</span><span class="co">]</span>, and it will be</span>
<span id="cb78-499"><a href="#cb78-499" aria-hidden="true" tabindex="-1"></a>introduced later. These data are highly relevant and we would like to</span>
<span id="cb78-500"><a href="#cb78-500" aria-hidden="true" tabindex="-1"></a>integrate the historical information into our analysis.</span>
<span id="cb78-501"><a href="#cb78-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-502"><a href="#cb78-502" aria-hidden="true" tabindex="-1"></a>Simulated data will be generated using <span class="in">`simsurv`</span> function via</span>
<span id="cb78-503"><a href="#cb78-503" aria-hidden="true" tabindex="-1"></a>simulating survival times from the Weibull model using the</span>
<span id="cb78-504"><a href="#cb78-504" aria-hidden="true" tabindex="-1"></a>proportional hazard form of the model. We assumed a 20% hazard rate</span>
<span id="cb78-505"><a href="#cb78-505" aria-hidden="true" tabindex="-1"></a>(HR) reduction due to active treatment administration (<span class="in">`CompoundX`</span>) to</span>
<span id="cb78-506"><a href="#cb78-506" aria-hidden="true" tabindex="-1"></a>the active group in comparison to the control group and a 5%</span>
<span id="cb78-507"><a href="#cb78-507" aria-hidden="true" tabindex="-1"></a>difference in HR for the two chemotherapy SoCs (<span class="in">`ChemoB`</span> is 5% worse</span>
<span id="cb78-508"><a href="#cb78-508" aria-hidden="true" tabindex="-1"></a>than <span class="in">`ChemoA`</span> on the hazard scale). We also assumed that both of the</span>
<span id="cb78-509"><a href="#cb78-509" aria-hidden="true" tabindex="-1"></a>historical data have a 2% worse outcome on the hazards scale and we</span>
<span id="cb78-510"><a href="#cb78-510" aria-hidden="true" tabindex="-1"></a>represent the two studies with <span class="in">`hist1`</span> and <span class="in">`hist2`</span> respectively</span>
<span id="cb78-511"><a href="#cb78-511" aria-hidden="true" tabindex="-1"></a>(<span class="in">`hist1`</span> for simulated historidal data and <span class="in">`hist2`</span> for CheckMate 649).</span>
<span id="cb78-512"><a href="#cb78-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-513"><a href="#cb78-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate_data, eval=TRUE,echo=TRUE,message=FALSE,warning=FALSE}</span></span>
<span id="cb78-514"><a href="#cb78-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb78-515"><a href="#cb78-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show the code"</span></span>
<span id="cb78-516"><a href="#cb78-516" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">46767</span>)</span>
<span id="cb78-517"><a href="#cb78-517" aria-hidden="true" tabindex="-1"></a><span class="co"># n per group</span></span>
<span id="cb78-518"><a href="#cb78-518" aria-hidden="true" tabindex="-1"></a>n_grp <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb78-519"><a href="#cb78-519" aria-hidden="true" tabindex="-1"></a>n_hist <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb78-520"><a href="#cb78-520" aria-hidden="true" tabindex="-1"></a><span class="co"># use month as time-unit</span></span>
<span id="cb78-521"><a href="#cb78-521" aria-hidden="true" tabindex="-1"></a>rate_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">6</span></span>
<span id="cb78-522"><a href="#cb78-522" aria-hidden="true" tabindex="-1"></a>rate_cens <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb78-523"><a href="#cb78-523" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">trt=</span><span class="sc">-</span><span class="fl">0.2</span>,        <span class="do">## roughly 20% HR reduction</span></span>
<span id="cb78-524"><a href="#cb78-524" aria-hidden="true" tabindex="-1"></a>          <span class="at">soc_alt=</span><span class="fl">0.05</span>,    <span class="do">## alternative chemotherapy is 5% worse</span></span>
<span id="cb78-525"><a href="#cb78-525" aria-hidden="true" tabindex="-1"></a>          <span class="at">hist1=</span><span class="fl">0.02</span>)      <span class="do">## simulated historical data has a 2% worse outcome</span></span>
<span id="cb78-526"><a href="#cb78-526" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates of simulated trial data</span></span>
<span id="cb78-527"><a href="#cb78-527" aria-hidden="true" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">2</span><span class="sc">*</span>n_grp), <span class="at">trt =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">1</span>L),</span>
<span id="cb78-528"><a href="#cb78-528" aria-hidden="true" tabindex="-1"></a>                   <span class="at">soc_alt=</span><span class="fu">rbinom</span>(<span class="dv">2</span><span class="sc">*</span>n_grp, <span class="dv">1</span>L, <span class="fl">0.3</span>), <span class="at">hist1=</span><span class="dv">0</span>L, <span class="at">hist2=</span><span class="dv">0</span>L)</span>
<span id="cb78-529"><a href="#cb78-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-530"><a href="#cb78-530" aria-hidden="true" tabindex="-1"></a><span class="co"># covariates of historical data</span></span>
<span id="cb78-531"><a href="#cb78-531" aria-hidden="true" tabindex="-1"></a>hcovs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">seq</span>(<span class="dv">2</span><span class="sc">*</span>n_grp<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">*</span>n_grp<span class="sc">+</span><span class="dv">1</span> <span class="sc">+</span>n_hist <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb78-532"><a href="#cb78-532" aria-hidden="true" tabindex="-1"></a>                    <span class="at">trt =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">soc_alt=</span><span class="dv">0</span>, <span class="at">hist1=</span><span class="dv">1</span>L, <span class="at">hist2=</span><span class="dv">0</span>L)</span>
<span id="cb78-533"><a href="#cb78-533" aria-hidden="true" tabindex="-1"></a>simulate_trial <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, gamma, lambda_cens, x, betas) {</span>
<span id="cb78-534"><a href="#cb78-534" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate censoring times, note that we do not simulate end of</span></span>
<span id="cb78-535"><a href="#cb78-535" aria-hidden="true" tabindex="-1"></a>    <span class="do">## trial with maxt for now. Also note the different parametrization of</span></span>
<span id="cb78-536"><a href="#cb78-536" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simsurv which models log(shape) with a linear predictor.</span></span>
<span id="cb78-537"><a href="#cb78-537" aria-hidden="true" tabindex="-1"></a>    cens <span class="ot">&lt;-</span> <span class="fu">simsurv</span>(<span class="at">lambdas =</span> lambda_cens, <span class="at">gammas =</span> <span class="dv">1</span>, <span class="at">x=</span>x)</span>
<span id="cb78-538"><a href="#cb78-538" aria-hidden="true" tabindex="-1"></a>    events <span class="ot">&lt;-</span> <span class="fu">simsurv</span>(<span class="at">lambdas =</span> lambda, <span class="at">gammas =</span> gamma, <span class="at">x=</span>x, <span class="at">betas=</span>betas)</span>
<span id="cb78-539"><a href="#cb78-539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(cens) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(cens), <span class="st">"_cens"</span>)</span>
<span id="cb78-540"><a href="#cb78-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(events, <span class="fu">select</span>(cens, <span class="sc">-</span>id_cens), <span class="fu">select</span>(x, <span class="sc">-</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb78-541"><a href="#cb78-541" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">censtime=</span>eventtime_cens) <span class="sc">%&gt;%</span></span>
<span id="cb78-542"><a href="#cb78-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">event=</span><span class="dv">1</span>L<span class="sc">*</span>(eventtime <span class="sc">&lt;=</span> censtime),</span>
<span id="cb78-543"><a href="#cb78-543" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="fu">if_else</span>(event<span class="sc">==</span><span class="dv">1</span>, eventtime, censtime),</span>
<span id="cb78-544"><a href="#cb78-544" aria-hidden="true" tabindex="-1"></a>           <span class="at">status=</span><span class="cn">NULL</span>, <span class="at">status_cens=</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-545"><a href="#cb78-545" aria-hidden="true" tabindex="-1"></a>        <span class="fu">relocate</span>(id, y, event) <span class="sc">%&gt;%</span></span>
<span id="cb78-546"><a href="#cb78-546" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">soc=</span><span class="fu">factor</span>(soc_alt, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="st">"ChemoA"</span>, <span class="st">"ChemoB"</span>)),</span>
<span id="cb78-547"><a href="#cb78-547" aria-hidden="true" tabindex="-1"></a>               <span class="at">trt_ind=</span>trt,</span>
<span id="cb78-548"><a href="#cb78-548" aria-hidden="true" tabindex="-1"></a>               <span class="at">trt=</span><span class="fu">factor</span>(trt_ind, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"active"</span>)),</span>
<span id="cb78-549"><a href="#cb78-549" aria-hidden="true" tabindex="-1"></a>               <span class="at">arm=</span><span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"active"</span>)[trt_ind <span class="sc">+</span> <span class="dv">1</span>], soc),</span>
<span id="cb78-550"><a href="#cb78-550" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"activeChemoA"</span>, <span class="st">"controlChemoA"</span>,</span>
<span id="cb78-551"><a href="#cb78-551" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"activeChemoB"</span>, <span class="st">"controlChemoB"</span>)))</span>
<span id="cb78-552"><a href="#cb78-552" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-553"><a href="#cb78-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-554"><a href="#cb78-554" aria-hidden="true" tabindex="-1"></a><span class="co"># using shape=1 for simulation (corresponding to exponential survival times)</span></span>
<span id="cb78-555"><a href="#cb78-555" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">simulate_trial</span>(rate_1, <span class="dv">1</span>, rate_cens, covs, beta)</span>
<span id="cb78-556"><a href="#cb78-556" aria-hidden="true" tabindex="-1"></a>hdata1 <span class="ot">&lt;-</span> <span class="fu">simulate_trial</span>(rate_1, <span class="dv">1</span>, rate_cens, hcovs, beta) <span class="sc">%&gt;%</span></span>
<span id="cb78-557"><a href="#cb78-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id=</span>id<span class="sc">+</span><span class="fu">max</span>(sim<span class="sc">$</span>id))</span>
<span id="cb78-558"><a href="#cb78-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-559"><a href="#cb78-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-560"><a href="#cb78-560" aria-hidden="true" tabindex="-1"></a>We can check how the simulated data looks like and its sample size.</span>
<span id="cb78-561"><a href="#cb78-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-564"><a href="#cb78-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-565"><a href="#cb78-565" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_preview</span>(sim) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">where</span>(is.double), <span class="at">decimals=</span><span class="dv">1</span>)</span>
<span id="cb78-566"><a href="#cb78-566" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sim<span class="sc">$</span>arm)</span>
<span id="cb78-567"><a href="#cb78-567" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(hdata1<span class="sc">$</span>arm)</span>
<span id="cb78-568"><a href="#cb78-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-569"><a href="#cb78-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-570"><a href="#cb78-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-571"><a href="#cb78-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-572"><a href="#cb78-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-573"><a href="#cb78-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Models</span></span>
<span id="cb78-574"><a href="#cb78-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-575"><a href="#cb78-575" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model specification</span></span>
<span id="cb78-576"><a href="#cb78-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-577"><a href="#cb78-577" aria-hidden="true" tabindex="-1"></a>Survival data will be fitted by a Bayesian generalized linear model.</span>
<span id="cb78-578"><a href="#cb78-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-579"><a href="#cb78-579" aria-hidden="true" tabindex="-1"></a>The survival function follows a Weibull distribution with shape</span>
<span id="cb78-580"><a href="#cb78-580" aria-hidden="true" tabindex="-1"></a>parameter $\alpha$ and scale parameter $s$,</span>
<span id="cb78-581"><a href="#cb78-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-582"><a href="#cb78-582" aria-hidden="true" tabindex="-1"></a>$$T|\alpha,s \sim f_{\mbox{Weibull}}(T).$$</span>
<span id="cb78-583"><a href="#cb78-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-584"><a href="#cb78-584" aria-hidden="true" tabindex="-1"></a>A common shape parameter $\alpha$ is assumed for all treatment arms,</span>
<span id="cb78-585"><a href="#cb78-585" aria-hidden="true" tabindex="-1"></a>with the scale parameter allowed to vary by treatment arm. In place of</span>
<span id="cb78-586"><a href="#cb78-586" aria-hidden="true" tabindex="-1"></a>directly modeling the scale parameter $s$, the mean of the Weibull</span>
<span id="cb78-587"><a href="#cb78-587" aria-hidden="true" tabindex="-1"></a>distribution is modelled on the logarithmic scale such that the scale</span>
<span id="cb78-588"><a href="#cb78-588" aria-hidden="true" tabindex="-1"></a>is set to $s = \frac{\mu}{\Gamma(1 + \frac{1}{\alpha})}$ and</span>
<span id="cb78-589"><a href="#cb78-589" aria-hidden="true" tabindex="-1"></a>$\log(\mu)$ is modelled as a linear function of the covariates.  We</span>
<span id="cb78-590"><a href="#cb78-590" aria-hidden="true" tabindex="-1"></a>use $\lambda_{\mbox{activeChemoA}}$ to represent the logarithm of the</span>
<span id="cb78-591"><a href="#cb78-591" aria-hidden="true" tabindex="-1"></a>mean survival time for patients receiving <span class="in">`CompoundX`</span>+<span class="in">`mAb`</span>+<span class="in">`ChemoA`</span></span>
<span id="cb78-592"><a href="#cb78-592" aria-hidden="true" tabindex="-1"></a>($\lambda_{\mbox{activeChemoA}} = \log(\mu_{\mbox{activeChemoA}})$),</span>
<span id="cb78-593"><a href="#cb78-593" aria-hidden="true" tabindex="-1"></a>and $\lambda_{\mbox{controlChemoA}}$ for patients receiving</span>
<span id="cb78-594"><a href="#cb78-594" aria-hidden="true" tabindex="-1"></a><span class="in">`mAb`</span>+<span class="in">`ChemoA`</span>.  We define $\lambda_{\mbox{activeChemoB}}$ and</span>
<span id="cb78-595"><a href="#cb78-595" aria-hidden="true" tabindex="-1"></a>$\lambda_{\mbox{controlChemoB}}$ similarly for patients receiving the</span>
<span id="cb78-596"><a href="#cb78-596" aria-hidden="true" tabindex="-1"></a><span class="in">`ChemoB`</span> chemotherapy backbone.</span>
<span id="cb78-597"><a href="#cb78-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-598"><a href="#cb78-598" aria-hidden="true" tabindex="-1"></a>With 4 different patient groups we may define 4 parameters in</span>
<span id="cb78-599"><a href="#cb78-599" aria-hidden="true" tabindex="-1"></a>total. The default parametrization in <span class="in">`R`</span> for categorical variables is</span>
<span id="cb78-600"><a href="#cb78-600" aria-hidden="true" tabindex="-1"></a>the treatment contrast representation. This representation delcares a</span>
<span id="cb78-601"><a href="#cb78-601" aria-hidden="true" tabindex="-1"></a>reference category to form the overall intercept and defines</span>
<span id="cb78-602"><a href="#cb78-602" aria-hidden="true" tabindex="-1"></a>differences to the overall intercept for each categorical level. As</span>
<span id="cb78-603"><a href="#cb78-603" aria-hidden="true" tabindex="-1"></a>this does automatically define the parametrization of the model, we</span>
<span id="cb78-604"><a href="#cb78-604" aria-hidden="true" tabindex="-1"></a>here define the contrasts in a customized manner. Doing so ensures</span>
<span id="cb78-605"><a href="#cb78-605" aria-hidden="true" tabindex="-1"></a>that we control directly the exact parametrization of the model. This</span>
<span id="cb78-606"><a href="#cb78-606" aria-hidden="true" tabindex="-1"></a>is important in this problem as we can then setup priors in a tailored</span>
<span id="cb78-607"><a href="#cb78-607" aria-hidden="true" tabindex="-1"></a>manner. More details in defining custom contrasts are explained by Ben</span>
<span id="cb78-608"><a href="#cb78-608" aria-hidden="true" tabindex="-1"></a>Bolker</span>
<span id="cb78-609"><a href="#cb78-609" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">here</span><span class="co">](https://bbolker.github.io/mixedmodels-misc/notes/contrasts.pdf)</span>.</span>
<span id="cb78-610"><a href="#cb78-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-611"><a href="#cb78-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-612"><a href="#cb78-612" aria-hidden="true" tabindex="-1"></a>In addition to the overall mean (global intercept)</span>
<span id="cb78-613"><a href="#cb78-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-614"><a href="#cb78-614" aria-hidden="true" tabindex="-1"></a>$$\gamma = \frac{1}{4}( \lambda_{\mbox{activeChemoA}} +</span>
<span id="cb78-615"><a href="#cb78-615" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{controlChemoA}} + \lambda_{\mbox{activeChemoB}} +</span>
<span id="cb78-616"><a href="#cb78-616" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{controlChemoB}} ), $$</span>
<span id="cb78-617"><a href="#cb78-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-618"><a href="#cb78-618" aria-hidden="true" tabindex="-1"></a>we define for the four groups the following contrasts of interest:</span>
<span id="cb78-619"><a href="#cb78-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-620"><a href="#cb78-620" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Average difference between the active and control</span>
<span id="cb78-621"><a href="#cb78-621" aria-hidden="true" tabindex="-1"></a>arms in each chemotherapy backbone: </span>
<span id="cb78-622"><a href="#cb78-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-623"><a href="#cb78-623" aria-hidden="true" tabindex="-1"></a>$$\delta_{\mbox{EffectAvg}} = \frac{1}{2} {</span>
<span id="cb78-624"><a href="#cb78-624" aria-hidden="true" tabindex="-1"></a>(\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) + (</span>
<span id="cb78-625"><a href="#cb78-625" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}} ) } $$</span>
<span id="cb78-626"><a href="#cb78-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-627"><a href="#cb78-627" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Half of the difference in treatment effect between the two chemotherapy</span>
<span id="cb78-628"><a href="#cb78-628" aria-hidden="true" tabindex="-1"></a>backbones:</span>
<span id="cb78-629"><a href="#cb78-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-630"><a href="#cb78-630" aria-hidden="true" tabindex="-1"></a>$$\delta_{\mbox{effect}} = \frac{1}{2} { (\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) - ( \lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}}) }$$</span>
<span id="cb78-631"><a href="#cb78-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-632"><a href="#cb78-632" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Difference between the two control arms:</span>
<span id="cb78-633"><a href="#cb78-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-634"><a href="#cb78-634" aria-hidden="true" tabindex="-1"></a>$$\delta_{\mbox{control}} = - \lambda_{\mbox{controlChemoA}}  +</span>
<span id="cb78-635"><a href="#cb78-635" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{controlChemoB}} $$</span>
<span id="cb78-636"><a href="#cb78-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-637"><a href="#cb78-637" aria-hidden="true" tabindex="-1"></a>To formalize these contrast definitions, we summarize the arms to</span>
<span id="cb78-638"><a href="#cb78-638" aria-hidden="true" tabindex="-1"></a>parameter mapping as matrix:</span>
<span id="cb78-639"><a href="#cb78-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-640"><a href="#cb78-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tb_model1, echo = FALSE}</span></span>
<span id="cb78-641"><a href="#cb78-641" aria-hidden="true" tabindex="-1"></a>tb1 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Parameter=</span> <span class="fu">c</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">gamma$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{EffectAvg}}$"</span>,</span>
<span id="cb78-642"><a href="#cb78-642" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{effect}}$$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{control}}$"</span>),</span>
<span id="cb78-643"><a href="#cb78-643" aria-hidden="true" tabindex="-1"></a>                 <span class="at">activeChemoA =</span> <span class="fu">c</span>(<span class="st">"1/4"</span>, <span class="st">"1/2"</span>, <span class="st">"1/2"</span>, <span class="st">"0"</span>),</span>
<span id="cb78-644"><a href="#cb78-644" aria-hidden="true" tabindex="-1"></a>                 <span class="at">controlChemoA =</span> <span class="fu">c</span>(<span class="st">"1/4"</span>, <span class="st">"-1/2"</span>, <span class="st">"-1/2"</span>, <span class="st">"-1"</span>),</span>
<span id="cb78-645"><a href="#cb78-645" aria-hidden="true" tabindex="-1"></a>                 <span class="at">activeChemoB =</span> <span class="fu">c</span>(<span class="st">"1/4"</span>, <span class="st">"1/2"</span>, <span class="st">"-1/2"</span>, <span class="st">"0"</span>),</span>
<span id="cb78-646"><a href="#cb78-646" aria-hidden="true" tabindex="-1"></a>                 <span class="at">controlChemoB =</span> <span class="fu">c</span>(<span class="st">"1/4"</span>, <span class="st">"-1/2"</span>, <span class="st">"1/2"</span>, <span class="st">"1"</span>))</span>
<span id="cb78-647"><a href="#cb78-647" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tb1)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">lambda_{</span><span class="sc">\\</span><span class="st">mbox{"</span>, <span class="fu">colnames</span>(tb1)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="st">"}}$"</span>)</span>
<span id="cb78-648"><a href="#cb78-648" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(tb1) <span class="sc">%&gt;%</span> <span class="fu">fmt_markdown</span>(<span class="fu">everything</span>())</span>
<span id="cb78-649"><a href="#cb78-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-650"><a href="#cb78-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-651"><a href="#cb78-651" aria-hidden="true" tabindex="-1"></a>In this form it is straightforward to derive the definition of a</span>
<span id="cb78-652"><a href="#cb78-652" aria-hidden="true" tabindex="-1"></a>parameter and how it relates to the strata of the data based on the</span>
<span id="cb78-653"><a href="#cb78-653" aria-hidden="true" tabindex="-1"></a>parameter definitions. However, in order to define the design matrix,</span>
<span id="cb78-654"><a href="#cb78-654" aria-hidden="true" tabindex="-1"></a>which maps parameters to data strata, we will need the inverse of the</span>
<span id="cb78-655"><a href="#cb78-655" aria-hidden="true" tabindex="-1"></a>above matrix. By convention <span class="in">`R`</span> requires for the specification of</span>
<span id="cb78-656"><a href="#cb78-656" aria-hidden="true" tabindex="-1"></a>custom contrats, the matrix mapping parameters to the data means such</span>
<span id="cb78-657"><a href="#cb78-657" aria-hidden="true" tabindex="-1"></a>that the above matrix is referred to as $C^{-1}$ in the following.</span>
<span id="cb78-658"><a href="#cb78-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-659"><a href="#cb78-659" aria-hidden="true" tabindex="-1"></a>The linear model for $\log(\mu)$ is parameterised in terms of the</span>
<span id="cb78-660"><a href="#cb78-660" aria-hidden="true" tabindex="-1"></a>defined contrasts with additional parameters allowing for</span>
<span id="cb78-661"><a href="#cb78-661" aria-hidden="true" tabindex="-1"></a>heterogeneity between data from the two separate historical data</span>
<span id="cb78-662"><a href="#cb78-662" aria-hidden="true" tabindex="-1"></a>strata. For the 4 different treatment arms the linear predictor is</span>
<span id="cb78-663"><a href="#cb78-663" aria-hidden="true" tabindex="-1"></a>then given by:</span>
<span id="cb78-664"><a href="#cb78-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-665"><a href="#cb78-665" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb78-666"><a href="#cb78-666" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb78-667"><a href="#cb78-667" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{activeChemoA}} <span class="sc">\\</span></span>
<span id="cb78-668"><a href="#cb78-668" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{controlChemoA}} <span class="sc">\\</span></span>
<span id="cb78-669"><a href="#cb78-669" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{activeChemoB}} <span class="sc">\\</span></span>
<span id="cb78-670"><a href="#cb78-670" aria-hidden="true" tabindex="-1"></a>\lambda_{\mbox{controlChemoB}}</span>
<span id="cb78-671"><a href="#cb78-671" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb78-672"><a href="#cb78-672" aria-hidden="true" tabindex="-1"></a>&amp;= C \,</span>
<span id="cb78-673"><a href="#cb78-673" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb78-674"><a href="#cb78-674" aria-hidden="true" tabindex="-1"></a>    \gamma <span class="sc">\\</span></span>
<span id="cb78-675"><a href="#cb78-675" aria-hidden="true" tabindex="-1"></a>    \delta_{\mbox{EffectAvg}} <span class="sc">\\</span></span>
<span id="cb78-676"><a href="#cb78-676" aria-hidden="true" tabindex="-1"></a>    \delta_{\mbox{effect}} <span class="sc">\\</span></span>
<span id="cb78-677"><a href="#cb78-677" aria-hidden="true" tabindex="-1"></a>    \delta_{\mbox{control}}</span>
<span id="cb78-678"><a href="#cb78-678" aria-hidden="true" tabindex="-1"></a>        \end{bmatrix}</span>
<span id="cb78-679"><a href="#cb78-679" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>I_{\mbox{hist1}} \,</span>
<span id="cb78-680"><a href="#cb78-680" aria-hidden="true" tabindex="-1"></a>\beta_{\mbox{hist1}} + I_{\mbox{hist2}} \, \beta_{\mbox{hist2}}</span>
<span id="cb78-681"><a href="#cb78-681" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb78-682"><a href="#cb78-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-683"><a href="#cb78-683" aria-hidden="true" tabindex="-1"></a>The indicators $I_{\mbox{hist1}}$ and $I_{\mbox{hist2}}$ represent that a patient was in</span>
<span id="cb78-684"><a href="#cb78-684" aria-hidden="true" tabindex="-1"></a>the simulated historical stratum, or in the historical CheckMate 649</span>
<span id="cb78-685"><a href="#cb78-685" aria-hidden="true" tabindex="-1"></a>stratum, respectively. The corresponding parameters $\beta_{\mbox{hist1}}$ and</span>
<span id="cb78-686"><a href="#cb78-686" aria-hidden="true" tabindex="-1"></a>$\beta_{\mbox{hist2}}$ capture differences in outcome between these two historical</span>
<span id="cb78-687"><a href="#cb78-687" aria-hidden="true" tabindex="-1"></a>strata, and patients in our randomised comparison. In order to borrow</span>
<span id="cb78-688"><a href="#cb78-688" aria-hidden="true" tabindex="-1"></a>strength from the historical data, the prior on these two regression</span>
<span id="cb78-689"><a href="#cb78-689" aria-hidden="true" tabindex="-1"></a>coefficients are set reasonably narrow which in effect emulates a</span>
<span id="cb78-690"><a href="#cb78-690" aria-hidden="true" tabindex="-1"></a>random effects meta-analysis.</span>
<span id="cb78-691"><a href="#cb78-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-692"><a href="#cb78-692" aria-hidden="true" tabindex="-1"></a>As the historical data set reported in CheckMate 649 reported the</span>
<span id="cb78-693"><a href="#cb78-693" aria-hidden="true" tabindex="-1"></a>outcome for the control treatment with a mixed population of 50% being</span>
<span id="cb78-694"><a href="#cb78-694" aria-hidden="true" tabindex="-1"></a>on either SoC, we consider this data to report an average SoC</span>
<span id="cb78-695"><a href="#cb78-695" aria-hidden="true" tabindex="-1"></a>effect. Basic algebra shows that</span>
<span id="cb78-696"><a href="#cb78-696" aria-hidden="true" tabindex="-1"></a>$$\frac{1}{2} \,</span>
<span id="cb78-697"><a href="#cb78-697" aria-hidden="true" tabindex="-1"></a>(\lambda_{\mbox{activeChemoA}} + \lambda_{\mbox{activeChemoB}}) = \gamma -</span>
<span id="cb78-698"><a href="#cb78-698" aria-hidden="true" tabindex="-1"></a>\frac{1}{2} \, \delta_{\mbox{effect}}. $$</span>
<span id="cb78-699"><a href="#cb78-699" aria-hidden="true" tabindex="-1"></a>Thus, we may simply add an additional row to the matrix $C$ such that</span>
<span id="cb78-700"><a href="#cb78-700" aria-hidden="true" tabindex="-1"></a>the full matrix $C$ is:</span>
<span id="cb78-701"><a href="#cb78-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-702"><a href="#cb78-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tb_model, echo = FALSE}</span></span>
<span id="cb78-703"><a href="#cb78-703" aria-hidden="true" tabindex="-1"></a>tb2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">TreatmentArm =</span> <span class="fu">c</span>(<span class="st">"activeChemoA"</span>, <span class="st">"controlChemoA"</span>,</span>
<span id="cb78-704"><a href="#cb78-704" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"activeChemoB"</span>, <span class="st">"controlChemoB"</span>,</span>
<span id="cb78-705"><a href="#cb78-705" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"controlAverage"</span>),</span>
<span id="cb78-706"><a href="#cb78-706" aria-hidden="true" tabindex="-1"></a>                  <span class="at">intercept =</span> <span class="st">"1"</span>,</span>
<span id="cb78-707"><a href="#cb78-707" aria-hidden="true" tabindex="-1"></a>                 <span class="at">effectAvg =</span> <span class="fu">c</span>(<span class="st">"1/2"</span>, <span class="st">"-1/2"</span>, <span class="st">"1/2"</span>, <span class="st">"-1/2"</span>, <span class="st">"-1/2"</span>),</span>
<span id="cb78-708"><a href="#cb78-708" aria-hidden="true" tabindex="-1"></a>                 <span class="at">effect =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"0"</span>, <span class="st">"-1"</span>, <span class="st">"0"</span>, <span class="st">"0"</span>),</span>
<span id="cb78-709"><a href="#cb78-709" aria-hidden="true" tabindex="-1"></a>                 <span class="at">control =</span> <span class="fu">c</span>(<span class="st">"-1/2"</span>, <span class="st">"-1/2"</span>, <span class="st">"1/2"</span>, <span class="st">"1/2"</span>, <span class="st">"0"</span>))</span>
<span id="cb78-710"><a href="#cb78-710" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tb2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Treatment arm"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">gamma$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{EffectAvg}}$"</span>,</span>
<span id="cb78-711"><a href="#cb78-711" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{effect}}$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{control}}$"</span>)</span>
<span id="cb78-712"><a href="#cb78-712" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(tb2) <span class="sc">%&gt;%</span> <span class="fu">fmt_markdown</span>(<span class="fu">everything</span>())</span>
<span id="cb78-713"><a href="#cb78-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-714"><a href="#cb78-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-715"><a href="#cb78-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-716"><a href="#cb78-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-717"><a href="#cb78-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### Priors {#tte-model-prior}</span></span>
<span id="cb78-718"><a href="#cb78-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-719"><a href="#cb78-719" aria-hidden="true" tabindex="-1"></a>Priors for each random variable are described in the following table. </span>
<span id="cb78-720"><a href="#cb78-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-721"><a href="#cb78-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prior, echo = FALSE}</span></span>
<span id="cb78-722"><a href="#cb78-722" aria-hidden="true" tabindex="-1"></a>tb2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Parameter =</span> <span class="fu">c</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">alpha$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">gamma$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{effectAvg}}$"</span>,</span>
<span id="cb78-723"><a href="#cb78-723" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{effect}}$"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">delta_{</span><span class="sc">\\</span><span class="st">mbox{control}}$"</span>,</span>
<span id="cb78-724"><a href="#cb78-724" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"$</span><span class="sc">\\</span><span class="st">beta_{</span><span class="sc">\\</span><span class="st">mbox{hist1}}$"</span>,<span class="st">"$</span><span class="sc">\\</span><span class="st">beta_{</span><span class="sc">\\</span><span class="st">mbox{hist2}}$"</span>),</span>
<span id="cb78-725"><a href="#cb78-725" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Prior =</span> <span class="fu">c</span>(<span class="st">"$</span><span class="sc">\\</span><span class="st">Gamma(3, 2.7)$"</span>,</span>
<span id="cb78-726"><a href="#cb78-726" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}( </span><span class="sc">\\</span><span class="st">log(</span><span class="sc">\\</span><span class="st">frac{8}{</span><span class="sc">\\</span><span class="st">log(2)}), </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(4)}{1.64})$"</span>,</span>
<span id="cb78-727"><a href="#cb78-727" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}(0, </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(2)}{1.64})$"</span>,</span>
<span id="cb78-728"><a href="#cb78-728" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}(0, </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(1.25)}{1.64})$"</span>,</span>
<span id="cb78-729"><a href="#cb78-729" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}(0, </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(1.25)}{1.64})$"</span>,</span>
<span id="cb78-730"><a href="#cb78-730" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}(0, </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(1.8)}{1.64})$"</span>,</span>
<span id="cb78-731"><a href="#cb78-731" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"$</span><span class="sc">\\</span><span class="st">mbox{Normal}(0, </span><span class="sc">\\</span><span class="st">frac{</span><span class="sc">\\</span><span class="st">log(1.8)}{1.64})$"</span>))</span>
<span id="cb78-732"><a href="#cb78-732" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(tb2) <span class="sc">%&gt;%</span> <span class="fu">fmt_markdown</span>(<span class="fu">everything</span>())</span>
<span id="cb78-733"><a href="#cb78-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-734"><a href="#cb78-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-735"><a href="#cb78-735" aria-hidden="true" tabindex="-1"></a>These priors parametrize the central 90% credible interval for the</span>
<span id="cb78-736"><a href="#cb78-736" aria-hidden="true" tabindex="-1"></a>respective normal priors used. As the parameters are additive on the</span>
<span id="cb78-737"><a href="#cb78-737" aria-hidden="true" tabindex="-1"></a>$\log$ scale, the standard deviation of $\log(2)/\Phi^{-1}(95\%)</span>
<span id="cb78-738"><a href="#cb78-738" aria-hidden="true" tabindex="-1"></a>\approx \log(2)/1.64$ defines a 90%</span>
<span id="cb78-739"><a href="#cb78-739" aria-hidden="true" tabindex="-1"></a>credible interval of $<span class="co">[</span><span class="ot">-\log(2), \log(2)</span><span class="co">]</span>$ and implies on the</span>
<span id="cb78-740"><a href="#cb78-740" aria-hidden="true" tabindex="-1"></a>back-transformed scale a respective interval of $<span class="co">[</span><span class="ot">1/2, 2</span><span class="co">]</span>$, i.e. a</span>
<span id="cb78-741"><a href="#cb78-741" aria-hidden="true" tabindex="-1"></a>doubling or a halving of the progression speed.</span>
<span id="cb78-742"><a href="#cb78-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-743"><a href="#cb78-743" aria-hidden="true" tabindex="-1"></a>The common shape parameter, $\alpha$, is set to have median value of</span>
<span id="cb78-744"><a href="#cb78-744" aria-hidden="true" tabindex="-1"></a>unity and it's 90% credible interval is $<span class="co">[</span><span class="ot">0.3, 2.33</span><span class="co">]</span>$, which admits</span>
<span id="cb78-745"><a href="#cb78-745" aria-hidden="true" tabindex="-1"></a>substantial deviation from unity, which is the case of exponential</span>
<span id="cb78-746"><a href="#cb78-746" aria-hidden="true" tabindex="-1"></a>survival time distribution.</span>
<span id="cb78-747"><a href="#cb78-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-748"><a href="#cb78-748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prior_dist, echo=FALSE, eval=FALSE, fig.cap="Prior distribution of shape parameter k (inset) with an illustration of the corresponding range of survival curves for a fixed value of $\\lambda$.", out.width = '40%', fig.align = 'center'}</span></span>
<span id="cb78-749"><a href="#cb78-749" aria-hidden="true" tabindex="-1"></a><span class="co"># FIGURES TO BE REPLOTTED</span></span>
<span id="cb78-750"><a href="#cb78-750" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::include_graphics(here::here("src/fig_prior.png"))</span></span>
<span id="cb78-751"><a href="#cb78-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-752"><a href="#cb78-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-753"><a href="#cb78-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-754"><a href="#cb78-754" aria-hidden="true" tabindex="-1"></a>The prior for $\gamma$, the intercept, is set with a mean</span>
<span id="cb78-755"><a href="#cb78-755" aria-hidden="true" tabindex="-1"></a>approximately corresponding to expected median PFS on anti-PD-1 with</span>
<span id="cb78-756"><a href="#cb78-756" aria-hidden="true" tabindex="-1"></a>SoC, as estimated from CheckMate 649 (approx. 8 months). The width of</span>
<span id="cb78-757"><a href="#cb78-757" aria-hidden="true" tabindex="-1"></a>the central 90% credible interval for the intercept prior $\gamma$ is</span>
<span id="cb78-758"><a href="#cb78-758" aria-hidden="true" tabindex="-1"></a>set to admit for a 4 fold increase or decrease.  A priori it is</span>
<span id="cb78-759"><a href="#cb78-759" aria-hidden="true" tabindex="-1"></a>expected that the outcome for <span class="in">`controlChemoA`</span>and <span class="in">`controlChemoB`</span> will</span>
<span id="cb78-760"><a href="#cb78-760" aria-hidden="true" tabindex="-1"></a>be similar (Janjijian et al, mPFS by chemotherapy not provided, but</span>
<span id="cb78-761"><a href="#cb78-761" aria-hidden="true" tabindex="-1"></a>mOS was 14 months for both anti-PD1+Chemotherapy backbones (considered</span>
<span id="cb78-762"><a href="#cb78-762" aria-hidden="true" tabindex="-1"></a>as similar to <span class="in">`mAb`</span>+<span class="in">`ChemoA`</span> and<span class="in">`mAb`</span>+<span class="in">`ChemoB`</span> in our simulated data),</span>
<span id="cb78-763"><a href="#cb78-763" aria-hidden="true" tabindex="-1"></a>hence a prior for $\delta_{\mbox{control}}$ is centered on 0 with a</span>
<span id="cb78-764"><a href="#cb78-764" aria-hidden="true" tabindex="-1"></a>standard deviation corresponding to a 25% increase or decrease is</span>
<span id="cb78-765"><a href="#cb78-765" aria-hidden="true" tabindex="-1"></a>chosen for the 90% credible interval.  Similarly, the treatment</span>
<span id="cb78-766"><a href="#cb78-766" aria-hidden="true" tabindex="-1"></a>benefit from adding <span class="in">`CompoundX`</span> is expected to be similar for both</span>
<span id="cb78-767"><a href="#cb78-767" aria-hidden="true" tabindex="-1"></a>arms, so the prior for $\delta_{\mbox{effect}}$ is again centered on 0</span>
<span id="cb78-768"><a href="#cb78-768" aria-hidden="true" tabindex="-1"></a>with the prior admitting a 25% increase or decrease a priori in terms</span>
<span id="cb78-769"><a href="#cb78-769" aria-hidden="true" tabindex="-1"></a>of the 90% central credible interval.  Priors for $\beta_{\mbox{hist1}}$</span>
<span id="cb78-770"><a href="#cb78-770" aria-hidden="true" tabindex="-1"></a>and $\beta_{\mbox{hist2}}$ are centered at a mean of 0, corresponding to</span>
<span id="cb78-771"><a href="#cb78-771" aria-hidden="true" tabindex="-1"></a>no difference in outcome for the two historical studies as compared to</span>
<span id="cb78-772"><a href="#cb78-772" aria-hidden="true" tabindex="-1"></a>this trial’s randomised part, but with the same variance allowing</span>
<span id="cb78-773"><a href="#cb78-773" aria-hidden="true" tabindex="-1"></a>substantial differences between the randomised study and historical</span>
<span id="cb78-774"><a href="#cb78-774" aria-hidden="true" tabindex="-1"></a>data. The use of Student-t priors for these parameters also</span>
<span id="cb78-775"><a href="#cb78-775" aria-hidden="true" tabindex="-1"></a>robustifies against possible data discordance between the randomised</span>
<span id="cb78-776"><a href="#cb78-776" aria-hidden="true" tabindex="-1"></a>comparison and historical data.</span>
<span id="cb78-777"><a href="#cb78-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-778"><a href="#cb78-778" aria-hidden="true" tabindex="-1"></a>These prior definitions provide an uninformative prior, that allows</span>
<span id="cb78-779"><a href="#cb78-779" aria-hidden="true" tabindex="-1"></a>for a broad range of shapes for the survival curve.</span>
<span id="cb78-780"><a href="#cb78-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-781"><a href="#cb78-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-782"><a href="#cb78-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prior_2, echo=FALSE, eval = FALSE, fig.cap="Left: 100  random samples from the prior for PFS for the $activeChemoA$ treatment group, illustrating the wide range of survival curves that can be described by the model \\n Right: Pointwise (by time) prior credible intervals and median for the $activeChemoA$ treatment group, 95%, 90%, and 80% credible intervals are shown.", out.width = '80%', fig.align = 'center'}</span></span>
<span id="cb78-783"><a href="#cb78-783" aria-hidden="true" tabindex="-1"></a><span class="co">#knitr::include_graphics(here::here("src/fig_prior_2.png"))</span></span>
<span id="cb78-784"><a href="#cb78-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-785"><a href="#cb78-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-786"><a href="#cb78-786" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementation/Results</span></span>
<span id="cb78-787"><a href="#cb78-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-788"><a href="#cb78-788" aria-hidden="true" tabindex="-1"></a><span class="fu">### Construct customized coded contrasts</span></span>
<span id="cb78-789"><a href="#cb78-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-790"><a href="#cb78-790" aria-hidden="true" tabindex="-1"></a>First we define customized contrasts which define the parametrization</span>
<span id="cb78-791"><a href="#cb78-791" aria-hidden="true" tabindex="-1"></a>of the model as defined in the *Model sepcification* section.</span>
<span id="cb78-792"><a href="#cb78-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-793"><a href="#cb78-793" aria-hidden="true" tabindex="-1"></a>The mapping of data strata to parameters is:</span>
<span id="cb78-794"><a href="#cb78-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-795"><a href="#cb78-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r contrast}</span></span>
<span id="cb78-796"><a href="#cb78-796" aria-hidden="true" tabindex="-1"></a>cc_inv <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb78-797"><a href="#cb78-797" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb78-798"><a href="#cb78-798" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,  <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb78-799"><a href="#cb78-799" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">0</span>,   <span class="sc">-</span><span class="dv">1</span>,    <span class="dv">0</span>,    <span class="dv">1</span>),</span>
<span id="cb78-800"><a href="#cb78-800" aria-hidden="true" tabindex="-1"></a><span class="at">nrow=</span><span class="dv">4</span>, <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>,</span>
<span id="cb78-801"><a href="#cb78-801" aria-hidden="true" tabindex="-1"></a><span class="at">dimnames=</span><span class="fu">list</span>(<span class="at">contrast=</span><span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"deltaEffectAvg"</span>,</span>
<span id="cb78-802"><a href="#cb78-802" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"deltaEffect"</span>, <span class="st">"deltaControl"</span>),</span>
<span id="cb78-803"><a href="#cb78-803" aria-hidden="true" tabindex="-1"></a>              <span class="at">arm=</span><span class="fu">c</span>(<span class="st">"activeChemoA"</span>, <span class="st">"controlChemoA"</span>,</span>
<span id="cb78-804"><a href="#cb78-804" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"activeChemoB"</span>, <span class="st">"controlChemoB"</span>)))</span>
<span id="cb78-805"><a href="#cb78-805" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(cc_inv)</span>
<span id="cb78-806"><a href="#cb78-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-807"><a href="#cb78-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-808"><a href="#cb78-808" aria-hidden="true" tabindex="-1"></a><span class="in">`intercept`</span> ($\gamma$) is the overall mean while <span class="in">`deltaControl`</span></span>
<span id="cb78-809"><a href="#cb78-809" aria-hidden="true" tabindex="-1"></a>($\delta_{\mbox{control}}$) is the difference between the two control</span>
<span id="cb78-810"><a href="#cb78-810" aria-hidden="true" tabindex="-1"></a>arms.</span>
<span id="cb78-811"><a href="#cb78-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-812"><a href="#cb78-812" aria-hidden="true" tabindex="-1"></a>By way of defining <span class="in">`deltaEffectAvg`</span> ($\delta_{\mbox{EffectAvg}}$) we</span>
<span id="cb78-813"><a href="#cb78-813" aria-hidden="true" tabindex="-1"></a>obtain the average treatment effect. Setting <span class="in">`deltaEffect`</span></span>
<span id="cb78-814"><a href="#cb78-814" aria-hidden="true" tabindex="-1"></a>($\delta_{\mbox{effect}}$) to half of the difference between the two</span>
<span id="cb78-815"><a href="#cb78-815" aria-hidden="true" tabindex="-1"></a>treatment effects one arrives at the following symmetric relations to</span>
<span id="cb78-816"><a href="#cb78-816" aria-hidden="true" tabindex="-1"></a>obtain the chemo therapy specific treatment effect:</span>
<span id="cb78-817"><a href="#cb78-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-818"><a href="#cb78-818" aria-hidden="true" tabindex="-1"></a>$$\delta_{\mbox{EffectAvg}} = \frac{1}{2} \, [</span>
<span id="cb78-819"><a href="#cb78-819" aria-hidden="true" tabindex="-1"></a>(\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) +</span>
<span id="cb78-820"><a href="#cb78-820" aria-hidden="true" tabindex="-1"></a>(\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}})]$$</span>
<span id="cb78-821"><a href="#cb78-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-822"><a href="#cb78-822" aria-hidden="true" tabindex="-1"></a>$$\delta_{\mbox{effect}} = \frac{1}{2} \, <span class="co">[</span><span class="ot"> (\lambda_{\mbox{activeChemoA}} - \lambda_{\mbox{controlChemoA}}) - (\lambda_{\mbox{activeChemoB}} - \lambda_{\mbox{controlChemoB}})</span><span class="co">]</span>$$</span>
<span id="cb78-823"><a href="#cb78-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-824"><a href="#cb78-824" aria-hidden="true" tabindex="-1"></a>$$ \Leftrightarrow \delta_{\mbox{effectChemoA}}  =</span>
<span id="cb78-825"><a href="#cb78-825" aria-hidden="true" tabindex="-1"></a>\delta_{\mbox{effectAvg}} + \delta_{\mbox{effect}}$$</span>
<span id="cb78-826"><a href="#cb78-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-827"><a href="#cb78-827" aria-hidden="true" tabindex="-1"></a>$$ \Leftrightarrow \delta_{\mbox{effectChemoB}}  = \delta_{\mbox{effectAvg}} - \delta_{\mbox{effect}}$$</span>
<span id="cb78-828"><a href="#cb78-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-829"><a href="#cb78-829" aria-hidden="true" tabindex="-1"></a><span class="in">`R`</span> requires to define the inverse relationship, i.e. the mapping from</span>
<span id="cb78-830"><a href="#cb78-830" aria-hidden="true" tabindex="-1"></a>parameters to data strata (as needed to define the design</span>
<span id="cb78-831"><a href="#cb78-831" aria-hidden="true" tabindex="-1"></a>matrix). Therefore, the contrast matrix $C$ is:</span>
<span id="cb78-832"><a href="#cb78-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-835"><a href="#cb78-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-836"><a href="#cb78-836" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">solve</span>(cc_inv)</span>
<span id="cb78-837"><a href="#cb78-837" aria-hidden="true" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(cc)</span>
<span id="cb78-838"><a href="#cb78-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-839"><a href="#cb78-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-840"><a href="#cb78-840" aria-hidden="true" tabindex="-1"></a>In order to setup custom contrasts of discrete explanatory variables</span>
<span id="cb78-841"><a href="#cb78-841" aria-hidden="true" tabindex="-1"></a>like treatment arms, <span class="in">`R`</span> requires to define the explanatory variable</span>
<span id="cb78-842"><a href="#cb78-842" aria-hidden="true" tabindex="-1"></a>as <span class="in">`factor`</span>, which has been defined accordingly in the simulation</span>
<span id="cb78-843"><a href="#cb78-843" aria-hidden="true" tabindex="-1"></a>routine of this case study:</span>
<span id="cb78-844"><a href="#cb78-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-847"><a href="#cb78-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-848"><a href="#cb78-848" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sim<span class="sc">$</span>arm)</span>
<span id="cb78-849"><a href="#cb78-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-850"><a href="#cb78-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-851"><a href="#cb78-851" aria-hidden="true" tabindex="-1"></a>As <span class="in">`R`</span> sets up the overall intercept separatley, we need to drop the</span>
<span id="cb78-852"><a href="#cb78-852" aria-hidden="true" tabindex="-1"></a>overall intercept definition from $C$ and define the contrast of the</span>
<span id="cb78-853"><a href="#cb78-853" aria-hidden="true" tabindex="-1"></a><span class="in">`factor`</span> variable to be equal to the matrix $C$:</span>
<span id="cb78-854"><a href="#cb78-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-857"><a href="#cb78-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-858"><a href="#cb78-858" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(sim<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb78-859"><a href="#cb78-859" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-860"><a href="#cb78-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-861"><a href="#cb78-861" aria-hidden="true" tabindex="-1"></a>Then to check if the contrasts work as expected, we can use a dummy</span>
<span id="cb78-862"><a href="#cb78-862" aria-hidden="true" tabindex="-1"></a>fit to see if things get used correctly and the results here are</span>
<span id="cb78-863"><a href="#cb78-863" aria-hidden="true" tabindex="-1"></a>consistent with our definitions:</span>
<span id="cb78-864"><a href="#cb78-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-865"><a href="#cb78-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r contrast check}</span></span>
<span id="cb78-866"><a href="#cb78-866" aria-hidden="true" tabindex="-1"></a>lfit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, sim)</span>
<span id="cb78-867"><a href="#cb78-867" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lfit1)</span>
<span id="cb78-868"><a href="#cb78-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-869"><a href="#cb78-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-870"><a href="#cb78-870" aria-hidden="true" tabindex="-1"></a>We can see that above model specification for <span class="in">`lm`</span> estimates the</span>
<span id="cb78-871"><a href="#cb78-871" aria-hidden="true" tabindex="-1"></a>parameter coefficient for the three contrasts <span class="in">`armdeltaEffectAvg`</span></span>
<span id="cb78-872"><a href="#cb78-872" aria-hidden="true" tabindex="-1"></a>($\delta_{\mbox{EffectAvg}}$), <span class="in">`armdeltaEffect`</span> ($\delta_{\mbox{effect}}$)</span>
<span id="cb78-873"><a href="#cb78-873" aria-hidden="true" tabindex="-1"></a>and <span class="in">`armdeltaControl`</span> ($\delta_{\mbox{control}}$).</span>
<span id="cb78-874"><a href="#cb78-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-875"><a href="#cb78-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-876"><a href="#cb78-876" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model fit with `brms`</span></span>
<span id="cb78-877"><a href="#cb78-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-878"><a href="#cb78-878" aria-hidden="true" tabindex="-1"></a>Now we start with analyzing the simulated randomized study and specify</span>
<span id="cb78-879"><a href="#cb78-879" aria-hidden="true" tabindex="-1"></a>the <span class="in">`brms`</span> model using a Weibull distribution. In a first version, we</span>
<span id="cb78-880"><a href="#cb78-880" aria-hidden="true" tabindex="-1"></a>do not include the literature historical data which requires the</span>
<span id="cb78-881"><a href="#cb78-881" aria-hidden="true" tabindex="-1"></a>definition of a custom design matrix as will be explained below.</span>
<span id="cb78-882"><a href="#cb78-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-883"><a href="#cb78-883" aria-hidden="true" tabindex="-1"></a>First we define with a call to <span class="in">`bf`</span> the model formula and model</span>
<span id="cb78-884"><a href="#cb78-884" aria-hidden="true" tabindex="-1"></a>family. This defines the model's likelihood and the parametrization.</span>
<span id="cb78-885"><a href="#cb78-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-886"><a href="#cb78-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brms model}</span></span>
<span id="cb78-887"><a href="#cb78-887" aria-hidden="true" tabindex="-1"></a>model_weibull <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb78-888"><a href="#cb78-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-889"><a href="#cb78-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-890"><a href="#cb78-890" aria-hidden="true" tabindex="-1"></a> The left hand side of the formula, <span class="in">`y | cens(1-event) ~ ...`</span>, denotes</span>
<span id="cb78-891"><a href="#cb78-891" aria-hidden="true" tabindex="-1"></a>with $y$ the data being modeled</span>
<span id="cb78-892"><a href="#cb78-892" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the time variable -, while <span class="in">`cens`</span> is a response modifier added with</span>
<span id="cb78-893"><a href="#cb78-893" aria-hidden="true" tabindex="-1"></a>a vertical bar<span class="in">`|`</span> to the left hand side. Here, <span class="in">`cens`</span> defines which</span>
<span id="cb78-894"><a href="#cb78-894" aria-hidden="true" tabindex="-1"></a>data rows correspond to (right) censored observations. The censoring</span>
<span id="cb78-895"><a href="#cb78-895" aria-hidden="true" tabindex="-1"></a>information is passed into <span class="in">`cens`</span> by the variable <span class="in">`1-event`</span>. The right</span>
<span id="cb78-896"><a href="#cb78-896" aria-hidden="true" tabindex="-1"></a>hand side defines the linear regressor formula used for the mean</span>
<span id="cb78-897"><a href="#cb78-897" aria-hidden="true" tabindex="-1"></a>parameter of the model, which is in this case modeled by default with</span>
<span id="cb78-898"><a href="#cb78-898" aria-hidden="true" tabindex="-1"></a>a $\log$ link function.  The formula <span class="in">`1 + arm`</span> defines an overall</span>
<span id="cb78-899"><a href="#cb78-899" aria-hidden="true" tabindex="-1"></a>intercept and the covariate <span class="in">`arm`</span> (coded as <span class="in">`factor`</span> in the data) is</span>
<span id="cb78-900"><a href="#cb78-900" aria-hidden="true" tabindex="-1"></a>used with it's custom constrasts as explanatory variable. Finally, the</span>
<span id="cb78-901"><a href="#cb78-901" aria-hidden="true" tabindex="-1"></a><span class="in">`family`</span> argument specifies that the event and censoring times stored</span>
<span id="cb78-902"><a href="#cb78-902" aria-hidden="true" tabindex="-1"></a>in $y$ are distributed according to a <span class="in">`weibull`</span> probability density</span>
<span id="cb78-903"><a href="#cb78-903" aria-hidden="true" tabindex="-1"></a>distribution.</span>
<span id="cb78-904"><a href="#cb78-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-905"><a href="#cb78-905" aria-hidden="true" tabindex="-1"></a>With the model (and data) being defined, we are left to specify the</span>
<span id="cb78-906"><a href="#cb78-906" aria-hidden="true" tabindex="-1"></a>priors for the model. With the help of the <span class="in">`get_prior`</span> function we can</span>
<span id="cb78-907"><a href="#cb78-907" aria-hidden="true" tabindex="-1"></a>report which default priors and parameters were instantiated by <span class="in">`brms`</span></span>
<span id="cb78-908"><a href="#cb78-908" aria-hidden="true" tabindex="-1"></a>and hence need an assignment of a prior.</span>
<span id="cb78-909"><a href="#cb78-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-912"><a href="#cb78-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-913"><a href="#cb78-913" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_weibull, sim))</span>
<span id="cb78-914"><a href="#cb78-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-915"><a href="#cb78-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-916"><a href="#cb78-916" aria-hidden="true" tabindex="-1"></a>Here we define the priors with standard deviations stored in</span>
<span id="cb78-917"><a href="#cb78-917" aria-hidden="true" tabindex="-1"></a>variables, which are passed as <span class="in">`stanvars`</span> to the <span class="in">`brms`</span> model. Doing</span>
<span id="cb78-918"><a href="#cb78-918" aria-hidden="true" tabindex="-1"></a>so allows to change the prior quickly, since the Stan model as</span>
<span id="cb78-919"><a href="#cb78-919" aria-hidden="true" tabindex="-1"></a>generated by <span class="in">`brms`</span> </span>
<span id="cb78-920"><a href="#cb78-920" aria-hidden="true" tabindex="-1"></a>remains unchanged whenever the standard deviation of a prior is</span>
<span id="cb78-921"><a href="#cb78-921" aria-hidden="true" tabindex="-1"></a>changed. A priori it is expected that the outcome</span>
<span id="cb78-922"><a href="#cb78-922" aria-hidden="true" tabindex="-1"></a>for the two control groups will be similar, so the prior on</span>
<span id="cb78-923"><a href="#cb78-923" aria-hidden="true" tabindex="-1"></a><span class="in">`deltaControl`</span> ($\delta_{\mbox{control}}$)</span>
<span id="cb78-924"><a href="#cb78-924" aria-hidden="true" tabindex="-1"></a>is centered on $0$. The same is a priori assumed for the <span class="in">`deltaEffect`</span></span>
<span id="cb78-925"><a href="#cb78-925" aria-hidden="true" tabindex="-1"></a>($\delta_{\mbox{effect}}$) parameter. </span>
<span id="cb78-926"><a href="#cb78-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-929"><a href="#cb78-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-930"><a href="#cb78-930" aria-hidden="true" tabindex="-1"></a>model_weibull_prior <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(meanInter, <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>),</span>
<span id="cb78-931"><a href="#cb78-931" aria-hidden="true" tabindex="-1"></a>                             <span class="at">class=</span><span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb78-932"><a href="#cb78-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdEffectAvg), <span class="at">coef=</span>armdeltaEffectAvg) <span class="sc">+</span></span>
<span id="cb78-933"><a href="#cb78-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaEffect), <span class="at">coef=</span>armdeltaEffect) <span class="sc">+</span></span>
<span id="cb78-934"><a href="#cb78-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaControl), <span class="at">coef=</span>armdeltaControl) <span class="sc">+</span></span>
<span id="cb78-935"><a href="#cb78-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="dv">3</span>, <span class="fl">2.7</span>), <span class="at">class=</span>shape)</span>
<span id="cb78-936"><a href="#cb78-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-937"><a href="#cb78-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-938"><a href="#cb78-938" aria-hidden="true" tabindex="-1"></a>The prior for the intercept, $\gamma$, is set to a mean approximately</span>
<span id="cb78-939"><a href="#cb78-939" aria-hidden="true" tabindex="-1"></a>corresponding to an expected median PFS on anti-PD-1 + SoC, as estimated</span>
<span id="cb78-940"><a href="#cb78-940" aria-hidden="true" tabindex="-1"></a>from CheckMate 649 (here 8 month)</span>
<span id="cb78-941"><a href="#cb78-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-944"><a href="#cb78-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-945"><a href="#cb78-945" aria-hidden="true" tabindex="-1"></a>prior_mean <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="dv">8</span><span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)), <span class="st">"meanInter"</span>)</span>
<span id="cb78-946"><a href="#cb78-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-947"><a href="#cb78-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-948"><a href="#cb78-948" aria-hidden="true" tabindex="-1"></a>The standard deviations are setup with reference to a $90 \%$ credible</span>
<span id="cb78-949"><a href="#cb78-949" aria-hidden="true" tabindex="-1"></a>interval. Hence, $log(2)/1.64$ for the standard deviation of the prior</span>
<span id="cb78-950"><a href="#cb78-950" aria-hidden="true" tabindex="-1"></a>for <span class="in">`deltaEffectAvg`</span> ($\delta_{\mbox{effectAvg}}$) means that the event</span>
<span id="cb78-951"><a href="#cb78-951" aria-hidden="true" tabindex="-1"></a>process can increase/decrease in progression speed by a factor of $2$</span>
<span id="cb78-952"><a href="#cb78-952" aria-hidden="true" tabindex="-1"></a>at most.</span>
<span id="cb78-953"><a href="#cb78-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-956"><a href="#cb78-956" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-957"><a href="#cb78-957" aria-hidden="true" tabindex="-1"></a>prior_sd <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="dv">2</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdEffectAvg"</span>) <span class="sc">+</span></span>
<span id="cb78-958"><a href="#cb78-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.25</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdDeltaEffect"</span>)<span class="sc">+</span></span>
<span id="cb78-959"><a href="#cb78-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.25</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdDeltaControl"</span>)</span>
<span id="cb78-960"><a href="#cb78-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-961"><a href="#cb78-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-962"><a href="#cb78-962" aria-hidden="true" tabindex="-1"></a>Now the model and prior specifications are complete and we are ready</span>
<span id="cb78-963"><a href="#cb78-963" aria-hidden="true" tabindex="-1"></a>to run the model in <span class="in">`brms`</span>. First fit the model using the</span>
<span id="cb78-964"><a href="#cb78-964" aria-hidden="true" tabindex="-1"></a>randomized study data</span>
<span id="cb78-965"><a href="#cb78-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-966"><a href="#cb78-966" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit_weibull}</span></span>
<span id="cb78-967"><a href="#cb78-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb78-968"><a href="#cb78-968" aria-hidden="true" tabindex="-1"></a>fit_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_weibull, <span class="at">data=</span>sim, <span class="at">prior=</span>model_weibull_prior,</span>
<span id="cb78-969"><a href="#cb78-969" aria-hidden="true" tabindex="-1"></a>               <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean,</span>
<span id="cb78-970"><a href="#cb78-970" aria-hidden="true" tabindex="-1"></a>               <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-971"><a href="#cb78-971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-972"><a href="#cb78-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-973"><a href="#cb78-973" aria-hidden="true" tabindex="-1"></a>When looking at the model summary, it is preferable to use <span class="in">`robust=TRUE`</span> </span>
<span id="cb78-974"><a href="#cb78-974" aria-hidden="true" tabindex="-1"></a>to get the median estimate of the posterior rather than the mean (which</span>
<span id="cb78-975"><a href="#cb78-975" aria-hidden="true" tabindex="-1"></a>would change due to transforms)</span>
<span id="cb78-976"><a href="#cb78-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-979"><a href="#cb78-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-980"><a href="#cb78-980" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-981"><a href="#cb78-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-982"><a href="#cb78-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-983"><a href="#cb78-983" aria-hidden="true" tabindex="-1"></a>Summarize posterior draws based on point estimates, estimation errors</span>
<span id="cb78-984"><a href="#cb78-984" aria-hidden="true" tabindex="-1"></a>and quantiles. And we transform the estimates to the original scale</span>
<span id="cb78-985"><a href="#cb78-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-988"><a href="#cb78-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-989"><a href="#cb78-989" aria-hidden="true" tabindex="-1"></a>post_sum <span class="ot">&lt;-</span> <span class="fu">posterior_summary</span>(fit_weibull, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-990"><a href="#cb78-990" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">exp</span>(post_sum[,<span class="st">"Estimate"</span>]), <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb78-991"><a href="#cb78-991" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-992"><a href="#cb78-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-993"><a href="#cb78-993" aria-hidden="true" tabindex="-1"></a>These estimates are the AFT regression coefficients such that the</span>
<span id="cb78-994"><a href="#cb78-994" aria-hidden="true" tabindex="-1"></a>effect of treatment is to *slowdown* the time to an event and thus the</span>
<span id="cb78-995"><a href="#cb78-995" aria-hidden="true" tabindex="-1"></a>treatment effect estimate $\delta_{\mbox{effectAvg}}$ is positive. To</span>
<span id="cb78-996"><a href="#cb78-996" aria-hidden="true" tabindex="-1"></a>convert to hazard ratios, one needs to multiply with the negative of</span>
<span id="cb78-997"><a href="#cb78-997" aria-hidden="true" tabindex="-1"></a>the estimated shape parameter. Doing so for all 3 regression</span>
<span id="cb78-998"><a href="#cb78-998" aria-hidden="true" tabindex="-1"></a>coefficients by using the <span class="in">`rvar`</span> facility (provided from the</span>
<span id="cb78-999"><a href="#cb78-999" aria-hidden="true" tabindex="-1"></a><span class="in">`posterior`</span> R package) yields:</span>
<span id="cb78-1000"><a href="#cb78-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1003"><a href="#cb78-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1004"><a href="#cb78-1004" aria-hidden="true" tabindex="-1"></a>post_rv <span class="ot">&lt;-</span> <span class="fu">as_draws_rvars</span>(fit_weibull)</span>
<span id="cb78-1005"><a href="#cb78-1005" aria-hidden="true" tabindex="-1"></a>post_rv_HR <span class="ot">&lt;-</span> <span class="fu">with</span>(post_rv, <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> shape <span class="sc">*</span> <span class="fu">c</span>(b_armdeltaEffectAvg, b_armdeltaEffect, b_armdeltaControl)))</span>
<span id="cb78-1006"><a href="#cb78-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(post_rv_HR) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"deltaEffectAvg"</span>, <span class="st">"deltaEffect"</span>, <span class="st">"deltaControl"</span>)</span>
<span id="cb78-1007"><a href="#cb78-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_draws</span>(post_rv_HR), <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb78-1008"><a href="#cb78-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1009"><a href="#cb78-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1010"><a href="#cb78-1010" aria-hidden="true" tabindex="-1"></a>Obtain posterior mean estimates (mean rate). Median of the posterior</span>
<span id="cb78-1011"><a href="#cb78-1011" aria-hidden="true" tabindex="-1"></a>estimates indicated a roughly 20% increase in survival in <span class="in">`activeChemoA`</span></span>
<span id="cb78-1012"><a href="#cb78-1012" aria-hidden="true" tabindex="-1"></a>compared to <span class="in">`controlChemoA`</span>.</span>
<span id="cb78-1013"><a href="#cb78-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1014"><a href="#cb78-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1017"><a href="#cb78-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1018"><a href="#cb78-1018" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span><span class="dv">0</span>, <span class="at">event=</span><span class="dv">0</span>, <span class="at">arm=</span><span class="fu">levels</span>(sim<span class="sc">$</span>arm))</span>
<span id="cb78-1019"><a href="#cb78-1019" aria-hidden="true" tabindex="-1"></a>post_mean <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_weibull, <span class="at">newdata=</span>nd)</span>
<span id="cb78-1020"><a href="#cb78-1020" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(post_mean) <span class="ot">&lt;-</span> nd<span class="sc">$</span>arm</span>
<span id="cb78-1021"><a href="#cb78-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(post_mean[,<span class="st">"activeChemoA"</span>] <span class="sc">/</span> post_mean[,<span class="st">"controlChemoA"</span>],</span>
<span id="cb78-1022"><a href="#cb78-1022" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb78-1023"><a href="#cb78-1023" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1024"><a href="#cb78-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1025"><a href="#cb78-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1026"><a href="#cb78-1026" aria-hidden="true" tabindex="-1"></a>Now extract posterior coefficients with a 90% credible interval</span>
<span id="cb78-1027"><a href="#cb78-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1030"><a href="#cb78-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1031"><a href="#cb78-1031" aria-hidden="true" tabindex="-1"></a>post_est <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit_weibull, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-1032"><a href="#cb78-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">as.data.frame</span>(post_est)) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">everything</span>(), <span class="at">decimals=</span><span class="dv">2</span>)</span>
<span id="cb78-1033"><a href="#cb78-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1034"><a href="#cb78-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1035"><a href="#cb78-1035" aria-hidden="true" tabindex="-1"></a>Define trial successfull if the <span class="in">`deltaEffectAvg`</span> exceed 0 (which means</span>
<span id="cb78-1036"><a href="#cb78-1036" aria-hidden="true" tabindex="-1"></a>the survival time is increased) and the result is not </span>
<span id="cb78-1037"><a href="#cb78-1037" aria-hidden="true" tabindex="-1"></a>significant here.</span>
<span id="cb78-1038"><a href="#cb78-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1041"><a href="#cb78-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1042"><a href="#cb78-1042" aria-hidden="true" tabindex="-1"></a>post_est[<span class="st">"armdeltaEffectAvg"</span>,<span class="st">"Q5"</span>] <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb78-1043"><a href="#cb78-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1044"><a href="#cb78-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1045"><a href="#cb78-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1046"><a href="#cb78-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">### Incoporate simulated historical data</span></span>
<span id="cb78-1047"><a href="#cb78-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1048"><a href="#cb78-1048" aria-hidden="true" tabindex="-1"></a>Since we have the simulated historical data <span class="in">`hist1`</span> on one control</span>
<span id="cb78-1049"><a href="#cb78-1049" aria-hidden="true" tabindex="-1"></a>arm, we can incorporate the information by adding the corresponding</span>
<span id="cb78-1050"><a href="#cb78-1050" aria-hidden="true" tabindex="-1"></a>covariate <span class="in">`hist1`</span> (indicator variable being $1$ for the historical</span>
<span id="cb78-1051"><a href="#cb78-1051" aria-hidden="true" tabindex="-1"></a>study and $0$ otherwise) when specifying the formula for</span>
<span id="cb78-1052"><a href="#cb78-1052" aria-hidden="true" tabindex="-1"></a>meta-analytic-combined (MAC) analysis:</span>
<span id="cb78-1053"><a href="#cb78-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1056"><a href="#cb78-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1057"><a href="#cb78-1057" aria-hidden="true" tabindex="-1"></a>model_mac_weibull <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm <span class="sc">+</span> hist1, <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb78-1058"><a href="#cb78-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1059"><a href="#cb78-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1060"><a href="#cb78-1060" aria-hidden="true" tabindex="-1"></a>And <span class="in">`get_prior`</span> function shows that in addition to the priors</span>
<span id="cb78-1061"><a href="#cb78-1061" aria-hidden="true" tabindex="-1"></a>for the weibull model on randomised data, the co-data model needs</span>
<span id="cb78-1062"><a href="#cb78-1062" aria-hidden="true" tabindex="-1"></a>one more prior on the historical data.</span>
<span id="cb78-1063"><a href="#cb78-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1066"><a href="#cb78-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1067"><a href="#cb78-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_mac_weibull, sim))</span>
<span id="cb78-1068"><a href="#cb78-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1069"><a href="#cb78-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1070"><a href="#cb78-1070" aria-hidden="true" tabindex="-1"></a>We use a student with 6 degrees of freedom for the regression</span>
<span id="cb78-1071"><a href="#cb78-1071" aria-hidden="true" tabindex="-1"></a>coefficient for the historical data prior. Using a Student-t</span>
<span id="cb78-1072"><a href="#cb78-1072" aria-hidden="true" tabindex="-1"></a>distribution robustifies against possible data discordance between the</span>
<span id="cb78-1073"><a href="#cb78-1073" aria-hidden="true" tabindex="-1"></a>randomised study and the historical data, since very large deviations</span>
<span id="cb78-1074"><a href="#cb78-1074" aria-hidden="true" tabindex="-1"></a>between the two data sets are admitted by the heavy tails of the</span>
<span id="cb78-1075"><a href="#cb78-1075" aria-hidden="true" tabindex="-1"></a>prior. The prior is centered at a mean of $0$, corresponding to no</span>
<span id="cb78-1076"><a href="#cb78-1076" aria-hidden="true" tabindex="-1"></a>expected difference in the outcome for historical and current study.</span>
<span id="cb78-1077"><a href="#cb78-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1080"><a href="#cb78-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1081"><a href="#cb78-1081" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior <span class="ot">&lt;-</span> model_weibull_prior <span class="sc">+</span></span>
<span id="cb78-1082"><a href="#cb78-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">6</span>, <span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist1)</span>
<span id="cb78-1083"><a href="#cb78-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1084"><a href="#cb78-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1085"><a href="#cb78-1085" aria-hidden="true" tabindex="-1"></a>A variance allowing substantial differences, a $1.8$ fold of</span>
<span id="cb78-1086"><a href="#cb78-1086" aria-hidden="true" tabindex="-1"></a>increase/decrease, between the randomised study and historical data is</span>
<span id="cb78-1087"><a href="#cb78-1087" aria-hidden="true" tabindex="-1"></a>set.</span>
<span id="cb78-1088"><a href="#cb78-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1091"><a href="#cb78-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1092"><a href="#cb78-1092" aria-hidden="true" tabindex="-1"></a>prior_sdHist <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="fu">log</span>(<span class="fl">1.8</span>)<span class="sc">/</span><span class="fl">1.64</span>, <span class="st">"sdHist"</span>)</span>
<span id="cb78-1093"><a href="#cb78-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1094"><a href="#cb78-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1095"><a href="#cb78-1095" aria-hidden="true" tabindex="-1"></a>Now we combine the simulated trial data and historical data to fit</span>
<span id="cb78-1096"><a href="#cb78-1096" aria-hidden="true" tabindex="-1"></a>the co-data MAC model. Don't forget to set contrasts of arm in the</span>
<span id="cb78-1097"><a href="#cb78-1097" aria-hidden="true" tabindex="-1"></a>combined data to the contrast matrix.</span>
<span id="cb78-1098"><a href="#cb78-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1101"><a href="#cb78-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1102"><a href="#cb78-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb78-1103"><a href="#cb78-1103" aria-hidden="true" tabindex="-1"></a>comb_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sim, hdata1)</span>
<span id="cb78-1104"><a href="#cb78-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(comb_data<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb78-1105"><a href="#cb78-1105" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull, <span class="at">data=</span>comb_data,</span>
<span id="cb78-1106"><a href="#cb78-1106" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prior=</span>model_weibull_mac_prior,</span>
<span id="cb78-1107"><a href="#cb78-1107" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb78-1108"><a href="#cb78-1108" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-1109"><a href="#cb78-1109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1110"><a href="#cb78-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1111"><a href="#cb78-1111" aria-hidden="true" tabindex="-1"></a>And we can compare the results from two models. Inclusion of</span>
<span id="cb78-1112"><a href="#cb78-1112" aria-hidden="true" tabindex="-1"></a>historical data on <span class="in">`controlChemoA`</span> affect the estimates of</span>
<span id="cb78-1113"><a href="#cb78-1113" aria-hidden="true" tabindex="-1"></a>coefficients for overall mean and <span class="in">`EffectAverage`</span>.</span>
<span id="cb78-1114"><a href="#cb78-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1117"><a href="#cb78-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1118"><a href="#cb78-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-1119"><a href="#cb78-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-1120"><a href="#cb78-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1121"><a href="#cb78-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1122"><a href="#cb78-1122" aria-hidden="true" tabindex="-1"></a>Next, we check the informativeness of the historical data by only</span>
<span id="cb78-1123"><a href="#cb78-1123" aria-hidden="true" tabindex="-1"></a>including the historical data. Note that we have to request that</span>
<span id="cb78-1124"><a href="#cb78-1124" aria-hidden="true" tabindex="-1"></a>factor levels for which no realization is present in the data set must</span>
<span id="cb78-1125"><a href="#cb78-1125" aria-hidden="true" tabindex="-1"></a>be kept, since only the <span class="in">`controlChemoA`</span> arm is present in the</span>
<span id="cb78-1126"><a href="#cb78-1126" aria-hidden="true" tabindex="-1"></a>historical data.</span>
<span id="cb78-1127"><a href="#cb78-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1130"><a href="#cb78-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1131"><a href="#cb78-1131" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb78-1132"><a href="#cb78-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(hdata1<span class="sc">$</span>arm) <span class="ot">&lt;-</span> cc[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb78-1133"><a href="#cb78-1133" aria-hidden="true" tabindex="-1"></a>fit_mac_prior_weibull <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull, <span class="at">data=</span>hdata1,</span>
<span id="cb78-1134"><a href="#cb78-1134" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior=</span>model_weibull_mac_prior,</span>
<span id="cb78-1135"><a href="#cb78-1135" aria-hidden="true" tabindex="-1"></a>                             <span class="at">drop_unused_levels=</span><span class="cn">FALSE</span>,</span>
<span id="cb78-1136"><a href="#cb78-1136" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb78-1137"><a href="#cb78-1137" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-1138"><a href="#cb78-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1139"><a href="#cb78-1139" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">as.data.frame</span>(<span class="fu">fixef</span>(fit_mac_prior_weibull, <span class="at">robust=</span><span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> <span class="fu">fmt_number</span>(<span class="fu">everything</span>(), <span class="at">decimals=</span><span class="dv">2</span>)</span>
<span id="cb78-1140"><a href="#cb78-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1141"><a href="#cb78-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1142"><a href="#cb78-1142" aria-hidden="true" tabindex="-1"></a>We see that we essentially sample the prior for most regression</span>
<span id="cb78-1143"><a href="#cb78-1143" aria-hidden="true" tabindex="-1"></a>coefficients, but we do substantially reduce the standard error of the</span>
<span id="cb78-1144"><a href="#cb78-1144" aria-hidden="true" tabindex="-1"></a>intercept estimate which is almost halved in comparison to the prior</span>
<span id="cb78-1145"><a href="#cb78-1145" aria-hidden="true" tabindex="-1"></a>standard deviation of <span class="in">`r round(log(4)/1.64, 2)`</span>.</span>
<span id="cb78-1146"><a href="#cb78-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1147"><a href="#cb78-1147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Including historical data of average SoC</span></span>
<span id="cb78-1148"><a href="#cb78-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1149"><a href="#cb78-1149" aria-hidden="true" tabindex="-1"></a>So far we have setup a custom parametrization allowing to define</span>
<span id="cb78-1150"><a href="#cb78-1150" aria-hidden="true" tabindex="-1"></a>priors aligned with prior expectations (small difference of the</span>
<span id="cb78-1151"><a href="#cb78-1151" aria-hidden="true" tabindex="-1"></a>treatment effect and small difference between SoC). However, the</span>
<span id="cb78-1152"><a href="#cb78-1152" aria-hidden="true" tabindex="-1"></a>CheckMate 649 historical data reports the effect of an average SoC</span>
<span id="cb78-1153"><a href="#cb78-1153" aria-hidden="true" tabindex="-1"></a>treatment. Thus, the data of CheckMate 649 is incompatible with the 4</span>
<span id="cb78-1154"><a href="#cb78-1154" aria-hidden="true" tabindex="-1"></a>defined categorical factor levels so far as it does not correspond to</span>
<span id="cb78-1155"><a href="#cb78-1155" aria-hidden="true" tabindex="-1"></a>any of the 4 treatment arms in the current data set. However, as the</span>
<span id="cb78-1156"><a href="#cb78-1156" aria-hidden="true" tabindex="-1"></a>custom factor contrasts and <span class="in">`factor`</span> level definitions are translated</span>
<span id="cb78-1157"><a href="#cb78-1157" aria-hidden="true" tabindex="-1"></a>by <span class="in">`R`</span> into a design matrix, we can customize the created design</span>
<span id="cb78-1158"><a href="#cb78-1158" aria-hidden="true" tabindex="-1"></a>matrix directly. This requires to setup the design matrix manually</span>
<span id="cb78-1159"><a href="#cb78-1159" aria-hidden="true" tabindex="-1"></a>giving us the freedom to define the design matrix appropiatley for the</span>
<span id="cb78-1160"><a href="#cb78-1160" aria-hidden="true" tabindex="-1"></a>CheckMate 649 data set.</span>
<span id="cb78-1161"><a href="#cb78-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1162"><a href="#cb78-1162" aria-hidden="true" tabindex="-1"></a>There is an alternative way to use the customized contrast and setup analysis</span>
<span id="cb78-1163"><a href="#cb78-1163" aria-hidden="true" tabindex="-1"></a>by using respective indicator flags, which is created using</span>
<span id="cb78-1164"><a href="#cb78-1164" aria-hidden="true" tabindex="-1"></a><span class="in">`model.matrix`</span>. The <span class="in">`model.matrix`</span> function is used internally by</span>
<span id="cb78-1165"><a href="#cb78-1165" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span> to create the design matrix for the regression problem</span>
<span id="cb78-1166"><a href="#cb78-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1169"><a href="#cb78-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1170"><a href="#cb78-1170" aria-hidden="true" tabindex="-1"></a>Xind <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> arm, comb_data)</span>
<span id="cb78-1171"><a href="#cb78-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_preview</span>(Xind)</span>
<span id="cb78-1172"><a href="#cb78-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1173"><a href="#cb78-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1174"><a href="#cb78-1174" aria-hidden="true" tabindex="-1"></a>By adding the generated design matrix to the original data set, we can</span>
<span id="cb78-1175"><a href="#cb78-1175" aria-hidden="true" tabindex="-1"></a>then simply delcare the model formula using these created indicator</span>
<span id="cb78-1176"><a href="#cb78-1176" aria-hidden="true" tabindex="-1"></a>variables:</span>
<span id="cb78-1177"><a href="#cb78-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1180"><a href="#cb78-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1181"><a href="#cb78-1181" aria-hidden="true" tabindex="-1"></a>comb_data_ind <span class="ot">&lt;-</span> <span class="fu">cbind</span>(comb_data, Xind[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb78-1182"><a href="#cb78-1182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1183"><a href="#cb78-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1184"><a href="#cb78-1184" aria-hidden="true" tabindex="-1"></a>Thus we use those indicator variables in the fit as if these were</span>
<span id="cb78-1185"><a href="#cb78-1185" aria-hidden="true" tabindex="-1"></a>continuous covariates which replaces the use of the categorical</span>
<span id="cb78-1186"><a href="#cb78-1186" aria-hidden="true" tabindex="-1"></a><span class="in">`factor`</span> variable <span class="in">`arm`</span> used in the first approach.</span>
<span id="cb78-1187"><a href="#cb78-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1190"><a href="#cb78-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1191"><a href="#cb78-1191" aria-hidden="true" tabindex="-1"></a>model_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> armdeltaEffectAvg <span class="sc">+</span></span>
<span id="cb78-1192"><a href="#cb78-1192" aria-hidden="true" tabindex="-1"></a>                            armdeltaEffect <span class="sc">+</span> armdeltaControl <span class="sc">+</span> hist1,</span>
<span id="cb78-1193"><a href="#cb78-1193" aria-hidden="true" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb78-1194"><a href="#cb78-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1195"><a href="#cb78-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1196"><a href="#cb78-1196" aria-hidden="true" tabindex="-1"></a>And query what prior parameters need to be set</span>
<span id="cb78-1197"><a href="#cb78-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1200"><a href="#cb78-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1201"><a href="#cb78-1201" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(<span class="fu">get_prior</span>(model_mac_weibull_ind, comb_data_ind))</span>
<span id="cb78-1202"><a href="#cb78-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1203"><a href="#cb78-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1204"><a href="#cb78-1204" aria-hidden="true" tabindex="-1"></a>Fit the model using indicator flags with the same priors as before and</span>
<span id="cb78-1205"><a href="#cb78-1205" aria-hidden="true" tabindex="-1"></a>compare with the previous one fitted with <span class="in">`arm`</span> variable, the results</span>
<span id="cb78-1206"><a href="#cb78-1206" aria-hidden="true" tabindex="-1"></a>are the same.</span>
<span id="cb78-1207"><a href="#cb78-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1210"><a href="#cb78-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1211"><a href="#cb78-1211" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb78-1212"><a href="#cb78-1212" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior_ind <span class="ot">&lt;-</span> <span class="fu">prior</span>(<span class="fu">normal</span>(meanInter, <span class="fu">log</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="fl">1.64</span>),</span>
<span id="cb78-1213"><a href="#cb78-1213" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">class=</span><span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb78-1214"><a href="#cb78-1214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdEffectAvg), <span class="at">coef=</span>armdeltaEffectAvg) <span class="sc">+</span></span>
<span id="cb78-1215"><a href="#cb78-1215" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaEffect), <span class="at">coef=</span>armdeltaEffect) <span class="sc">+</span></span>
<span id="cb78-1216"><a href="#cb78-1216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdDeltaControl), <span class="at">coef=</span>armdeltaControl) <span class="sc">+</span></span>
<span id="cb78-1217"><a href="#cb78-1217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist1)</span>
<span id="cb78-1218"><a href="#cb78-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1219"><a href="#cb78-1219" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull_ind, <span class="at">data=</span>comb_data_ind,</span>
<span id="cb78-1220"><a href="#cb78-1220" aria-hidden="true" tabindex="-1"></a>                           <span class="at">prior=</span>model_weibull_mac_prior_ind,</span>
<span id="cb78-1221"><a href="#cb78-1221" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb78-1222"><a href="#cb78-1222" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-1223"><a href="#cb78-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-1224"><a href="#cb78-1224" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mac_weibull_ind, <span class="at">prob=</span><span class="fl">0.9</span>, <span class="at">robust=</span><span class="cn">TRUE</span>)</span>
<span id="cb78-1225"><a href="#cb78-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1226"><a href="#cb78-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1227"><a href="#cb78-1227" aria-hidden="true" tabindex="-1"></a>Note that the equality holds exactly for the entire posterior, since</span>
<span id="cb78-1228"><a href="#cb78-1228" aria-hidden="true" tabindex="-1"></a>the very same problem (using the same random seed) has been fitted by</span>
<span id="cb78-1229"><a href="#cb78-1229" aria-hidden="true" tabindex="-1"></a><span class="in">`brms`</span>:</span>
<span id="cb78-1230"><a href="#cb78-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1233"><a href="#cb78-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1234"><a href="#cb78-1234" aria-hidden="true" tabindex="-1"></a>post_mac <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(fit_mac_weibull)</span>
<span id="cb78-1235"><a href="#cb78-1235" aria-hidden="true" tabindex="-1"></a>post_mac_ind <span class="ot">&lt;-</span> <span class="fu">as_draws_matrix</span>(fit_mac_weibull_ind)</span>
<span id="cb78-1236"><a href="#cb78-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(post_mac <span class="sc">==</span> post_mac_ind)</span>
<span id="cb78-1237"><a href="#cb78-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1238"><a href="#cb78-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1239"><a href="#cb78-1239" aria-hidden="true" tabindex="-1"></a>The benefit of this approach is that we can then include external data </span>
<span id="cb78-1240"><a href="#cb78-1240" aria-hidden="true" tabindex="-1"></a>corresponding to the <span class="in">`controlAverage`</span> from the second historical study</span>
<span id="cb78-1241"><a href="#cb78-1241" aria-hidden="true" tabindex="-1"></a>CheckMate 649, which is not one of the</span>
<span id="cb78-1242"><a href="#cb78-1242" aria-hidden="true" tabindex="-1"></a>treatment groups but the average effect of control groups,</span>
<span id="cb78-1243"><a href="#cb78-1243" aria-hidden="true" tabindex="-1"></a>$\frac{1}{2} \, (\lambda_{\mbox{controlChemoA}}+\lambda_{\mbox{controlChemoB}})$.</span>
<span id="cb78-1244"><a href="#cb78-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1245"><a href="#cb78-1245" aria-hidden="true" tabindex="-1"></a>To now find the indicators needed for the effect of <span class="in">`controlAverage`</span></span>
<span id="cb78-1246"><a href="#cb78-1246" aria-hidden="true" tabindex="-1"></a>in the given parametrization so far, we can obtain this via simple</span>
<span id="cb78-1247"><a href="#cb78-1247" aria-hidden="true" tabindex="-1"></a>algebra as:</span>
<span id="cb78-1248"><a href="#cb78-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1251"><a href="#cb78-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1252"><a href="#cb78-1252" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">solve</span>(cc_inv))</span>
<span id="cb78-1253"><a href="#cb78-1253" aria-hidden="true" tabindex="-1"></a>cc</span>
<span id="cb78-1254"><a href="#cb78-1254" aria-hidden="true" tabindex="-1"></a><span class="fl">0.5</span><span class="sc">*</span>(cc[<span class="st">"controlChemoA"</span>,] <span class="sc">+</span> cc[<span class="st">"controlChemoB"</span>,])</span>
<span id="cb78-1255"><a href="#cb78-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1256"><a href="#cb78-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1257"><a href="#cb78-1257" aria-hidden="true" tabindex="-1"></a>Hence we must set the <span class="in">`deltaEffectAvg`</span> column to $-\frac{1}{2}$ and the others</span>
<span id="cb78-1258"><a href="#cb78-1258" aria-hidden="true" tabindex="-1"></a>to $0$ to get the indicator for <span class="in">`controlAverage`</span> (the overall</span>
<span id="cb78-1259"><a href="#cb78-1259" aria-hidden="true" tabindex="-1"></a>intercept is always added to the linear predictor as we define <span class="in">`1`</span> as</span>
<span id="cb78-1260"><a href="#cb78-1260" aria-hidden="true" tabindex="-1"></a>the first term of the model formula) in order to</span>
<span id="cb78-1261"><a href="#cb78-1261" aria-hidden="true" tabindex="-1"></a>include the new historical data from CheckMate649.</span>
<span id="cb78-1262"><a href="#cb78-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1265"><a href="#cb78-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1266"><a href="#cb78-1266" aria-hidden="true" tabindex="-1"></a>hdata2_ind <span class="ot">&lt;-</span> <span class="fu">rename</span>(hdata2, <span class="at">y=</span>time, <span class="at">event=</span>status) <span class="sc">%&gt;%</span></span>
<span id="cb78-1267"><a href="#cb78-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hist1=</span><span class="dv">0</span>, <span class="at">hist2=</span><span class="dv">1</span>, <span class="at">armdeltaEffectAvg=</span><span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb78-1268"><a href="#cb78-1268" aria-hidden="true" tabindex="-1"></a>         <span class="at">armdeltaEffect=</span><span class="dv">0</span>, <span class="at">armdeltaControl=</span><span class="dv">0</span>)</span>
<span id="cb78-1269"><a href="#cb78-1269" aria-hidden="true" tabindex="-1"></a>all_comb_data_ind <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(comb_data_ind, hdata2_ind)</span>
<span id="cb78-1270"><a href="#cb78-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1271"><a href="#cb78-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1272"><a href="#cb78-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1273"><a href="#cb78-1273" aria-hidden="true" tabindex="-1"></a>To include the second historical data, we specify the formula and the priors</span>
<span id="cb78-1274"><a href="#cb78-1274" aria-hidden="true" tabindex="-1"></a>as we did for one historical study.</span>
<span id="cb78-1275"><a href="#cb78-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1278"><a href="#cb78-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1279"><a href="#cb78-1279" aria-hidden="true" tabindex="-1"></a>model_mac_weibull_ind_all <span class="ot">&lt;-</span> <span class="fu">bf</span>(y <span class="sc">|</span> <span class="fu">cens</span>(<span class="dv">1</span><span class="sc">-</span>event) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> armdeltaEffectAvg <span class="sc">+</span></span>
<span id="cb78-1280"><a href="#cb78-1280" aria-hidden="true" tabindex="-1"></a>                              armdeltaEffect <span class="sc">+</span> armdeltaControl <span class="sc">+</span> hist1<span class="sc">+</span> hist2,</span>
<span id="cb78-1281"><a href="#cb78-1281" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family=</span><span class="fu">weibull</span>())</span>
<span id="cb78-1282"><a href="#cb78-1282" aria-hidden="true" tabindex="-1"></a>model_weibull_mac_prior_all <span class="ot">&lt;-</span> model_weibull_mac_prior <span class="sc">+</span></span>
<span id="cb78-1283"><a href="#cb78-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, sdHist), <span class="at">coef=</span>hist2)</span>
<span id="cb78-1284"><a href="#cb78-1284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1285"><a href="#cb78-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1286"><a href="#cb78-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1287"><a href="#cb78-1287" aria-hidden="true" tabindex="-1"></a>Fit the model and compare:</span>
<span id="cb78-1288"><a href="#cb78-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1291"><a href="#cb78-1291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-1292"><a href="#cb78-1292" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: FALSE</span></span>
<span id="cb78-1293"><a href="#cb78-1293" aria-hidden="true" tabindex="-1"></a>fit_all_mac_weibull_ind <span class="ot">&lt;-</span> <span class="fu">brm</span>(model_mac_weibull_ind_all, <span class="at">data=</span>all_comb_data_ind,</span>
<span id="cb78-1294"><a href="#cb78-1294" aria-hidden="true" tabindex="-1"></a>                               <span class="at">prior=</span>model_weibull_mac_prior_all,</span>
<span id="cb78-1295"><a href="#cb78-1295" aria-hidden="true" tabindex="-1"></a>                               <span class="at">stanvars=</span>prior_sd <span class="sc">+</span> prior_mean <span class="sc">+</span> prior_sdHist,</span>
<span id="cb78-1296"><a href="#cb78-1296" aria-hidden="true" tabindex="-1"></a>                               <span class="at">seed=</span><span class="dv">43534</span>, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb78-1297"><a href="#cb78-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1298"><a href="#cb78-1298" aria-hidden="true" tabindex="-1"></a>fit_mac_weibull_ind</span>
<span id="cb78-1299"><a href="#cb78-1299" aria-hidden="true" tabindex="-1"></a>fit_all_mac_weibull_ind</span>
<span id="cb78-1300"><a href="#cb78-1300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-1301"><a href="#cb78-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1302"><a href="#cb78-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb78-1303"><a href="#cb78-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1304"><a href="#cb78-1304" aria-hidden="true" tabindex="-1"></a>Here we showed how <span class="in">`brms`</span> enabled us to model time-to-event data with</span>
<span id="cb78-1305"><a href="#cb78-1305" aria-hidden="true" tabindex="-1"></a>censoring and incorporate historical data into the analysis. By use of</span>
<span id="cb78-1306"><a href="#cb78-1306" aria-hidden="true" tabindex="-1"></a>custom contrasts we controlled the parametrization of the problem</span>
<span id="cb78-1307"><a href="#cb78-1307" aria-hidden="true" tabindex="-1"></a>allowing for the specification of priors aligned with the prior</span>
<span id="cb78-1308"><a href="#cb78-1308" aria-hidden="true" tabindex="-1"></a>knowledge. This is possible in <span class="in">`R`</span> using the <span class="in">`contrasts`</span> function to</span>
<span id="cb78-1309"><a href="#cb78-1309" aria-hidden="true" tabindex="-1"></a>setup custom contrast matrices used to setup the design matrix of the</span>
<span id="cb78-1310"><a href="#cb78-1310" aria-hidden="true" tabindex="-1"></a>model. Going beyond that we also discussed that in some situations the</span>
<span id="cb78-1311"><a href="#cb78-1311" aria-hidden="true" tabindex="-1"></a>facilities in <span class="in">`R`</span> are too limiting and a customized setup of the model</span>
<span id="cb78-1312"><a href="#cb78-1312" aria-hidden="true" tabindex="-1"></a>design matrix allows for even greater flexibility. This allowed in</span>
<span id="cb78-1313"><a href="#cb78-1313" aria-hidden="true" tabindex="-1"></a>this case study the inclusion of historical data which corresponds to</span>
<span id="cb78-1314"><a href="#cb78-1314" aria-hidden="true" tabindex="-1"></a>the average effect of standard of care.</span>
<span id="cb78-1315"><a href="#cb78-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1316"><a href="#cb78-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1317"><a href="#cb78-1317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb78-1318"><a href="#cb78-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1319"><a href="#cb78-1319" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>In <span class="in">`brms`</span> various families can be used to model time-to-event data.</span>
<span id="cb78-1320"><a href="#cb78-1320" aria-hidden="true" tabindex="-1"></a>Re-fit the model using <span class="in">`exponential`</span> distribution and compare with</span>
<span id="cb78-1321"><a href="#cb78-1321" aria-hidden="true" tabindex="-1"></a>the <span class="in">`weibull`</span> results.</span>
<span id="cb78-1322"><a href="#cb78-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-1323"><a href="#cb78-1323" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Cox regression is implemented in <span class="in">`brms`</span> using M-splines, which is a</span>
<span id="cb78-1324"><a href="#cb78-1324" aria-hidden="true" tabindex="-1"></a>very close approximation to the semi-parametric Cox model. Show that</span>
<span id="cb78-1325"><a href="#cb78-1325" aria-hidden="true" tabindex="-1"></a>the estimates for the covariate effect we get from <span class="in">`brms`</span> are quite</span>
<span id="cb78-1326"><a href="#cb78-1326" aria-hidden="true" tabindex="-1"></a>similar to what we get from <span class="in">`survival`</span> package. Also compare the</span>
<span id="cb78-1327"><a href="#cb78-1327" aria-hidden="true" tabindex="-1"></a>estimate of the overall intercept which needs to account for an offset</span>
<span id="cb78-1328"><a href="#cb78-1328" aria-hidden="true" tabindex="-1"></a>as detailled in section \@ref(sec:tte-model-brms). </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Novartis/bamdd/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>